保护网络免受攻击和未经授权的访问是任何体系结构的重要部分。 在这里, 我们将了解网络安全的外观、如何将分层方法集成到您的体系结构中, 以及 Azure 如何帮助您为您的环境提供网络安全。

## <a name="a-layered-approach-to-network-security"></a>网络安全的分层方法

您可能已经注意到, 本模块中的一个常用主题是强调安全性的分层方法, 这在网络层中没有什么不同。 仅专注于保护网络外围, 或将重点放在网络内的服务之间的网络安全上是不够的。 分层方法提供了多个级别的保护, 因此, 如果攻击者通过一个层, 则有进一步的保护来限制进一步的攻击。

让我们来看看 Azure 如何为分层方法提供用于保护网络空间的工具。

:::row:::
  :::column:::
    ![表示安全 internet 的图像](../media/5-internet-protection.png)
  :::column-end:::
    :::column span="3"::::
**Internet 保护**

如果我们在网络外围启动, 我们将重点介绍如何限制和消除来自 internet 的攻击。 我们建议首先评估面向 internet 的资源, 并在必要时仅允许入站和出站通信。 确保您确定所有允许任何类型的入站网络流量的资源, 然后确保它们仅限于所需的端口和协议。 Azure 安全中心是查找此信息的理想位置, 因为它将识别没有关联的网络安全组的面向 internet 的资源, 以及在_防火墙_后面不受保护的资源。

:::column-end:::
:::row-end:::

### <a name="what-is-a-firewall"></a>什么是防火墙？
防火墙是一项服务, 它基于每个请求的原始 IP 地址授予服务器访问权限。 创建用于指定 IP 地址范围的防火墙规则。 仅允许来自这些已授予 IP 地址的客户端访问服务器。 通常情况下, 防火墙规则还包括特定网络协议和端口信息。

若要在外围提供入站保护, 您有多种选择。

- **Azure 防火墙**是一个基于云的托管网络安全服务, 可保护你的 Azure 虚拟网络资源。 它是一种具有内置高可用性和无限制云可伸缩性的服务的完全有状态的防火墙。 Azure 防火墙为非 HTTP/S 协议提供入站保护。 非 HTTP/S 协议的示例包括: 远程桌面协议 (RDP)、安全命令行管理程序 (SSH) 和文件传输协议 (FTP)。 此外, 它还为所有端口和协议提供出站、网络级保护和出站 HTTP/S 的应用程序级别的保护。

- **Azure 应用程序网关**是一个负载平衡器, 其中包含一个 Web 应用程序防火墙 (WAF), 可提供对网站中常见的已知漏洞的保护。 它专为保护 HTTP 流量而设计。

- **网络虚拟设备 (NVAs)** 是用于非 HTTP 服务或高级配置的理想选项, 类似于硬件防火墙设备。

### <a name="stopping-distributed-denial-of-service-ddos-attacks"></a>停止分布式拒绝服务 (DDos) 攻击

internet 上公开的任何资源都存在受到拒绝服务攻击的风险。 这些类型的攻击试图通过发送这么多请求资源变慢或不响应, 从而导致网络资源严重不足。 

将**Azure DDoS 保护**与应用程序设计最佳实践结合使用时, 可帮助提供针对 DDoS 攻击的防御。 DDoS 保护利用 Microsoft 的全球网络的规模和弹性为每个 Azure 区域引入 DDoS 缓解能力。 azure DDoS 保护服务通过在 azure 网络边缘擦除流量来保护你的 azure 应用程序, 然后它会影响你的服务的可用性。 在几分钟的攻击检测中, 您会收到使用 Azure Monitor 指标的通知。

此图显示了从客户和攻击者流入到 Azure 中的网络流量。 Azure DDoS 保护识别攻击者对网络负担严重的尝试, 并阻止来自 Azure 服务的进一步流量。 来自客户的合法流量仍将流入 Azure, 而不会中断任何服务。

![显示在虚拟网络和外部用户请求之间安装了 Azure DDoS 保护的说明。 Azure DDoS 保护会阻止恶意流量攻击, 但会将合法流量转发到预期的目标。](../media/ddos.png)

Azure DDoS 保护提供以下服务层:

- **vba.** 基本服务层将自动启用为 Azure 平台的一部分。 实时流量监控和实时网络级攻击的实时缓解措施提供 Microsoft 在线服务使用的相同防护。 Azure 的全局网络用于跨区域分发和缓解攻击流量。
- **普通.** 标准服务层提供了专门针对 Microsoft Azure 虚拟网络资源进行优化的其他缓解功能。 DDoS 保护标准易于启用且无需更改应用程序。 通过专用的流量监控和机器学习算法来优化保护策略。 策略应用于与虚拟网络 (如 Azure 负载平衡器和应用程序网关) 中部署的资源相关联的公用 IP 地址。 DDoS 标准保护可缓解以下类型的攻击:
    - Volumetric 攻击。 攻击者的目标是使用大量看似合法的流量淹没网络层。
    - 协议攻击。 这些攻击导致无法访问目标, 方法是利用第3层和第4层协议堆栈中的弱点。
    - 资源 (应用程序) 层攻击。 这些攻击将目标 web 应用程序数据包, 以中断主机之间的数据传输。

## <a name="controlling-the-traffic-inside-your-virtual-network"></a>控制虚拟网络内的流量

:::row:::
  :::column:::
    ![表示安全虚拟网络的图像](../media/5-vnet-security.png)
  :::column-end:::
    :::column span="3"::::
**虚拟网络安全**

在虚拟网络 (VNet) 中, 将资源之间的通信限制为仅需要的内容, 这一点非常重要。

对于虚拟机之间的通信,_网络安全组_(NSGs) 是限制不必要的通信的关键部分。 
 :::column-end:::
:::row-end:::

通过网络安全组, 可以筛选与 azure 虚拟网络中的 azure 资源之间的网络通信。 NSG 可以包含多个入站和出站安全规则, 这些规则使您能够按源和目标 IP 地址、端口和协议筛选出进出资源的流量。 它们提供了与网络接口和子网之间允许和拒绝的通信的列表, 并可完全自定义。

您可以通过限制对服务终结点的访问来完全删除对您的服务的公共 internet 访问。 借助服务终结点, 可以将 Azure 服务访问限制到你的虚拟网络。

:::row:::
  :::column:::
    ![表示安全网络的图像](../media/5-network-integration.png)
  :::column-end:::
    :::column span="3"::::
**网络集成**

通常需要集成现有网络基础结构以提供来自本地网络的通信, 或在 Azure 中提供服务之间的改进通信。 有几种主要方法可以处理这种集成并提高网络安全性。

 :::column-end:::
:::row-end:::

虚拟专用网络 (VPN) 连接是在网络之间建立安全通信通道的常用方法。 azure 虚拟网络和本地 VPN 设备之间的连接是在网络和 Azure 上的 VNet 之间提供安全通信的绝佳方式。

若要在网络和 Azure 之间提供专用的专用连接, 可以使用 Azure ExpressRoute。 ExpressRoute 允许你通过连接提供程序加速的专用连接将本地网络扩展到 Microsoft 云。 使用 ExpressRoute, 可以建立与 microsoft 云服务 (如 microsoft Azure、Office 365 和 Dynamics 365) 的连接。 这将通过使用专用线路而不是通过 internet 发送此流量来提高本地通信的安全性。 您无需通过 internet 允许最终用户访问这些服务, 并且可以通过设备发送此流量以进行进一步的流量检查。

## <a name="summary"></a>摘要

网络安全的分层方法有助于降低通过基于网络的攻击暴露的风险。 Azure 提供了多种服务和功能, 以保护面向 internet 的资源、内部资源和本地网络之间的通信。 利用这些功能, 可以在 Azure 上创建安全解决方案。

您还可以将多个 Azure 网络和安全服务结合起来, 以管理网络安全并提供增强的分层保护。 例如, 可以使用 Azure 防火墙保护到 Internet 的入站和出站流量, 并使用网络安全组来限制对虚拟网络中的资源的流量。