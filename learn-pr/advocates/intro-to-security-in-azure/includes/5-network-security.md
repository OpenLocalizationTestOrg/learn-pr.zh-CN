<span data-ttu-id="3e3f2-101">保护网络免受攻击和未经授权的访问是任何体系结构的重要部分。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-101">Securing your network from attacks and unauthorized access is an important part of any architecture.</span></span> <span data-ttu-id="3e3f2-102">在这里, 我们将了解网络安全的外观、如何将分层方法集成到您的体系结构中, 以及 Azure 如何帮助您为您的环境提供网络安全。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-102">Here, we'll take a look at what network security looks like, how to integrate a layered approach into your architecture, and how Azure can help you provide network security for your environment.</span></span>

## <a name="a-layered-approach-to-network-security"></a><span data-ttu-id="3e3f2-103">网络安全的分层方法</span><span class="sxs-lookup"><span data-stu-id="3e3f2-103">A layered approach to network security</span></span>

<span data-ttu-id="3e3f2-104">您可能已经注意到, 本模块中的一个常用主题是强调安全性的分层方法, 这在网络层中没有什么不同。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-104">You've probably noticed that a common theme throughout this module is the emphasis of a layered approach to security, and this is no different at the network layer.</span></span> <span data-ttu-id="3e3f2-105">仅专注于保护网络外围, 或将重点放在网络内的服务之间的网络安全上是不够的。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-105">It's not enough to just focus on securing the network perimeter, or focusing on the network security between services inside a network.</span></span> <span data-ttu-id="3e3f2-106">分层方法提供了多个级别的保护, 因此, 如果攻击者通过一个层, 则有进一步的保护来限制进一步的攻击。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-106">A layered approach provides multiple levels of protection, so that if an attacker gets through one layer, there are further protections in place to limit further attack.</span></span>

<span data-ttu-id="3e3f2-107">让我们来看看 Azure 如何为分层方法提供用于保护网络空间的工具。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-107">Let's take a look at how Azure can provide the tools for a layered approach to securing your network footprint.</span></span>

:::row:::
  :::column:::
    ![表示安全 internet 的图像](../media/5-internet-protection.png)
  :::column-end:::
    :::column span="3"::::
<span data-ttu-id="3e3f2-109">**Internet 保护**</span><span class="sxs-lookup"><span data-stu-id="3e3f2-109">**Internet protection**</span></span>

<span data-ttu-id="3e3f2-110">如果我们在网络外围启动, 我们将重点介绍如何限制和消除来自 internet 的攻击。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-110">If we start on the perimeter of the network, we're focused on limiting and eliminating attacks from the internet.</span></span> <span data-ttu-id="3e3f2-111">我们建议首先评估面向 internet 的资源, 并在必要时仅允许入站和出站通信。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-111">We suggest first assessing the resources that are internet-facing, and to only allow inbound and outbound communication where necessary.</span></span> <span data-ttu-id="3e3f2-112">确保您确定所有允许任何类型的入站网络流量的资源, 然后确保它们仅限于所需的端口和协议。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-112">Make sure you identify all resources that are allowing inbound network traffic of any type, and then ensure they are restricted to only the ports and protocols required.</span></span> <span data-ttu-id="3e3f2-113">Azure 安全中心是查找此信息的理想位置, 因为它将识别没有关联的网络安全组的面向 internet 的资源, 以及在_防火墙_后面不受保护的资源。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-113">Azure Security Center is a great place to look for this information, because it will identify internet-facing resources that don't have network security groups associated with them, as well as resources that are not secured behind a _firewall_.</span></span>

:::column-end:::
:::row-end:::

### <a name="what-is-a-firewall"></a><span data-ttu-id="3e3f2-114">什么是防火墙？</span><span class="sxs-lookup"><span data-stu-id="3e3f2-114">What is a Firewall?</span></span>
<span data-ttu-id="3e3f2-115">防火墙是一项服务, 它基于每个请求的原始 IP 地址授予服务器访问权限。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-115">A firewall is a service that grants server access based on the originating IP address of each request.</span></span> <span data-ttu-id="3e3f2-116">创建用于指定 IP 地址范围的防火墙规则。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-116">You create firewall rules that specify ranges of IP addresses.</span></span> <span data-ttu-id="3e3f2-117">仅允许来自这些已授予 IP 地址的客户端访问服务器。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-117">Only clients from these granted IP addresses will be allowed to access the server.</span></span> <span data-ttu-id="3e3f2-118">通常情况下, 防火墙规则还包括特定网络协议和端口信息。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-118">Firewall rules, generally speaking, also include specific network protocol and port information.</span></span>

<span data-ttu-id="3e3f2-119">若要在外围提供入站保护, 您有多种选择。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-119">To provide inbound protection at the perimeter, you have several choices.</span></span>

- <span data-ttu-id="3e3f2-120">**Azure 防火墙**是一个基于云的托管网络安全服务, 可保护你的 Azure 虚拟网络资源。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-120">**Azure Firewall** is a managed, cloud-based, network security service that protects your Azure Virtual Network resources.</span></span> <span data-ttu-id="3e3f2-121">它是一种具有内置高可用性和无限制云可伸缩性的服务的完全有状态的防火墙。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-121">It is a fully stateful firewall as a service with built-in high availability and unrestricted cloud scalability.</span></span> <span data-ttu-id="3e3f2-122">Azure 防火墙为非 HTTP/S 协议提供入站保护。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-122">Azure Firewall provides inbound protection for non-HTTP/S protocols.</span></span> <span data-ttu-id="3e3f2-123">非 HTTP/S 协议的示例包括: 远程桌面协议 (RDP)、安全命令行管理程序 (SSH) 和文件传输协议 (FTP)。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-123">Examples of non-HTTP/S protocols include: Remote Desktop Protocol (RDP), Secure Shell (SSH), and File Transfer Protocol (FTP).</span></span> <span data-ttu-id="3e3f2-124">此外, 它还为所有端口和协议提供出站、网络级保护和出站 HTTP/S 的应用程序级别的保护。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-124">It also.provides outbound, network-level protection for all ports and protocols, and application-level protection for outbound HTTP/S.</span></span>

- <span data-ttu-id="3e3f2-125">**Azure 应用程序网关**是一个负载平衡器, 其中包含一个 Web 应用程序防火墙 (WAF), 可提供对网站中常见的已知漏洞的保护。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-125">**Azure Application Gateway** is a load balancer that includes a Web Application Firewall (WAF) that provides protection from common, known vulnerabilities in websites.</span></span> <span data-ttu-id="3e3f2-126">它专为保护 HTTP 流量而设计。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-126">It is specifically designed to protect HTTP traffic.</span></span>

- <span data-ttu-id="3e3f2-127">**网络虚拟设备 (NVAs)** 是用于非 HTTP 服务或高级配置的理想选项, 类似于硬件防火墙设备。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-127">**Network virtual appliances (NVAs)** are ideal options for non-HTTP services or advanced configurations, and are similar to hardware firewall appliances.</span></span>

### <a name="stopping-distributed-denial-of-service-ddos-attacks"></a><span data-ttu-id="3e3f2-128">停止分布式拒绝服务 (DDos) 攻击</span><span class="sxs-lookup"><span data-stu-id="3e3f2-128">Stopping Distributed Denial of Service (DDos) attacks</span></span>

<span data-ttu-id="3e3f2-129">internet 上公开的任何资源都存在受到拒绝服务攻击的风险。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-129">Any resource exposed on the internet is at risk of being attacked by a denial of service attack.</span></span> <span data-ttu-id="3e3f2-130">这些类型的攻击试图通过发送这么多请求资源变慢或不响应, 从而导致网络资源严重不足。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-130">These types of attacks attempt to overwhelm a network resource by sending so many requests that the resource becomes slow or unresponsive.</span></span> 

<span data-ttu-id="3e3f2-131">将**Azure DDoS 保护**与应用程序设计最佳实践结合使用时, 可帮助提供针对 DDoS 攻击的防御。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-131">When you combine **Azure DDoS Protection** with application design best practices, you help provide defense against DDoS attacks.</span></span> <span data-ttu-id="3e3f2-132">DDoS 保护利用 Microsoft 的全球网络的规模和弹性为每个 Azure 区域引入 DDoS 缓解能力。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-132">DDoS Protection leverages the scale and elasticity of Microsoft’s global network to bring DDoS mitigation capacity to every Azure region.</span></span> <span data-ttu-id="3e3f2-133">azure DDoS 保护服务通过在 azure 网络边缘擦除流量来保护你的 azure 应用程序, 然后它会影响你的服务的可用性。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-133">The Azure DDoS Protection service protects your Azure applications by scrubbing traffic at the Azure network edge before it can impact your service's availability.</span></span> <span data-ttu-id="3e3f2-134">在几分钟的攻击检测中, 您会收到使用 Azure Monitor 指标的通知。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-134">Within a few minutes of attack detection, you are notified using Azure Monitor metrics.</span></span>

<span data-ttu-id="3e3f2-135">此图显示了从客户和攻击者流入到 Azure 中的网络流量。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-135">This diagram shows network traffic flowing into Azure from both customers and an attacker.</span></span> <span data-ttu-id="3e3f2-136">Azure DDoS 保护识别攻击者对网络负担严重的尝试, 并阻止来自 Azure 服务的进一步流量。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-136">Azure DDoS protection identifies the attacker's attempt to overwhelm the network and blocks further traffic from reaching Azure services.</span></span> <span data-ttu-id="3e3f2-137">来自客户的合法流量仍将流入 Azure, 而不会中断任何服务。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-137">Legitimate traffic from customers still flows into Azure without any interruption of service.</span></span>

![显示在虚拟网络和外部用户请求之间安装了 Azure DDoS 保护的说明。](../media/ddos.png)

<span data-ttu-id="3e3f2-140">Azure DDoS 保护提供以下服务层:</span><span class="sxs-lookup"><span data-stu-id="3e3f2-140">Azure DDoS Protection provides the following service tiers:</span></span>

- <span data-ttu-id="3e3f2-141">**vba.**</span><span class="sxs-lookup"><span data-stu-id="3e3f2-141">**Basic.**</span></span> <span data-ttu-id="3e3f2-142">基本服务层将自动启用为 Azure 平台的一部分。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-142">The Basic service tier is automatically enabled as part of the Azure platform.</span></span> <span data-ttu-id="3e3f2-143">实时流量监控和实时网络级攻击的实时缓解措施提供 Microsoft 在线服务使用的相同防护。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-143">Always-on traffic monitoring and real-time mitigation of common network-level attacks provide the same defenses that Microsoft’s online services use.</span></span> <span data-ttu-id="3e3f2-144">Azure 的全局网络用于跨区域分发和缓解攻击流量。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-144">Azure’s global network is used to distribute and mitigate attack traffic across regions.</span></span>
- <span data-ttu-id="3e3f2-145">**普通.**</span><span class="sxs-lookup"><span data-stu-id="3e3f2-145">**Standard.**</span></span> <span data-ttu-id="3e3f2-146">标准服务层提供了专门针对 Microsoft Azure 虚拟网络资源进行优化的其他缓解功能。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-146">The Standard service tier provides additional mitigation capabilities that are tuned specifically to Microsoft Azure Virtual Network resources.</span></span> <span data-ttu-id="3e3f2-147">DDoS 保护标准易于启用且无需更改应用程序。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-147">DDoS Protection Standard is simple to enable and requires no application changes.</span></span> <span data-ttu-id="3e3f2-148">通过专用的流量监控和机器学习算法来优化保护策略。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-148">Protection policies are tuned through dedicated traffic monitoring and machine learning algorithms.</span></span> <span data-ttu-id="3e3f2-149">策略应用于与虚拟网络 (如 Azure 负载平衡器和应用程序网关) 中部署的资源相关联的公用 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-149">Policies are applied to public IP addresses which are associated with resources deployed in virtual networks, such as Azure Load Balancer and Application Gateway.</span></span> <span data-ttu-id="3e3f2-150">DDoS 标准保护可缓解以下类型的攻击:</span><span class="sxs-lookup"><span data-stu-id="3e3f2-150">DDoS standard protection can mitigate the following types of attacks:</span></span>
    - <span data-ttu-id="3e3f2-151">Volumetric 攻击。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-151">Volumetric attacks.</span></span> <span data-ttu-id="3e3f2-152">攻击者的目标是使用大量看似合法的流量淹没网络层。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-152">The attackers goal is to flood the network layer with a substantial amount of seemingly legitimate traffic.</span></span>
    - <span data-ttu-id="3e3f2-153">协议攻击。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-153">Protocol attacks.</span></span> <span data-ttu-id="3e3f2-154">这些攻击导致无法访问目标, 方法是利用第3层和第4层协议堆栈中的弱点。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-154">These attacks render a target inaccessible, by exploiting a weakness in the layer 3 and layer 4 protocol stack.</span></span>
    - <span data-ttu-id="3e3f2-155">资源 (应用程序) 层攻击。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-155">Resource (application) layer attacks.</span></span> <span data-ttu-id="3e3f2-156">这些攻击将目标 web 应用程序数据包, 以中断主机之间的数据传输。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-156">These attacks target web application packets to disrupt the transmission of data between hosts.</span></span>

## <a name="controlling-the-traffic-inside-your-virtual-network"></a><span data-ttu-id="3e3f2-157">控制虚拟网络内的流量</span><span class="sxs-lookup"><span data-stu-id="3e3f2-157">Controlling the traffic inside your virtual network</span></span>

:::row:::
  :::column:::
    ![表示安全虚拟网络的图像](../media/5-vnet-security.png)
  :::column-end:::
    :::column span="3"::::
<span data-ttu-id="3e3f2-159">**虚拟网络安全**</span><span class="sxs-lookup"><span data-stu-id="3e3f2-159">**Virtual network security**</span></span>

<span data-ttu-id="3e3f2-160">在虚拟网络 (VNet) 中, 将资源之间的通信限制为仅需要的内容, 这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-160">Once inside a virtual network (VNet), it's crucial that you limit communication between resources to only what is required.</span></span>

<span data-ttu-id="3e3f2-161">对于虚拟机之间的通信,_网络安全组_(NSGs) 是限制不必要的通信的关键部分。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-161">For communication between virtual machines, _Network Security Groups_ (NSGs) are a critical piece to restrict unnecessary communication.</span></span> 
 :::column-end:::
:::row-end:::

<span data-ttu-id="3e3f2-162">通过网络安全组, 可以筛选与 azure 虚拟网络中的 azure 资源之间的网络通信。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-162">Network Security Groups allow you to filter network traffic to and from Azure resources in an Azure virtual network.</span></span> <span data-ttu-id="3e3f2-163">NSG 可以包含多个入站和出站安全规则, 这些规则使您能够按源和目标 IP 地址、端口和协议筛选出进出资源的流量。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-163">An NSG can contain multiple inbound and outbound security rules that enable you to filter traffic to and from resources by source and destination IP address, port, and protocol.</span></span> <span data-ttu-id="3e3f2-164">它们提供了与网络接口和子网之间允许和拒绝的通信的列表, 并可完全自定义。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-164">They provide a list of allowed and denied communication to and from network interfaces and subnets, and are fully customizable.</span></span>

<span data-ttu-id="3e3f2-165">您可以通过限制对服务终结点的访问来完全删除对您的服务的公共 internet 访问。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-165">You can completely remove public internet access to your services by restricting access to service endpoints.</span></span> <span data-ttu-id="3e3f2-166">借助服务终结点, 可以将 Azure 服务访问限制到你的虚拟网络。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-166">With service endpoints, Azure service access can be limited to your virtual network.</span></span>

:::row:::
  :::column:::
    ![表示安全网络的图像](../media/5-network-integration.png)
  :::column-end:::
    :::column span="3"::::
<span data-ttu-id="3e3f2-168">**网络集成**</span><span class="sxs-lookup"><span data-stu-id="3e3f2-168">**Network integration**</span></span>

<span data-ttu-id="3e3f2-169">通常需要集成现有网络基础结构以提供来自本地网络的通信, 或在 Azure 中提供服务之间的改进通信。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-169">It's common to have existing network infrastructure that needs to be integrated to provide communication from on-premises networks or to provide improved communication between services in Azure.</span></span> <span data-ttu-id="3e3f2-170">有几种主要方法可以处理这种集成并提高网络安全性。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-170">There are a few key ways to handle this integration and improve the security of your network.</span></span>

 :::column-end:::
:::row-end:::

<span data-ttu-id="3e3f2-171">虚拟专用网络 (VPN) 连接是在网络之间建立安全通信通道的常用方法。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-171">Virtual private network (VPN) connections are a common way of establishing secure communication channels between networks.</span></span> <span data-ttu-id="3e3f2-172">azure 虚拟网络和本地 VPN 设备之间的连接是在网络和 Azure 上的 VNet 之间提供安全通信的绝佳方式。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-172">Connection between Azure Virtual Network and an on-premises VPN device is a great way to provide secure communication between your network and your VNet on Azure.</span></span>

<span data-ttu-id="3e3f2-173">若要在网络和 Azure 之间提供专用的专用连接, 可以使用 Azure ExpressRoute。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-173">To provide a dedicated, private connection between your network and Azure, you can use Azure ExpressRoute.</span></span> <span data-ttu-id="3e3f2-174">ExpressRoute 允许你通过连接提供程序加速的专用连接将本地网络扩展到 Microsoft 云。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-174">ExpressRoute lets you extend your on-premises networks into the Microsoft cloud over a private connection facilitated by a connectivity provider.</span></span> <span data-ttu-id="3e3f2-175">使用 ExpressRoute, 可以建立与 microsoft 云服务 (如 microsoft Azure、Office 365 和 Dynamics 365) 的连接。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-175">With ExpressRoute, you can establish connections to Microsoft cloud services, such as Microsoft Azure, Office 365, and Dynamics 365.</span></span> <span data-ttu-id="3e3f2-176">这将通过使用专用线路而不是通过 internet 发送此流量来提高本地通信的安全性。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-176">This improves the security of your on-premises communication by sending this traffic over the private circuit instead of over the internet.</span></span> <span data-ttu-id="3e3f2-177">您无需通过 internet 允许最终用户访问这些服务, 并且可以通过设备发送此流量以进行进一步的流量检查。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-177">You don't need to allow access to these services for your end users over the internet, and you can send this traffic through appliances for further traffic inspection.</span></span>

## <a name="summary"></a><span data-ttu-id="3e3f2-178">摘要</span><span class="sxs-lookup"><span data-stu-id="3e3f2-178">Summary</span></span>

<span data-ttu-id="3e3f2-179">网络安全的分层方法有助于降低通过基于网络的攻击暴露的风险。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-179">A layered approach to network security helps reduce your risk of exposure through network-based attacks.</span></span> <span data-ttu-id="3e3f2-180">Azure 提供了多种服务和功能, 以保护面向 internet 的资源、内部资源和本地网络之间的通信。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-180">Azure provides several services and capabilities to secure your internet-facing resource, internal resources, and communication between on-premises networks.</span></span> <span data-ttu-id="3e3f2-181">利用这些功能, 可以在 Azure 上创建安全解决方案。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-181">These features make it possible to create secure solutions on Azure.</span></span>

<span data-ttu-id="3e3f2-182">您还可以将多个 Azure 网络和安全服务结合起来, 以管理网络安全并提供增强的分层保护。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-182">You can also combine multiple Azure networking and security services to manage your network security and provide increased layered protection.</span></span> <span data-ttu-id="3e3f2-183">例如, 可以使用 Azure 防火墙保护到 Internet 的入站和出站流量, 并使用网络安全组来限制对虚拟网络中的资源的流量。</span><span class="sxs-lookup"><span data-stu-id="3e3f2-183">For example, you can use Azure Firewall to protect inbound and outbound traffic to the Internet, and Network Security Groups to limit traffic to resources inside your virtual networks.</span></span>