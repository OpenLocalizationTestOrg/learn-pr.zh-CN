<span data-ttu-id="69c2e-101">假设新闻报道刚刚发布, 覆盖了贵组织的突破性 cancer 处理。</span><span class="sxs-lookup"><span data-stu-id="69c2e-101">Imagine a news story has just been published covering your organization's breakthrough cancer treatment.</span></span> <span data-ttu-id="69c2e-102">这是一种极大的里程碑, 无疑会给您的网站提供大量难题的流量。</span><span class="sxs-lookup"><span data-stu-id="69c2e-102">This is a terrific milestone, and will undoubtedly bring a large influx of traffic to your website.</span></span> <span data-ttu-id="69c2e-103">网站是否会对此流量造成影响, 或导致网站运行缓慢或不响应？</span><span class="sxs-lookup"><span data-stu-id="69c2e-103">Will the website handle this traffic increase, or will the load cause the site to be slow or unresponsive?</span></span>

<span data-ttu-id="69c2e-104">在这里, 我们将介绍一些使用缩放和优化原则确保未完成的应用程序性能的基本原则。</span><span class="sxs-lookup"><span data-stu-id="69c2e-104">Here, we'll look at some of the basic principles of ensuring outstanding application performance using scaling and optimization principles.</span></span>

## <a name="what-is-scaling-and-performance-optimization"></a><span data-ttu-id="69c2e-105">什么是扩展和性能优化？</span><span class="sxs-lookup"><span data-stu-id="69c2e-105">What is scaling and performance optimization?</span></span>

<span data-ttu-id="69c2e-106">扩展和性能优化是与应用程序在收到的需求匹配时可使用的资源。</span><span class="sxs-lookup"><span data-stu-id="69c2e-106">Scaling and performance optimization are about matching the resources available to an application with the demand it is receiving.</span></span> <span data-ttu-id="69c2e-107">性能优化包括扩展资源、识别和优化潜在的瓶颈, 并优化应用程序代码以实现最佳性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-107">Performance optimization includes scaling resources, identifying and optimizing potential bottlenecks, and optimizing your application code for peak performance.</span></span>

### <a name="scaling"></a><span data-ttu-id="69c2e-108">Scaling</span><span class="sxs-lookup"><span data-stu-id="69c2e-108">Scaling</span></span>

<span data-ttu-id="69c2e-109">可通过两个不同的方向扩展计算资源:</span><span class="sxs-lookup"><span data-stu-id="69c2e-109">Compute resources can be scaled in two different directions:</span></span>

* <span data-ttu-id="69c2e-110">*向上*扩展是向单个实例添加更多资源的操作。</span><span class="sxs-lookup"><span data-stu-id="69c2e-110">Scaling *up* is the action of adding more resources to a single instance.</span></span>
* <span data-ttu-id="69c2e-111">向*外*扩展是对实例的添加。</span><span class="sxs-lookup"><span data-stu-id="69c2e-111">Scaling *out* is the addition of instances.</span></span>

![显示向上扩展和向外扩展虚拟机以提高性能能力的图。](../media/scale-up-scale-out.png)

<span data-ttu-id="69c2e-113">向上扩展与向单个实例添加更多资源 (如 CPU 或内存) 相关。</span><span class="sxs-lookup"><span data-stu-id="69c2e-113">Scaling up is concerned with adding more resources, such as CPU or memory, to a single instance.</span></span> <span data-ttu-id="69c2e-114">此实例可以是虚拟机, 也可以是 PaaS 服务。</span><span class="sxs-lookup"><span data-stu-id="69c2e-114">This instance could be a virtual machine or a PaaS service.</span></span> <span data-ttu-id="69c2e-115">向实例添加更多容量的操作增加了应用程序可使用的资源, 但有限制。</span><span class="sxs-lookup"><span data-stu-id="69c2e-115">The act of adding more capacity to the instance increases the resources available to your application, but it does come with a limit.</span></span> <span data-ttu-id="69c2e-116">虚拟机仅限于它们在其上运行的主机的容量, 并且主机本身具有物理限制。</span><span class="sxs-lookup"><span data-stu-id="69c2e-116">Virtual machines are limited to the capacity of the host they run on, and hosts themselves have physical limitations.</span></span> <span data-ttu-id="69c2e-117">最终, 当您向上扩展实例时, 您可以使用这些限制, 从而限制您向实例添加更多资源的能力。</span><span class="sxs-lookup"><span data-stu-id="69c2e-117">Eventually, when you scale up an instance, you can run into these limits, restricting your ability to add further resources to the instance.</span></span>

<span data-ttu-id="69c2e-118">向后扩展与向服务添加其他实例相关。</span><span class="sxs-lookup"><span data-stu-id="69c2e-118">Scaling out is concerned with adding additional instances to a service.</span></span> <span data-ttu-id="69c2e-119">这些服务可以是虚拟机或 PaaS 服务, 而不是通过让单个实例更加强大而添加更多容量, 而是通过增加总实例总数增加容量。</span><span class="sxs-lookup"><span data-stu-id="69c2e-119">These can be virtual machines or PaaS services, but instead of adding more capacity by making a single instance more powerful, we add capacity by increasing the overall total number of instances.</span></span> <span data-ttu-id="69c2e-120">向外扩展的优势在于, 如果要将更多的计算机添加到体系结构中, 则可以使用永久扩展。</span><span class="sxs-lookup"><span data-stu-id="69c2e-120">The advantage of scaling out is that you can conceivably scale out forever if you have more machines to add to the architecture.</span></span> <span data-ttu-id="69c2e-121">向之外扩展需要某种类型的负载分配。</span><span class="sxs-lookup"><span data-stu-id="69c2e-121">Scaling out requires some type of load distribution.</span></span> <span data-ttu-id="69c2e-122">这可能是负载平衡器在可用服务器之间分发请求的形式, 或者是用于标识要向其发送请求的活动服务器的服务发现机制。</span><span class="sxs-lookup"><span data-stu-id="69c2e-122">This could be in the form of a load balancer distributing requests across available servers, or a service discovery mechanism for identifying active servers to send requests to.</span></span>

<span data-ttu-id="69c2e-123">在这两种情况下, 可以减少资源, 从而将成本优化引入图片中。</span><span class="sxs-lookup"><span data-stu-id="69c2e-123">In both cases, resources can be reduced, bringing cost optimization into the picture.</span></span>

### <a name="performance-optimization"></a><span data-ttu-id="69c2e-124">性能优化</span><span class="sxs-lookup"><span data-stu-id="69c2e-124">Performance optimization</span></span>

<span data-ttu-id="69c2e-125">在优化性能时, 你将看到网络和存储, 以确保性能可接受。</span><span class="sxs-lookup"><span data-stu-id="69c2e-125">When optimizing for performance, you'll look at network and storage to ensure performance is acceptable.</span></span> <span data-ttu-id="69c2e-126">这两种情况都可能会影响应用程序的响应时间。</span><span class="sxs-lookup"><span data-stu-id="69c2e-126">Both can impact the response time of your application.</span></span> <span data-ttu-id="69c2e-127">为你的体系结构选择适当的网络和存储技术将有助于确保你能够为你的消费者提供最佳体验。</span><span class="sxs-lookup"><span data-stu-id="69c2e-127">Selecting the right networking and storage technologies for your architecture will help you ensure you're providing the best experience for your consumers.</span></span>

<span data-ttu-id="69c2e-128">性能优化还包括了解应用程序自身的执行方式。</span><span class="sxs-lookup"><span data-stu-id="69c2e-128">Performance optimization will also include understanding how the applications themselves are performing.</span></span> <span data-ttu-id="69c2e-129">相关系统中的错误、执行不好的代码和瓶颈都可以通过应用程序性能管理工具来发现。</span><span class="sxs-lookup"><span data-stu-id="69c2e-129">Errors, poorly performing code, and bottlenecks in dependent systems can all be uncovered through an application performance management tool.</span></span> <span data-ttu-id="69c2e-130">通常, 这些问题可能对最终用户、开发人员和管理员隐藏或进行了模糊处理, 但可能会对应用程序的整体性能产生不利影响。</span><span class="sxs-lookup"><span data-stu-id="69c2e-130">Often, these issues may be hidden or obfuscated for end users, developers, and administrators, but can have adverse impact on the overall performance of your application.</span></span>

## <a name="scalability-and-performance-patterns-and-practices"></a><span data-ttu-id="69c2e-131">可伸缩性和性能模式和做法</span><span class="sxs-lookup"><span data-stu-id="69c2e-131">Scalability and performance patterns and practices</span></span>

<span data-ttu-id="69c2e-132">我们来看看一些模式和做法, 可以利用这些模式和做法来增强应用程序的可伸缩性和性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-132">Let's take a look at some patterns and practices that can be leveraged to enhance the scalability and performance of your application.</span></span>

### <a name="data-partitioning"></a><span data-ttu-id="69c2e-133">数据分区</span><span class="sxs-lookup"><span data-stu-id="69c2e-133">Data partitioning</span></span>

<span data-ttu-id="69c2e-134">在许多大规模解决方案中, 数据分为单独的分区, 可以单独管理和访问。</span><span class="sxs-lookup"><span data-stu-id="69c2e-134">In many large-scale solutions, data is divided into separate partitions that can be managed and accessed separately.</span></span> <span data-ttu-id="69c2e-135">必须仔细选择分区策略, 以最大限度地减少负面影响的优势。</span><span class="sxs-lookup"><span data-stu-id="69c2e-135">The partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span> <span data-ttu-id="69c2e-136">分区有助于提高可伸缩性、减少争用和优化性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-136">Partitioning can help improve scalability, reduce contention, and optimize performance.</span></span>

### <a name="caching"></a><span data-ttu-id="69c2e-137">Caching</span><span class="sxs-lookup"><span data-stu-id="69c2e-137">Caching</span></span>

<span data-ttu-id="69c2e-138">在体系结构中使用缓存可帮助提高性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-138">Use caching in your architecture can help improve performance.</span></span> <span data-ttu-id="69c2e-139">缓存是一种用于存储经常使用的数据或资产 (网页、图像) 以加快检索速度的机制。</span><span class="sxs-lookup"><span data-stu-id="69c2e-139">Caching is a mechanism to store frequently used data or assets (web pages, images) for faster retrieval.</span></span> <span data-ttu-id="69c2e-140">可以在应用程序的不同层使用缓存。</span><span class="sxs-lookup"><span data-stu-id="69c2e-140">Caching can be used at different layers of your application.</span></span> <span data-ttu-id="69c2e-141">您可以在应用程序服务器和数据库之间使用缓存, 以减少数据检索次数。</span><span class="sxs-lookup"><span data-stu-id="69c2e-141">You can use caching between your application servers and a database, to decrease data retrieval times.</span></span> <span data-ttu-id="69c2e-142">您还可以在最终用户和 web 服务器之间使用缓存, 将静态内容放置在离用户更近的时间, 并减少将网页返回给最终用户所花费的时间。</span><span class="sxs-lookup"><span data-stu-id="69c2e-142">You could also use caching between your end users and your web servers, placing static content closer to the user and decreasing the time it takes to return web pages to the end user.</span></span> <span data-ttu-id="69c2e-143">这还具有从数据库或 web 服务器中卸载请求的次要效果, 从而提高了其他请求的性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-143">This also has a secondary effect of offloading requests from your database or web servers, increasing the performance for other requests.</span></span>

### <a name="autoscaling"></a><span data-ttu-id="69c2e-144">缩放</span><span class="sxs-lookup"><span data-stu-id="69c2e-144">Autoscaling</span></span>

<span data-ttu-id="69c2e-145">自动缩放是动态分配资源以满足性能要求的过程。</span><span class="sxs-lookup"><span data-stu-id="69c2e-145">Autoscaling is the process of dynamically allocating resources to match performance requirements.</span></span> <span data-ttu-id="69c2e-146">随着工作量的增加, 应用程序可能需要其他资源来维护所需的性能级别并满足服务级别协议 (sla)。</span><span class="sxs-lookup"><span data-stu-id="69c2e-146">As the volume of work grows, an application may need additional resources to maintain the desired performance levels and satisfy service-level agreements (SLAs).</span></span> <span data-ttu-id="69c2e-147">随着需求的 slackens 和不再需要的其他资源, 可以对其进行释放以最大限度地减少成本。</span><span class="sxs-lookup"><span data-stu-id="69c2e-147">As demand slackens and the additional resources are no longer needed, they can be de-allocated to minimize costs.</span></span>

<span data-ttu-id="69c2e-148">自动缩放利用云托管环境的弹性, 同时简化管理开销。</span><span class="sxs-lookup"><span data-stu-id="69c2e-148">Autoscaling takes advantage of the elasticity of cloud-hosted environments while easing management overhead.</span></span> <span data-ttu-id="69c2e-149">它减少了操作员持续监视系统性能并做出有关添加或删除资源的决策的需求。</span><span class="sxs-lookup"><span data-stu-id="69c2e-149">It reduces the need for an operator to continually monitor the performance of a system and make decisions about adding or removing resources.</span></span>

### <a name="decouple-resource-intensive-tasks-as-background-jobs"></a><span data-ttu-id="69c2e-150">将大量占用资源的任务作为后台作业分离</span><span class="sxs-lookup"><span data-stu-id="69c2e-150">Decouple resource-intensive tasks as background jobs</span></span>

<span data-ttu-id="69c2e-151">许多类型的应用程序都需要独立于用户界面 (UI) 运行的后台任务。</span><span class="sxs-lookup"><span data-stu-id="69c2e-151">Many types of applications require background tasks that run independently of the user interface (UI).</span></span> <span data-ttu-id="69c2e-152">示例包括批处理作业、大量处理任务和长时间运行的进程 (如工作流)。</span><span class="sxs-lookup"><span data-stu-id="69c2e-152">Examples include batch jobs, intensive processing tasks, and long-running processes such as workflows.</span></span> <span data-ttu-id="69c2e-153">后台作业可在无需用户交互的情况下执行--应用程序可以启动作业, 然后继续处理来自用户的交互式请求。</span><span class="sxs-lookup"><span data-stu-id="69c2e-153">Background jobs can be executed without requiring user interaction--the application can start the job and then continue to process interactive requests from users.</span></span> <span data-ttu-id="69c2e-154">这有助于最大限度地减少应用程序 UI 上的负载, 从而可提高可用性并缩短交互响应时间。</span><span class="sxs-lookup"><span data-stu-id="69c2e-154">This can help to minimize the load on the application UI, which can improve availability and reduce interactive response times.</span></span>

### <a name="use-a-messaging-layer-between-services"></a><span data-ttu-id="69c2e-155">在服务之间使用消息层</span><span class="sxs-lookup"><span data-stu-id="69c2e-155">Use a messaging layer between services</span></span>

<span data-ttu-id="69c2e-156">在服务之间添加邮件层可以对性能和可伸缩性有好处。</span><span class="sxs-lookup"><span data-stu-id="69c2e-156">Adding a messaging layer in between services can have a benefit to performance and scalability.</span></span> <span data-ttu-id="69c2e-157">添加邮件层会为服务之间的请求创建一个缓冲区, 以便在应用程序无法持续的情况下, 请求可以在不出错的情况下继续流动。</span><span class="sxs-lookup"><span data-stu-id="69c2e-157">Adding a messaging layer creates a buffer for requests between the services so that requests can continue to flow in without error if the application can’t keep up.</span></span> <span data-ttu-id="69c2e-158">当应用程序通过请求工作时, 将按接收顺序对它们进行应答。</span><span class="sxs-lookup"><span data-stu-id="69c2e-158">As the application works through the requests, they will be answered in the order in which they were received.</span></span>

### <a name="implement-scale-units"></a><span data-ttu-id="69c2e-159">实施扩展单元</span><span class="sxs-lookup"><span data-stu-id="69c2e-159">Implement scale units</span></span>

<span data-ttu-id="69c2e-160">作为一个单元进行缩放。</span><span class="sxs-lookup"><span data-stu-id="69c2e-160">Scale as a unit.</span></span> <span data-ttu-id="69c2e-161">对于每个资源, 确定扩展活动可能对依赖系统产生的影响。</span><span class="sxs-lookup"><span data-stu-id="69c2e-161">For each resource, determine the impact that a scaling activity may have on dependent systems.</span></span> <span data-ttu-id="69c2e-162">这会使应用的扩展操作更简单, 且不易影响应用程序的负面影响。</span><span class="sxs-lookup"><span data-stu-id="69c2e-162">This makes applying scale-out operations easier, and less prone to negative impact on the application.</span></span> <span data-ttu-id="69c2e-163">例如, 添加 x 个 web 和辅助角色的角色可能需要 y 个额外的队列和 z 个存储帐户数, 以处理这些角色生成的其他工作负载。</span><span class="sxs-lookup"><span data-stu-id="69c2e-163">For example, adding x number of web and worker roles might require y number of additional queues and z number of storage accounts to handle the additional workload generated by the roles.</span></span> <span data-ttu-id="69c2e-164">缩放单位可以包含 x web 和辅助角色、y 队列和 z 存储帐户。</span><span class="sxs-lookup"><span data-stu-id="69c2e-164">A scale unit could consist of x web and worker roles, y queues, and z storage accounts.</span></span> <span data-ttu-id="69c2e-165">设计应用程序, 以便通过添加一个或多个缩放单元轻松地进行缩放。</span><span class="sxs-lookup"><span data-stu-id="69c2e-165">Design the application so that it's easily scaled by adding one or more scale units.</span></span>

### <a name="performance-monitoring"></a><span data-ttu-id="69c2e-166">性能监视</span><span class="sxs-lookup"><span data-stu-id="69c2e-166">Performance monitoring</span></span>

<span data-ttu-id="69c2e-167">在云中运行的分布式应用程序和服务的性质是构成许多移动部件的复杂软件部分。</span><span class="sxs-lookup"><span data-stu-id="69c2e-167">Distributed applications and services running in the cloud are, by their nature, complex pieces of software that comprise many moving parts.</span></span> <span data-ttu-id="69c2e-168">在生产环境中, 很重要的一点是, 能够跟踪用户使用系统的方式、跟踪资源使用率, 并通常监视系统的运行状况和性能。</span><span class="sxs-lookup"><span data-stu-id="69c2e-168">In a production environment, it's important to be able to track the way in which users utilize your system, trace resource utilization, and generally monitor the health and performance of your system.</span></span> <span data-ttu-id="69c2e-169">您可以使用此信息作为诊断工具来检测和纠正问题, 还可以帮助发现潜在问题并防止发生问题。</span><span class="sxs-lookup"><span data-stu-id="69c2e-169">You can use this information as a diagnostic aid to detect and correct issues, and also to help spot potential problems and prevent them from occurring.</span></span>

<span data-ttu-id="69c2e-170">跨应用程序的所有层进行查看, 并确定和修正应用程序中的性能瓶颈。</span><span class="sxs-lookup"><span data-stu-id="69c2e-170">Look across all layers of your application and identify and remediate performance bottlenecks in your application.</span></span> <span data-ttu-id="69c2e-171">这些瓶颈可能是应用程序中的内存处理较差, 甚至是将索引添加到数据库中的过程。</span><span class="sxs-lookup"><span data-stu-id="69c2e-171">These bottlenecks could be poor memory handling in your application, or even the process of adding indexes into your database.</span></span> <span data-ttu-id="69c2e-172">它可能是一个迭代过程, 在您缓解一个瓶颈, 然后发现另一个尚未察觉的情况。</span><span class="sxs-lookup"><span data-stu-id="69c2e-172">It may be an iterative process as you relieve one bottleneck and then uncover another that you were unaware of.</span></span>

<span data-ttu-id="69c2e-173">通过全面的性能监控方法, 你将能够确定你的体系结构将从中受益的模式和做法的类型。</span><span class="sxs-lookup"><span data-stu-id="69c2e-173">With a thorough approach to performance monitoring, you'll be able to determine what types of patterns and practices your architecture will benefit from.</span></span>