现在, 你的网站已启动并在 Azure 上运行。 但如何帮助确保您的网站运行的是24/7？

例如, 当您需要进行每周维护时, 会发生什么？ 在维护时段内, 你的服务仍将不可用。 而且, 由于你的网站在全球范围内获得了用户, 因此没有合适的时间将系统用于维护。 如果同时连接的用户太多, 也可能会遇到性能问题。

## <a name="what-are-availability-and-high-availability"></a>什么是可用性和高可用性？

:::row:::
  :::column:::
    ![表示高可用性的速度培训](../media/3-availability.png)
  :::column-end:::
    :::column span="3":::
_可用性_是指您的服务在不中断的情况下运行多长时间。 _高可用性_或_高_可用性是指在很长一段时间内启动和运行的服务。

您知道当您无法访问所需信息时, 有什么麻烦。 试想一下你每天访问的社交媒体或新闻网站。 您是否可以始终访问网站, 或者您是否经常看到类似于 "503 服务不可用" 的错误消息？
  :::column-end:::
 :::row-end:::

您可能会听到类似 "五个9的可用性" 的术语。 "五个 9" 的可用性是指保证服务运行的是 99.999% 的时间。 虽然很难实现 100% 的可用性, 但许多团队至少要努力5个九。

## <a name="what-is-resiliency"></a>什么是弹性？

:::row:::
  :::column:::
    ![表示弹性的运行状况图](../media/3-resiliency.png)
  :::column-end:::
    :::column span="3":::
_复原_是指系统在异常情况中保持运行的功能。

这些条件包括:

- 自然灾难
- 系统维护, 包括计划的和未计划的, 包括软件更新和安全修补程序。
- 网站流量中的峰值
- 由恶意方 (如分布式拒绝服务或 DDoS 攻击) 所做的威胁
  :::column-end:::
:::row-end:::

设想您的市场营销团队希望进行快速促销, 以促进新的 vitamin 补充行为。 在这段时间内, 您可能会期待流量大的峰值。 此峰值可能会严重影响您的处理系统, 导致用户 disappointing 速度下降或停止。 您可能已经为自己体验了此 disappointment。 您是否曾尝试仅访问在线销售以查找网站未响应？

## <a name="what-is-a-load-balancer"></a>什么是负载平衡器？

:::row:::
  :::column:::
    ![表示负载平衡的扩展](../media/3-lb.png)
  :::column-end:::
    :::column span="3":::
_负载平衡器_在池中的每个系统之间平均分布流量。 负载平衡器可帮助您实现高可用性和弹性。

假设您首先向每个层添加其他 vm (每个配置相同)。 其目的是让其他系统准备就绪, 以便在一段时间内或同时为太多用户提供服务。
  :::column-end:::
:::row-end:::

此处的问题是每个虚拟机都有自己的 IP 地址。 此外, 在一个系统出现故障或繁忙的情况下, 你无法分配流量的方法。 如何连接你的 vm, 以使其作为一个系统显示给用户？

答案是使用_负载平衡器_来分发流量。 负载平衡器成为用户的入口点。 用户不知道 (或需要知道) 负载平衡器选择接收请求的系统。

下图显示了负载平衡器的角色。

![显示三层体系结构的 web 层的插图。 web 层具有多个虚拟机来为用户请求提供服务。 有一个负载平衡器, 用于在虚拟机之间分发用户请求。](../media/3-load-balancer.png)

负载平衡器接收用户的请求, 并将请求定向到 web 层中的其中一个 vm。 如果 VM 不可用或停止响应, 则负载平衡器将停止向其发送流量。 然后, 负载平衡器将通信定向到某个响应性服务器。

负载平衡使您能够在不中断服务的情况下运行维护任务。 例如, 可以错开每个 VM 的维护时段。 在维护时段内, 负载平衡器检测到 VM 无响应, 并将流量定向到池中的其他 vm。

对于您的电子商务站点, 应用层和数据层也可以具有负载平衡器。 这一切都取决于您的服务所需的内容。

## <a name="what-is-azure-load-balancer"></a>什么是 Azure 负载平衡器？

Azure 负载平衡器是 Microsoft 提供的一种负载平衡器服务, 可帮助您处理维护。 负载平衡器支持入站和出站方案, 提供低延迟和高吞吐量, 并可扩展所有传输控制协议 (TCP) 和用户数据报协议 (UDP) 应用程序的流量。 可以将负载平衡器与传入 internet 流量、跨 Azure 服务的内部流量、特定流量的端口转发或虚拟网络中的 vm 的出站连接结合使用。

在虚拟机上手动配置典型负载平衡器软件时, 存在一些缺点: 现在, 您有一个需要维护的额外系统。 如果你的负载平衡器停机或需要例行维护, 你将回到原始问题。

然而, 如果使用的是 Azure 负载平衡器, 则不需要维护任何基础结构或软件。 将基于源 ip 和端口的转发规则定义到一组目标 ip/端口。

下图显示了多层体系结构中的 Azure 负载平衡器的角色。

![显示三层体系结构的 web 层的插图。 web 层具有多个虚拟机来为用户请求提供服务。 有一个负载平衡器, 用于在虚拟机之间分发用户请求。](../media/3-azure-load-balancer.png)

## <a name="azure-application-gateway"></a>Azure 应用程序网关

如果你的所有流量都是 HTTP, 则一个可能更好的方法是使用 Azure 应用程序网关。 应用程序网关是为 web 应用程序设计的负载平衡器。 它在传输级别 (TCP) 使用 Azure 负载平衡器, 并应用基于 URL 的复杂路由规则来支持多种高级方案。

![显示基于 URL 的服务器组之间的应用程序网关产品路由 HTTP 流量的概念性图像](../media/3-appgateway.png)

这种类型的路由称为应用程序层 (OSI 层 7) 负载平衡, 因为它了解 HTTP 消息的结构。 

下面是在简单负载平衡器上使用 Azure 应用程序网关的一些好处:

- **Cookie 关联**。 当您想要在同一个后端服务器上保留用户会话时, 此方法非常有用。
- **SSL 终止**。 应用程序网关可以管理 SSL 证书并将未加密的流量传递给后端服务器, 以避免加密/解密开销。 它还支持对需要的应用程序的完整端到端加密。
- **Web 应用程序防火墙**。 应用程序网关支持具有详细监控和日志记录的高级防火墙 (WAF), 以检测对网络基础结构的恶意攻击。
- **基于 URL 规则的路由**。 应用程序网关允许您根据 URL 模式、源 ip 地址和端口到目标 ip 地址和端口路由流量。 这在设置_内容传递网络_时非常有用。
- **重写 HTTP 标头**。 您可以在每个请求的入站和出站 HTTP 标头中添加或删除信息, 以启用重要的安全方案, 或清理敏感信息 (如服务器名称)。

### <a name="what-is-a-content-delivery-network"></a>什么是内容传递网络？

内容传递网络 (CDN) 是服务器的分布式网络, 可有效地向用户传递 web 内容。 这是在本地区域中向用户获取内容以最大限度地减少延迟的一种方式。 可以在 Azure 或任何其他位置托管 CDN。 您可以在世界上有战略放置的物理节点上缓存内容, 并为最终用户提供更好的性能。 典型的使用方案包括包含多媒体内容的 web 应用程序、特定区域中的产品启动事件或在某个区域中预计高带宽要求的任何事件。

## <a name="what-about-dns"></a>DNS 的目标是什么？

:::row:::
  :::column:::
    ![代表 DNS 的地图上的 pin](../media/3-map-pin.png)
  :::column-end:::
    :::column span="3":::
DNS 或域名系统, 是一种将用户友好名称映射到其 IP 地址的方法。 你可以将 DNS 视为 internet 的电话簿。

例如, 您的域名 (contoso.com) 可能会映射到 web 层上的负载平衡器的 IP 地址, 40.65.106.192。

你可以将自己的 dns 服务器或使用 azure DNS 用于在 Azure 基础结构上运行的 DNS 域的托管服务。
  :::column-end:::
:::row-end:::

下图显示了 Azure DNS。 当用户导航到**contoso.com**时, Azure DNS 会将流量路由到负载平衡器。

![显示 Azure 域名系统位于负载平衡器前面的插图。](../media/3-dns.png)

## <a name="summary"></a>摘要

使用负载平衡时, 你的电子商务网站现在更具可用性和灵活性。 当您在流量中执行维护或接收 uptick 时, 负载平衡器可以将流量分发到另一个可用系统。

虽然您可以在虚拟机上配置自己的负载平衡器, 但 Azure 负载平衡器降低了维护, 因为没有要维护的基础结构或软件。

DNS 将用户友好名称映射到其 IP 地址, 这与电话簿将人员或公司的名称映射到电话号码的方式非常相似。 你可以引入自己的 DNS 服务器, 也可以使用 Azure DNS。
