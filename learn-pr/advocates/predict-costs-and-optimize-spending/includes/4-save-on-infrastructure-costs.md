我们了解了如何为你想要构建的环境创建成本估算, 通过了一些工具来获取有关我们支出资金和计划未来费用的详细信息。 我们下一项挑战是了解如何减少这些基础结构成本。

## <a name="use-azure-credits"></a>使用 Azure 信用

Visual Studio 订阅者可以激活每月信用收益, 这样您就可以在 Azure 上试用、开发和测试新的解决方案。 使用 Azure 信用来试用新服务, 例如应用服务、Windows 10 虚拟机、Azure SQL Server 数据库、容器、认知服务、函数、数据不足, 并且不会导致任何货币成本。

当您激活此权益时, 您将在您的帐户下拥有单独的 Azure 订阅, 在您保持活动的 Visual Studio 订阅者的情况下, 每月的信用额度也会每月续订一次。

贷方金额根据计划级别-$ 50/月为 VS Professional 和企业的 150/月而异。 有关您为您的特定订阅级别收到的信用量的详细信息, 请查看文档。

> [!IMPORTANT]
> Visual Studio 订阅者的每月 Azure 信用**仅用于开发和测试**, 而不会执行财务支持的 SLA。 Azure 将挂起在超过120小时内连续运行的任何实例 (VM 或云服务), 或者如果确定实例正在用于生产。 此优势在最佳的基础上可供 Visual Studio 订阅者使用;无法保证容量可用性。

## <a name="use-spending-limits"></a>使用花费限制

默认情况下, 具有相关月信用 (包括试用帐户) 的 Azure 订阅具有_支出限制_, 以确保在使用完学分后不会向您收取费用。 此功能对探索新的解决方案体系结构的开发团队很有用, 因为它可确保您在月末不会遇到意外的费用。

> [!NOTE]
> Azure 支出限制与订阅、服务或资源组限制和配额不同。

Azure 提供了支出限制功能, 以帮助防止你在每个帐单期内耗尽你的帐户信用。 当您的 Azure 使用率导致使用所有包括的按月贷款的费用时, 您部署的服务将被禁用, 并在该帐单期内关闭。 在新的帐单期初 (假定有学分) 后, 将重新激活和部署资源。

当你击中你的订阅的支出限制时, 你将收到电子邮件通知。 此外, Azure 门户还包括有关你的信用卡费用的通知。 您可以根据需要调整花费限制, 甚至可以将其关闭。

> [!IMPORTANT]
> 支出限制功能特定于包含每月 Azure 信用配额的订阅。 它在仅付款订阅中不可用。

## <a name="use-reserved-instances"></a>使用保留实例

如果您的 VM 工作负载是静态且可预测的, 尤其是那些运行24x7x365 的 VM 工作负载, 则使用保留实例是一种极好的方法, 可根据 VM 大小极大可能节省 70-80%。 下图显示了使用 azure 保留实例可为您节省最多 72%, 使用保留实例加上 azure 混合优势节省了高达 80% 的成本。

![该图显示了使用 azure 保留实例和 azure 混合优势与按需付费进行比较的成本优势。](../media/4-savings-coins.png)

保留实例按一年或三年的条款购买, 并提前进行完整术语所需的付款。 在购买后, Microsoft 会匹配保留项以运行实例, 并从保留中减少小时数。 可以通过 Azure 门户购买保留项。 而且, 由于保留实例是计算折扣, 因此可用于 Windows 和 Linux 虚拟机。

## <a name="choose-low-cost-locations-and-regions"></a>选择低成本位置和区域

Azure 产品、服务和资源的成本在不同位置和地区各不相同, 如果可能, 应将其用于成本较低的这些位置和地区。

> [!NOTE]  
> 某些资源按其占用的传出网络带宽量 (出局) 进行计量和计费。 应设置_在同一区域中_按带宽计量的已连接资源, 以减少它们之间的传出流量。

## <a name="research-available-cost-saving-offers"></a>研究可用的成本节省优惠

使用最新的 Azure 客户和订阅提供更新, 并切换到提供最具成本效益优势的提供。

您可以查看 " [azure 更新" 页面](https://azure.microsoft.com/en-us/updates/), 了解有关 Azure 产品、服务和功能的最新更新以及产品路线图和通知的信息。

## <a name="right-size-underutilized-virtual-machines"></a>正确大小未充分利用的虚拟机

从前面的讨论中回想, azure 成本管理和 Azure Advisor 可能建议对虚拟机进行正确的大小调整或关闭。 将虚拟机正确调整大小是将其调整为适当大小的过程。 假设您有一个作为域控制器运行的服务器, 其大小为**Standard_D4sv3**, 但您的 VM 在绝大多数时间中处于 90% 空闲状态。 通过将此 VM 调整为**Standard_D2sv3**, 可以将计算成本降低 50%。 对于同一系列中的每个大小时, 成本都是线性的和双倍的。 在这种情况下, 您甚至可以从更改实例系列转到成本较低的 VM 系列中获益。 下图显示了通过在同一个系列中向下移动一个大小而实现的 50% 的节省。

![说明如何通过 downsizing 未充分利用的虚拟机来实现节省的成本。](../media/4-vm-resize.png)

大小过大的虚拟机在 Azure 上是一个常见的不必要的费用, 可以轻松修复。 您可以通过 azure 门户、azure PowerShell 或 azure CLI 更改 VM 的大小。

> [!TIP]
> 调整虚拟机大小需要先停止、调整大小, 然后重新启动。 此操作可能需要几分钟时间, 具体取决于大小变化的多少。 在执行此任务时, 请规划中断, 或将流量转移到另一个实例。

## <a name="deallocate-virtual-machines-in-off-hours"></a>取消分配虚拟机的时间 (以小时为单位)

如果你的虚拟机工作负载仅在特定时段内使用, 但每小时运行一次, 则会浪费资金。 这些虚拟机非常适合在未使用时关闭, 并按计划重新启动, 在 VM 被释放时节省计算成本。

此方法是开发环境的绝佳策略。 通常情况下, 开发可能仅在工作时间发生, 这样您就可以灵活地在下班时间内取消分配这些系统, 并从应计成本中停止计算成本。 Azure 现在有一个[自动化解决方案](https://docs.microsoft.com/azure/automation/automation-solution-vm-management), 可让你在你的环境中充分利用。

您还可以在虚拟机上使用自动关闭功能安排自动关机。

![显示启用了关闭时间的虚拟机边栏自动关闭部分的 Azure 门户屏幕截图。](../media/4-vm-auto-shutdown.png)

## <a name="delete-unused-virtual-machines"></a>删除未使用的虚拟机

 此建议听起来可能很明显, 但如果您不使用服务, 则应将其关闭。 在不再需要的项目后面找出非生产或概念证明系统留下的情况并不常见。 定期查看您的环境并努力确定这些系统。 关闭这些系统可能会带来 multifaceted 好处, 只需在基础结构成本上进行保存, 但在许可和操作方面也可能会节省成本。

## <a name="migrate-to-paas-or-saas-services"></a>迁移到 PaaS 或 SaaS 服务

最后, 当您将工作负载移到云时, 自然演变是从基础结构即服务 (IaaS) 服务开始, 然后在迭代过程中根据需要将它们移动到平台即服务 (PaaS)。

PaaS 服务通常在资源和运营成本方面节省大量资金。 困难在于, 根据服务类型, 从时间和资源角度来看, 需要进行不同级别的工作来移动到这些服务。 您可以轻松地将 SQL Server 数据库移动到 Azure sql 数据库, 但将多层应用程序转移到基于容器或无服务器的体系结构可能需要更多的努力。 最好的做法是, 不断评估应用程序的体系结构, 以确定是否可以通过 PaaS 服务获得高效的效率。

Azure 使您能够轻松地测试这些服务, 并降低风险, 使您能够相对轻松地试用新的体系结构模式。 也就是说, 这通常是一项较长的旅程, 如果你要从成本节约角度寻求快速的 wins, 则可能无法立即获得帮助。 Azure 体系结构中心是获取有关转换应用程序的建议的理想位置, 以及跨大量体系结构和 Azure 服务的最佳做法。