<span data-ttu-id="36f3b-101">我们了解了如何为你想要构建的环境创建成本估算, 通过了一些工具来获取有关我们支出资金和计划未来费用的详细信息。</span><span class="sxs-lookup"><span data-stu-id="36f3b-101">We have seen how to create cost estimates for environments you'd like to build, walked through some tools to get details on where we're spending money, and projected future expenses.</span></span> <span data-ttu-id="36f3b-102">我们下一项挑战是了解如何减少这些基础结构成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-102">Our next challenge is to look at how to reduce those infrastructure costs.</span></span>

## <a name="use-azure-credits"></a><span data-ttu-id="36f3b-103">使用 Azure 信用</span><span class="sxs-lookup"><span data-stu-id="36f3b-103">Use Azure credits</span></span>

<span data-ttu-id="36f3b-104">Visual Studio 订阅者可以激活每月信用收益, 这样您就可以在 Azure 上试用、开发和测试新的解决方案。</span><span class="sxs-lookup"><span data-stu-id="36f3b-104">Visual Studio subscribers can activate a monthly credit benefit which allows you to experiment with, develop, and test new solutions on Azure.</span></span> <span data-ttu-id="36f3b-105">使用 Azure 信用来试用新服务, 例如应用服务、Windows 10 虚拟机、Azure SQL Server 数据库、容器、认知服务、函数、数据不足, 并且不会导致任何货币成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-105">Use Azure credits to try out new services such as App Service, Windows 10 VMs, Azure SQL Server databases, Containers, Cognitive Services, Functions, Data Lake, and more without incurring any monetary costs.</span></span>

<span data-ttu-id="36f3b-106">当您激活此权益时, 您将在您的帐户下拥有单独的 Azure 订阅, 在您保持活动的 Visual Studio 订阅者的情况下, 每月的信用额度也会每月续订一次。</span><span class="sxs-lookup"><span data-stu-id="36f3b-106">When you activate this benefit, you will own a separate Azure subscription under your account with a monthly credit balance that renews each month while you remain an active Visual Studio subscriber.</span></span>

<span data-ttu-id="36f3b-107">贷方金额根据计划级别-$ 50/月为 VS Professional 和企业的 150/月而异。</span><span class="sxs-lookup"><span data-stu-id="36f3b-107">The credit amount varies based on the program level - $50/month for VS Professional and $150/month for Enterprise.</span></span> <span data-ttu-id="36f3b-108">有关您为您的特定订阅级别收到的信用量的详细信息, 请查看文档。</span><span class="sxs-lookup"><span data-stu-id="36f3b-108">Check the documentation for more details on how much credit you receive for your specific subscription level.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="36f3b-109">Visual Studio 订阅者的每月 Azure 信用**仅用于开发和测试**, 而不会执行财务支持的 SLA。</span><span class="sxs-lookup"><span data-stu-id="36f3b-109">The monthly Azure credit for Visual Studio subscribers is for **development and testing only** and does not carry a financially-backed SLA.</span></span> <span data-ttu-id="36f3b-110">Azure 将挂起在超过120小时内连续运行的任何实例 (VM 或云服务), 或者如果确定实例正在用于生产。</span><span class="sxs-lookup"><span data-stu-id="36f3b-110">Azure will suspend any instance (VM or cloud service) that runs continuously for more than 120 hours or if it's determined that the instance is being used for production.</span></span> <span data-ttu-id="36f3b-111">此优势在最佳的基础上可供 Visual Studio 订阅者使用;无法保证容量可用性。</span><span class="sxs-lookup"><span data-stu-id="36f3b-111">This benefit is made available to Visual Studio subscribers on a best efforts basis; there is no guarantee of capacity availability.</span></span>

## <a name="use-spending-limits"></a><span data-ttu-id="36f3b-112">使用花费限制</span><span class="sxs-lookup"><span data-stu-id="36f3b-112">Use spending limits</span></span>

<span data-ttu-id="36f3b-113">默认情况下, 具有相关月信用 (包括试用帐户) 的 Azure 订阅具有_支出限制_, 以确保在使用完学分后不会向您收取费用。</span><span class="sxs-lookup"><span data-stu-id="36f3b-113">By default, Azure subscriptions which have associated monthly credits (which includes trial accounts) have a _spending limit_ to ensure you aren't charged once you have used up your credits.</span></span> <span data-ttu-id="36f3b-114">此功能对探索新的解决方案体系结构的开发团队很有用, 因为它可确保您在月末不会遇到意外的费用。</span><span class="sxs-lookup"><span data-stu-id="36f3b-114">This feature is useful for development teams exploring new solution architectures as it ensures you won't have an unexpectedly large bill at the end of the month.</span></span>

> [!NOTE]
> <span data-ttu-id="36f3b-115">Azure 支出限制与订阅、服务或资源组限制和配额不同。</span><span class="sxs-lookup"><span data-stu-id="36f3b-115">Azure spending limits are not the same as Subscription, Service, or Resource Group limits and quotas.</span></span>

<span data-ttu-id="36f3b-116">Azure 提供了支出限制功能, 以帮助防止你在每个帐单期内耗尽你的帐户信用。</span><span class="sxs-lookup"><span data-stu-id="36f3b-116">Azure provides the Spending Limits feature to help prevent you from exhausting the credit on your account within each billing period.</span></span> <span data-ttu-id="36f3b-117">当您的 Azure 使用率导致使用所有包括的按月贷款的费用时, 您部署的服务将被禁用, 并在该帐单期内关闭。</span><span class="sxs-lookup"><span data-stu-id="36f3b-117">When your Azure usage results in charges that use all the included monthly credit, the services that you deployed are disabled and turned off for the rest of that billing period.</span></span> <span data-ttu-id="36f3b-118">在新的帐单期初 (假定有学分) 后, 将重新激活和部署资源。</span><span class="sxs-lookup"><span data-stu-id="36f3b-118">Once a new billing period starts, assuming there are credits available, the resources are re-activated and deployed.</span></span>

<span data-ttu-id="36f3b-119">当你击中你的订阅的支出限制时, 你将收到电子邮件通知。</span><span class="sxs-lookup"><span data-stu-id="36f3b-119">You are notified by email when you hit the spending limit for your subscription.</span></span> <span data-ttu-id="36f3b-120">此外, Azure 门户还包括有关你的信用卡费用的通知。</span><span class="sxs-lookup"><span data-stu-id="36f3b-120">In addition, the Azure portal includes notifications about your credit spend.</span></span> <span data-ttu-id="36f3b-121">您可以根据需要调整花费限制, 甚至可以将其关闭。</span><span class="sxs-lookup"><span data-stu-id="36f3b-121">You can adjust the spending limit as desired or even turn it off.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="36f3b-122">支出限制功能特定于包含每月 Azure 信用配额的订阅。</span><span class="sxs-lookup"><span data-stu-id="36f3b-122">The spending limit feature is specific to subscriptions that include a  monthly Azure credit allotment.</span></span> <span data-ttu-id="36f3b-123">它在仅付款订阅中不可用。</span><span class="sxs-lookup"><span data-stu-id="36f3b-123">It is not available on pay-only subscriptions.</span></span>

## <a name="use-reserved-instances"></a><span data-ttu-id="36f3b-124">使用保留实例</span><span class="sxs-lookup"><span data-stu-id="36f3b-124">Use reserved instances</span></span>

<span data-ttu-id="36f3b-125">如果您的 VM 工作负载是静态且可预测的, 尤其是那些运行24x7x365 的 VM 工作负载, 则使用保留实例是一种极好的方法, 可根据 VM 大小极大可能节省 70-80%。</span><span class="sxs-lookup"><span data-stu-id="36f3b-125">If you have VM workloads that are static and predictable, particularly ones that run 24x7x365, using reserved instances is a fantastic way to potentially save up to 70-80%, depending on the VM size.</span></span> <span data-ttu-id="36f3b-126">下图显示了使用 azure 保留实例可为您节省最多 72%, 使用保留实例加上 azure 混合优势节省了高达 80% 的成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-126">The following illustration shows that using Azure reserved instances saves you up to 72% and using reserved instance plus Azure Hybrid Benefit saves up to 80% in costs.</span></span>

![该图显示了使用 azure 保留实例和 azure 混合优势与按需付费进行比较的成本优势。](../media/4-savings-coins.png)

<span data-ttu-id="36f3b-128">保留实例按一年或三年的条款购买, 并提前进行完整术语所需的付款。</span><span class="sxs-lookup"><span data-stu-id="36f3b-128">Reserved instances are purchased in one-year or three-year terms, with payment required for the full term up front.</span></span> <span data-ttu-id="36f3b-129">在购买后, Microsoft 会匹配保留项以运行实例, 并从保留中减少小时数。</span><span class="sxs-lookup"><span data-stu-id="36f3b-129">After it's purchased, Microsoft matches up the reservation to running instances and decrements the hours from your reservation.</span></span> <span data-ttu-id="36f3b-130">可以通过 Azure 门户购买保留项。</span><span class="sxs-lookup"><span data-stu-id="36f3b-130">Reservations can be purchased through the Azure portal.</span></span> <span data-ttu-id="36f3b-131">而且, 由于保留实例是计算折扣, 因此可用于 Windows 和 Linux 虚拟机。</span><span class="sxs-lookup"><span data-stu-id="36f3b-131">And because reserved instances are a compute discount, they are available for both Windows and Linux VMs.</span></span>

## <a name="choose-low-cost-locations-and-regions"></a><span data-ttu-id="36f3b-132">选择低成本位置和区域</span><span class="sxs-lookup"><span data-stu-id="36f3b-132">Choose low-cost locations and regions</span></span>

<span data-ttu-id="36f3b-133">Azure 产品、服务和资源的成本在不同位置和地区各不相同, 如果可能, 应将其用于成本较低的这些位置和地区。</span><span class="sxs-lookup"><span data-stu-id="36f3b-133">The cost of Azure products, services, and resources can vary across locations and regions, and if possible, you should use them in those locations and regions where they cost less.</span></span>

> [!NOTE]  
> <span data-ttu-id="36f3b-134">某些资源按其占用的传出网络带宽量 (出局) 进行计量和计费。</span><span class="sxs-lookup"><span data-stu-id="36f3b-134">Some resources are metered and billed according to how much outgoing network bandwidth they consume (egress).</span></span> <span data-ttu-id="36f3b-135">应设置_在同一区域中_按带宽计量的已连接资源, 以减少它们之间的传出流量。</span><span class="sxs-lookup"><span data-stu-id="36f3b-135">You should provision connected resources that are bandwidth metered _in the same region_ to reduce egress traffic between them.</span></span>

## <a name="research-available-cost-saving-offers"></a><span data-ttu-id="36f3b-136">研究可用的成本节省优惠</span><span class="sxs-lookup"><span data-stu-id="36f3b-136">Research available cost-saving offers</span></span>

<span data-ttu-id="36f3b-137">使用最新的 Azure 客户和订阅提供更新, 并切换到提供最具成本效益优势的提供。</span><span class="sxs-lookup"><span data-stu-id="36f3b-137">Keep up-to-date with the latest Azure customer and subscription offers, and switch to offers that provide the most significant cost-saving benefit.</span></span>

<span data-ttu-id="36f3b-138">您可以查看 " [azure 更新" 页面](https://azure.microsoft.com/en-us/updates/), 了解有关 Azure 产品、服务和功能的最新更新以及产品路线图和通知的信息。</span><span class="sxs-lookup"><span data-stu-id="36f3b-138">You can check the [Azure Updates page](https://azure.microsoft.com/en-us/updates/) for information about the latest updates to Azure products, services, and features, as well as product roadmaps and announcements.</span></span>

## <a name="right-size-underutilized-virtual-machines"></a><span data-ttu-id="36f3b-139">正确大小未充分利用的虚拟机</span><span class="sxs-lookup"><span data-stu-id="36f3b-139">Right-size underutilized virtual machines</span></span>

<span data-ttu-id="36f3b-140">从前面的讨论中回想, azure 成本管理和 Azure Advisor 可能建议对虚拟机进行正确的大小调整或关闭。</span><span class="sxs-lookup"><span data-stu-id="36f3b-140">Recall from our previous discussion that Azure Cost Management and Azure Advisor might recommend right-sizing or shutting down VMs.</span></span> <span data-ttu-id="36f3b-141">将虚拟机正确调整大小是将其调整为适当大小的过程。</span><span class="sxs-lookup"><span data-stu-id="36f3b-141">Right-sizing a virtual machine is the process of resizing it to a proper size.</span></span> <span data-ttu-id="36f3b-142">假设您有一个作为域控制器运行的服务器, 其大小为**Standard_D4sv3**, 但您的 VM 在绝大多数时间中处于 90% 空闲状态。</span><span class="sxs-lookup"><span data-stu-id="36f3b-142">Let's imagine you have a server running as a domain controller that is sized as a **Standard_D4sv3**, but your VM is sitting at 90% idle the vast majority of the time.</span></span> <span data-ttu-id="36f3b-143">通过将此 VM 调整为**Standard_D2sv3**, 可以将计算成本降低 50%。</span><span class="sxs-lookup"><span data-stu-id="36f3b-143">By resizing this VM to a **Standard_D2sv3**, you reduce your compute cost by 50%.</span></span> <span data-ttu-id="36f3b-144">对于同一系列中的每个大小时, 成本都是线性的和双倍的。</span><span class="sxs-lookup"><span data-stu-id="36f3b-144">Costs are linear and double for each size larger in the same series.</span></span> <span data-ttu-id="36f3b-145">在这种情况下, 您甚至可以从更改实例系列转到成本较低的 VM 系列中获益。</span><span class="sxs-lookup"><span data-stu-id="36f3b-145">In this case, you might even benefit from changing the instance series to go to a less expensive VM series.</span></span> <span data-ttu-id="36f3b-146">下图显示了通过在同一个系列中向下移动一个大小而实现的 50% 的节省。</span><span class="sxs-lookup"><span data-stu-id="36f3b-146">The following illustration shows a 50% savings achieved by moving one size down within the same series.</span></span>

![说明如何通过 downsizing 未充分利用的虚拟机来实现节省的成本。](../media/4-vm-resize.png)

<span data-ttu-id="36f3b-148">大小过大的虚拟机在 Azure 上是一个常见的不必要的费用, 可以轻松修复。</span><span class="sxs-lookup"><span data-stu-id="36f3b-148">Over-sized virtual machines are a common unnecessary expense on Azure and one that can be easily fixed.</span></span> <span data-ttu-id="36f3b-149">您可以通过 azure 门户、azure PowerShell 或 azure CLI 更改 VM 的大小。</span><span class="sxs-lookup"><span data-stu-id="36f3b-149">You can change the size of a VM through the Azure portal, Azure PowerShell, or the Azure CLI.</span></span>

> [!TIP]
> <span data-ttu-id="36f3b-150">调整虚拟机大小需要先停止、调整大小, 然后重新启动。</span><span class="sxs-lookup"><span data-stu-id="36f3b-150">Resizing a VM requires it to be stopped, resized, and then restarted.</span></span> <span data-ttu-id="36f3b-151">此操作可能需要几分钟时间, 具体取决于大小变化的多少。</span><span class="sxs-lookup"><span data-stu-id="36f3b-151">This may take a few minutes depending on how significant the size change is.</span></span> <span data-ttu-id="36f3b-152">在执行此任务时, 请规划中断, 或将流量转移到另一个实例。</span><span class="sxs-lookup"><span data-stu-id="36f3b-152">Plan for an outage, or shift your traffic to another instance while you perform this task.</span></span>

## <a name="deallocate-virtual-machines-in-off-hours"></a><span data-ttu-id="36f3b-153">取消分配虚拟机的时间 (以小时为单位)</span><span class="sxs-lookup"><span data-stu-id="36f3b-153">Deallocate virtual machines in off hours</span></span>

<span data-ttu-id="36f3b-154">如果你的虚拟机工作负载仅在特定时段内使用, 但每小时运行一次, 则会浪费资金。</span><span class="sxs-lookup"><span data-stu-id="36f3b-154">If you have virtual machine workloads that are only used during certain periods, but you're running them every hour of every day, you're wasting money.</span></span> <span data-ttu-id="36f3b-155">这些虚拟机非常适合在未使用时关闭, 并按计划重新启动, 在 VM 被释放时节省计算成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-155">These VMs are great candidates to shut down when not in use and start back up on a schedule, saving you compute costs while the VM is deallocated.</span></span>

<span data-ttu-id="36f3b-156">此方法是开发环境的绝佳策略。</span><span class="sxs-lookup"><span data-stu-id="36f3b-156">This approach is an excellent strategy for development environments.</span></span> <span data-ttu-id="36f3b-157">通常情况下, 开发可能仅在工作时间发生, 这样您就可以灵活地在下班时间内取消分配这些系统, 并从应计成本中停止计算成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-157">It's often the case that development may happen only during business hours, giving you the flexibility to deallocate these systems in the off hours and stopping your compute costs from accruing.</span></span> <span data-ttu-id="36f3b-158">Azure 现在有一个[自动化解决方案](https://docs.microsoft.com/azure/automation/automation-solution-vm-management), 可让你在你的环境中充分利用。</span><span class="sxs-lookup"><span data-stu-id="36f3b-158">Azure now has an [automation solution](https://docs.microsoft.com/azure/automation/automation-solution-vm-management) fully available for you to leverage in your environment.</span></span>

<span data-ttu-id="36f3b-159">您还可以在虚拟机上使用自动关闭功能安排自动关机。</span><span class="sxs-lookup"><span data-stu-id="36f3b-159">You can also use the auto-shutdown feature on a virtual machine to schedule automated shutdowns.</span></span>

![显示启用了关闭时间的虚拟机边栏自动关闭部分的 Azure 门户屏幕截图。](../media/4-vm-auto-shutdown.png)

## <a name="delete-unused-virtual-machines"></a><span data-ttu-id="36f3b-161">删除未使用的虚拟机</span><span class="sxs-lookup"><span data-stu-id="36f3b-161">Delete unused virtual machines</span></span>

 <span data-ttu-id="36f3b-162">此建议听起来可能很明显, 但如果您不使用服务, 则应将其关闭。</span><span class="sxs-lookup"><span data-stu-id="36f3b-162">This advice may sound obvious, but if you aren't using a service, you should shut it down.</span></span> <span data-ttu-id="36f3b-163">在不再需要的项目后面找出非生产或概念证明系统留下的情况并不常见。</span><span class="sxs-lookup"><span data-stu-id="36f3b-163">It's not uncommon to find non-production or proof-of-concept systems left around following a project that is no longer needed.</span></span> <span data-ttu-id="36f3b-164">定期查看您的环境并努力确定这些系统。</span><span class="sxs-lookup"><span data-stu-id="36f3b-164">Regularly review your environment and work to identify these systems.</span></span> <span data-ttu-id="36f3b-165">关闭这些系统可能会带来 multifaceted 好处, 只需在基础结构成本上进行保存, 但在许可和操作方面也可能会节省成本。</span><span class="sxs-lookup"><span data-stu-id="36f3b-165">Shutting down these systems can have a multifaceted benefit by saving you not only on infrastructure costs but also potential savings on licensing and operations.</span></span>

## <a name="migrate-to-paas-or-saas-services"></a><span data-ttu-id="36f3b-166">迁移到 PaaS 或 SaaS 服务</span><span class="sxs-lookup"><span data-stu-id="36f3b-166">Migrate to PaaS or SaaS services</span></span>

<span data-ttu-id="36f3b-167">最后, 当您将工作负载移到云时, 自然演变是从基础结构即服务 (IaaS) 服务开始, 然后在迭代过程中根据需要将它们移动到平台即服务 (PaaS)。</span><span class="sxs-lookup"><span data-stu-id="36f3b-167">Lastly, as you move workloads to the cloud, a natural evolution is to start with infrastructure-as-a-service (IaaS) services and then move them to platform-as-a-service (PaaS) as appropriate, in an iterative process.</span></span>

<span data-ttu-id="36f3b-168">PaaS 服务通常在资源和运营成本方面节省大量资金。</span><span class="sxs-lookup"><span data-stu-id="36f3b-168">PaaS services typically provide substantial savings in both resource and operational costs.</span></span> <span data-ttu-id="36f3b-169">困难在于, 根据服务类型, 从时间和资源角度来看, 需要进行不同级别的工作来移动到这些服务。</span><span class="sxs-lookup"><span data-stu-id="36f3b-169">The challenge is that depending on the type of service, varying levels of effort will be required to move to these services from both a time and resource perspective.</span></span> <span data-ttu-id="36f3b-170">您可以轻松地将 SQL Server 数据库移动到 Azure sql 数据库, 但将多层应用程序转移到基于容器或无服务器的体系结构可能需要更多的努力。</span><span class="sxs-lookup"><span data-stu-id="36f3b-170">You might be able to move a SQL Server database to Azure SQL Database easily, but it might take substantially more effort to transfer your multi-tier application to a container or serverless-based architecture.</span></span> <span data-ttu-id="36f3b-171">最好的做法是, 不断评估应用程序的体系结构, 以确定是否可以通过 PaaS 服务获得高效的效率。</span><span class="sxs-lookup"><span data-stu-id="36f3b-171">It's a good practice to continuously evaluate the architecture of your applications to determine if there are efficiencies to be gained through PaaS services.</span></span>

<span data-ttu-id="36f3b-172">Azure 使您能够轻松地测试这些服务, 并降低风险, 使您能够相对轻松地试用新的体系结构模式。</span><span class="sxs-lookup"><span data-stu-id="36f3b-172">Azure makes it easy to test these services with little risk, giving you the ability to try out new architecture patterns relatively easily.</span></span> <span data-ttu-id="36f3b-173">也就是说, 这通常是一项较长的旅程, 如果你要从成本节约角度寻求快速的 wins, 则可能无法立即获得帮助。</span><span class="sxs-lookup"><span data-stu-id="36f3b-173">That said, it's typically a longer journey and might not be of immediate help if you're looking for quick wins from a cost-savings perspective.</span></span> <span data-ttu-id="36f3b-174">Azure 体系结构中心是获取有关转换应用程序的建议的理想位置, 以及跨大量体系结构和 Azure 服务的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="36f3b-174">The Azure Architecture Center is a great place to get ideas for transforming your application, as well as best practices across a wide array of architectures and Azure services.</span></span>