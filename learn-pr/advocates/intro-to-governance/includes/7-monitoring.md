定义策略和访问可提供对云 IT 基础结构中的资源的精细控制。 部署这些资源后, 您需要了解他们可能遇到的任何问题或性能问题。

Azure 提供了两种主要服务来监视应用和资源的运行状况。

1. Azure 监视器
2. Azure 服务运行状况

## <a name="azure-monitor"></a>Azure 监视器

:::row:::
  :::column:::
    ![表示 Azure 监视器的图标](../media/7-azuremonitor.png)
  :::column-end:::
    :::column span="3":::
**Azure Monitor**提供了一个综合解决方案, 用于收集、分析和操作来自你的云和本地环境的遥测, 从而最大限度地提高应用程序的可用性和性能。 它可帮助您了解应用程序的执行方式并主动发现影响它们的问题以及它们所依赖的资源。
  :::column-end:::
:::row-end:::

### <a name="data-sources"></a>数据源
Azure Monitor 可以收集各种源中的数据。 您可以将应用程序的监视数据从应用程序、其所依赖的任何操作系统和服务 (而不是平台本身) 考虑在内。 

> [!div class="mx-tableFixed"]
> | 数据层 | 说明 |
> |-----------|-------------|
> | 应用程序监控数据 | 有关您编写的代码的性能和功能的数据, 而不考虑其平台。 |
> | 来宾 OS 监视数据 | 有关运行应用程序的操作系统的数据。 这可以在 Azure、另一个云或本地中运行。 |
> | Azure 资源监控数据 | 有关 Azure 资源的操作的数据。 |
> | Azure 订阅监控数据 | 有关 azure 订阅的操作和管理的数据, 以及有关 azure 本身的运行状况和操作的数据。 |
> | Azure 租户监控数据 | 有关租户级别 azure 服务 (如 Azure Active Directory) 操作的数据。 |

### <a name="diagnostic-settings"></a>诊断设置
一旦您创建 azure 订阅并开始添加资源 (如虚拟机和 web 应用), Azure Monitor 便会开始收集数据。 在创建或修改资源时,*活动日志*将记录在资源的创建或修改,*指标*将告诉您资源的执行方式以及所使用的资源。 

通过启用**诊断**和添加代理来计算资源, 您可以将正在收集的数据扩展到资源的实际操作中。 在 "资源设置" 下, 您可以启用诊断
- *启用来宾级监视*
- *性能计数器*: 收集性能数据
- *事件日志*: 启用各种事件日志
- *故障转储*: 启用或禁用
- *接收器*: 将诊断数据发送到其他服务以进行更多分析
- *代理*: 配置代理设置

### <a name="getting-more-data-from-your-apps"></a>从你的应用中获取更多数据
仅在改进计算环境中的操作可见时, 数据监控才有用。 Azure Monitor 包含多种功能和工具, 可提供对应用程序的有价值的见解以及它们可能依赖的其他资源。

**application Insights**是一项服务, 可监视 web 应用程序的可用性、性能和使用情况, 无论它们是托管在云中还是在本地。 它利用日志分析中功能强大的数据分析平台向您提供对应用程序操作的深入见解。  Application Insights 无需等待用户报告即可诊断错误。 Application Insights 包含指向各种开发工具的连接点, 并与 Microsoft Visual Studio 集成以支持您的 DevOps 过程。

"**容器的 Azure 监视器**" 是一种服务, 旨在监视容器工作负载的性能, 这些工作负载部署到 Azure Kubernetes 服务 (AKS) 托管的托管 Kubernetes 群集中。 它通过从控制器、节点和容器中收集内存和处理器指标 (可通过指标 API 在 Kubernetes 中提供) 来提供性能可见性。 还收集了容器日志。

**azure Monitor of 虚拟机**是一项服务, 它通过分析 Windows 和 Linux vm 的性能和运行状况 (包括它们的不同过程和其他资源的相互连接的依赖项) 来监视 azure vm 以及外部进程)。 虚拟机的 Azure 监视器包括对托管在本地的 vm 的性能和应用程序依赖性的支持, 以及与其他云提供商托管的 vm 的支持。

将任何或所有这些监视服务与 Azure 服务运行状况相集成都有额外的好处。 及时了解 azure 服务的运行状况状态, 可帮助您了解影响 azure 服务的问题对环境的影响。 看起来像本地化的问题可能是一个更广泛的问题的结果, 而 Azure 服务运行状况提供了这种类型的洞察力。 azure 服务运行状况确定可能会影响应用程序的 azure 服务的任何问题。 Azure 服务运行状况还有助于规划计划的维护。

### <a name="responding-to-alert-conditions"></a>响应警报条件
除了允许您以交互方式分析监视数据之外, 有效的监视解决方案必须主动响应收集的数据中标识的任何关键条件。 例如, 这可能涉及将文本或电子邮件发送给负责调查问题的管理员, 或者启动尝试纠正错误条件的自动过程。

**通知**。 Azure Monitor 主动通知你使用警报的关键情况, 并可能尝试采取纠正措施。 基于指标的警报规则可以基于数值在几乎实时提供警报。 基于日志的警报规则允许跨数据的复杂逻辑, 来自多个源。

**自动缩放**。 Azure Monitor 使用自动缩放, 以确保您有适当的资源来运行, 以有效管理应用程序上的负载。 自动缩放使您能够创建使用 Azure Monitor 收集的指标的规则, 以确定何时自动添加资源以处理负载增加。 自动缩放还可以通过删除未使用的资源来帮助减少 Azure 成本。 您可以指定最小和最大实例数, 并提供确定自动缩放何时应增加或减少资源的逻辑。

### <a name="visualize-monitoring-data"></a>可视化监视数据
可视化效果 (如图表和表格) 是用于汇总监控数据并向不同受众呈现数据的有效工具。 Azure 监视器具有其自己的可视化监视数据的功能, 并利用其他 Azure 服务为不同的访问群体发布数据。 可用于可视化数据的其他工具 (针对特定访问群体和方案) 包括:

- 概括性
- 视图
- Power BI

### <a name="integrate-with-other-services"></a>与其他服务集成
您通常需要将 Azure 监视器与其他系统集成, 并构建使用您的监视数据的自定义解决方案。 其他 azure 服务可与 azure Monitor 配合使用, 以提供此集成。

## <a name="azure-service-health"></a>Azure 服务运行状况

:::row:::
  :::column:::
    ![表示 Azure 监视器的图标](../media/7-azureservicehealth.png)
  :::column-end:::
    :::column span="3":::
**azure 服务运行状况**是一系列的体验, 可在 Azure 服务出现的问题影响时提供个性化指导和支持。 它可以通知你, 帮助你了解问题的影响, 并在问题解决后及时更新。 Azure 服务运行状况还可帮助你准备计划的维护和可能影响你的资源可用性的更改。
  :::column-end:::
:::row-end:::

Azure 服务运行状况由以下视图组成。

**azure 状态**提供 azure 服务运行状况状态的全局视图。 在 Azure 状态下, 你可以获取有关服务可用性的最新信息。 每个人都有权访问 Azure 状态, 并且可以查看报告其运行状况状态的所有服务。

**服务运行状况**为你提供了一个可自定义的仪表板, 用于跟踪你的 Azure 服务在使用的区域中的状态。 在此仪表板中, 可以跟踪活动事件, 如日常服务问题、即将进行的计划内维护或相关的*运行状况通报*。 当事件变为非活动状态时, 它们将放在*运行状况历史记录*中, 最长可达90天。 最后, 您可以使用**服务运行状况**仪表板来创建和管理服务*运行状况警报*, 这将在出现影响您的服务问题时通知您。

**资源运行状况**可帮助你在 Azure 服务问题影响你的资源时诊断和获取支持。 它提供了有关您的资源的当前和过去状态的详细信息。 此外, 它还提供技术支持来帮助您缓解问题。 与 azure 状态 (即通知您影响大量 Azure 客户的服务问题) 的不同之处是,*资源运行状况*为您的资源运行状况提供个性化的仪表板。 *资源运行状况*显示了你的资源因 Azure 服务问题而不可用时的时间 (过去)。 然后, 您可以更轻松地了解是否违反了 SLA。

azure 服务运行状况组件共同提供了 azure 的运行状况状态的综合视图, 以与你最相关的粒度级别为依据。