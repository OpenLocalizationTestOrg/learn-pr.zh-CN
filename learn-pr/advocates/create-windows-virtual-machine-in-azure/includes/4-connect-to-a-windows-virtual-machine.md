<span data-ttu-id="b7f59-101">现在, 我们已在 Azure 中安装了 Windows VM, 接下来要做的是, 将应用程序和数据放置在这些虚拟机上, 以处理我们的流量视频。</span><span class="sxs-lookup"><span data-stu-id="b7f59-101">Now that we have a Windows VM in Azure, the next thing you’ll do is put your applications and data on those VMs to process our traffic videos.</span></span> 

<span data-ttu-id="b7f59-102">但是, 除非已将站点到站点 VPN 设置为 azure, 否则你的 azure vm 将无法从你的本地网络访问。</span><span class="sxs-lookup"><span data-stu-id="b7f59-102">However, unless you’ve set up a site-to-site VPN to Azure, your Azure VMs won’t be accessible from your local network.</span></span> <span data-ttu-id="b7f59-103">如果只是开始使用 Azure, 您不太可能拥有工作的站点到站点 VPN。</span><span class="sxs-lookup"><span data-stu-id="b7f59-103">If you’re just getting started with Azure, it’s unlikely that you have a working site-to-site VPN.</span></span> <span data-ttu-id="b7f59-104">那么, 如何将文件传输到 Azure vm 呢？</span><span class="sxs-lookup"><span data-stu-id="b7f59-104">So how can you transfer files to Azure VMs?</span></span> <span data-ttu-id="b7f59-105">一种简单的方法是使用 azure 的远程桌面连接功能, 与新的 Azure 虚拟机共享你的本地驱动器。</span><span class="sxs-lookup"><span data-stu-id="b7f59-105">One easy way is to use Azure’s Remote Desktop Connections feature to share your local drives with your new Azure VMs.</span></span>

<span data-ttu-id="b7f59-106">现在, 我们已有一个新的 Windows 虚拟机, 我们需要将自定义软件安装到它上面。</span><span class="sxs-lookup"><span data-stu-id="b7f59-106">Now that we have a new Windows virtual machine, we need to install our custom software on to it.</span></span> <span data-ttu-id="b7f59-107">有几种方法可以实现此目的。</span><span class="sxs-lookup"><span data-stu-id="b7f59-107">There are several ways we can do this.</span></span>

- <span data-ttu-id="b7f59-108">远程桌面协议 (RDP)</span><span class="sxs-lookup"><span data-stu-id="b7f59-108">Remote Desktop Protocol (RDP)</span></span>
- <span data-ttu-id="b7f59-109">自定义脚本</span><span class="sxs-lookup"><span data-stu-id="b7f59-109">Custom scripts</span></span>
- <span data-ttu-id="b7f59-110">自定义 VM 映像 (预安装了软件)</span><span class="sxs-lookup"><span data-stu-id="b7f59-110">Custom VM images (with the software preinstalled)</span></span>

<span data-ttu-id="b7f59-111">让我们来看一下 Windows 虚拟机的最简单方法: 远程桌面。</span><span class="sxs-lookup"><span data-stu-id="b7f59-111">Let's look at the simplest approach for Windows VMs: Remote Desktop.</span></span>

## <a name="what-is-the-remote-desktop-protocol"></a><span data-ttu-id="b7f59-112">远程桌面协议是什么？</span><span class="sxs-lookup"><span data-stu-id="b7f59-112">What is the Remote Desktop Protocol?</span></span>

<span data-ttu-id="b7f59-113">远程桌面 (RDP) 提供到基于 Windows 的计算机的 UI 的远程连接。</span><span class="sxs-lookup"><span data-stu-id="b7f59-113">Remote Desktop (RDP) provides remote connectivity to the UI of Windows-based computers.</span></span> <span data-ttu-id="b7f59-114">RDP 使您能够登录到远程物理或虚拟 Windows 计算机, 并控制该计算机, 就像您在控制台上已安装一样。</span><span class="sxs-lookup"><span data-stu-id="b7f59-114">RDP enables you to sign in to a remote physical or virtual Windows computer and control that computer as if you were seated at the console.</span></span> <span data-ttu-id="b7f59-115">通过 RDP 连接, 可以执行可以从物理计算机的控制台执行的绝大多数操作, 但某些电源和硬件相关功能除外。</span><span class="sxs-lookup"><span data-stu-id="b7f59-115">An RDP connection enables you to carry out the vast majority of operations that you can do from the console of a physical computer, with the exception of some power and hardware-related functions.</span></span>

<span data-ttu-id="b7f59-116">rdp 连接需要 rdp 客户端。</span><span class="sxs-lookup"><span data-stu-id="b7f59-116">An RDP connection requires an RDP client.</span></span> <span data-ttu-id="b7f59-117">Microsoft 为以下操作系统提供 RDP 客户端:</span><span class="sxs-lookup"><span data-stu-id="b7f59-117">Microsoft provides RDP clients for the following operating systems:</span></span>

- <span data-ttu-id="b7f59-118">Windows (内置)</span><span class="sxs-lookup"><span data-stu-id="b7f59-118">Windows (built-in)</span></span>
- <span data-ttu-id="b7f59-119">MacOS</span><span class="sxs-lookup"><span data-stu-id="b7f59-119">MacOS</span></span>
- <span data-ttu-id="b7f59-120">iOS</span><span class="sxs-lookup"><span data-stu-id="b7f59-120">iOS</span></span>
- <span data-ttu-id="b7f59-121">Android</span><span class="sxs-lookup"><span data-stu-id="b7f59-121">Android</span></span>

<span data-ttu-id="b7f59-122">下面的屏幕截图显示 Windows 10 中的远程桌面协议客户端。</span><span class="sxs-lookup"><span data-stu-id="b7f59-122">The following screenshot displays the Remote Desktop Protocol client in Windows 10.</span></span>

![远程桌面协议客户端的用户界面的屏幕截图。](../media/4-rdp-client.png)

<span data-ttu-id="b7f59-124">此外, 还提供了开放源代码 Linux 客户端, 如 Remmina, 使您能够从 Ubuntu 分布中连接到 Windows 电脑。</span><span class="sxs-lookup"><span data-stu-id="b7f59-124">There are also open source Linux clients, such as Remmina that enable you to connect to a Windows PC from an Ubuntu distribution.</span></span>

## <a name="connecting-to-an-azure-vm"></a><span data-ttu-id="b7f59-125">连接到 Azure VM</span><span class="sxs-lookup"><span data-stu-id="b7f59-125">Connecting to an Azure VM</span></span>

<span data-ttu-id="b7f59-126">正如我们看到的, Azure 虚拟机在虚拟网络上进行通信。</span><span class="sxs-lookup"><span data-stu-id="b7f59-126">As we saw a moment ago, Azure VMs communicate on a virtual network.</span></span> <span data-ttu-id="b7f59-127">他们还可以为其分配一个可选的公共 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="b7f59-127">They can also have an optional public IP address assigned to them.</span></span> <span data-ttu-id="b7f59-128">通过公用 IP, 我们可以通过 Internet 与 VM 通信。</span><span class="sxs-lookup"><span data-stu-id="b7f59-128">With a public IP, we can communicate with the VM over the Internet.</span></span> <span data-ttu-id="b7f59-129">此外, 我们还可以设置将本地网络连接到 Azure 的虚拟专用网络 (VPN), 让我们能够安全地连接到 VM, 而不公开公共 IP。</span><span class="sxs-lookup"><span data-stu-id="b7f59-129">Alternatively, we can setup a virtual private network (VPN) that connects our on-premises network to Azure - letting us securely connect to the VM without exposing a public IP.</span></span> <span data-ttu-id="b7f59-130">此方法在其他模块中进行了介绍, 如果您有兴趣浏览该选项, 则会对其进行全面记录。</span><span class="sxs-lookup"><span data-stu-id="b7f59-130">This approach is covered in another module and is fully documented if you are interested in exploring that option.</span></span>

<span data-ttu-id="b7f59-131">在 Azure 中使用公用 IP 地址需要注意的一点是, 它们通常是动态分配的。</span><span class="sxs-lookup"><span data-stu-id="b7f59-131">One thing to be aware of with public IP addresses in Azure is they are often dynamically allocated.</span></span> <span data-ttu-id="b7f59-132">这意味着, 在 vm 重新启动时, IP 地址可能会随着时间的推移而变化。</span><span class="sxs-lookup"><span data-stu-id="b7f59-132">That means the IP address can change over time - for VMs this happens when the VM is restarted.</span></span> <span data-ttu-id="b7f59-133">如果要直接连接到 IP 地址而不是名称, 并且需要确保 IP 地址不会发生变化, 则可以使用更多的费用来分配静态地址。</span><span class="sxs-lookup"><span data-stu-id="b7f59-133">You can pay more to assign static addresses if you want to connect directly to an IP address instead of a name and need to ensure that the IP address will not change.</span></span>

### <a name="how-do-you-connect-to-a-vm-in-azure-using-rdp"></a><span data-ttu-id="b7f59-134">如何使用 RDP 在 Azure 中连接到 VM？</span><span class="sxs-lookup"><span data-stu-id="b7f59-134">How do you connect to a VM in Azure using RDP?</span></span>

<span data-ttu-id="b7f59-135">使用 RDP 连接到 Azure 中的 VM 是一个简单的过程。</span><span class="sxs-lookup"><span data-stu-id="b7f59-135">Connecting to a VM in Azure using RDP is a simple process.</span></span> <span data-ttu-id="b7f59-136">在 Azure 门户中, 转到 VM 的属性, 然后在顶部单击 "**连接**"。</span><span class="sxs-lookup"><span data-stu-id="b7f59-136">In the Azure portal, you go to the properties of your VM, and at the top, click **Connect**.</span></span> <span data-ttu-id="b7f59-137">这将显示分配给 VM 的 IP 地址, 并提供下载 Windows 随后在 rdp 客户端中打开的预配置 **.rdp**文件的选项。</span><span class="sxs-lookup"><span data-stu-id="b7f59-137">This will show you the IP addresses assigned to the VM and give you the option to download a preconfigured **.rdp** file that Windows then opens in the RDP client.</span></span> <span data-ttu-id="b7f59-138">可以选择通过 RDP 文件中的 VM 的公共 IP 地址进行连接。</span><span class="sxs-lookup"><span data-stu-id="b7f59-138">You can choose to connect over the public IP address of the VM in the RDP file.</span></span> <span data-ttu-id="b7f59-139">或者, 如果通过 VPN 或 ExpressRoute 连接, 则可以选择 "内部 IP 地址"。</span><span class="sxs-lookup"><span data-stu-id="b7f59-139">Alternatively, if you're connecting over VPN or ExpressRoute, you can select the internal IP address.</span></span> <span data-ttu-id="b7f59-140">您还可以选择连接的端口号。</span><span class="sxs-lookup"><span data-stu-id="b7f59-140">You can also select the port number for the connection.</span></span>

<span data-ttu-id="b7f59-141">如果您使用的是 VM 的静态公共 IP 地址, 则可以将 **.rdp**文件保存到您的桌面。</span><span class="sxs-lookup"><span data-stu-id="b7f59-141">If you're using a static public IP address for the VM, you can save the **.rdp** file to your desktop.</span></span> <span data-ttu-id="b7f59-142">如果使用的是动态 IP 寻址, **.rdp**文件仅在运行 VM 时保持有效。</span><span class="sxs-lookup"><span data-stu-id="b7f59-142">If you're using dynamic IP addressing, the **.rdp** file only remains valid while the VM is running.</span></span> <span data-ttu-id="b7f59-143">如果您停止并重新启动 VM, 则必须下载另一个 **.rdp**文件。</span><span class="sxs-lookup"><span data-stu-id="b7f59-143">If you stop and restart the VM, you must download another **.rdp** file.</span></span>

> [!TIP]
> <span data-ttu-id="b7f59-144">您还可以将 VM 的公共 IP 地址输入到 Windows RDP 客户端, 然后单击 "**连接**"。</span><span class="sxs-lookup"><span data-stu-id="b7f59-144">You can also enter the public IP address of the VM into the Windows RDP client and click **Connect**.</span></span>

<span data-ttu-id="b7f59-145">当您进行连接时, 通常会收到两个警告。</span><span class="sxs-lookup"><span data-stu-id="b7f59-145">When you connect, you will typically receive two warnings.</span></span> <span data-ttu-id="b7f59-146">这些内容包括:</span><span class="sxs-lookup"><span data-stu-id="b7f59-146">These are:</span></span>

<span data-ttu-id="b7f59-147">-**发布者警告**-由于 **.rdp**文件未公开签名导致的问题。</span><span class="sxs-lookup"><span data-stu-id="b7f59-147">-**Publisher warning** - caused by the **.rdp** file not being publicly signed.</span></span>
- <span data-ttu-id="b7f59-148">**证书警告**-由不受信任的计算机证书引起的。</span><span class="sxs-lookup"><span data-stu-id="b7f59-148">**Certificate warning** - caused by the machine certificate not being trusted.</span></span>

<span data-ttu-id="b7f59-149">在测试环境中, 可以忽略这些警告。</span><span class="sxs-lookup"><span data-stu-id="b7f59-149">In test environments, these warnings can be ignored.</span></span> <span data-ttu-id="b7f59-150">在生产环境中, 可以使用 RDPSIGN 对 **.rdp**文件进行签名 **。EXE**和放置在客户端的**受信任根证书颁发机构**存储中的计算机证书。</span><span class="sxs-lookup"><span data-stu-id="b7f59-150">In production environments, the **.rdp** file can be signed using **RDPSIGN.EXE** and the machine certificate placed in the client's **Trusted Root Certification Authorities** store.</span></span>

<span data-ttu-id="b7f59-151">让我们尝试使用 RDP 连接到我们的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="b7f59-151">Let's try using RDP to connect to our VM.</span></span>