现在, 我们已在 Azure 中安装了 Windows VM, 接下来要做的是, 将应用程序和数据放置在这些虚拟机上, 以处理我们的流量视频。 

但是, 除非已将站点到站点 VPN 设置为 azure, 否则你的 azure vm 将无法从你的本地网络访问。 如果只是开始使用 Azure, 您不太可能拥有工作的站点到站点 VPN。 那么, 如何将文件传输到 Azure vm 呢？ 一种简单的方法是使用 azure 的远程桌面连接功能, 与新的 Azure 虚拟机共享你的本地驱动器。

现在, 我们已有一个新的 Windows 虚拟机, 我们需要将自定义软件安装到它上面。 有几种方法可以实现此目的。

- 远程桌面协议 (RDP)
- 自定义脚本
- 自定义 VM 映像 (预安装了软件)

让我们来看一下 Windows 虚拟机的最简单方法: 远程桌面。

## <a name="what-is-the-remote-desktop-protocol"></a>远程桌面协议是什么？

远程桌面 (RDP) 提供到基于 Windows 的计算机的 UI 的远程连接。 RDP 使您能够登录到远程物理或虚拟 Windows 计算机, 并控制该计算机, 就像您在控制台上已安装一样。 通过 RDP 连接, 可以执行可以从物理计算机的控制台执行的绝大多数操作, 但某些电源和硬件相关功能除外。

rdp 连接需要 rdp 客户端。 Microsoft 为以下操作系统提供 RDP 客户端:

- Windows (内置)
- MacOS
- iOS
- Android

下面的屏幕截图显示 Windows 10 中的远程桌面协议客户端。

![远程桌面协议客户端的用户界面的屏幕截图。](../media/4-rdp-client.png)

此外, 还提供了开放源代码 Linux 客户端, 如 Remmina, 使您能够从 Ubuntu 分布中连接到 Windows 电脑。

## <a name="connecting-to-an-azure-vm"></a>连接到 Azure VM

正如我们看到的, Azure 虚拟机在虚拟网络上进行通信。 他们还可以为其分配一个可选的公共 IP 地址。 通过公用 IP, 我们可以通过 Internet 与 VM 通信。 此外, 我们还可以设置将本地网络连接到 Azure 的虚拟专用网络 (VPN), 让我们能够安全地连接到 VM, 而不公开公共 IP。 此方法在其他模块中进行了介绍, 如果您有兴趣浏览该选项, 则会对其进行全面记录。

在 Azure 中使用公用 IP 地址需要注意的一点是, 它们通常是动态分配的。 这意味着, 在 vm 重新启动时, IP 地址可能会随着时间的推移而变化。 如果要直接连接到 IP 地址而不是名称, 并且需要确保 IP 地址不会发生变化, 则可以使用更多的费用来分配静态地址。

### <a name="how-do-you-connect-to-a-vm-in-azure-using-rdp"></a>如何使用 RDP 在 Azure 中连接到 VM？

使用 RDP 连接到 Azure 中的 VM 是一个简单的过程。 在 Azure 门户中, 转到 VM 的属性, 然后在顶部单击 "**连接**"。 这将显示分配给 VM 的 IP 地址, 并提供下载 Windows 随后在 rdp 客户端中打开的预配置 **.rdp**文件的选项。 可以选择通过 RDP 文件中的 VM 的公共 IP 地址进行连接。 或者, 如果通过 VPN 或 ExpressRoute 连接, 则可以选择 "内部 IP 地址"。 您还可以选择连接的端口号。

如果您使用的是 VM 的静态公共 IP 地址, 则可以将 **.rdp**文件保存到您的桌面。 如果使用的是动态 IP 寻址, **.rdp**文件仅在运行 VM 时保持有效。 如果您停止并重新启动 VM, 则必须下载另一个 **.rdp**文件。

> [!TIP]
> 您还可以将 VM 的公共 IP 地址输入到 Windows RDP 客户端, 然后单击 "**连接**"。

当您进行连接时, 通常会收到两个警告。 这些内容包括:

-**发布者警告**-由于 **.rdp**文件未公开签名导致的问题。
- **证书警告**-由不受信任的计算机证书引起的。

在测试环境中, 可以忽略这些警告。 在生产环境中, 可以使用 RDPSIGN 对 **.rdp**文件进行签名 **。EXE**和放置在客户端的**受信任根证书颁发机构**存储中的计算机证书。

让我们尝试使用 RDP 连接到我们的虚拟机。