我们已部署并运行 Windows VM, 但未将其配置为执行任何工作。

回想一下我们的方案是视频处理系统。 我们的平台通过 FTP 接收文件。 通讯摄像机将视频剪辑上载到一个已知的 URL, 该 URL 映射到服务器上的文件夹。 每个 Windows VM 上的自定义软件作为一项服务运行, 并监视该文件夹并处理每个已上载的剪辑。 然后, 它将规范化的视频传递给在其他 Azure 服务上运行的算法。

若要支持此方案, 我们需要进行以下配置:

- 安装 FTP 并打开通信所需的端口。
- 安装城市的摄像头系统特有的专用视频编解码器。
- 安装处理已上载视频的转码服务。

其中很多是典型的管理任务, 我们不会在这里实际介绍, 并且我们没有要安装的软件。 相反, 我们将逐步完成这些步骤, 并向你展示__ 如何使用远程桌面安装自定义或第三方软件。 首先, 我们来获取连接信息。

## <a name="connect-to-the-vm-with-remote-desktop-protocol"></a>使用远程桌面协议连接到 VM

若要使用 RDP 客户端连接到 Azure 虚拟机, 你将需要:

- vm 的公共 IP 地址 (如果虚拟机配置为连接到网络, 则为 "私人")。
- 端口号。

您可以将此信息输入到 RDP 客户端, 也可以下载预先配置的**RDP**文件。

### <a name="download-the-rdp-file"></a>下载 RDP 文件

1. 在[Azure 门户](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)中, 确保先前创建的虚拟机的**概述**面板处于打开状态。 如果需要打开 VM, 则可以在 "**所有资源**" 下找到它。 概述面板包含有关 VM 的大量信息。

    - 您可以查看虚拟机是否正在运行。
    - 停止或重新启动它。
    - 获取用于连接到 VM 的公共 IP 地址。
    - 查看 CPU、磁盘和网络的活动。

1. 单击窗格顶部的 "**连接**" 按钮。

1. 在 "**连接到虚拟机**叶片" 中, 记下 " **IP 地址**" 和 "**端口号**" 设置, 然后单击 "**下载 RDP 文件**" 并将其保存到计算机。

1. 在连接之前, 我们先调整几个设置。 在 Windows 上, 使用资源管理器查找文件, 然后右键单击并选择 "**编辑**"。 在 MacOS 上, 需要先使用 RDP 客户端打开文件, 然后在显示的列表中右键单击该项目, 然后选择 "**编辑**"。

1. 您可以调整各种设置, 以控制连接到 Azure VM 的体验。 您要检查的设置包括:

    - **显示**: 默认情况下, 它将全屏显示。 您可以将其更改为较低的分辨率, 如果您有多个监视器, 则使用所有监视器。
    - **本地资源**: 可以与 vm 共享本地驱动器-允许你将文件从电脑复制到 vm。 单击 "**本地设备和资源**" 下的 "**更多**" 按钮以选择共享内容。
    - **体验**: 根据你的网络质量调整视觉体验。

1. 共享本地 C: 驱动器, 使其对 VM 可见。

1. 切换回 "**常规**" 选项卡, 然后单击 "**保存**" 以保存所做的更改。 你可以随时返回并稍后编辑此文件, 以尝试其他设置。

### <a name="connect-to-the-windows-vm"></a>连接到 Windows VM

1. 单击 "**连接**" 按钮以启动到 VM 的连接。

1. 在 "**远程桌面连接**" 对话框中, 记下 "安全警告" 和 "远程计算机 IP 地址", 然后单击 "**连接**"。

1. 在 " **Windows 安全性**" 对话框中, 输入您在步骤6和7中使用的用户名和密码。

    > [!NOTE]
    > 如果您使用 Windows 客户端连接到 VM, 它将默认为您的计算机上的已知标识。 您可以单击 "**更多选择**" 选项, 然后选择 "使用其他帐户", 让您输入不同的用户名/密码组合。

1. 在第二个 "**远程桌面连接**" 对话框中, 记下证书错误, 然后单击 **"是"**。

### <a name="install-worker-roles"></a>安装辅助角色

首次连接到 Windows server VM 时, 将启动服务器管理器。 这使您可以为常见的 web 或数据任务分配 worker 角色。 还可以通过 "开始" 菜单启动服务器管理器。

这是我们将 Web 服务器角色添加到服务器的地方。 这将在配置过程中安装 IIS 和, 以关闭 HTTP 请求并启用 FTP 服务器。 或者, 我们可以忽略 IIS 并安装第三方 FTP 服务器。 然后, 将 FTP 服务器配置为允许访问我们添加到 VM 的大型数据驱动器上的文件夹。

由于我们不会在此处实际配置这些内容, 因此只需关闭服务器管理器即可。

## <a name="install-custom-software"></a>安装自定义软件

我们有两种方法可用于安装软件。 首先, 此 VM 已连接到 Internet。 如果所需的软件具有可下载的安装程序, 则可以在 RDP 会话中打开 web 浏览器、下载软件并安装它。 其次, 如果软件是自定义的 (如自定义服务), 您可以将其从本地计算机复制到 VM 以安装它。 让我们来看看这后一方法。

1. 打开文件资源管理器。 单击边栏中的 "**这台电脑**"。 您应该会看到几个驱动器:

    - Windows (C:)表示操作系统的驱动器。
    - 临时存储 (D:)驱动器.
    - 本地 C: drive (它的名称将与下图所示的名称不同)。

    ![显示与 Azure VM 共享的本地驱动器的屏幕截图。](../media/6-drive-list.png)

通过对本地驱动器的访问权限, 您可以将自定义软件的文件复制到 VM 并安装软件。 我们实际上不会这样做, 因为它只是一个模拟方案, 但您可以想像它的工作方式。

在驱动器列表中观察的更有趣的事情是_缺少_的内容。 请注意, 我们的**数据**驱动器不存在。 Azure 添加了一个 VHD, 但未将其初始化。

## <a name="initialize-data-disks"></a>初始化数据磁盘

从头开始创建的任何其他驱动器都需要进行初始化和格式化。 执行此操作的过程与物理驱动器相同。

1. 从 "开始" 菜单启动 "**磁盘管理**" 工具。 您可能需要先转到 "计算机管理" 工具, 再转到 "磁盘管理", 或尝试在 "开始" 菜单中搜索 "磁盘管理"。

1. 它将显示一条警告, 指出它已检测到未初始化的磁盘。

    ![显示有关 VM 中未初始化的数据磁盘的磁盘管理工具警告的屏幕截图。](../media/6-disk-management.png)

1. 单击 **"确定"** 以初始化磁盘。 它将显示在可以设置格式的卷列表中, 并为其分配驱动器号。

1. 打开文件资源管理器, 您现在应该会看到您的数据驱动器。

1. 继续并关闭 RDP 客户端以注销 VM。 服务器将继续运行。

RDP 允许你像本地计算机一样使用 Azure 虚拟机。 使用桌面 UI 访问时, 您可以像管理任何 Windows 计算机一样管理此 VM: 安装软件、配置角色、调整功能和其他常见任务。 但是, 这是一个手动过程-如果我们始终需要安装一些软件, 则可以考虑使用脚本自动执行该过程。