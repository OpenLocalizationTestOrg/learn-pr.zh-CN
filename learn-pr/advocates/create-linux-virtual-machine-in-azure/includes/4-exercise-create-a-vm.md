请记住, 我们的目标是将运行 Apache 的现有 Linux 服务器移动到 Azure。 我们将首先创建 Ubuntu Linux 服务器。

## <a name="create-a-new-linux-virtual-machine"></a>创建新的 Linux 虚拟机

我们可以使用 azure 门户、azure CLI 或 azure PowerShell 创建 Linux 虚拟机。 从 Azure 开始时, 最简单的方法是使用门户, 因为它将引导您完成所需的信息, 并在创建过程中提供提示和有用的消息:

1. 使用与激活沙盒时相同的帐户登录[Azure 门户](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)。

1. 单击 Azure 门户左上角的 "**创建资源**"。

1. 在搜索框中, 输入**Ubuntu 服务器**以查看可用的不同版本。 从显示的列表中选择 " **Ubuntu Server 18.04 LTS** "。

1. 单击 "**创建**" 按钮开始配置 VM。

## <a name="configure-the-vm-settings"></a>配置虚拟机设置

门户中的 VM 创建体验以一种向导格式显示, 以引导您完成 VM 的所有配置区域。 单击 "**下一步**" 按钮将转到下一个可配置的部分。 但是, 您可以在中的各节之间移动, 这些选项卡将在标识每个部件的顶部运行。

![显示初始创建 Ubuntu 服务器计算机的虚拟机薄片的 Azure 门户屏幕截图。](../media/3-azure-portal-create-vm.png)

一旦您填写了所有必需的选项 (用红色星号标识), 您就可以跳过向导体验的其余部分, 并通过底部的 "**审阅 + 创建**" 按钮开始创建 VM。

我们将从 "**基础知识**" 部分开始。 这些说明适用于沙盒门户。 如果你使用的是其他 Azure 门户帐户, 你可能需要相应地调整一些详细信息。

### <a name="configure-basic-vm-settings"></a>配置基本虚拟机设置

1. 对于**订阅**, 默认情况下应为您选择沙盒订阅。

1. 对于**资源组**, 默认情况下应为您选择名称为**<rgn>[沙盒资源组名称]</rgn>** 的资源组。

1. 在 "**实例详细信息**" 部分, 输入您的 web 服务器 VM 的名称, 例如**eus-vm1**。 这表示环境 (**测试**)、角色 (**web**)、位置 (**东 US**)、服务 (**vm**) 和实例号 (**1**)。
    - 我们认为, 最佳做法是对资源名称进行标准化, 以便您可以快速确定其用途。 Linux VM 名称必须介于1到64个字符之间, 并且由数字、字母和短划线组成。

    > [!NOTE]
    > 当您在每个自由文本字段中更改设置和选项卡时, Azure 将自动验证每个值, 并在其正常时在其旁边放置绿色复选标记。 您可以将鼠标指针悬停在错误指示器上方, 以获取有关它发现的问题的详细信息。

1. 选择一个位置。

    <!-- Resource selection -->  
    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

1. 将**可用性选项**设置为 "**无需任何基础结构冗余**"。 此选项可用于通过将多个虚拟机作为一组进行分组以处理计划内或计划外的维护事件或中断, 从而确保虚拟机高度可用。 在本练习中, 我们将不需要此服务。

1. 确保将图像设置为**Ubuntu Server 18.04 LTS**。 您可以打开下拉列表以查看所有可用选项。

1. **Size**字段不是直接可编辑的, 并且具有**DS2_v3**默认大小, 这是通用计算选择之一。 此选项对于公共 web 服务器而言非常理想, 但用于演示单击 "**更改大小**" 链接以浏览其他 VM 大小。 请注意, 生成的对话框允许您基于 # of **vCPUs**、 **Name**和**Disk Type**进行筛选。 选择相同的**DS2_v3**选项, 它为您提供了两个具有 8 GB RAM 的 vCPUs。

1. 若要转到 "**管理员访问**" 部分, 请在 "**身份验证类型**" 中选择 " **SSH 公钥**" 选项。

1. 输入你将用于使用 SSH 登录的**用户名**。 选择你可以记住或记下它的内容。

1. 从您在上一个设备中创建的公钥文件中复制 SSH 密钥, 并将其粘贴到**SSH 公钥**字段中。

    > [!IMPORTANT]
    > 将公钥复制到 Azure 门户中时, 请确保不添加任何其他空格或换行符。

1. 在 "**入站端口规则**" 部分, 选择 "**允许选择的端口**"。 由于这是 Linux VM, 因此我们希望能够远程使用 SSH 访问 VM。 如有必要, 滚动 "**选择入站端口**" 列表, 直到找到**SSH (22)** 并启用它。

    ![显示入站端口设置的 Azure 门户的屏幕截图, 如为 SSH 访问打开 Linux VM 所述。](../media/3-open-ports.png)

## <a name="configure-disks-for-the-vm"></a>为 VM 配置磁盘

1. 单击 "**下一步: 磁盘 >** " 移动到 "**磁盘**" 部分。

1. 为**OS 磁盘类型**选择 "**高级 SSD** "。

### <a name="create-a-data-disk"></a>创建数据磁盘

回想一下, 我们将获取 OS 磁盘 (/dev/sda) 和临时磁盘 (/dev/sdb)。 还可以添加数据磁盘:

1. 单击 "**数据磁盘**" 部分中的 "**创建并附加新磁盘**" 链接。

    ![显示 "创建新磁盘" 边栏的 Azure 门户屏幕截图。](../media/3-add-data-disk.png)

1. 您可以采用所有默认值:**高级 SSD**、自动生成的名称、 **1023** GiB 的大小和**无 (空磁盘)** 作为**源类型**, 但请注意, 源类型是可以使用快照或 Azure Blob 存储创建 VHD 的位置。.

1. 单击 **"确定"** 以创建磁盘并返回到 "**数据磁盘**" 部分。

1. 现在, 第一行中应该有一个新磁盘。

    ![显示用于 VM 创建过程的新创建的数据磁盘行的 Azure 门户屏幕截图。](../media/3-new-disk.png)

## <a name="configure-the-network"></a>配置网络

1. 单击 "**下一步: 网络 >** " 移动到 "**网络**" 部分。

1. 在我们已有其他组件的生产环境中, 您想要利用_现有_的虚拟网络。 这样一来, 你的 VM 可以与解决方案中的其他云服务进行通信。 如果尚未在此位置中定义任何一个, 则可以在此处创建并配置以下内容:
    - **地址空间**: 此网络可用的总 IPV4 空间。
    - **子网范围**: 要细分地址空间的第一个子网-它必须在定义的地址空间内。 创建 VNet 后, 可以添加其他子网。

> [!NOTE]
> 默认情况下, Azure 将为你的 VM 创建虚拟网络、网络接口和公用 IP。 在创建虚拟机之后更改网络选项并不常用, 因此请务必仔细检查在 Azure 中创建的服务上的网络分配。 在本练习中, 默认值应正常运行。

## <a name="finish-configuring-the-vm-and-create-the-image"></a>完成虚拟机的配置并创建映像

其余选项具有合理的默认设置, 无需更改任何其他选项。 如果愿意, 你可以浏览其他选项卡。 各个选项旁边都有`(i)`一个图标, 将显示一个帮助提示来说明该选项。 这是了解可用于配置 VM 的各种选项的好方法:

1. 单击面板底部的 "**审阅 + 创建**" 按钮。

1. 系统将验证您的选项, 并提供有关正在创建的 VM 的详细信息。

1. 单击 "**创建**" 以创建和部署 VM。 Azure 仪表板将显示正在部署的 VM。 这可能需要几分钟时间。

在部署时, 让我们来看看我们可以使用此 VM 做什么。
