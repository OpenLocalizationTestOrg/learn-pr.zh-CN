<span data-ttu-id="e173b-101">您是解决方案架构师。</span><span class="sxs-lookup"><span data-stu-id="e173b-101">You are a solution architect.</span></span> <span data-ttu-id="e173b-102">您的组织, Lamna 医疗保健已将其工作负荷转移到云。</span><span class="sxs-lookup"><span data-stu-id="e173b-102">Your organization, Lamna Healthcare has moved its workloads to the cloud.</span></span> <span data-ttu-id="e173b-103">最近, 这些资源和工作流的帐单的增长超过了 Lamna 的预期。</span><span class="sxs-lookup"><span data-stu-id="e173b-103">Recently, the bill for these resources and workflows has increased more than Lamna had anticipated.</span></span> <span data-ttu-id="e173b-104">您已被要求确定是自然增长、高效增长, 还是可以通过更高效地使用组织的云资源来降低成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-104">You have been asked to determine whether the increase is natural, efficient growth, or whether the cost can be reduced by being more efficient with the organization's cloud resources.</span></span>

#### <a name="maximize-efficiency-of-cloud-spend"></a><span data-ttu-id="e173b-105">最大限度地提高云支出的效率</span><span class="sxs-lookup"><span data-stu-id="e173b-105">Maximize efficiency of cloud spend</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RWjTgy]

## <a name="how-the-cloud-changes-your-expenses"></a><span data-ttu-id="e173b-106">云如何更改你的支出</span><span class="sxs-lookup"><span data-stu-id="e173b-106">How the cloud changes your expenses</span></span>

<span data-ttu-id="e173b-107">公共云和本地基础结构之间的差异之一是您为所使用的服务付费的费用。</span><span class="sxs-lookup"><span data-stu-id="e173b-107">One of the differences between the public cloud and on-premises infrastructure is how you pay for the services you use.</span></span> <span data-ttu-id="e173b-108">在本地数据中心内, 硬件采购时间很长, 将调整硬件大小以实现最大容量, 并且可以从消耗资源的业务单元中隐藏某些成本 (如电源和空间)。</span><span class="sxs-lookup"><span data-stu-id="e173b-108">In an on-premises datacenter, hardware procurement time is long, hardware is sized for maximum capacity, and some of the costs, such as power and space, can be hidden from the business unit consuming the resources.</span></span> <span data-ttu-id="e173b-109">购买物理基础结构将投资与长期资产结合在一起, 从而使您能够灵活地处理您的资源。</span><span class="sxs-lookup"><span data-stu-id="e173b-109">Purchasing physical infrastructure ties up investments in long-term assets, hindering your ability to be agile with your resources.</span></span>

<span data-ttu-id="e173b-110">切换到云时, 会引入按使用付费的成本模型。</span><span class="sxs-lookup"><span data-stu-id="e173b-110">Shifting to the cloud introduces a pay-for-what-you-use cost model.</span></span> <span data-ttu-id="e173b-111">您不再需要占用资产的投资, 如果资源要求发生变化, 则可以通过添加、移动或删除资源来做出响应。</span><span class="sxs-lookup"><span data-stu-id="e173b-111">You no longer need to tie up investments in assets, and if your resource requirements change, you can respond by adding, moving, or removing resources.</span></span> <span data-ttu-id="e173b-112">工作负载在服务之间有所不同, 需求可能是不可预测的, 并且随着时间的推移, 增长模式也会发生变化。</span><span class="sxs-lookup"><span data-stu-id="e173b-112">Workloads vary between and within services, demand can be unpredictable, and your growth patterns shift over time.</span></span> <span data-ttu-id="e173b-113">由于您只是为在云中使用而付费, 因此您的成本结构可以与资源中的更改进行同步。</span><span class="sxs-lookup"><span data-stu-id="e173b-113">Since you only pay for what you use in the cloud, your cost structure can move in sync with the changes in resources.</span></span>

<span data-ttu-id="e173b-114">云基础结构可以处理波动资源使用情况。</span><span class="sxs-lookup"><span data-stu-id="e173b-114">Cloud infrastructure can handle fluctuating resource usage scenarios.</span></span> <span data-ttu-id="e173b-115">在不使用的情况下, 可以关闭处于不活动状态的资源, 而不会产生任何成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-115">Resources that have significant periods of inactivity can be shut down when not in use and not incur any cost at all.</span></span> <span data-ttu-id="e173b-116">资源在增长时可以随着成功的服务增长, 而无需等待下一个采购周期。</span><span class="sxs-lookup"><span data-stu-id="e173b-116">Resources can grow with a successful service as it grows, rather than having to wait for the next procurement cycle.</span></span> <span data-ttu-id="e173b-117">可以动态添加和删除更多资源, 以响应可预测和不可预知的突发要求。</span><span class="sxs-lookup"><span data-stu-id="e173b-117">More resources can be dynamically added and removed to respond to predictable and unpredictable bursts of demand.</span></span> <span data-ttu-id="e173b-118">下图显示了为什么本地基础结构无法处理所有这些波动方案。</span><span class="sxs-lookup"><span data-stu-id="e173b-118">The following illustration shows why the on-premises infrastructure cannot handle all these fluctuating scenarios.</span></span>

![展示了使用本地基础结构的缺点的图示。](../media/cloudcomputingpatterns.png)

<span data-ttu-id="e173b-120">在有效的体系结构中, 预配的资源符合对这些资源的需求。</span><span class="sxs-lookup"><span data-stu-id="e173b-120">In an efficient architecture, provisioned resources match the demand for those resources.</span></span> <span data-ttu-id="e173b-121">如果虚拟机的大部分时间使用不到 10%, 则需要在计算和成本方面浪费资源。</span><span class="sxs-lookup"><span data-stu-id="e173b-121">If a virtual machine is less than 10% utilized the majority of the time, you are wasting resources, both in compute and cost.</span></span> <span data-ttu-id="e173b-122">相反, 运行 90% 的虚拟机使用的是大部分可用资源, 并且是有效使用资金的一种。</span><span class="sxs-lookup"><span data-stu-id="e173b-122">Conversely, a virtual machine that is running 90% utilized is using the majority of the available resources and is an efficient use of money.</span></span> <span data-ttu-id="e173b-123">将系统运行到 100% 的使用率会给出性能问题带来的风险。</span><span class="sxs-lookup"><span data-stu-id="e173b-123">Running a system to 100% utilization runs the risk of introducing performance issues.</span></span> <span data-ttu-id="e173b-124">确保最大化效率不会对系统性能产生负面影响, 这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="e173b-124">It is important to ensure that maximizing efficiency doesn't negatively impact the performance of your system.</span></span> <span data-ttu-id="e173b-125">Demand 很少变, 因此尽可能调整资源以满足需求是确保效率的重要。</span><span class="sxs-lookup"><span data-stu-id="e173b-125">Demand is rarely constant, so adjusting resources when possible to match demand is important to ensure efficiency.</span></span>

## <a name="track-your-cloud-spend"></a><span data-ttu-id="e173b-126">跟踪你的云花费</span><span class="sxs-lookup"><span data-stu-id="e173b-126">Track your cloud spend</span></span>

<span data-ttu-id="e173b-127">为了做出明智的决策, 您需要数据。</span><span class="sxs-lookup"><span data-stu-id="e173b-127">In order to make intelligent decisions, you need data.</span></span> <span data-ttu-id="e173b-128">通过查看你的资金的发展位置, 你可以开始比较, 以揭示在你的环境中可能浪费的位置。</span><span class="sxs-lookup"><span data-stu-id="e173b-128">By looking at where your money is going, you can start comparing that to utilization to uncover where you may have waste within your environment.</span></span>

<span data-ttu-id="e173b-129">你的帐单数据的导出随时可用。</span><span class="sxs-lookup"><span data-stu-id="e173b-129">An export of your billing data is available at any time.</span></span> <span data-ttu-id="e173b-130">使用您的帐单数据, 您可以跟踪开销的位置以及在您的资源中分配这些数据的方式。</span><span class="sxs-lookup"><span data-stu-id="e173b-130">Using your billing data, you can track where your costs are going and how they're allocated across your resources.</span></span> <span data-ttu-id="e173b-131">困难在于帐单数据显示成本而不是使用率。</span><span class="sxs-lookup"><span data-stu-id="e173b-131">The challenge is that the billing data shows cost but not utilization.</span></span> <span data-ttu-id="e173b-132">你将拥有表明你为该大型 VM 付费的数据, 但你实际使用的是多少？</span><span class="sxs-lookup"><span data-stu-id="e173b-132">You'll have data that indicates you're paying for that large VM, but how much are you actually using it?</span></span>

<span data-ttu-id="e173b-133">Azure 成本管理让你能够深入了解你的支出以及已充分利用的资源。</span><span class="sxs-lookup"><span data-stu-id="e173b-133">Azure Cost Management gives you insights where your spend is going, as well as underutilized resources.</span></span> <span data-ttu-id="e173b-134">Azure 成本管理跟踪每个服务的总花费、成本和成本随时间推移。</span><span class="sxs-lookup"><span data-stu-id="e173b-134">Azure Cost Management tracks your total spend, cost by service, and cost over time.</span></span> <span data-ttu-id="e173b-135">您可以深入到资源类型和实例。</span><span class="sxs-lookup"><span data-stu-id="e173b-135">You can drill down into resource types and instances.</span></span> <span data-ttu-id="e173b-136">您还可以通过使用这些类别对资源进行标记来分解组织或成本中心的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-136">You can also break down your costs by organization or cost center by tagging resources with those categories.</span></span>

<span data-ttu-id="e173b-137">Azure Advisor 也具有成本组件。</span><span class="sxs-lookup"><span data-stu-id="e173b-137">Azure Advisor also has a cost component.</span></span> <span data-ttu-id="e173b-138">它建议在成本较低时购买保留实例, 而不是随即付即用实例。</span><span class="sxs-lookup"><span data-stu-id="e173b-138">It recommends VM resizing, buying reserved instances when more cost effective than pay-as-you-go instances.</span></span> <span data-ttu-id="e173b-139">它标识未使用的 ExpressRoute 电路和空闲的虚拟网络网关。</span><span class="sxs-lookup"><span data-stu-id="e173b-139">It identifies unused ExpressRoute circuits and idle virtual network gateways.</span></span> <span data-ttu-id="e173b-140">Advisor 在性能、高可用性和安全性方面提出了更多建议。</span><span class="sxs-lookup"><span data-stu-id="e173b-140">Advisor makes additional recommendations in the areas of performance, high availability, and security.</span></span>

<span data-ttu-id="e173b-141">重要的部分是花时间查看你的花费并评估你的金钱的发展方向。</span><span class="sxs-lookup"><span data-stu-id="e173b-141">The important part is to take time to review your spend and evaluate where your money is going.</span></span> <span data-ttu-id="e173b-142">确定效率低下的部分, 以确保您尽可能高效地运行。</span><span class="sxs-lookup"><span data-stu-id="e173b-142">Identify areas of inefficiency to ensure you're operating as efficiently as possible.</span></span>

## <a name="organize-to-optimize"></a><span data-ttu-id="e173b-143">进行组织以优化</span><span class="sxs-lookup"><span data-stu-id="e173b-143">Organize to optimize</span></span>

<span data-ttu-id="e173b-144">将一些组织放到你的资源中可帮助跟踪你的一些成本的发展。</span><span class="sxs-lookup"><span data-stu-id="e173b-144">Putting some organization to your resources can help track where some of your costs are going.</span></span> <span data-ttu-id="e173b-145">有多种方法可以将资源组合在一起, 从而建立关系, 以便您知道成本的相关位置。</span><span class="sxs-lookup"><span data-stu-id="e173b-145">There are ways to group resources together, establishing a relationship so you know where your costs are related.</span></span> <span data-ttu-id="e173b-146">从记帐的角度来看, 可以轻松地对资源进行分组:</span><span class="sxs-lookup"><span data-stu-id="e173b-146">From a billing perspective, resources can be easily grouped by:</span></span>

- <span data-ttu-id="e173b-147">将资源分配给不同的订阅。</span><span class="sxs-lookup"><span data-stu-id="e173b-147">Assigning resources to different subscriptions.</span></span>
- <span data-ttu-id="e173b-148">将资源分配给不同的资源组。</span><span class="sxs-lookup"><span data-stu-id="e173b-148">Assigning resources to different resource groups.</span></span>
- <span data-ttu-id="e173b-149">对资源应用标记。</span><span class="sxs-lookup"><span data-stu-id="e173b-149">Applying tags to resources.</span></span>

<span data-ttu-id="e173b-150">使用订阅和资源组来组织资源是对资源进行逻辑分组的简单方法, 可在执行帐单数据时进行利用。</span><span class="sxs-lookup"><span data-stu-id="e173b-150">Using subscriptions and resource groups to organize resources is an easy way to logically group resources and can be leveraged when going through billing data.</span></span> <span data-ttu-id="e173b-151">当资源关系跨越订阅和资源组的边界时, 标记将进入播放。</span><span class="sxs-lookup"><span data-stu-id="e173b-151">Tags come into play when resource relationships span the boundaries of subscriptions and resource groups.</span></span> <span data-ttu-id="e173b-152">标记是可添加到任何资源并在记帐数据中公开的键/值对, 使您可以将部门或成本中心与您的资源相关联。</span><span class="sxs-lookup"><span data-stu-id="e173b-152">Tags are key/value pairs that can be added to any resource, and are exposed in billing data, allowing you to associate a department or cost center with your resource.</span></span> <span data-ttu-id="e173b-153">标记可提高您的成本报告能力, 并为组织中的每个部门提供自己的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-153">Tags improve your ability to report on cost, as well as giving each department in your organization accountability for their own costs.</span></span> <span data-ttu-id="e173b-154">下图显示了如何将相同的标记应用于不同资源组中的资源, 甚至可以在不同的订阅中应用。</span><span class="sxs-lookup"><span data-stu-id="e173b-154">The following illustration shows how you can apply the same tag to resources in different resource groups and even in different subscriptions.</span></span>

![显示使用标记、资源组和订阅组织的资源的插图。](../media/tagging.png)

<span data-ttu-id="e173b-156">将一些组织添加到你的资源可能会很长, 并且可以真正帮助你了解成本的进展情况。</span><span class="sxs-lookup"><span data-stu-id="e173b-156">Adding some organization to your resources can go a long way and can really aid in your ability to understand where your costs are going.</span></span> <span data-ttu-id="e173b-157">现在, 我们来看看一些优化成本的方法。</span><span class="sxs-lookup"><span data-stu-id="e173b-157">Now let's take a look at some ways to optimize costs.</span></span>

## <a name="optimizing-iaas-costs"></a><span data-ttu-id="e173b-158">优化 IaaS 成本</span><span class="sxs-lookup"><span data-stu-id="e173b-158">Optimizing IaaS costs</span></span>

<span data-ttu-id="e173b-159">在将基础结构作为服务 (VM) 等资源 (作为解决方案的一部分) 使用时, 与虚拟机相关的成本通常是花费的最大一部分。</span><span class="sxs-lookup"><span data-stu-id="e173b-159">When using Infrastructure as a Service (IaaS) resources such as virtual machines (VM) as part of your solution, the cost associated with VMs is often the biggest portion of spend.</span></span> <span data-ttu-id="e173b-160">计算成本通常是最大的一段, 后跟存储。</span><span class="sxs-lookup"><span data-stu-id="e173b-160">The compute costs are typically the biggest piece, followed by storage.</span></span> <span data-ttu-id="e173b-161">花费时间来优化使用情况的资源可能会对您的月度帐单的规模产生很大影响。</span><span class="sxs-lookup"><span data-stu-id="e173b-161">Taking time to optimize pay-for-what-you-use resources can have a large impact on the size of your monthly bill.</span></span>

<span data-ttu-id="e173b-162">让我们来看看可降低您的计算和存储成本的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="e173b-162">Let's take a look at best practices to reduce your compute and storage costs.</span></span>

### <a name="compute"></a><span data-ttu-id="e173b-163">计算</span><span class="sxs-lookup"><span data-stu-id="e173b-163">Compute</span></span>

<span data-ttu-id="e173b-164">有几种不同的选项可用于实现虚拟机的成本节约。</span><span class="sxs-lookup"><span data-stu-id="e173b-164">There are different options available to achieve cost savings for virtual machines.</span></span>

- <span data-ttu-id="e173b-165">选择一个较小的虚拟机实例大小。</span><span class="sxs-lookup"><span data-stu-id="e173b-165">Choose a smaller virtual machine instance size.</span></span>
- <span data-ttu-id="e173b-166">减少虚拟机运行的小时数。</span><span class="sxs-lookup"><span data-stu-id="e173b-166">Reduce the number of hours a virtual machine runs.</span></span>
- <span data-ttu-id="e173b-167">对计算成本使用折扣。</span><span class="sxs-lookup"><span data-stu-id="e173b-167">Use discounts for the compute costs.</span></span>

#### <a name="right-size-virtual-machines"></a><span data-ttu-id="e173b-168">正确大小虚拟机</span><span class="sxs-lookup"><span data-stu-id="e173b-168">Right size virtual machines</span></span>

<span data-ttu-id="e173b-169">正确调整虚拟机的大小是将虚拟机大小与 VM 所需的资源需求相匹配的过程。</span><span class="sxs-lookup"><span data-stu-id="e173b-169">Right sizing a virtual machine is the process of matching the virtual machine size with the resource demand required of the VM.</span></span> <span data-ttu-id="e173b-170">如果 vm 运行的是 25% 空闲, 则减小 vm 的大小将会立即降低成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-170">If a VM is running 25% idle, reducing the size of the VM will immediately reduce your cost.</span></span> <span data-ttu-id="e173b-171">虚拟机的成本在实例系列中是线性的;下一个较大的大小将使您的成本加倍。</span><span class="sxs-lookup"><span data-stu-id="e173b-171">Virtual machine costs are linear within an instance family; each next size larger will double your cost.</span></span> <span data-ttu-id="e173b-172">反之, 将 VM 减少为单个实例大小会降低一半的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-172">Conversely, reducing a VM by a single instance size will reduce your cost in half.</span></span> <span data-ttu-id="e173b-173">下图显示了通过在同一个系列中向下移动一个大小而实现的 50% 的节省。</span><span class="sxs-lookup"><span data-stu-id="e173b-173">The following illustration shows a 50% savings achieved by moving one size down within the same series.</span></span>

![说明如何通过 downsizing 未充分利用的虚拟机来实现节省的成本。](../media/vm-resize.png)

<span data-ttu-id="e173b-175">Azure Advisor 可识别哪些虚拟机未充分利用。</span><span class="sxs-lookup"><span data-stu-id="e173b-175">Azure Advisor identifies which virtual machines are underutilized.</span></span> <span data-ttu-id="e173b-176">Advisor 将虚拟机使用率监视14天, 然后识别未充分利用的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="e173b-176">Advisor monitors your virtual machine usage for 14 days and then identifies underutilized virtual machines.</span></span> <span data-ttu-id="e173b-177">CPU 利用率为 5% 或更低且网络使用率为 7 MB 或更少的虚拟机被视为使用不足的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="e173b-177">Virtual machines whose CPU utilization is 5 percent or less and network usage is 7 MB or less for four or more days are considered underutilized virtual machines.</span></span>

#### <a name="implement-shutdown-schedules-for-virtual-machines"></a><span data-ttu-id="e173b-178">为虚拟机实施关闭计划</span><span class="sxs-lookup"><span data-stu-id="e173b-178">Implement shutdown schedules for virtual machines</span></span>

<span data-ttu-id="e173b-179">如果您有仅定期使用但连续运行的 VM 工作负载, 则会浪费资金。</span><span class="sxs-lookup"><span data-stu-id="e173b-179">If you have VM workloads that are only used periodically, but are running continuously, you're wasting money.</span></span> <span data-ttu-id="e173b-180">这些 vm 可在不使用时关闭保存 vm 时计算成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-180">These VMs can be shut down when not in use saving you compute costs while the VM is deallocated.</span></span> <span data-ttu-id="e173b-181">例如, 开发环境是一个很好的候选方案, 因为开发通常只在工作时间发生。</span><span class="sxs-lookup"><span data-stu-id="e173b-181">For example, a development environment is a good candidate because development generally happens only during business hours.</span></span>

<span data-ttu-id="e173b-182">有几个选项可用于取消分配 VM。</span><span class="sxs-lookup"><span data-stu-id="e173b-182">You have several options to deallocate a VM.</span></span> <span data-ttu-id="e173b-183">您可以使用 Azure 自动化仅在工作负荷需要的时间段内运行虚拟机。</span><span class="sxs-lookup"><span data-stu-id="e173b-183">You can use Azure Automation to run your VMs only during those times that your workloads require.</span></span> <span data-ttu-id="e173b-184">您可以在虚拟机上使用自动关闭功能安排一次性自动关闭。</span><span class="sxs-lookup"><span data-stu-id="e173b-184">You can use the auto-shutdown feature on a virtual machine to schedule a one-off automated shutdown.</span></span> <span data-ttu-id="e173b-185">最后, 您可以在 Azure 门户中手动停止 VM。</span><span class="sxs-lookup"><span data-stu-id="e173b-185">Finally, you can stop a VM manually in the Azure portal.</span></span> <span data-ttu-id="e173b-186">应始终使用 Azure 控件停止 vm;从 VM 中关闭 OS 不会取消分配其 Azure 资源, 因此您将继续累计成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-186">You should always use the Azure controls to stop your VMs; shutting down the OS from inside a VM does not deallocate its Azure resource so you will continue to accrue costs.</span></span>

#### <a name="apply-compute-cost-discounts"></a><span data-ttu-id="e173b-187">应用计算成本折扣</span><span class="sxs-lookup"><span data-stu-id="e173b-187">Apply compute cost discounts</span></span>

<span data-ttu-id="e173b-188">通过允许你将本地 Windows server 或 sql server 许可证与软件保障结合使用, 以在对这些 vm 的计算成本进行折扣时使用 Azure 混合优势, 可以进一步优化 Windows server 和 sql server 的成本, 从而消除了 Windows 和 SQL Server 在启用的实例上的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-188">The Azure Hybrid Benefit allows you to further optimize your costs for both Windows Server and SQL Server by allowing you to use your on-premises Windows Server or SQL Server licenses with Software Assurance to be used as a discount toward the compute cost of these VMs, eliminating the costs for Windows and SQL Server on enabled instances.</span></span>

<span data-ttu-id="e173b-189">某些虚拟机需要随时启动并运行。</span><span class="sxs-lookup"><span data-stu-id="e173b-189">Some virtual machines need to be up and running all the time.</span></span> <span data-ttu-id="e173b-190">可能有一个用于生产工作负荷的 web 应用程序服务器场, 也可能有一个支持虚拟网络上的各种服务器的域控制器。</span><span class="sxs-lookup"><span data-stu-id="e173b-190">Maybe you have a web application server farm for a production workload or maybe a domain controller supporting various servers on a virtual network.</span></span> <span data-ttu-id="e173b-191">如果你知道这些虚拟机将在未来一年或更长时间内运行, 则可以通过购买保留实例来获得更多的成本节约。</span><span class="sxs-lookup"><span data-stu-id="e173b-191">If you know with certainty that these virtual machines will run over the coming year or maybe longer, you can get further cost savings by purchasing a reserved instance.</span></span> <span data-ttu-id="e173b-192">Azure 保留的虚拟机实例可购买一年或三年的计算能力, 每个折扣与按即点即用计算资源相比。</span><span class="sxs-lookup"><span data-stu-id="e173b-192">Azure Reserved Virtual Machine Instances can be purchased for one year or three years of compute capacity, at a discount compared to pay-as-you-go compute resources.</span></span> <span data-ttu-id="e173b-193">Azure 保留的虚拟机实例可显著降低虚拟机的成本, 最高可达 72% 的即付即用价格, 为期一年或三年的提前承诺。</span><span class="sxs-lookup"><span data-stu-id="e173b-193">Azure Reserved Virtual Machine Instances can significantly reduce your virtual machine costs, up to 72 percent on pay-as-you-go prices, with one-year or three-year upfront commitment.</span></span> <span data-ttu-id="e173b-194">下图显示了将本地许可证与 azure 混合优势结合使用时以及将本地许可证与 azure RI 和 azure 混合优势结合使用时实现的节省。</span><span class="sxs-lookup"><span data-stu-id="e173b-194">The following illustration shows savings achieved when you combine your on-premises license with the Azure Hybrid Benefit and when you combine your on-premises license with both Azure RI and the Azure Hybrid Benefit.</span></span>

![该图显示了在使用具有软件保证的本地许可证时, 在 Azure 产品上节省的成本。](../media/ahub-save.png)

### <a name="virtual-machine-disk-storage-cost-optimization"></a><span data-ttu-id="e173b-196">虚拟机磁盘存储成本优化</span><span class="sxs-lookup"><span data-stu-id="e173b-196">Virtual machine disk storage cost optimization</span></span>

<span data-ttu-id="e173b-197">对于不需要高可靠性和性能磁盘的工作负荷, 可以使用成本低廉的标准存储。</span><span class="sxs-lookup"><span data-stu-id="e173b-197">For workloads that do not require high reliability and performance disks, you can use the reduced-cost standard storage.</span></span> <span data-ttu-id="e173b-198">您可以选择对开发和测试环境使用标准存储, 而无需与生产工作负载完全相同。</span><span class="sxs-lookup"><span data-stu-id="e173b-198">You might choose to use standard storage for development and test environments that are not required to be an identical match for a production workload.</span></span>

<span data-ttu-id="e173b-199">确保您的环境中没有剩余的孤立磁盘。</span><span class="sxs-lookup"><span data-stu-id="e173b-199">Ensure you don't have any orphaned disks remaining in your environment.</span></span> <span data-ttu-id="e173b-200">与 VM 不关联的磁盘仍会导致存储成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-200">Disks that aren't associated with a VM still incur storage costs.</span></span> <span data-ttu-id="e173b-201">如果已删除虚拟机而不是磁盘, 则可以使用孤立磁盘来降低存储成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-201">If you've removed a VM but not the disks, the orphaned disks may be a place to reduce your storage cost.</span></span>

<span data-ttu-id="e173b-202">类似于孤立的磁盘, 如果你有任何孤立的快照延迟, 请花些时间清理这些快照。</span><span class="sxs-lookup"><span data-stu-id="e173b-202">Similar to orphaned disks, if you have any orphaned snapshots lingering around, take some time to clean them up.</span></span> <span data-ttu-id="e173b-203">这些资源的定价低于磁盘本身, 但仍为消除不必要的资源成本的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="e173b-203">Pricing for these is lower than the disks themselves, but it's still a good practice to eliminate costs of unnecessary resources.</span></span>

## <a name="optimizing-paas-costs"></a><span data-ttu-id="e173b-204">优化 PaaS 成本</span><span class="sxs-lookup"><span data-stu-id="e173b-204">Optimizing PaaS costs</span></span>

<span data-ttu-id="e173b-205">平台即服务 (PaaS) 服务通常针对 IaaS 服务的成本进行优化, 但有机会确定浪费并优化为最低成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-205">Platform as a Service (PaaS) services are typically optimized for costs over IaaS services, but there are opportunities to identify waste and optimize for minimal costs.</span></span> <span data-ttu-id="e173b-206">让我们来看看降低 azure SQL 数据库和 azure Blob 存储成本的方法。</span><span class="sxs-lookup"><span data-stu-id="e173b-206">Let's take a look at ways to reduce Azure SQL Database and Azure Blob storage costs.</span></span>

### <a name="optimizing-azure-sql-database-costs"></a><span data-ttu-id="e173b-207">优化 Azure SQL 数据库成本</span><span class="sxs-lookup"><span data-stu-id="e173b-207">Optimizing Azure SQL Database costs</span></span>

<span data-ttu-id="e173b-208">创建 azure sql 数据库时, 必须选择 azure sql Server 并决定性能层。</span><span class="sxs-lookup"><span data-stu-id="e173b-208">When creating an Azure SQL database, you have to select an Azure SQL Server and decide on a performance tier.</span></span> <span data-ttu-id="e173b-209">每个层都提供数据库事务单元 (dtu) 或虚拟核心 (vCores) 中的性能级别。</span><span class="sxs-lookup"><span data-stu-id="e173b-209">Each tier provides a performance level either in database transaction units (DTUs) or virtual cores (vCores).</span></span> <span data-ttu-id="e173b-210">对于稳定的数据库负载, 可以通过选择适当的级别来实现所需的性能来优化。</span><span class="sxs-lookup"><span data-stu-id="e173b-210">For database loads that are steady, it's easy to optimize by selecting the properly sized tier for the needed performance.</span></span> <span data-ttu-id="e173b-211">但如果您的数据库在活动中有不可预测的突发或峰值, 该怎么办？</span><span class="sxs-lookup"><span data-stu-id="e173b-211">But what if your database has unpredictable bursts or spikes in activity?</span></span> <span data-ttu-id="e173b-212">弹性池可以降低不可预测工作负载的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-212">Elastic pools can reduce costs for unpredictable workloads.</span></span>

<span data-ttu-id="e173b-213">SQL 数据库弹性池是一个简单且经济高效的解决方案, 用于管理和扩展多个具有不同且不可预测的使用要求的数据库。</span><span class="sxs-lookup"><span data-stu-id="e173b-213">SQL Database elastic pools are a simple, cost-effective solution for managing and scaling several databases that have varying and unpredictable usage demands.</span></span> <span data-ttu-id="e173b-214">弹性池中的数据库位于单个 Azure SQL 数据库服务器上, 并按设置的价格共享一组资源数。</span><span class="sxs-lookup"><span data-stu-id="e173b-214">The databases in an elastic pool are on a single Azure SQL Database server and share a set number of resources at a set price.</span></span> <span data-ttu-id="e173b-215">池非常适合于具有特定使用率模式的大量数据库。</span><span class="sxs-lookup"><span data-stu-id="e173b-215">Pools are well suited for a large number of databases with specific utilization patterns.</span></span> <span data-ttu-id="e173b-216">对于给定数据库, 此模式的特征是低平均利用率, 使用率峰值相对较少。</span><span class="sxs-lookup"><span data-stu-id="e173b-216">For a given database, this pattern is characterized by low average utilization with relatively infrequent utilization spikes.</span></span>
<span data-ttu-id="e173b-217">可以添加到池的数据库越多, 节省的空间就越多。</span><span class="sxs-lookup"><span data-stu-id="e173b-217">The more databases you can add to a pool, the greater your savings become.</span></span> <span data-ttu-id="e173b-218">下图显示了三种类型的弹性数据库池的功能: basic、standard 和 premium。</span><span class="sxs-lookup"><span data-stu-id="e173b-218">The following illustration shows the capabilities of the three types of Elastic Database Pools: basic, standard, and premium.</span></span>  <span data-ttu-id="e173b-219">基本自动扩展能力高达5个 eDTUs 每个 db, 标准自动扩展到每个数据库100个 eDTUs, 并可自动扩展到每个数据库的 1000 eDTUs。</span><span class="sxs-lookup"><span data-stu-id="e173b-219">Basic auto scales up to 5 eDTUs per DB, standard auto scales up to 100 eDTUs per DB, and Premium that auto scales up to 1000 eDTUs per DB.</span></span>

![该图显示了不同类型弹性数据库池的自动扩展容量。](../media/sqldb-elastic-pools.png)

<span data-ttu-id="e173b-221">弹性池是跨多个数据库扩展成本的一种极好的方法, 它会对减少 Azure SQL 数据库成本产生重大影响。</span><span class="sxs-lookup"><span data-stu-id="e173b-221">Elastic pools are a great way to spread costs across multiple databases and can make a significant impact on reducing your Azure SQL Database costs.</span></span>

### <a name="optimizing-blob-storage-costs"></a><span data-ttu-id="e173b-222">优化 Blob 存储成本</span><span class="sxs-lookup"><span data-stu-id="e173b-222">Optimizing Blob storage costs</span></span>

<span data-ttu-id="e173b-223">Blob 存储是存储数据的一种经济高效的方法, 但是随着数据量的增加, 您的帐单可以从优化数据存储方式中受益。</span><span class="sxs-lookup"><span data-stu-id="e173b-223">Blob storage is a cost-effective way to store data, but as the amount of data grows, your bill can benefit from optimizing how the data is stored.</span></span>

<span data-ttu-id="e173b-224">让我们回到 Lamna 保健。</span><span class="sxs-lookup"><span data-stu-id="e173b-224">Let's return to Lamna Healthcare.</span></span> <span data-ttu-id="e173b-225">您有一个在 blob 存储中存储图像的医学图像应用程序。</span><span class="sxs-lookup"><span data-stu-id="e173b-225">You have a medical-imaging application that stores images in blob storage.</span></span> <span data-ttu-id="e173b-226">由于图像的数量和大小, 存储最终将成为应用程序的显著成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-226">Due to the quantity and size of the images, the storage ends up being a notable cost for the application.</span></span> <span data-ttu-id="e173b-227">如果为患者拍摄了图像, 则在第一周中可能会多次查看该图像, 并且图像检索的性能预计较高。</span><span class="sxs-lookup"><span data-stu-id="e173b-227">When an image has been taken for a patient, it's likely that in the first week, that image will be viewed several times, and the performance of image retrieval is expected to be high.</span></span> <span data-ttu-id="e173b-228">相反, 在两年前拍摄的图像可能很少访问, 并且检索性能的预期较低。</span><span class="sxs-lookup"><span data-stu-id="e173b-228">Conversely, an image taken two years ago may be accessed infrequently and has a lower retrieval performance expectation.</span></span> <span data-ttu-id="e173b-229">您可以使用存储分层来优化图像检索的成本, 假定图像老化所需的性能降低。</span><span class="sxs-lookup"><span data-stu-id="e173b-229">You can use storage tiering to optimize the cost of image retrieval, given the reduced performance required as the image ages.</span></span>

<span data-ttu-id="e173b-230">Azure 存储为 blob 对象存储提供了三个存储层。</span><span class="sxs-lookup"><span data-stu-id="e173b-230">Azure Storage offers three storage tiers for blob object storage.</span></span> <span data-ttu-id="e173b-231">Azure 热存储层针对存储经常访问的数据进行了优化。</span><span class="sxs-lookup"><span data-stu-id="e173b-231">The Azure hot storage tier is optimized for storing data that is accessed frequently.</span></span> <span data-ttu-id="e173b-232">Azure 酷存储层已优化为存储在至少30天内不经常访问和存储的数据。</span><span class="sxs-lookup"><span data-stu-id="e173b-232">The Azure cool storage tier is optimized for storing data that is infrequently accessed and stored for at least 30 days.</span></span> <span data-ttu-id="e173b-233">Azure 存档存储层已经过优化, 可用于存储在至少180天内少使用和存储的数据以及灵活的延迟要求。</span><span class="sxs-lookup"><span data-stu-id="e173b-233">The Azure archive storage tier is optimized for storing data that is rarely accessed and stored for at least 180 days with flexible latency requirements.</span></span>

- <span data-ttu-id="e173b-234">"**快速访问" 层**-最高存储成本, 但访问成本最低。</span><span class="sxs-lookup"><span data-stu-id="e173b-234">**Hot access tier** - Highest storage costs but the lowest access costs.</span></span>
- <span data-ttu-id="e173b-235">**冷却访问层**-与热存储相比, 降低了存储成本和更高的访问成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-235">**Cool access tier** - Lower storage costs and higher access costs compared to hot storage.</span></span> <span data-ttu-id="e173b-236">此层适用于将在很少30天内保留在酷层中的数据。</span><span class="sxs-lookup"><span data-stu-id="e173b-236">This tier is intended for data that will stay in the cool tier for at least 30 days.</span></span>
- <span data-ttu-id="e173b-237">**存档访问层**-与热和酷存储相比, 最低的存储成本和最高的数据检索成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-237">**Archive access tier** - Lowest storage cost and highest data retrieval costs compared to hot and cool storage.</span></span> <span data-ttu-id="e173b-238">此层适用于可容许几个小时的检索延迟的数据, 并将在存档层中持续至少180天。</span><span class="sxs-lookup"><span data-stu-id="e173b-238">This tier is intended for data that can tolerate several hours of retrieval latency and will stay in the archive tier for at least 180 days.</span></span>

<span data-ttu-id="e173b-239">对于 Lamna 保健, 将新图像保留在即时访问层上是有意义的, 以便查看最新的图像的速度尽可能快。</span><span class="sxs-lookup"><span data-stu-id="e173b-239">For Lamna Healthcare, keeping new images on the hot access tier for a month makes sense, so that viewing the most recent images performs as fast as possible.</span></span> <span data-ttu-id="e173b-240">然后, 您可以将图像在一年前移动到存档层, 因为这可能会导致无法检索这些图像。</span><span class="sxs-lookup"><span data-stu-id="e173b-240">You could then move images over one year old to the archive tier since it is likely that these images will not be retrieved.</span></span> <span data-ttu-id="e173b-241">这将降低与存储这些图像相关的成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-241">This would reduce their costs associated with storing these images.</span></span>

### <a name="leverage-consumption-pricing-models"></a><span data-ttu-id="e173b-242">利用消费定价模型</span><span class="sxs-lookup"><span data-stu-id="e173b-242">Leverage consumption pricing models</span></span>

<span data-ttu-id="e173b-243">移动到 PaaS 服务还可以采用 "即点即用" 模式, 甚至可以将其作为真正的消费定价模型。</span><span class="sxs-lookup"><span data-stu-id="e173b-243">Moving to PaaS services can also take the pay-as-you-go model even further into a true consumption pricing model.</span></span> <span data-ttu-id="e173b-244">Azure 函数等服务能够使用_消耗计划_。</span><span class="sxs-lookup"><span data-stu-id="e173b-244">Services such as Azure Functions have the ability to use _Consumption plans_.</span></span> <span data-ttu-id="e173b-245">使用消耗计划时, 将根据传入事件数动态添加和删除 Azure 函数主机的实例。</span><span class="sxs-lookup"><span data-stu-id="e173b-245">When you're using a Consumption plan, instances of the Azure Functions host are dynamically added and removed based on the number of incoming events.</span></span> <span data-ttu-id="e173b-246">此无服务器计划将自动扩展, 并且您仅在运行您的功能时才对计算资源收取费用。</span><span class="sxs-lookup"><span data-stu-id="e173b-246">This serverless plan scales automatically, and you're charged for compute resources only when your functions are running.</span></span> <span data-ttu-id="e173b-247">在消耗计划中, 函数执行将在可配置的一段时间后超时。</span><span class="sxs-lookup"><span data-stu-id="e173b-247">On a Consumption plan, a function execution times out after a configurable period of time.</span></span>

<span data-ttu-id="e173b-248">计费基于执行次数、执行时间和使用的内存。</span><span class="sxs-lookup"><span data-stu-id="e173b-248">Billing is based on number of executions, execution time, and memory used.</span></span> <span data-ttu-id="e173b-249">在函数应用程序内的所有函数中聚合记帐。</span><span class="sxs-lookup"><span data-stu-id="e173b-249">Billing is aggregated across all functions within a function app.</span></span>

<span data-ttu-id="e173b-250">移动到使用消费定价模型的服务后, 可以采用新方法在体系结构中节省成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-250">Moving to services that use a consumption pricing model can bring a new approach to cost savings into your architecture.</span></span>

## <a name="cost-optimization-at-lamna-healthcare"></a><span data-ttu-id="e173b-251">Lamna 保健中的成本优化</span><span class="sxs-lookup"><span data-stu-id="e173b-251">Cost optimization at Lamna Healthcare</span></span>

<span data-ttu-id="e173b-252">Lamna 医疗保健在降低成本方面取得了努力。</span><span class="sxs-lookup"><span data-stu-id="e173b-252">Lamna Healthcare is making strides on reducing their costs.</span></span> <span data-ttu-id="e173b-253">他们按月对成本进行组织, 每个部门都有权访问 Azure 成本管理, 在这种管理中, 他们可以在每个月中查看其成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-253">They have organized a monthly review of their costs, and each department has access to Azure Cost Management, where they can review their costs throughout the month.</span></span> <span data-ttu-id="e173b-254">他们已确定可使用保留实例的多个位置, 并已购买多个位置以利用此折扣。</span><span class="sxs-lookup"><span data-stu-id="e173b-254">They've identified a number of places where reserved instances can be used and have purchased several to take advantage of this discount.</span></span> <span data-ttu-id="e173b-255">他们已实施自动化的过程以在非工作时间停止开发环境, 并在未使用这些资源的时间内节省额外成本。</span><span class="sxs-lookup"><span data-stu-id="e173b-255">They have implemented automated processes to stop development environments in off-hours, saving them additional costs during times when these resources were not being used.</span></span> 

<span data-ttu-id="e173b-256">除了为映像存储优化 blob 存储外, 它们还在过去几个月内被管理, 以丢弃其记帐的特别数。</span><span class="sxs-lookup"><span data-stu-id="e173b-256">Along with the optimization of blob storage for their imaging storage, they've managed to drop their bill notably over the past couple of months.</span></span>

## <a name="summary"></a><span data-ttu-id="e173b-257">摘要</span><span class="sxs-lookup"><span data-stu-id="e173b-257">Summary</span></span>

<span data-ttu-id="e173b-258">优化云基础结构的成本涉及到跟踪你的花费并确保资源利用率符合工作负载的需求。</span><span class="sxs-lookup"><span data-stu-id="e173b-258">Optimizing the cost of your cloud infrastructure involves tracking your spend and ensuring that your resource utilization matches the demands of your workloads.</span></span> <span data-ttu-id="e173b-259">对你的资源使用正确的质量和性能层可以进一步优化你的云花费。</span><span class="sxs-lookup"><span data-stu-id="e173b-259">Using the right quality and performance tier for your resources can further optimize your cloud spend.</span></span>
