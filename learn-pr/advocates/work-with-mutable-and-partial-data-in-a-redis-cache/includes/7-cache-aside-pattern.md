生成应用程序时, 您希望提供很好的用户体验, 并且其中的一部分是快速数据检索。 从数据库检索数据通常是一个较慢的过程, 如果此数据经常读取, 这可能会带来较差的用户体验。 "正向缓存" 模式介绍了如何将缓存与数据库结合使用, 以尽可能快地返回最常访问的数据。

在这里, 你将了解如何使用带旁缓存的模式来确保你的重要数据能够快速访问。

## <a name="what-is-the-cache-aside-pattern"></a>什么是旁缓存模式？

旁缓存模式规定, 当您需要从数据源 (如关系数据库) 检索数据时, 应首先检查缓存中的数据。 如果数据在缓存中, 请使用它。 如果数据不在缓存中, 则查询数据库, 并在将数据返回给用户时, 将数据添加到缓存中。 这将允许您在下次需要时访问缓存中的数据。

## <a name="when-to-implement-the-cache-aside-pattern"></a>何时实现与缓存无关的模式？

从数据库读取数据通常是一个较慢的过程。 它涉及编译复杂查询、准备查询执行计划、执行查询, 然后准备结果。 在某些情况下, 此过程可能也会从磁盘中读取数据。 可以对数据库级别进行优化, 如预编译查询以及将某些数据加载到内存中。 但是, 在从数据库检索数据时, 执行查询和准备的操作将始终发生。

我们可以使用旁向模式解决此问题。 在旁缓存模式中, 仍有应用程序和数据库, 但现在我们也有缓存。 缓存将其数据存储在内存中, 因此无需与文件系统进行交互。 缓存还将数据存储在非常简单的数据结构 (如键值对) 中, 因此它们不必在写入数据时执行复杂查询来收集数据或维护索引。 因此, 缓存通常比数据库的性能更高。 使用应用程序时, 它将首先尝试读取缓存中的数据。 如果请求的数据不在缓存中, 应用程序将从数据库中检索它, 就好像它始终已完成。 但是, 它会将数据存储在缓存中, 以实现后续请求。 下次当任何用户请求数据时, 它将直接从缓存中返回。

![将数据加载到缓存的关系图](../media/8-cache-aside-set-cache.png)

### <a name="how-to-manage-updating-data"></a>如何管理更新数据

当您实现与缓存无关的模式时, 会引入一个小问题。 由于您的数据现在存储在缓存和数据存储中, 因此当您尝试进行更新时, 您可以遇到问题。 例如, 若要更新数据, 则需要更新缓存和数据存储区。

与备用模式相比, 此问题的解决方案是使缓存中的数据无效。 更新应用程序中的数据时, 应该先删除缓存中的数据, 然后直接对数据源进行更改。 这样一来, 在下次请求数据时, 它将不会出现在缓存中, 并且该过程将重复。 

![使缓存数据失效的关系图](../media/8-cache-aside-invalidate.png)

## <a name="considerations-for-using-the-cache-aside-pattern"></a>使用旁缓存模式的注意事项

仔细考虑要放入缓存中的数据。 并不是所有数据都适合进行缓存。

- **生存时间**: 对于 "缓存", 请确保过期策略与数据的访问频率相匹配。 使过期时间过短可能会导致应用程序持续检索数据存储区中的数据并将其添加到缓存中。

- **逐出**: 与典型数据存储相比, 缓存具有有限的大小, 它们将在必要时逐出数据。 请确保为您的数据选择适当的逐出策略。

- **Priming**: 若要使备用模式成为有效模式, 许多解决方案将预填充其认为将经常访问的数据的缓存。

- **一致性**: 实现非缓存模式并不能保证数据存储和缓存之间的一致性。 可以在不通知缓存的情况下更改数据存储区中的数据。 这可能会导致严重的同步问题。

如果需要从使用磁盘的数据源频繁访问数据, 则 "带缓存" 模式非常有用。 使用带旁缓存的模式, 您将在缓存中存储重要数据, 以帮助提高检索它的速度。 