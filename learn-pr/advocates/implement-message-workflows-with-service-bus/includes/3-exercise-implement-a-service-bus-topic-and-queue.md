假设您有一个适用于全球公司的销售团队的应用程序。 每个团队成员都有一个移动电话, 将在其中安装应用程序。 azure 中托管的 web 服务实现应用程序的业务逻辑并将信息存储在 azure SQL 数据库中。 每个地理区域都有一个 web 服务实例。 您已确定在移动应用程序和 web 服务之间发送邮件的以下目的:

- 与单个销售相关的邮件必须仅发送到用户区域中的 web 服务实例。
- 必须将与销售业绩相关的邮件发送到 web 服务的所有实例。

您已决定为第一个用例实现服务总线队列, 为第二个用例实现服务总线主题。

[!include[](../../../includes/azure-sandbox-activate.md)]

在本练习中, 将创建一个服务总线命名空间, 该命名空间将包含队列和包含订阅的主题。

## <a name="create-a-service-bus-namespace"></a>创建服务总线命名空间

在 Azure 服务总线中, 命名空间是一个容器, 其中包含唯一的完全限定的域名, 用于队列、主题和中继。 必须首先创建命名空间。

每个命名空间都有主要和次要共享访问签名加密密钥。 若要获取对命名空间中的对象的访问权限, 发送或接收组件在连接时必须提供这些密钥。

若要使用 Azure 门户创建服务总线命名空间, 请按照以下步骤操作:

1. 登录到[Azure 门户](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)。

1. 在左侧的导航栏中, 单击 "**所有服务**"。

1. 在 "**所有服务**" 边栏选项卡中, 向下滚动到 "**集成**" 部分, 然后单击 "**服务总线**"。

    ![显示所有服务总线处于突出显示状态的 "所有服务" 边栏集成部分的屏幕截图](../media/3-create-namespace-1.png)

1. 在**服务总线**刀片式服务器的左上角, 单击 "**添加**"。

1. 在 "**名称**" 文本框中, 键入命名空间的唯一名称。 例如: "salesteamapp" +*你的首字母缩写* + *当前日期*。

1. 在 "**定价层**" 下拉列表中, 选择 "**标准**"。

1. 在 "**订阅**" 下拉列表中, 选择您的订阅 ("Concierge 订阅")。

1. 在 "**资源组**" 下, 选择 "**使用现有**" 并选择 "<rgn>[沙盒资源组名称]</rgn>"。

1. 在 "**位置**" 下拉列表中, 从下面的列表中选择邻近你的位置。

    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

1. 单击 "**创建**" 以创建服务总线命名空间。

    ![突出显示 "添加" 按钮和 "创建" 按钮的服务总线屏幕截图和创建命名空间刀片](../media/3-create-namespace-2.png)

## <a name="create-a-service-bus-queue"></a>创建服务总线队列

现在您已经有了一个命名空间, 您可以为每个销售的邮件创建队列。 为此, 请按照以下步骤操作:

1. 在**服务总线**刀片中, 单击 "**刷新**"。 将显示您刚创建的命名空间。

1. 单击您刚创建的命名空间。

1. 在命名空间边栏的左上角, 单击 " **+ 队列**"。

1. 在 "**创建队列**边栏" 中的 "**名称**" 文本框中, 键入**salesmessages**, 然后单击 "**创建**"。 Azure 在你的命名空间中创建队列。

    ![突出显示 "创建" 按钮的 "创建队列" 边栏屏幕截图](../media/3-create-queue.png)

## <a name="create-a-service-bus-topic-and-subscriptions"></a>创建服务总线主题和订阅

此外, 您还需要创建一个将用于与销售业绩相关的邮件的主题。 业务逻辑 web 服务的多个实例将订阅来自不同国家/地区的本主题。 每封邮件都将传递给多个实例。

按照以下步骤操作:

1. 在**服务总线命名空间**刀片中, 单击 " **+ 主题**"。

1. 在 "**创建主题**边栏" 框的 "**名称**" 文本框中, 键入**salesperformancemessages**, 然后单击 "**创建**"。 Azure 在你的命名空间中创建主题。

    ![突出显示 "创建" 按钮的 "创建主题边栏" 屏幕截图](../media/3-create-topic.png)

1. 创建主题后, 在 "**服务总线命名空间**" 边栏中的 "**实体**" 下, 单击 "**主题**"。

1. 在主题列表中, 单击 " **salesperformancemessages**", 然后单击 " **+ 订阅**"。

1. 在 "**名称**" 文本框中, 键入 "**美洲**", 然后单击 "**创建**"。

1. 单击 " **+ 订阅**"。

1. 在 "**名称**" 文本框中, 键入**EuropeAndAfrica**, 然后单击 "**创建**"。

您已构建了使用服务总线以提高销售团队分布式应用程序的恢复能力所需的基础结构。 您已为有关单个销售额的邮件创建了队列, 并为有关销售业绩的消息创建了一个主题。 主题包括多个订阅, 因为发送到该主题的邮件可传递到世界各地的多个收件人 web 服务。
