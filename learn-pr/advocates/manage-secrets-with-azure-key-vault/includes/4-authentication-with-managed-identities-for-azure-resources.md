<span data-ttu-id="82a55-101">azure Key Vault 使用**azure Active Directory**对尝试访问保管库的用户和应用程序进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="82a55-101">Azure Key Vault uses **Azure Active Directory** to authenticate users and applications that try to access a vault.</span></span> <span data-ttu-id="82a55-102">若要向 web 应用程序授予对保管库的访问权限, 我们首先需要使用 Azure Active Directory 注册应用。</span><span class="sxs-lookup"><span data-stu-id="82a55-102">To grant our web application access to the vault, we first need to register our app with Azure Active Directory.</span></span> <span data-ttu-id="82a55-103">注册会为应用程序创建标识。</span><span class="sxs-lookup"><span data-stu-id="82a55-103">Registering creates an identity for the app.</span></span> <span data-ttu-id="82a55-104">一旦应用程序具有标识, 我们就可以将保管库权限分配给它。</span><span class="sxs-lookup"><span data-stu-id="82a55-104">Once the app has an identity, we can assign vault permissions to it.</span></span>

<span data-ttu-id="82a55-105">应用和用户使用 Azure Active Directory 身份验证令牌对密钥保管库进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="82a55-105">Apps and users authenticate to Key Vault using an Azure Active Directory authentication token.</span></span> <span data-ttu-id="82a55-106">从 Azure Active Directory 获取令牌需要一个机密或证书, 因为拥有令牌的任何人都可以使用应用程序标识访问保管库中的所有机密。</span><span class="sxs-lookup"><span data-stu-id="82a55-106">Getting a token from Azure Active Directory requires a secret or certificate, because anyone with a token could use the application identity to access all of the secrets in the vault.</span></span>

<span data-ttu-id="82a55-107">我们的应用程序机密在保管库中是安全的, 但我们仍需要在保管库外部保存机密或证书, 以便访问它们!</span><span class="sxs-lookup"><span data-stu-id="82a55-107">Our application secrets are secure in the vault, but we still need to keep a secret or certificate outside of the vault in order to access them!</span></span> <span data-ttu-id="82a55-108">此问题称为 "*引导问题*", 并且 Azure 为其提供了解决方案。</span><span class="sxs-lookup"><span data-stu-id="82a55-108">This problem is called the *bootstrapping problem*, and Azure has a solution for it.</span></span>

## <a name="managed-identities-for-azure-resources"></a><span data-ttu-id="82a55-109">Azure 资源的托管标识</span><span class="sxs-lookup"><span data-stu-id="82a55-109">Managed identities for Azure resources</span></span>

<span data-ttu-id="82a55-110">azure 资源的托管标识是一个 Azure 功能, 您的应用程序可以使用它来访问密钥存储库和其他 Azure 服务, 而无需在保管库外管理甚至单个密钥。</span><span class="sxs-lookup"><span data-stu-id="82a55-110">Managed identities for Azure resources is an Azure feature that your app can use to access Key Vault and other Azure services without having to manage even a single secret outside of the vault.</span></span> <span data-ttu-id="82a55-111">使用托管标识是利用 web 应用中的密钥存储库的一种简单且安全的方式。</span><span class="sxs-lookup"><span data-stu-id="82a55-111">Using a managed identity is a simple and secure way to take advantage of Key Vault from your web app.</span></span>

<span data-ttu-id="82a55-112">当您在 web 应用程序上启用托管标识时, Azure 将激活单独的令牌授予 REST 服务, 以供您的应用程序使用。</span><span class="sxs-lookup"><span data-stu-id="82a55-112">When you enable managed identity on your web app, Azure activates a separate token-granting REST service specifically for use by your app.</span></span> <span data-ttu-id="82a55-113">你的应用将从该服务 (而不是直接从 Azure Active Directory) 中请求令牌。</span><span class="sxs-lookup"><span data-stu-id="82a55-113">Your app will request tokens from this service instead of directly from Azure Active Directory.</span></span> <span data-ttu-id="82a55-114">您的应用程序需要使用密码来访问此服务, 但在应用程序启动时, 该密码将被注入到应用程序服务的环境变量中。</span><span class="sxs-lookup"><span data-stu-id="82a55-114">Your app needs to use a secret to access this service, but that secret is injected into your app's environment variables by App Service when it starts up.</span></span> <span data-ttu-id="82a55-115">您无需在任何位置管理或存储此密钥值, 并且应用程序以外的任何内容都不能访问此机密或托管标识令牌服务终结点。</span><span class="sxs-lookup"><span data-stu-id="82a55-115">You don't need to manage or store this secret value anywhere, and nothing outside of your app can access this secret or the managed identity token service endpoint.</span></span>

<span data-ttu-id="82a55-116">azure 资源的托管标识还为你在 Azure Active Directory 中注册应用, 如果你删除 web 应用或禁用其托管标识, 则将删除注册。</span><span class="sxs-lookup"><span data-stu-id="82a55-116">Managed identities for Azure resources also registers your app in Azure Active Directory for you, and will delete the registration if you delete the web app or disable its managed identity.</span></span>

<span data-ttu-id="82a55-117">托管标识在所有版本的 azure Active Directory 中可用, 包括 azure 订阅附带的免费版本。</span><span class="sxs-lookup"><span data-stu-id="82a55-117">Managed identities are available in all editions of Azure Active Directory, including the Free edition included with an Azure subscription.</span></span> <span data-ttu-id="82a55-118">在应用服务中使用它没有额外的成本且无需任何配置, 并且可以随时在应用程序上启用或禁用。</span><span class="sxs-lookup"><span data-stu-id="82a55-118">Using it in App Service has no extra cost and requires no configuration, and it can be enabled or disabled on an app at any time.</span></span>

> [!NOTE]
> <span data-ttu-id="82a55-119">Linux 或容器 web 应用目前不支持 Azure 资源的托管标识。</span><span class="sxs-lookup"><span data-stu-id="82a55-119">Managed identities for Azure resources is not currently supported for Linux or Container web apps.</span></span>

<span data-ttu-id="82a55-120">为 web 应用启用托管标识只需要一个 Azure CLI 命令, 而无需进行配置。</span><span class="sxs-lookup"><span data-stu-id="82a55-120">Enabling a managed identity for a web app requires only a single Azure CLI command with no configuration.</span></span> <span data-ttu-id="82a55-121">稍后, 我们将在设置应用服务应用程序并将其部署到 Azure 时执行此操作。</span><span class="sxs-lookup"><span data-stu-id="82a55-121">We'll do it later on when we set up an App Service app and deploy to Azure.</span></span> <span data-ttu-id="82a55-122">在此之前, 我们将应用托管标识的知识, 以编写适用于我们的应用程序的代码。</span><span class="sxs-lookup"><span data-stu-id="82a55-122">Before that, though, we're going to apply our knowledge of managed identities to write the code for our app.</span></span>