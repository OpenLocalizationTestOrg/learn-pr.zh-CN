azure Key Vault 使用**azure Active Directory**对尝试访问保管库的用户和应用程序进行身份验证。 若要向 web 应用程序授予对保管库的访问权限, 我们首先需要使用 Azure Active Directory 注册应用。 注册会为应用程序创建标识。 一旦应用程序具有标识, 我们就可以将保管库权限分配给它。

应用和用户使用 Azure Active Directory 身份验证令牌对密钥保管库进行身份验证。 从 Azure Active Directory 获取令牌需要一个机密或证书, 因为拥有令牌的任何人都可以使用应用程序标识访问保管库中的所有机密。

我们的应用程序机密在保管库中是安全的, 但我们仍需要在保管库外部保存机密或证书, 以便访问它们! 此问题称为 "*引导问题*", 并且 Azure 为其提供了解决方案。

## <a name="managed-identities-for-azure-resources"></a>Azure 资源的托管标识

azure 资源的托管标识是一个 Azure 功能, 您的应用程序可以使用它来访问密钥存储库和其他 Azure 服务, 而无需在保管库外管理甚至单个密钥。 使用托管标识是利用 web 应用中的密钥存储库的一种简单且安全的方式。

当您在 web 应用程序上启用托管标识时, Azure 将激活单独的令牌授予 REST 服务, 以供您的应用程序使用。 你的应用将从该服务 (而不是直接从 Azure Active Directory) 中请求令牌。 您的应用程序需要使用密码来访问此服务, 但在应用程序启动时, 该密码将被注入到应用程序服务的环境变量中。 您无需在任何位置管理或存储此密钥值, 并且应用程序以外的任何内容都不能访问此机密或托管标识令牌服务终结点。

azure 资源的托管标识还为你在 Azure Active Directory 中注册应用, 如果你删除 web 应用或禁用其托管标识, 则将删除注册。

托管标识在所有版本的 azure Active Directory 中可用, 包括 azure 订阅附带的免费版本。 在应用服务中使用它没有额外的成本且无需任何配置, 并且可以随时在应用程序上启用或禁用。

> [!NOTE]
> Linux 或容器 web 应用目前不支持 Azure 资源的托管标识。

为 web 应用启用托管标识只需要一个 Azure CLI 命令, 而无需进行配置。 稍后, 我们将在设置应用服务应用程序并将其部署到 Azure 时执行此操作。 在此之前, 我们将应用托管标识的知识, 以编写适用于我们的应用程序的代码。