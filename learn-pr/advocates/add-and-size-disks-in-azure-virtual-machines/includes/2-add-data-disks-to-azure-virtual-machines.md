与其他任何计算机一样, Azure 中的虚拟机也将磁盘用作存储操作系统、应用程序和数据的位置。 这些磁盘称为虚拟硬盘 (vhd)。

假设您在 Azure 中创建了一个虚拟机 (VM), 它将托管您的法律事务所依赖的案例历史记录数据库。 设计良好的磁盘配置是对 SQL Server 性能和恢复能力的基础。

在此单元中, 你将了解如何为磁盘选择正确的配置值, 以及如何将这些磁盘附加到 VM。

## <a name="how-disks-are-used-by-vms"></a>虚拟机使用磁盘的方式

虚拟机将磁盘用于三个不同的目的:

- **操作系统存储**。 每个 VM 都包含一个存储操作系统的磁盘。 此驱动器注册为 SATA 驱动器, 并在 Windows 中标记为 C: 驱动器, 并在 Unix 操作系统中以 "/" 形式安装。 它的最大容量为2048千兆字节 (GB), 其内容取自用于创建 vm 的 vm 映像。
- **临时存储**。 每个 VM 都包含一个用于页面和交换文件的临时 VHD。 在维护事件或重新部署过程中, 此驱动器上的数据可能会丢失。 默认情况下, 驱动器被标记为 D: (在 Windows VM 上)。 请勿使用此驱动器存储不希望丢失的重要数据。
- **数据存储**。 数据磁盘是附加到 VM 的任何其他磁盘。 您可以使用数据磁盘存储文件、数据库和任何其他需要在重新启动后保留的数据。 默认情况下, 一些 VM 映像包含数据磁盘。 您还可以将其他数据磁盘添加到 VM 大小指定的最大值。 每个数据磁盘都注册为一个 SCSI 驱动器, 最大容量为 4095 GB。 你可以为数据驱动器选择驱动器号或装入点。

## <a name="storing-vhd-files"></a>存储 VHD 文件

在 azure 中, vhd 以**页面 blob**的形式存储在 azure 存储帐户中。

此表显示了不同类型的存储帐户以及可以与每个帐户一起使用的对象。

|**存储帐户类型**|**常规用途标准**|**常规用途高级版**|**Blob 存储、热和酷访问层**|
|-----|-----|-----|-----|
|**支持的服务**| azure Blob 存储、azure 文件、azure 队列存储 | Blob 存储 | Blob 存储|
|**支持的 blob 类型**|阻止 blob、页面 blob 和附加 blob | 页面 blob | 阻止 blob 和附加 blob|

常规用途标准和高级存储支持页面 blob。 如果成本是你主要关注的问题, 请选择一个标准存储帐户。 高级存储成本更高, 但每秒的 i/o 操作数或 IOPS 也将提供更高的 i/o 操作数。 如果你的 VM 需要数据性能, 请考虑使用高级存储。

## <a name="attach-data-disks-to-vms"></a>将数据磁盘附加到 vm

您可以随时将数据磁盘添加到虚拟机, 具体方法是将其附加到 VM。 附加磁盘将 VHD 文件与 VM 相关联。 

无法在连接时从存储中删除 VHD。

### <a name="attach-an-existing-data-disk-to-an-azure-vm"></a>将现有数据磁盘附加到 Azure 虚拟机

您可能已有一个 VHD, 用于存储要在 Azure VM 中使用的数据。 例如, 在我们的法律公司方案中, 你可能已将物理磁盘转换为本地 vhd。 在这种情况下, 您可以使用`Add-AzVhd` PowerShell cmdlet 将其上载到存储帐户。 此 cmdlet 针对传输 VHD 文件进行了优化, 并且可能会完成上载的速度快于其他方法。 通过使用多个线程来完成传输, 以获得最佳性能。 上载 VHD 之后, 将其作为数据磁盘附加到现有 VM。 这是一种将所有类型的数据部署到 Azure 虚拟机的绝佳方式。 数据自动显示在 VM 中, 无需对新磁盘进行分区或格式化。

### <a name="attach-a-new-data-disk-to-an-azure-vm"></a>将新的数据磁盘附加到 Azure 虚拟机

您可以使用 Azure 门户将新的空数据磁盘添加到 VM。 

此过程将在您指定的存储帐户中创建一个 **.vhd**文件作为页面 blob, 并将该 .vhd 文件作为数据磁盘附加到 VM。

在可以使用新 VHD 存储数据之前, 您必须对新磁盘进行初始化、分区和格式化。 我们将在下一个练习中练习这些步骤。

在物理本地服务器中, 将数据存储在物理硬盘上。 将数据存储在虚拟硬盘 (vhd) 上的 Azure 虚拟机 (VM) 中。 这些 vhd 以页面 blob 的形式存储在 Azure 存储帐户中。 例如, 当您将法律事务所的案例历史数据库迁移到 Azure 时, 您必须创建将保存数据库文件的 vhd。
