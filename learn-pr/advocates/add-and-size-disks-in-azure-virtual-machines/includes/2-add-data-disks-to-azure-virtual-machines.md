<span data-ttu-id="26f81-101">与其他任何计算机一样, Azure 中的虚拟机也将磁盘用作存储操作系统、应用程序和数据的位置。</span><span class="sxs-lookup"><span data-stu-id="26f81-101">Just like any other computer, virtual machines in Azure use disks as a place to store an operating system, applications, and data.</span></span> <span data-ttu-id="26f81-102">这些磁盘称为虚拟硬盘 (vhd)。</span><span class="sxs-lookup"><span data-stu-id="26f81-102">These disks are called virtual hard disks (VHDs).</span></span>

<span data-ttu-id="26f81-103">假设您在 Azure 中创建了一个虚拟机 (VM), 它将托管您的法律事务所依赖的案例历史记录数据库。</span><span class="sxs-lookup"><span data-stu-id="26f81-103">Suppose you have created a virtual machine (VM) in Azure, which will host the database of case histories that your law firm relies on.</span></span> <span data-ttu-id="26f81-104">设计良好的磁盘配置是对 SQL Server 性能和恢复能力的基础。</span><span class="sxs-lookup"><span data-stu-id="26f81-104">A well-designed disk configuration is fundamental to good performance and resilience for SQL Server.</span></span>

<span data-ttu-id="26f81-105">在此单元中, 你将了解如何为磁盘选择正确的配置值, 以及如何将这些磁盘附加到 VM。</span><span class="sxs-lookup"><span data-stu-id="26f81-105">In this unit, you'll learn how to choose the right configuration values for your disks and how to attach those disks to a VM.</span></span>

## <a name="how-disks-are-used-by-vms"></a><span data-ttu-id="26f81-106">虚拟机使用磁盘的方式</span><span class="sxs-lookup"><span data-stu-id="26f81-106">How disks are used by VMs</span></span>

<span data-ttu-id="26f81-107">虚拟机将磁盘用于三个不同的目的:</span><span class="sxs-lookup"><span data-stu-id="26f81-107">VMs use disks for three different purposes:</span></span>

- <span data-ttu-id="26f81-108">**操作系统存储**。</span><span class="sxs-lookup"><span data-stu-id="26f81-108">**Operating system storage**.</span></span> <span data-ttu-id="26f81-109">每个 VM 都包含一个存储操作系统的磁盘。</span><span class="sxs-lookup"><span data-stu-id="26f81-109">Every VM includes one disk that stores the operating system.</span></span> <span data-ttu-id="26f81-110">此驱动器注册为 SATA 驱动器, 并在 Windows 中标记为 C: 驱动器, 并在 Unix 操作系统中以 "/" 形式安装。</span><span class="sxs-lookup"><span data-stu-id="26f81-110">This drive is registered as a SATA drive and labeled as the C: drive in Windows and mounted at "/" in Unix-like operating systems.</span></span> <span data-ttu-id="26f81-111">它的最大容量为2048千兆字节 (GB), 其内容取自用于创建 vm 的 vm 映像。</span><span class="sxs-lookup"><span data-stu-id="26f81-111">It has a maximum capacity of 2048 gigabytes (GB), and its content is taken from the VM image you used to create the VM.</span></span>
- <span data-ttu-id="26f81-112">**临时存储**。</span><span class="sxs-lookup"><span data-stu-id="26f81-112">**Temporary storage**.</span></span> <span data-ttu-id="26f81-113">每个 VM 都包含一个用于页面和交换文件的临时 VHD。</span><span class="sxs-lookup"><span data-stu-id="26f81-113">Every VM includes a temporary VHD that is used for page and swap files.</span></span> <span data-ttu-id="26f81-114">在维护事件或重新部署过程中, 此驱动器上的数据可能会丢失。</span><span class="sxs-lookup"><span data-stu-id="26f81-114">Data on this drive may be lost during a maintenance event or redeployment.</span></span> <span data-ttu-id="26f81-115">默认情况下, 驱动器被标记为 D: (在 Windows VM 上)。</span><span class="sxs-lookup"><span data-stu-id="26f81-115">The drive is labeled as D: on a Windows VM by default.</span></span> <span data-ttu-id="26f81-116">请勿使用此驱动器存储不希望丢失的重要数据。</span><span class="sxs-lookup"><span data-stu-id="26f81-116">Do not use this drive to store important data that you do not want to lose.</span></span>
- <span data-ttu-id="26f81-117">**数据存储**。</span><span class="sxs-lookup"><span data-stu-id="26f81-117">**Data storage**.</span></span> <span data-ttu-id="26f81-118">数据磁盘是附加到 VM 的任何其他磁盘。</span><span class="sxs-lookup"><span data-stu-id="26f81-118">A data disk is any other disk attached to a VM.</span></span> <span data-ttu-id="26f81-119">您可以使用数据磁盘存储文件、数据库和任何其他需要在重新启动后保留的数据。</span><span class="sxs-lookup"><span data-stu-id="26f81-119">You use data disks to store files, databases, and any other data that you need to persist across reboots.</span></span> <span data-ttu-id="26f81-120">默认情况下, 一些 VM 映像包含数据磁盘。</span><span class="sxs-lookup"><span data-stu-id="26f81-120">Some VM images include data disks by default.</span></span> <span data-ttu-id="26f81-121">您还可以将其他数据磁盘添加到 VM 大小指定的最大值。</span><span class="sxs-lookup"><span data-stu-id="26f81-121">You can also add additional data disks up to the maximum number specified by the size of the VM.</span></span> <span data-ttu-id="26f81-122">每个数据磁盘都注册为一个 SCSI 驱动器, 最大容量为 4095 GB。</span><span class="sxs-lookup"><span data-stu-id="26f81-122">Each data disk is registered as a SCSI drive and has a max capacity of 4095 GB.</span></span> <span data-ttu-id="26f81-123">你可以为数据驱动器选择驱动器号或装入点。</span><span class="sxs-lookup"><span data-stu-id="26f81-123">You can choose drive letters or mount points for your data drives.</span></span>

## <a name="storing-vhd-files"></a><span data-ttu-id="26f81-124">存储 VHD 文件</span><span class="sxs-lookup"><span data-stu-id="26f81-124">Storing VHD files</span></span>

<span data-ttu-id="26f81-125">在 azure 中, vhd 以**页面 blob**的形式存储在 azure 存储帐户中。</span><span class="sxs-lookup"><span data-stu-id="26f81-125">In Azure, VHDs are stored in an Azure storage account as **page blobs**.</span></span>

<span data-ttu-id="26f81-126">此表显示了不同类型的存储帐户以及可以与每个帐户一起使用的对象。</span><span class="sxs-lookup"><span data-stu-id="26f81-126">This table shows the various kinds of storage accounts and which objects can be used with each.</span></span>

|<span data-ttu-id="26f81-127">**存储帐户类型**</span><span class="sxs-lookup"><span data-stu-id="26f81-127">**Type of storage account**</span></span>|<span data-ttu-id="26f81-128">**常规用途标准**</span><span class="sxs-lookup"><span data-stu-id="26f81-128">**General-purpose standard**</span></span>|<span data-ttu-id="26f81-129">**常规用途高级版**</span><span class="sxs-lookup"><span data-stu-id="26f81-129">**General-purpose premium**</span></span>|<span data-ttu-id="26f81-130">**Blob 存储、热和酷访问层**</span><span class="sxs-lookup"><span data-stu-id="26f81-130">**Blob storage, hot and cool access tiers**</span></span>|
|-----|-----|-----|-----|
|<span data-ttu-id="26f81-131">**支持的服务**</span><span class="sxs-lookup"><span data-stu-id="26f81-131">**Services supported**</span></span>| <span data-ttu-id="26f81-132">azure Blob 存储、azure 文件、azure 队列存储</span><span class="sxs-lookup"><span data-stu-id="26f81-132">Azure Blob storage, Azure Files, Azure Queue storage</span></span> | <span data-ttu-id="26f81-133">Blob 存储</span><span class="sxs-lookup"><span data-stu-id="26f81-133">Blob storage</span></span> | <span data-ttu-id="26f81-134">Blob 存储</span><span class="sxs-lookup"><span data-stu-id="26f81-134">Blob storage</span></span>|
|<span data-ttu-id="26f81-135">**支持的 blob 类型**</span><span class="sxs-lookup"><span data-stu-id="26f81-135">**Types of blobs supported**</span></span>|<span data-ttu-id="26f81-136">阻止 blob、页面 blob 和附加 blob</span><span class="sxs-lookup"><span data-stu-id="26f81-136">Block blobs, page blobs, and append blobs</span></span> | <span data-ttu-id="26f81-137">页面 blob</span><span class="sxs-lookup"><span data-stu-id="26f81-137">Page blobs</span></span> | <span data-ttu-id="26f81-138">阻止 blob 和附加 blob</span><span class="sxs-lookup"><span data-stu-id="26f81-138">Block blobs and append blobs</span></span>|

<span data-ttu-id="26f81-139">常规用途标准和高级存储支持页面 blob。</span><span class="sxs-lookup"><span data-stu-id="26f81-139">Both general-purpose standard and premium storage support page blobs.</span></span> <span data-ttu-id="26f81-140">如果成本是你主要关注的问题, 请选择一个标准存储帐户。</span><span class="sxs-lookup"><span data-stu-id="26f81-140">Choose a standard storage account if cost is your primary concern.</span></span> <span data-ttu-id="26f81-141">高级存储成本更高, 但每秒的 i/o 操作数或 IOPS 也将提供更高的 i/o 操作数。</span><span class="sxs-lookup"><span data-stu-id="26f81-141">Premium storage will cost more, but will also deliver much higher I/O operations per second, or IOPS.</span></span> <span data-ttu-id="26f81-142">如果你的 VM 需要数据性能, 请考虑使用高级存储。</span><span class="sxs-lookup"><span data-stu-id="26f81-142">If data performance is a requirement for your VM, consider using premium storage.</span></span>

## <a name="attach-data-disks-to-vms"></a><span data-ttu-id="26f81-143">将数据磁盘附加到 vm</span><span class="sxs-lookup"><span data-stu-id="26f81-143">Attach data disks to VMs</span></span>

<span data-ttu-id="26f81-144">您可以随时将数据磁盘添加到虚拟机, 具体方法是将其附加到 VM。</span><span class="sxs-lookup"><span data-stu-id="26f81-144">You can add data disks to a virtual machine at any time by attaching them to the VM.</span></span> <span data-ttu-id="26f81-145">附加磁盘将 VHD 文件与 VM 相关联。</span><span class="sxs-lookup"><span data-stu-id="26f81-145">Attaching a disk associates the VHD file with the VM.</span></span> 

<span data-ttu-id="26f81-146">无法在连接时从存储中删除 VHD。</span><span class="sxs-lookup"><span data-stu-id="26f81-146">The VHD can't be deleted from storage while it's attached.</span></span>

### <a name="attach-an-existing-data-disk-to-an-azure-vm"></a><span data-ttu-id="26f81-147">将现有数据磁盘附加到 Azure 虚拟机</span><span class="sxs-lookup"><span data-stu-id="26f81-147">Attach an existing data disk to an Azure VM</span></span>

<span data-ttu-id="26f81-148">您可能已有一个 VHD, 用于存储要在 Azure VM 中使用的数据。</span><span class="sxs-lookup"><span data-stu-id="26f81-148">You may already have a VHD that stores the data you want to use in your Azure VM.</span></span> <span data-ttu-id="26f81-149">例如, 在我们的法律公司方案中, 你可能已将物理磁盘转换为本地 vhd。</span><span class="sxs-lookup"><span data-stu-id="26f81-149">In our law firm scenario, for example, perhaps you've already converted your physical disks to VHDs locally.</span></span> <span data-ttu-id="26f81-150">在这种情况下, 您可以使用`Add-AzVhd` PowerShell cmdlet 将其上载到存储帐户。</span><span class="sxs-lookup"><span data-stu-id="26f81-150">In this case, you can use the PowerShell `Add-AzVhd` cmdlet to upload it to the storage account.</span></span> <span data-ttu-id="26f81-151">此 cmdlet 针对传输 VHD 文件进行了优化, 并且可能会完成上载的速度快于其他方法。</span><span class="sxs-lookup"><span data-stu-id="26f81-151">This cmdlet is optimized for transferring VHD files and may complete the upload faster than other methods.</span></span> <span data-ttu-id="26f81-152">通过使用多个线程来完成传输, 以获得最佳性能。</span><span class="sxs-lookup"><span data-stu-id="26f81-152">The transfer is completed by using multiple threads for best performance.</span></span> <span data-ttu-id="26f81-153">上载 VHD 之后, 将其作为数据磁盘附加到现有 VM。</span><span class="sxs-lookup"><span data-stu-id="26f81-153">Once the VHD has been uploaded, attach it to an existing VM as a data disk.</span></span> <span data-ttu-id="26f81-154">这是一种将所有类型的数据部署到 Azure 虚拟机的绝佳方式。</span><span class="sxs-lookup"><span data-stu-id="26f81-154">This approach an excellent way to deploy data of all types to Azure VMs.</span></span> <span data-ttu-id="26f81-155">数据自动显示在 VM 中, 无需对新磁盘进行分区或格式化。</span><span class="sxs-lookup"><span data-stu-id="26f81-155">The data is automatically present in the VM, and there's no need to partition or format the new disk.</span></span>

### <a name="attach-a-new-data-disk-to-an-azure-vm"></a><span data-ttu-id="26f81-156">将新的数据磁盘附加到 Azure 虚拟机</span><span class="sxs-lookup"><span data-stu-id="26f81-156">Attach a new data disk to an Azure VM</span></span>

<span data-ttu-id="26f81-157">您可以使用 Azure 门户将新的空数据磁盘添加到 VM。</span><span class="sxs-lookup"><span data-stu-id="26f81-157">You can use the Azure portal to add a new, empty data disk to a VM.</span></span> 

<span data-ttu-id="26f81-158">此过程将在您指定的存储帐户中创建一个 **.vhd**文件作为页面 blob, 并将该 .vhd 文件作为数据磁盘附加到 VM。</span><span class="sxs-lookup"><span data-stu-id="26f81-158">This process will create a **.vhd** file as a page blob in the storage account that you specify, and attach that .vhd file as a data disk to the VM.</span></span>

<span data-ttu-id="26f81-159">在可以使用新 VHD 存储数据之前, 您必须对新磁盘进行初始化、分区和格式化。</span><span class="sxs-lookup"><span data-stu-id="26f81-159">Before you can use the new VHD to store data, you have to initialize, partition, and format the new disk.</span></span> <span data-ttu-id="26f81-160">我们将在下一个练习中练习这些步骤。</span><span class="sxs-lookup"><span data-stu-id="26f81-160">We'll practice these steps in the next exercise.</span></span>

<span data-ttu-id="26f81-161">在物理本地服务器中, 将数据存储在物理硬盘上。</span><span class="sxs-lookup"><span data-stu-id="26f81-161">In physical on-premises servers, you store data on physical hard disks.</span></span> <span data-ttu-id="26f81-162">将数据存储在虚拟硬盘 (vhd) 上的 Azure 虚拟机 (VM) 中。</span><span class="sxs-lookup"><span data-stu-id="26f81-162">You store data in an Azure virtual machine (VM) on virtual hard disks (VHDs).</span></span> <span data-ttu-id="26f81-163">这些 vhd 以页面 blob 的形式存储在 Azure 存储帐户中。</span><span class="sxs-lookup"><span data-stu-id="26f81-163">These VHDs are stored as page blobs in Azure storage accounts.</span></span> <span data-ttu-id="26f81-164">例如, 当您将法律事务所的案例历史数据库迁移到 Azure 时, 您必须创建将保存数据库文件的 vhd。</span><span class="sxs-lookup"><span data-stu-id="26f81-164">For example, when you migrate your law firm's database of case histories to Azure, you must create VHDs where the database files will be saved.</span></span>
