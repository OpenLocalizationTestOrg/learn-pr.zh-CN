<span data-ttu-id="19702-101">接下来, 让我们考虑数据库的数据。</span><span class="sxs-lookup"><span data-stu-id="19702-101">Next, let's consider the data for your database.</span></span> <span data-ttu-id="19702-102">足够的吞吐量非常重要, 这是为了确保您能够处理满足业务需求的事务量。</span><span class="sxs-lookup"><span data-stu-id="19702-102">Adequate throughput is important to ensure you can handle the volume of transactions for your business needs.</span></span> <span data-ttu-id="19702-103">吞吐量要求并不总是一致的。</span><span class="sxs-lookup"><span data-stu-id="19702-103">Throughput requirements aren't always consistent.</span></span> <span data-ttu-id="19702-104">例如, 您可能要在销售或假日期间构建需要扩展的购物网站。</span><span class="sxs-lookup"><span data-stu-id="19702-104">For example, you may be building a shopping website that needs to scale during sales or holidays.</span></span> <span data-ttu-id="19702-105">我们将首先了解请求单元, 并了解如何估计吞吐量要求。</span><span class="sxs-lookup"><span data-stu-id="19702-105">We'll start by learning about request units and how to estimate throughput requirements.</span></span>

## <a name="what-is-database-throughput"></a><span data-ttu-id="19702-106">数据库的吞吐量是多少？</span><span class="sxs-lookup"><span data-stu-id="19702-106">What is database throughput?</span></span> 

<span data-ttu-id="19702-107">数据库吞吐量是您的数据库可以在一秒钟内执行的读取和写入操作的数量。</span><span class="sxs-lookup"><span data-stu-id="19702-107">Database throughput is the number of reads and writes that your database can perform in a single second.</span></span>

<span data-ttu-id="19702-108">若要以战略方式扩展吞吐量, 您需要通过估计在不同时间和不同文档大小支持的读取和写入次数来估计吞吐量需求。</span><span class="sxs-lookup"><span data-stu-id="19702-108">To scale throughput strategically, you need to estimate your throughput needs by estimating the number of reads and writes you'll have to support at different times and for different document sizes.</span></span> <span data-ttu-id="19702-109">如果你估计正确, 你将在需求高峰时让你的用户感到满意。</span><span class="sxs-lookup"><span data-stu-id="19702-109">If you estimate correctly, you'll keep your users happy when demand spikes.</span></span> <span data-ttu-id="19702-110">如果你不正确地估计, 你的请求可能会获得费率限制, 并且操作将不得不等待并重试, 这可能导致高延迟和客户不满意。</span><span class="sxs-lookup"><span data-stu-id="19702-110">If you estimate incorrectly, your requests can get rate-limited and operations will have to wait and retry, likely causing high latency and unhappy customers.</span></span>

## <a name="what-is-a-request-unit"></a><span data-ttu-id="19702-111">什么是请求单元？</span><span class="sxs-lookup"><span data-stu-id="19702-111">What is a request unit?</span></span>

<span data-ttu-id="19702-112">Azure Cosmos DB 使用称为**请求单元 (RU)** 的内容来衡量吞吐量。</span><span class="sxs-lookup"><span data-stu-id="19702-112">Azure Cosmos DB measures throughput using something called a **request unit (RU)**.</span></span> <span data-ttu-id="19702-113">每秒测量一次请求单位的使用, 因此度量单位为**每秒请求单位 (RU/秒)**。</span><span class="sxs-lookup"><span data-stu-id="19702-113">Request unit usage is measured per second, so the unit of measure is **request units per second (RU/s)**.</span></span> <span data-ttu-id="19702-114">您必须保留您希望 Azure Cosmos DB 提前进行预配的 RU/秒数, 以便它可以处理您估计的负载, 并可在任何时间扩展/秒以满足当前需求。</span><span class="sxs-lookup"><span data-stu-id="19702-114">You must reserve the number of RU/s you want Azure Cosmos DB to provision in advance, so it can handle the load you've estimated, and you can scale your RU/s up or down at any time to meet current demand.</span></span>

## <a name="request-unit-basics"></a><span data-ttu-id="19702-115">请求单元基础</span><span class="sxs-lookup"><span data-stu-id="19702-115">Request unit basics</span></span>

<span data-ttu-id="19702-116">一个请求单元 1 RU, 相当于在 1 KB 的文档上使用文档的 ID 执行单个 GET 请求的大致开销。</span><span class="sxs-lookup"><span data-stu-id="19702-116">A single request unit, 1 RU, is equal to the approximate cost of performing a single GET request on a 1-KB document using a document's ID.</span></span> <span data-ttu-id="19702-117">使用文档的 ID 执行 GET 是检索文档的有效方法, 因此成本较小。</span><span class="sxs-lookup"><span data-stu-id="19702-117">Performing a GET by using a document's ID is an efficient means for retrieving a document, and thus the cost is small.</span></span> <span data-ttu-id="19702-118">创建、替换或删除同一项目需要服务进行额外处理, 因此需要更多请求单元。</span><span class="sxs-lookup"><span data-stu-id="19702-118">Creating, replacing, or deleting the same item requires additional processing by the service, and therefore requires more request units.</span></span>

<span data-ttu-id="19702-119">根据文档的大小、文档中属性的数量、正在执行的操作和一些其他复杂概念 (如一致性和索引策略), 操作的请求单位数将发生变化。</span><span class="sxs-lookup"><span data-stu-id="19702-119">The number of request units used for an operation changes depending on the document size, the number of properties in the document, the operation being performed, and some additional complex concepts such as consistency and indexing policy.</span></span>

<span data-ttu-id="19702-120">下表显示了三个不同大小的项目 (1 KB、4 kb 和 64 KB) 和两个不同的性能级别 (500 读取/秒 + 100 写入/秒和500读取/秒 + 500 写入/秒) 所需的请求单位数。</span><span class="sxs-lookup"><span data-stu-id="19702-120">The following table shows the number of request units required for items of three different sizes (1 KB, 4 KB, and 64 KB) and at two different performance levels (500 reads/second + 100 writes/second and 500 reads/second + 500 writes/second).</span></span> <span data-ttu-id="19702-121">在此示例中, 数据一致性设置为**Session**, 索引策略设置为**无**。</span><span class="sxs-lookup"><span data-stu-id="19702-121">In this example, the data consistency is set to **Session**, and the indexing policy is set to **None**.</span></span>

| <span data-ttu-id="19702-122">项目大小</span><span class="sxs-lookup"><span data-stu-id="19702-122">Item size</span></span> | <span data-ttu-id="19702-123">读取数/秒</span><span class="sxs-lookup"><span data-stu-id="19702-123">Reads/second</span></span> | <span data-ttu-id="19702-124">Writes/second</span><span class="sxs-lookup"><span data-stu-id="19702-124">Writes/second</span></span> | <span data-ttu-id="19702-125">请求单位</span><span class="sxs-lookup"><span data-stu-id="19702-125">Request units</span></span>
| --- | --- | --- | --- |
| <span data-ttu-id="19702-126">1 KB</span><span class="sxs-lookup"><span data-stu-id="19702-126">1 KB</span></span> | <span data-ttu-id="19702-127">500</span><span class="sxs-lookup"><span data-stu-id="19702-127">500</span></span> | <span data-ttu-id="19702-128">100</span><span class="sxs-lookup"><span data-stu-id="19702-128">100</span></span> | <span data-ttu-id="19702-129">(500 \* 1) + (100 \* 5) = 1000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-129">(500 \* 1) + (100 \* 5) = 1,000 RU/s</span></span>
| <span data-ttu-id="19702-130">1 KB</span><span class="sxs-lookup"><span data-stu-id="19702-130">1 KB</span></span> | <span data-ttu-id="19702-131">500</span><span class="sxs-lookup"><span data-stu-id="19702-131">500</span></span> | <span data-ttu-id="19702-132">500</span><span class="sxs-lookup"><span data-stu-id="19702-132">500</span></span> | <span data-ttu-id="19702-133">(500 \* 1) + (500 \* 5) = 3000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-133">(500 \* 1) + (500 \* 5) = 3,000 RU/s</span></span>
| <span data-ttu-id="19702-134">4 KB</span><span class="sxs-lookup"><span data-stu-id="19702-134">4 KB</span></span> | <span data-ttu-id="19702-135">500</span><span class="sxs-lookup"><span data-stu-id="19702-135">500</span></span> | <span data-ttu-id="19702-136">100</span><span class="sxs-lookup"><span data-stu-id="19702-136">100</span></span> | <span data-ttu-id="19702-137">(500 \* 1.3) + (100 \* 7) = 1350 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-137">(500 \* 1.3) + (100 \* 7) = 1,350 RU/s</span></span>
| <span data-ttu-id="19702-138">4 KB</span><span class="sxs-lookup"><span data-stu-id="19702-138">4 KB</span></span> | <span data-ttu-id="19702-139">500</span><span class="sxs-lookup"><span data-stu-id="19702-139">500</span></span> | <span data-ttu-id="19702-140">500</span><span class="sxs-lookup"><span data-stu-id="19702-140">500</span></span> | <span data-ttu-id="19702-141">(500 \* 1.3) + (500 \* 7) = 4150 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-141">(500 \* 1.3) + (500 \* 7) = 4,150 RU/s</span></span>
| <span data-ttu-id="19702-142">64 KB</span><span class="sxs-lookup"><span data-stu-id="19702-142">64 KB</span></span> | <span data-ttu-id="19702-143">500</span><span class="sxs-lookup"><span data-stu-id="19702-143">500</span></span> | <span data-ttu-id="19702-144">100</span><span class="sxs-lookup"><span data-stu-id="19702-144">100</span></span> | <span data-ttu-id="19702-145">(500 \* 10) + (100 \* 48) = 9800 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-145">(500 \* 10) + (100 \* 48) = 9,800 RU/s</span></span>
| <span data-ttu-id="19702-146">64 KB</span><span class="sxs-lookup"><span data-stu-id="19702-146">64 KB</span></span> | <span data-ttu-id="19702-147">500</span><span class="sxs-lookup"><span data-stu-id="19702-147">500</span></span> | <span data-ttu-id="19702-148">500</span><span class="sxs-lookup"><span data-stu-id="19702-148">500</span></span> | <span data-ttu-id="19702-149">(500 \* 10) + (500 \* 48) = 29000 RU/秒</span><span class="sxs-lookup"><span data-stu-id="19702-149">(500 \* 10) + (500 \* 48) = 29,000 RU/s</span></span>
 
<span data-ttu-id="19702-150">正如您所看到的, 项目越大, 需要的读取和写入次数越多, 需要保留的请求单位越多。</span><span class="sxs-lookup"><span data-stu-id="19702-150">As you can see, the larger the item is, and the more reads and writes are required, the more request units you need to reserve.</span></span> <span data-ttu-id="19702-151">如果您需要估计应用程序的吞吐量需求, 则 Azure Cosmos DB[容量规划](https://www.documentdb.com/capacityplanner)器是一个在线工具, 可让您上载示例 JSON 文档并设置每秒需要完成的操作数量。</span><span class="sxs-lookup"><span data-stu-id="19702-151">If you need to estimate the throughput needs of an application, the Azure Cosmos DB [Capacity Planner](https://www.documentdb.com/capacityplanner) is an online tool that enables you to upload a sample JSON document and set the number of operations you need to complete per second.</span></span> <span data-ttu-id="19702-152">然后, 它提供了估计总保留。</span><span class="sxs-lookup"><span data-stu-id="19702-152">It then provides an estimated total to reserve.</span></span>

## <a name="exceeding-throughput-limits"></a><span data-ttu-id="19702-153">超出吞吐量限制</span><span class="sxs-lookup"><span data-stu-id="19702-153">Exceeding throughput limits</span></span>

<span data-ttu-id="19702-154">如果你没有保留足够的请求单元, 并且尝试读取或写入的数据超过你设置的吞吐量允许的数量, 则你的请求将受到分级限制。</span><span class="sxs-lookup"><span data-stu-id="19702-154">If you don’t reserve enough request units, and you attempt to read or write more data than your provisioned throughput allows, your request will be rate-limited.</span></span> <span data-ttu-id="19702-155">当请求受速率限制时, 必须在指定的时间间隔后再次重试请求。</span><span class="sxs-lookup"><span data-stu-id="19702-155">When a request is rate-limited, the request has to be retried again after a specified interval.</span></span> <span data-ttu-id="19702-156">如果使用 .net SDK, 则会在等待 "重试后" 标头中指定的时间量后自动重试该请求。</span><span class="sxs-lookup"><span data-stu-id="19702-156">If you use the .NET SDK, the request will be retried automatically after waiting the amount of time specified in the retry-after header.</span></span>

## <a name="creating-an-account-built-to-scale"></a><span data-ttu-id="19702-157">创建一个为扩展而构建的帐户</span><span class="sxs-lookup"><span data-stu-id="19702-157">Creating an account built to scale</span></span>

<span data-ttu-id="19702-158">您可以随时更改为数据库预配的请求单元数。</span><span class="sxs-lookup"><span data-stu-id="19702-158">You can change the number of request units provisioned to a database at any time.</span></span> <span data-ttu-id="19702-159">因此, 在较大的卷期内, 您可以扩展以适应这些高需求, 然后在非高峰时段降低设置的吞吐量以降低成本。</span><span class="sxs-lookup"><span data-stu-id="19702-159">So, during heavy volume periods, you can scale up to accommodate those high demands, and then reduce provisioned throughput during off peak times to reduce costs.</span></span>

<span data-ttu-id="19702-160">创建帐户时, 可以在门户中设置至少 400 ru/秒, 或最多为 250000 ru/秒。</span><span class="sxs-lookup"><span data-stu-id="19702-160">When you create an account, you can provision a minimum of 400 RU/s, or a maximum of 250,000 RU/s in the portal.</span></span> <span data-ttu-id="19702-161">如果你需要更多的吞吐量, 请在 Azure 门户中填写票证。</span><span class="sxs-lookup"><span data-stu-id="19702-161">If you need even more throughput, fill out a ticket in the Azure portal.</span></span> <span data-ttu-id="19702-162">建议几乎所有帐户将初始吞吐量设置为 1000 RU/秒, 因为这是您的数据库将自动缩放的最小值, 而您需要的存储空间量超过 10 GB。</span><span class="sxs-lookup"><span data-stu-id="19702-162">Setting the initial throughput to 1000 RU/s is recommended for almost all accounts, as it is the minimum value in which your database will autoscale should you need more than 10 GB of storage.</span></span> <span data-ttu-id="19702-163">如果将初始吞吐量设置为小于 1000 RU/秒的任何值, 则数据库将无法扩展到大于 10 GB, 除非您重新设置数据库并提供分区键。</span><span class="sxs-lookup"><span data-stu-id="19702-163">If you set the initial throughput to any value less than 1000 RU/s, your database will not be able to scale to larger than 10 GB unless you reprovision the database and provide a partition key.</span></span> <span data-ttu-id="19702-164">分区键支持在 Azure Cosmos DB 中快速查找数据, 并使其能够在需要时自动缩放数据库。</span><span class="sxs-lookup"><span data-stu-id="19702-164">Partition keys enable quick lookup of data in Azure Cosmos DB and enable it to autoscale your database when needed.</span></span> <span data-ttu-id="19702-165">本模块后面的部分将对分区键进行讨论。</span><span class="sxs-lookup"><span data-stu-id="19702-165">Partition keys are discussed a bit later in the module.</span></span>

## <a name="summary"></a><span data-ttu-id="19702-166">摘要</span><span class="sxs-lookup"><span data-stu-id="19702-166">Summary</span></span>

<span data-ttu-id="19702-167">现在, 您可以了解如何使用请求单元估计和评估 Azure Cosmos DB 的吞吐量, 并在创建新的 Azure Cosmos DB 集合时做出适当的选择。</span><span class="sxs-lookup"><span data-stu-id="19702-167">You now understand how to estimate and scope throughput for an Azure Cosmos DB using request units, and can make an appropriate selection when creating a new Azure Cosmos DB collection.</span></span> <span data-ttu-id="19702-168">可以随时修改请求单元, 但在创建帐户时将其设置为 1000 RU/秒有助于确保您的数据库可以在以后进行扩展。</span><span class="sxs-lookup"><span data-stu-id="19702-168">Request units can be modified at any time, but setting them to 1000 RU/s when you create an account helps ensure your database is ready to scale later.</span></span>