接下来, 让我们考虑数据库的数据。 足够的吞吐量非常重要, 这是为了确保您能够处理满足业务需求的事务量。 吞吐量要求并不总是一致的。 例如, 您可能要在销售或假日期间构建需要扩展的购物网站。 我们将首先了解请求单元, 并了解如何估计吞吐量要求。

## <a name="what-is-database-throughput"></a>数据库的吞吐量是多少？ 

数据库吞吐量是您的数据库可以在一秒钟内执行的读取和写入操作的数量。

若要以战略方式扩展吞吐量, 您需要通过估计在不同时间和不同文档大小支持的读取和写入次数来估计吞吐量需求。 如果你估计正确, 你将在需求高峰时让你的用户感到满意。 如果你不正确地估计, 你的请求可能会获得费率限制, 并且操作将不得不等待并重试, 这可能导致高延迟和客户不满意。

## <a name="what-is-a-request-unit"></a>什么是请求单元？

Azure Cosmos DB 使用称为**请求单元 (RU)** 的内容来衡量吞吐量。 每秒测量一次请求单位的使用, 因此度量单位为**每秒请求单位 (RU/秒)**。 您必须保留您希望 Azure Cosmos DB 提前进行预配的 RU/秒数, 以便它可以处理您估计的负载, 并可在任何时间扩展/秒以满足当前需求。

## <a name="request-unit-basics"></a>请求单元基础

一个请求单元 1 RU, 相当于在 1 KB 的文档上使用文档的 ID 执行单个 GET 请求的大致开销。 使用文档的 ID 执行 GET 是检索文档的有效方法, 因此成本较小。 创建、替换或删除同一项目需要服务进行额外处理, 因此需要更多请求单元。

根据文档的大小、文档中属性的数量、正在执行的操作和一些其他复杂概念 (如一致性和索引策略), 操作的请求单位数将发生变化。

下表显示了三个不同大小的项目 (1 KB、4 kb 和 64 KB) 和两个不同的性能级别 (500 读取/秒 + 100 写入/秒和500读取/秒 + 500 写入/秒) 所需的请求单位数。 在此示例中, 数据一致性设置为**Session**, 索引策略设置为**无**。

| 项目大小 | 读取数/秒 | Writes/second | 请求单位
| --- | --- | --- | --- |
| 1 KB | 500 | 100 | (500 * 1) + (100 * 5) = 1000 RU/秒
| 1 KB | 500 | 500 | (500 * 1) + (500 * 5) = 3000 RU/秒
| 4 KB | 500 | 100 | (500 * 1.3) + (100 * 7) = 1350 RU/秒
| 4 KB | 500 | 500 | (500 * 1.3) + (500 * 7) = 4150 RU/秒
| 64 KB | 500 | 100 | (500 * 10) + (100 * 48) = 9800 RU/秒
| 64 KB | 500 | 500 | (500 * 10) + (500 * 48) = 29000 RU/秒
 
正如您所看到的, 项目越大, 需要的读取和写入次数越多, 需要保留的请求单位越多。 如果您需要估计应用程序的吞吐量需求, 则 Azure Cosmos DB[容量规划](https://www.documentdb.com/capacityplanner)器是一个在线工具, 可让您上载示例 JSON 文档并设置每秒需要完成的操作数量。 然后, 它提供了估计总保留。

## <a name="exceeding-throughput-limits"></a>超出吞吐量限制

如果你没有保留足够的请求单元, 并且尝试读取或写入的数据超过你设置的吞吐量允许的数量, 则你的请求将受到分级限制。 当请求受速率限制时, 必须在指定的时间间隔后再次重试请求。 如果使用 .net SDK, 则会在等待 "重试后" 标头中指定的时间量后自动重试该请求。

## <a name="creating-an-account-built-to-scale"></a>创建一个为扩展而构建的帐户

您可以随时更改为数据库预配的请求单元数。 因此, 在较大的卷期内, 您可以扩展以适应这些高需求, 然后在非高峰时段降低设置的吞吐量以降低成本。

创建帐户时, 可以在门户中设置至少 400 ru/秒, 或最多为 250000 ru/秒。 如果你需要更多的吞吐量, 请在 Azure 门户中填写票证。 建议几乎所有帐户将初始吞吐量设置为 1000 RU/秒, 因为这是您的数据库将自动缩放的最小值, 而您需要的存储空间量超过 10 GB。 如果将初始吞吐量设置为小于 1000 RU/秒的任何值, 则数据库将无法扩展到大于 10 GB, 除非您重新设置数据库并提供分区键。 分区键支持在 Azure Cosmos DB 中快速查找数据, 并使其能够在需要时自动缩放数据库。 本模块后面的部分将对分区键进行讨论。

## <a name="summary"></a>摘要

现在, 您可以了解如何使用请求单元估计和评估 Azure Cosmos DB 的吞吐量, 并在创建新的 Azure Cosmos DB 集合时做出适当的选择。 可以随时修改请求单元, 但在创建帐户时将其设置为 1000 RU/秒有助于确保您的数据库可以在以后进行扩展。