<span data-ttu-id="2689f-101">您为计划快速扩展到新的地理区域而使用的在线零售商。</span><span class="sxs-lookup"><span data-stu-id="2689f-101">The online retailer that you work for plans to expand to a new geographical area soon.</span></span> <span data-ttu-id="2689f-102">此移动将增加客户群和交易量。</span><span class="sxs-lookup"><span data-stu-id="2689f-102">This move will increase your customer base and transaction volume.</span></span> <span data-ttu-id="2689f-103">您必须确保您的数据库在需要时能够处理展开。</span><span class="sxs-lookup"><span data-stu-id="2689f-103">You must ensure that your database is equipped to handle expansion whenever required.</span></span>

<span data-ttu-id="2689f-104">拥有分区策略可确保在数据库需要增长时, 可以轻松地执行此操作, 并继续执行高效的查询和事务。</span><span class="sxs-lookup"><span data-stu-id="2689f-104">Having a partition strategy ensures that when your database needs to grow, it can do so easily and continue to perform efficient queries and transactions.</span></span>

## <a name="what-is-a-partition-strategy"></a><span data-ttu-id="2689f-105">什么是分区策略？</span><span class="sxs-lookup"><span data-stu-id="2689f-105">What is a partition strategy?</span></span>

<span data-ttu-id="2689f-106">如果继续将新数据添加到单个服务器或单个分区中, 它最终会耗尽空间。</span><span class="sxs-lookup"><span data-stu-id="2689f-106">If you continue to add new data to a single server or a single partition, it will eventually run out of space.</span></span> <span data-ttu-id="2689f-107">为此, 您需要一个分区策略以向**外扩展**而不是向上扩展。</span><span class="sxs-lookup"><span data-stu-id="2689f-107">To prepare for this, you need a partitioning strategy to **scale out** instead of up.</span></span> <span data-ttu-id="2689f-108">向外扩展也称为水平缩放, 它使您可以在应用程序需要时向数据库添加更多分区。</span><span class="sxs-lookup"><span data-stu-id="2689f-108">Scaling out is also called horizontal scaling, and it enables you to add more partitions to your database as your application needs them.</span></span>

<span data-ttu-id="2689f-109">Azure Cosmos DB 中的分区和扩展策略由分区键驱动, 后者是创建集合时设置的值。</span><span class="sxs-lookup"><span data-stu-id="2689f-109">The partition and scale-out strategy in Azure Cosmos DB is driven by the partition key, which is a value set when you create a collection.</span></span> <span data-ttu-id="2689f-110">分区键设置后, 不能在不重新创建集合的情况下进行更改, 因此选择正确的分区键是在开发过程的早期阶段的重要决定。</span><span class="sxs-lookup"><span data-stu-id="2689f-110">Once the partition key is set, it cannot be changed without recreating the collection, so selecting the right partition key is an important decision to make early in your development process.</span></span>  

<span data-ttu-id="2689f-111">在此单元中, 您将了解如何选择适合您的方案的分区键, 并将利用 Azure Cosmos DB 可以为您做的自动缩放。</span><span class="sxs-lookup"><span data-stu-id="2689f-111">In this unit, you will learn how to choose a partition key that's right for your scenario and will take advantage of the autoscaling that Azure Cosmos DB can do for you.</span></span>

## <a name="what-is-a-partition-key"></a><span data-ttu-id="2689f-112">什么是分区键？</span><span class="sxs-lookup"><span data-stu-id="2689f-112">What is a partition key?</span></span>

<span data-ttu-id="2689f-113">分区键是 Azure 将数据组织为逻辑划分的值。</span><span class="sxs-lookup"><span data-stu-id="2689f-113">A partition key is the value by which Azure organizes your data into logical divisions.</span></span> <span data-ttu-id="2689f-114">在我们的联机零售方案中, `userID`使用`productId`或值作为分区键是一个很好的选择, 因为它将是唯一的, 并且很可能用于查找记录。</span><span class="sxs-lookup"><span data-stu-id="2689f-114">In our online retail scenario, using the `userID` or `productId` value as the partition key is a good choice because it will be unique and likely used to lookup records.</span></span> <span data-ttu-id="2689f-115">`userID`是一个很好的选择, 因为您的应用程序经常需要检索用户的个性化设置、购物车、订单历史记录和配置文件信息, 只需将其命名。</span><span class="sxs-lookup"><span data-stu-id="2689f-115">`userID` is a good choice, as your application frequently needs to retrieve the personalization settings, shopping cart, order history, and profile information for the user, just to name a few.</span></span> <span data-ttu-id="2689f-116">`productId`也是一个很好的选择, 因为您的应用程序需要查询库存水平、运输成本、颜色选项、仓库位置等。</span><span class="sxs-lookup"><span data-stu-id="2689f-116">`productId` is also a good choice, as your application needs to query inventory levels, shipping costs, color options, warehouse locations, and more.</span></span>

<span data-ttu-id="2689f-117">分区键应旨在在数据库中分配操作。</span><span class="sxs-lookup"><span data-stu-id="2689f-117">A partition key should aim to distribute operations across the database.</span></span> <span data-ttu-id="2689f-118">您希望分发请求以避免热点分区。</span><span class="sxs-lookup"><span data-stu-id="2689f-118">You want to distribute requests to avoid hot partitions.</span></span> <span data-ttu-id="2689f-119">热分区是接收比其他请求多个请求的单个分区, 这会产生吞吐量瓶颈。</span><span class="sxs-lookup"><span data-stu-id="2689f-119">A hot partition is a single partition that receives many more requests than the others, which can create a throughput bottleneck.</span></span> <span data-ttu-id="2689f-120">例如, 对于您的电子商务应用程序, 当前时间可能是分区键的选择较差, 因为所有传入数据都将转到单个分区键。</span><span class="sxs-lookup"><span data-stu-id="2689f-120">For example, for your e-commerce application, the current time would be a poor choice of partition key, because all the incoming data would go to a single partition key.</span></span> <span data-ttu-id="2689f-121">`userID`或者`productId`更好的是, 因为您的网站上的所有用户可能会在大约相同的频率添加和更新购物车或档案文件信息, 这将跨所有用户和产品分区分布读取和写入。</span><span class="sxs-lookup"><span data-stu-id="2689f-121">`userID` or `productId` would be better, as all the users on your site would likely be adding and updating their shopping cart or profile information at about the same frequency, which distributes the reads and writes across all the user and product partitions.</span></span>

<span data-ttu-id="2689f-122">与每个分区键关联的数据的存储空间不能超过 10 GB, 这是 Azure Cosmos DB 中一个物理分区的大小。</span><span class="sxs-lookup"><span data-stu-id="2689f-122">The storage space for the data associated with each partition key cannot exceed 10 GB, which is the size of one physical partition in Azure Cosmos DB.</span></span> <span data-ttu-id="2689f-123">因此, 如果您的`userID`单个`productId`或记录大于 10 GB, 请考虑使用复合键, 以便每个记录较小。</span><span class="sxs-lookup"><span data-stu-id="2689f-123">So, if your single `userID` or `productId` record is going to be larger than 10 GB, think about using a composite key instead so that each record is smaller.</span></span> <span data-ttu-id="2689f-124">复合键的示例如下所示`userID-date`, 如**CustomerName-08072018**。</span><span class="sxs-lookup"><span data-stu-id="2689f-124">An example of a composite key would be `userID-date`, which would look like **CustomerName-08072018**.</span></span> <span data-ttu-id="2689f-125">此组合键方法使您能够为用户访问站点的每一天创建一个新分区。</span><span class="sxs-lookup"><span data-stu-id="2689f-125">This composite key approach would enable you to create a new partition for each day a user visited the site.</span></span>

## <a name="best-practices"></a><span data-ttu-id="2689f-126">最佳实践</span><span class="sxs-lookup"><span data-stu-id="2689f-126">Best practices</span></span>

<span data-ttu-id="2689f-127">当您尝试确定正确的分区键和解决方案不明显时, 请注意以下几点提示。</span><span class="sxs-lookup"><span data-stu-id="2689f-127">When you're trying to determine the right partition key and the solution isn't obvious, here are a few tips to keep in mind.</span></span>

- <span data-ttu-id="2689f-128">不要担心选择包含大量值的分区键。</span><span class="sxs-lookup"><span data-stu-id="2689f-128">Don’t be afraid of choosing a partition key that has a large number of values.</span></span> <span data-ttu-id="2689f-129">您的分区键的值越多, 您拥有的可伸缩性越多。</span><span class="sxs-lookup"><span data-stu-id="2689f-129">The more values your partition key has, the more scalability you have.</span></span>
- <span data-ttu-id="2689f-130">若要确定可读繁重的工作负荷的最佳分区键, 请查看您计划使用的前三个和五个查询。</span><span class="sxs-lookup"><span data-stu-id="2689f-130">To determine the best partition key for a read-heavy workload, review the top three to five queries you plan on using.</span></span> <span data-ttu-id="2689f-131">WHERE 子句中最常包含的值是分区键的理想候选值。</span><span class="sxs-lookup"><span data-stu-id="2689f-131">The value most frequently included in the WHERE clause is a good candidate for the partition key.</span></span>
- <span data-ttu-id="2689f-132">对于编写繁重的工作负载, 您需要了解工作负荷的事务性需求, 因为分区键是多文档事务的范围。</span><span class="sxs-lookup"><span data-stu-id="2689f-132">For write-heavy workloads, you'll need to understand the transactional needs of your workload, because the partition key is the scope of multi-document transactions.</span></span>
