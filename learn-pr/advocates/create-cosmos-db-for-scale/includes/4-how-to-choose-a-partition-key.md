您为计划快速扩展到新的地理区域而使用的在线零售商。 此移动将增加客户群和交易量。 您必须确保您的数据库在需要时能够处理展开。

拥有分区策略可确保在数据库需要增长时, 可以轻松地执行此操作, 并继续执行高效的查询和事务。

## <a name="what-is-a-partition-strategy"></a>什么是分区策略？

如果继续将新数据添加到单个服务器或单个分区中, 它最终会耗尽空间。 为此, 您需要一个分区策略以向**外扩展**而不是向上扩展。 向外扩展也称为水平缩放, 它使您可以在应用程序需要时向数据库添加更多分区。

Azure Cosmos DB 中的分区和扩展策略由分区键驱动, 后者是创建集合时设置的值。 分区键设置后, 不能在不重新创建集合的情况下进行更改, 因此选择正确的分区键是在开发过程的早期阶段的重要决定。  

在此单元中, 您将了解如何选择适合您的方案的分区键, 并将利用 Azure Cosmos DB 可以为您做的自动缩放。

## <a name="what-is-a-partition-key"></a>什么是分区键？

分区键是 Azure 将数据组织为逻辑划分的值。 在我们的联机零售方案中, `userID`使用`productId`或值作为分区键是一个很好的选择, 因为它将是唯一的, 并且很可能用于查找记录。 `userID`是一个很好的选择, 因为您的应用程序经常需要检索用户的个性化设置、购物车、订单历史记录和配置文件信息, 只需将其命名。 `productId`也是一个很好的选择, 因为您的应用程序需要查询库存水平、运输成本、颜色选项、仓库位置等。

分区键应旨在在数据库中分配操作。 您希望分发请求以避免热点分区。 热分区是接收比其他请求多个请求的单个分区, 这会产生吞吐量瓶颈。 例如, 对于您的电子商务应用程序, 当前时间可能是分区键的选择较差, 因为所有传入数据都将转到单个分区键。 `userID`或者`productId`更好的是, 因为您的网站上的所有用户可能会在大约相同的频率添加和更新购物车或档案文件信息, 这将跨所有用户和产品分区分布读取和写入。

与每个分区键关联的数据的存储空间不能超过 10 GB, 这是 Azure Cosmos DB 中一个物理分区的大小。 因此, 如果您的`userID`单个`productId`或记录大于 10 GB, 请考虑使用复合键, 以便每个记录较小。 复合键的示例如下所示`userID-date`, 如**CustomerName-08072018**。 此组合键方法使您能够为用户访问站点的每一天创建一个新分区。

## <a name="best-practices"></a>最佳实践

当您尝试确定正确的分区键和解决方案不明显时, 请注意以下几点提示。

- 不要担心选择包含大量值的分区键。 您的分区键的值越多, 您拥有的可伸缩性越多。
- 若要确定可读繁重的工作负荷的最佳分区键, 请查看您计划使用的前三个和五个查询。 WHERE 子句中最常包含的值是分区键的理想候选值。
- 对于编写繁重的工作负载, 您需要了解工作负荷的事务性需求, 因为分区键是多文档事务的范围。
