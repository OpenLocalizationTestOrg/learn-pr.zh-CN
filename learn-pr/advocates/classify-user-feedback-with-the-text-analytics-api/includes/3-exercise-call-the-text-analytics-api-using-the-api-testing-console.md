若要查看正在运行的文本分析 API, 我们可以使用位于联机参考文档中的内置 API 测试控制台工具进行一些调用。 在执行此操作之前, 我们需要使用访问密钥才能进行这些呼叫。

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="create-an-access-key"></a>创建访问键

每次调用 Text Analytics API 都需要订阅密钥。 通常称为访问密钥, 用于验证您是否具有进行呼叫的访问权限。 我们将使用 Azure 门户来获取密钥。

1. 使用与激活沙盒时相同的帐户登录[Azure 门户](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)。

1. 单击 "**创建资源**"。

1. 在 "**搜索市场"** 搜索框中, 键入*文本分析*和命中返回。

1. 在搜索结果中选择 "**文本分析**", 然后选择屏幕右下角的 "**创建**" 按钮。

1. 在打开的 "**创建**" 页中, 在每个字段中输入以下值。

    |属性  | 值  | 说明  |
    |---------|---------|---------|
    |名称     |    MyTextAnalyticsAPIAccount     |  认知服务帐户的名称。 建议使用描述性名称。 有效的字符`a-z`为`0-9`、和`-`。    |
    |订购     |  Concierge 订阅    |   在其下创建此新的认知服务 API 帐户和**文本分析 API**所使用的订阅。      |
    |位置     |  *从下拉列表中选择区域*       |  由于你使用的是免费沙盒, 请从下拉列表中选择一个位置, 该位置**也**在下面所示的沙盒区域列表中。  |
    |定价层     | **F0 免费**     |   您的认知服务帐户的成本取决于实际使用情况和您选择的选项。 我们建议在此处选择免费的层。      |
    |资源组     |  选择 "**使用现有**" 并选择 " <rgn>[沙盒资源组名称]</rgn> "       |  要在其中创建您的认知服务文本分析 API 帐户的新资源组的名称。       |

    ### <a name="sandbox-region-list"></a>沙盒区域列表
    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

    > [!TIP]
    > 在创建文本分析认知服务帐户时, 请记住您选择的位置。 你将使用它来很快进行 API 调用。 

1. 在页面底部选择 "**创建**" 以启动帐户创建过程。 监视部署正在进行的通知。 然后, 你将收到一条通知, 表明已成功将该帐户部署到你的资源组。

    ![部署已成功通知, 其中包含 "转到资源" 按钮和 "固定到仪表板" 按钮。](../media/deploy-resource-group-success.PNG)

## <a name="get-the-access-key"></a>获取访问键

现在我们有了认知服务帐户, 我们来查找访问键, 以便我们可以开始调用 API。

1. 单击 "*部署成功*通知" 上的 "**转到资源**" 按钮。 此操作将打开帐户快速入门。

1. 从左侧的菜单中或在快速入门的 "*获取密钥*" 部分中选择 "**键**" 菜单项。 此操作将打开 "**管理密钥**" 页。

1. 使用 "复制" 按钮复制其中一个键。

    !["管理密钥" 用户界面, 显示认知服务帐户和 key 1 和 key 2 条目的名称。](../media/manage-keys.PNG)

    > [!IMPORTANT]
    > 始终保持访问密钥为安全, 永远不会共享它们。

1. 将此键存储在本模块的其余部分。 我们很快就会使用它从测试控制台和模块中的其余部分进行 API 调用。

## <a name="call-the-api-from-the-testing-console"></a>从测试控制台调用 API

现在我们拥有我们的关键, 我们可以转到测试控制台并采用 API 进行旋转。

1. 导航到您喜爱的浏览器中的以下 URL。 在`[location]`此单元前面创建文本分析认知服务帐户时, 将替换为您选择的位置。 例如, 如果您在*eastus*中创建了帐户, 您需要将`[location]`替换`eastus`为 URL 中的。

    ```bash
    https://[location].dev.cognitive.microsoft.com/docs/services/TextAnalytics.V2.0
    ```

    登陆页面在左侧显示一个菜单, 并在右侧显示内容。 该菜单列出了可以在文本分析 API 上调用的 POST 方法。 这些终结点将**检测语言**、**实体**、**关键短语**和**看法**。 若要调用这些操作之一, 我们需要执行几项操作。

    - 选择我们要调用的方法。
    - 将我们之前在本课中保存的访问键添加到每个调用中。

1. 从左侧菜单中, 选择 "**看法**"。 此选择将向右打开看法文档。 如文档所示, 我们将使用以下格式进行 REST 调用。  

    `https://[location].api.cognitive.microsoft.com/text/analytics/v2.0/sentiment`

     `[location]`将替换为您在创建文本分析帐户时选择的位置。  
我们将在**Apim-订阅密钥**标头中传入订阅密钥或访问密钥。

## <a name="make-some-api-calls"></a>进行一些 API 调用

1. 选择 "**打开 API 测试控制台**" 按钮以打开 live、交互的 api 控制台。

1. 将之前保存的访问密钥粘贴到标记为**Apim-key**的字段中。 请注意, 密钥将自动写入 HTTP 请求窗口作为标头值。

1. 滚动到页面底部, 然后单击 "**发送**"。

    让我们更详细地查看此屏幕的各个部分。

    在用户界面的 "标头" 部分中, 我们设置请求的标头中的 "访问" 或 "订阅" 项。

    ![标头部分的屏幕截图。](../media/2-marker.PNG)

    接下来, 我们提供了 "请求正文" 部分, 其中包含一个**文档**数组。 数组中的每个文档都有三个属性。 属性为 *"language"*、 *"id"* 和 *"text"*。 此示例中的 *"id"* 是一个数字, 但它可以是您想要的任何内容, 只要它在 documents 数组中是唯一的。 在此示例中, 我们还传递用三种不同语言编写的文档。 文本分析 API 的看法功能支持超过15种语言。 有关详细信息, 请参阅[Text Analytics API 中支持的语言](https://docs.microsoft.com//azure/cognitive-services/text-analytics/text-analytics-supported-languages)。 单个文档的最大大小为5000个字符, 一个请求最多可以包含1000个文档。

    !["请求正文" 部分的屏幕截图](../media/3-marker.PNG)

    包含标头和请求 URL 的完整请求将显示在下一节中。 在此示例中, 您可以看到请求被路由到以开头的 URL `westus`。 根据您在创建文本分析帐户时选择的位置, URL 会有所不同。

    ![显示请求 URL 的第四节的屏幕截图。](../media/4-marker.PNG)
    ![第五部分的屏幕截图, 显示了详细的 HTTP 请求。](../media/5-marker.PNG)

    然后, 我们提供有关响应的信息。 在此示例中, 我们发现请求成功, 并返回了代码`200` 。 此外, 我们还可以看到往返行程采用了38毫秒。

    ![第五部分显示响应状态的屏幕截图](../media/6-marker.PNG)

    最后, 我们会看到请求的响应。 该响应包含文本分析 API 对我们的文档的洞察力。 在不使用原始文本的情况下, 将文档的数组返回给我们。 我们获取每个文档的 *"id"* 和 *"得分"* 。 API 返回介于0和1之间的数值得分。 分数近1表示正看法, 而分数接近0表示负看法。 分数为0.5 表示缺少看法, 非特定语句。 在此示例中, 我们有两个非常积极的文档和一个负文档。

    ![显示响应内容的第五部分的屏幕截图。](../media/7-marker.PNG)

!! 您已对文本分析 API 进行了第一次调用, 而无需编写代码行。 你可以随意保留在控制台中并尝试更多呼叫。 以下是一些建议:

- 更改第2部分中的文档, 并查看 API 返回的内容。
- 使用相同的订阅密钥尝试其他方法,**检测语言**、**实体**和**密钥短语**。
- 尝试使用与订阅的其他区域进行呼叫, 并观察发生的情况。

api 测试控制台是探索此 API 的功能的一种很好的方法。 现在, 你已对你进行了探索, 我们将继续将此智能放到现实世界的方案中。