通常, 服务公司的成功将直接与公司与其客户签订的服务级别协议 (SLA) 相关。 您的客户预期您提供的服务始终可用, 并且其数据保持安全。 Microsoft 会认真对待这一点。 Azure 提供了可用于管理可用性、数据安全性和监控的工具, 因此您知道您的服务始终可供客户使用。

管理 Azure VM 并不局限于管理在 VM 上运行的操作系统或软件。 它有助于了解 Azure 提供的服务, 以确保服务可用性并支持自动化。 这些服务可帮助您规划您的组织的业务连续性和灾难恢复策略。

在这里, 我们将介绍 Azure 服务, 可帮助你改进 vm 可用性、简化 vm 管理任务, 并保持 vm 数据的备份和安全。 让我们先定义可用性。

## <a name="what-is-availability"></a>什么是可用性？

可用性是服务可使用的时间百分比。

假设你有一个网站, 你希望你的客户始终能够访问信息。 您的预期是关于网站访问的 100% 可用性。

### <a name="why-do-i-need-to-think-about-availability-when-using-azure"></a>为什么需要在使用 Azure 时考虑可用性？

azure 虚拟机在 azure 数据中心内托管的物理服务器上运行。 与大多数物理设备一样, 有可能出现故障的可能性。 如果物理服务器发生故障, 则该服务器上托管的虚拟机也将失败。 如果发生这种情况, Azure 会自动将 VM 移动到运行状况良好的主机服务器。 但是, 此自我修复迁移可能需要几分钟时间, 在此期间, 在该虚拟机上托管的应用程序将不可用。

虚拟机也可能会受到 Azure 本身启动的定期更新的影响。 这些维护事件的范围包括软件更新到硬件升级以及改进平台的可靠性和性能所必需的。 通常在不影响任何来宾 vm 的情况下执行这些事件, 但有时虚拟机将重新启动以完成更新或升级。

> [!NOTE]
> Microsoft 不会自动更新你的 VM 的操作系统或软件。 您拥有此的完全控制和责任。 但是, 将定期对基础软件主机和硬件进行修补, 以确保始终能够确保可靠性和高性能。

为了确保服务不会中断并避免出现单一故障点, 建议至少部署每个 VM 的两个实例。 此功能称为_可用性集_。

### <a name="what-is-an-availability-set"></a>可用性集是什么？

**可用性集**是一项逻辑功能, 用于确保一组相关虚拟机已部署, 以便它们不会受到单一故障点的攻击, 也不会在数据中心的主机操作系统升级过程中同时升级。 位于可用性集的 vm 应执行一组相同的功能, 并安装相同的软件。

> [!TIP]
> Microsoft 为可用性集中部署的多实例虚拟机提供了 99.95% 的外部连接服务级别协议 (SLA)。 这意味着, 要应用 SLA, 必须至少在可用性集中部署 VM 的两个实例。 

您可以通过 "灾难恢复" 部分中的 Azure 门户创建可用性集。 此外, 还可以使用资源管理器模板或任何脚本或 API 工具生成它们。 将 vm 放入可用性集时, Azure 可确保跨**故障域**传播它们并**更新域**。

#### <a name="what-is-a-fault-domain"></a>什么是故障域？

故障域是 Azure 中共享公共电源和网络交换机的硬件的逻辑组。 你可以将其视为本地数据中心中的机架。 可用性集中的前两个 vm 将预配到两个不同的机架中, 以便在机架中网络或电源出现故障时, 仅会影响一个 VM。 故障域也是为连接到虚拟机的托管磁盘定义的。

![显示两个具有两台虚拟机的容错域的图示。 每个故障域主机 Internet 信息服务中的两个顶级虚拟机, 并且是通用可用性集的一部分。 每个域承载 SQL 数据库中的下两台虚拟机, 并且是另一个可用性集的一部分。](../media/5-fault-domains.png)

#### <a name="what-is-an-update-domain"></a>什么是更新域？

update 域是一组可进行维护或同时重新启动的硬件逻辑组。 azure 将自动将可用性集置于更新域中, 以最大限度地减少 Azure 平台引入主机操作系统更改时的影响。 然后, Azure 每次处理一个更新域。

可用性集是一项强大的功能, 可确保你的虚拟机中运行的服务始终对你的客户可用。 但是, 它们并不是万无一失的。 如果数据或 VM 本身上运行的软件出现了什么情况, 该怎么办？ 为此, 我们需要查看其他灾难恢复和备份技术。

## <a name="failover-across-locations"></a>跨位置的故障转移

您还可以跨网站复制基础结构以处理区域故障转移。 **Azure Site Recovery**将工作负荷从主网站复制到辅助位置。 如果主站点发生中断, 则可以故障转移到辅助位置。 此故障转移使用户能够继续访问你的应用程序, 而不会中断。 然后, 您可以在主位置启动并再次运行时对其进行故障回复。 Azure Site Recovery 是关于虚拟机或物理机的复制;它使您的工作负荷在中断期间可用。

在网站恢复中有很多引人注目的技术功能的同时, 至少有两个显著的业务优势:

1. 通过网站恢复, 可以将 Azure 用作恢复目标, 从而消除维护辅助物理数据中心的成本和复杂性。

2. Site Recovery 使测试故障转移以实现恢复训练非常简单, 而不会影响生产环境。 这样可以轻松测试计划或未计划的故障转移。 毕竟, 如果您从未尝试进行故障转移, 则没有好的灾难恢复计划。

使用网站恢复创建的恢复计划可以像您的方案需要那样简单, 也可以复杂。 它们可以包括自定义 PowerShell 脚本、Azure 自动化 runbook 或手动干预步骤。 您可以利用恢复计划将工作负载复制到 Azure, 轻松实现迁移的新机会、在浪涌期间临时突发, 或者新应用程序的开发和测试。

azure Site Recovery 适用于内部部署基础结构中的 azure 资源、hyper-v、VMware 和物理服务器, 并且可以是组织的业务连续性和灾难恢复 (BCDR) 策略的关键部分, 具体方法是协调复制、工作负载和应用程序的故障转移和恢复 (如果主位置出现故障)。
