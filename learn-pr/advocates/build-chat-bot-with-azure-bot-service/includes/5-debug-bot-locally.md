[!INCLUDE [0-vm-note](0-vm-note.md)]

<span data-ttu-id="efe1f-101">与您编写的任何应用程序代码一样, 在部署到生产环境之前, 需要在本地测试和调试对 bot 代码所做的更改。</span><span class="sxs-lookup"><span data-stu-id="efe1f-101">As with any application code that you write, changes to bot code need to be tested and debugged locally before being deployed to production.</span></span> <span data-ttu-id="efe1f-102">为了帮助调试 bot, Microsoft 提供了 bot 框架模拟器。</span><span class="sxs-lookup"><span data-stu-id="efe1f-102">To help debug bots, Microsoft offers the Bot Framework Emulator.</span></span> <span data-ttu-id="efe1f-103">在此单元中, 你将了解如何使用 Visual Studio Code 和模拟器调试你的 bot。</span><span class="sxs-lookup"><span data-stu-id="efe1f-103">In this unit, you will learn how to use Visual Studio Code and the emulator to debug your bots.</span></span>

1. <span data-ttu-id="efe1f-104">在 Visual Studio Code 的集成终端中执行以下命令, 以安装[Restify](http://restify.com/), 用于构建和使用 RESTful web 服务的受欢迎的 node.js 包:</span><span class="sxs-lookup"><span data-stu-id="efe1f-104">Execute the following command in Visual Studio Code's integrated terminal to install [Restify](http://restify.com/), a popular Node.js package for building and consuming RESTful web services:</span></span>

    ```bash
    npm install restify
    ```

1. <span data-ttu-id="efe1f-105">对以下命令重复此步骤, 以安装[适用于 node.js 的 Microsoft Bot 框架自动程序生成器 SDK](https://docs.microsoft.com/bot-framework/nodejs/bot-builder-nodejs-quickstart):</span><span class="sxs-lookup"><span data-stu-id="efe1f-105">Repeat this step for the following commands to install the [Microsoft Bot Framework Bot Builder SDK for Node.js](https://docs.microsoft.com/bot-framework/nodejs/bot-builder-nodejs-quickstart):</span></span>

    ```bash
    npm install botbuilder
    npm install botbuilder-azure
    npm install botbuilder-cognitiveservices
    ```

1. <span data-ttu-id="efe1f-106">在 Visual Studio Code 的活动栏中选择 "**浏览器**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="efe1f-106">Select the **Explorer** button in Visual Studio Code's activity bar.</span></span> 
1. <span data-ttu-id="efe1f-107">选择**app.config**以在代码编辑器中打开它。</span><span class="sxs-lookup"><span data-stu-id="efe1f-107">Select **app.js** to open it in the code editor.</span></span> <span data-ttu-id="efe1f-108">此文件包含驱动机器人的代码 (由 Azure bot 服务生成的代码和从 azure 门户下载的代码)。</span><span class="sxs-lookup"><span data-stu-id="efe1f-108">This file contains the code that drives the bot — code that was generated by the Azure Bot Service and downloaded from the Azure portal.</span></span>

1. <span data-ttu-id="efe1f-109">将**app.config**的内容替换为以下代码, 然后保存文件。</span><span class="sxs-lookup"><span data-stu-id="efe1f-109">Replace the contents of **app.js** with the following code, then save the file.</span></span>

    ```JavaScript
    "use strict";
    var builder = require("botbuilder");
    var botbuilder_azure = require("botbuilder-azure");

    var useEmulator = true;
    var userName = "";
    var yearsCoding = "";
    var selectedLanguage = "";

    var connector = useEmulator ? new builder.ChatConnector() : new botbuilder_azure.BotServiceConnector({
        appId: process.env.MicrosoftAppId,
        appPassword: process.env.MicrosoftAppPassword
    });

    var bot = new builder.UniversalBot(connector);

    bot.dialog('/', [

    function (session) {
        builder.Prompts.text(session, "Hello, and welcome to QnA Factbot! What's your name?");
    },

    function (session, results) {
        userName = results.response;
        builder.Prompts.number(session, "Hi " + userName + ", how many years have you been writing code?");
    },

    function (session, results) {
        yearsCoding = results.response;
        builder.Prompts.choice(session, "What language do you love the most?", ["C#", "Python", "Node.js", "Visual FoxPro"]);
    },

    function (session, results) {
        selectedLanguage = results.response.entity;

        session.send("Okay, " + userName + ", I think I've got it:" +
            " You've been writing code for " + yearsCoding + " years," +
            " and prefer to use " + selectedLanguage + ".");
    }]);

    var restify = require('restify');
    var server = restify.createServer();

    server.listen(3978, function() {
        console.log('test bot endpoint at http://localhost:3978/api/messages');
    });

    server.post('/api/messages', connector.listen());
    ```

1. <span data-ttu-id="efe1f-110">通过在左侧的边距中进行选择, 在行`builder.Prompts...` 20、25和 30 (调用) 上设置断点。</span><span class="sxs-lookup"><span data-stu-id="efe1f-110">Set breakpoints on lines 20, 25, and 30 (`builder.Prompts...` calls) by selecting in the margin on the left.</span></span>

1. <span data-ttu-id="efe1f-111">在活动栏中选择 "**调试**" 按钮, 然后选择绿色的 "**启动调试**" 按钮以启动调试会话。</span><span class="sxs-lookup"><span data-stu-id="efe1f-111">Select the **Debug** button in the activity bar, then select the green arrow **Start Debugging** button to start a debugging session.</span></span> <span data-ttu-id="efe1f-112">确认 "测试机器人终结点http://localhost:3978/api/messages" 出现在调试控制台中。</span><span class="sxs-lookup"><span data-stu-id="efe1f-112">Confirm that "test bot endpoint at http://localhost:3978/api/messages" appears in the debug console.</span></span>

    ![显示具有调试导航项的调试系统的 Visual Studio 代码的屏幕截图和用于启动突出显示的调试会话的调试播放按钮。](../media/5-vs-launch-debugger.png)

    <span data-ttu-id="efe1f-114">你的 bot 代码现在正在本地运行。</span><span class="sxs-lookup"><span data-stu-id="efe1f-114">Your bot code is now running locally.</span></span>

1. <span data-ttu-id="efe1f-115">从 "开始" 菜单启动**Bot 框架模拟器**。</span><span class="sxs-lookup"><span data-stu-id="efe1f-115">Launch the **Bot Framework Emulator** from the Start Menu.</span></span>

1. <span data-ttu-id="efe1f-116">选择 "**输入您的终结点 URL** " 字段。</span><span class="sxs-lookup"><span data-stu-id="efe1f-116">Select the **Enter your endpoint URL** field.</span></span> <span data-ttu-id="efe1f-117">输入在上一步的调试控制台中显示的 bot 名称和 bot URL。</span><span class="sxs-lookup"><span data-stu-id="efe1f-117">Enter the bot name and the bot URL displayed in the debug console in the previous step.</span></span>

1. <span data-ttu-id="efe1f-118">将 microsoft app ID、microsoft app 密码和区域设置字段保留为空, 然后选择 "**连接**"。</span><span class="sxs-lookup"><span data-stu-id="efe1f-118">Leave the Microsoft App ID, Microsoft App Password, and Locale fields empty and select **CONNECT**.</span></span>

1. <span data-ttu-id="efe1f-119">然后, 选择 "**保存并连接**", 并将配置文件保存在您选择的位置。</span><span class="sxs-lookup"><span data-stu-id="efe1f-119">Then, select **Save and connect** and save the configuration file in the location of your choice.</span></span>

    >[!NOTE]
    > <span data-ttu-id="efe1f-120">以后, 您只需选择 "我的 bot" 下的 bot 名称即可重新连接到 bot。</span><span class="sxs-lookup"><span data-stu-id="efe1f-120">In the future, you can reconnect to the bot simply by selecting the bot name under "My Bots".</span></span>

    ![Bot 框架仿真程序的屏幕截图, 显示新的 bot 配置屏幕, 其中突出显示了 "保存并连接" 按钮。](../media/5-new-bot-configuration.png)

1. <span data-ttu-id="efe1f-122">在仿真程序底部的框中键入 "hi", 然后按**enter**。</span><span class="sxs-lookup"><span data-stu-id="efe1f-122">Type "hi" into the box at the bottom of the emulator and press **Enter**.</span></span> <span data-ttu-id="efe1f-123">确认 Visual Studio Code 在**应用 .js**的第20行中断。</span><span class="sxs-lookup"><span data-stu-id="efe1f-123">Confirm that Visual Studio Code breaks on line 20 of **app.js**.</span></span> <span data-ttu-id="efe1f-124">然后, 在 Visual Studio Code 的调试工具栏中选择 "**继续**" 按钮, 然后返回到仿真程序以查看 bot 的响应。</span><span class="sxs-lookup"><span data-stu-id="efe1f-124">Then, select the **Continue** button in Visual Studio Code's debugging toolbar, and return to the emulator to see the bot's response.</span></span>

1. <span data-ttu-id="efe1f-125">bot 将向你询问一系列问题。</span><span class="sxs-lookup"><span data-stu-id="efe1f-125">The bot will ask you a series of questions.</span></span> <span data-ttu-id="efe1f-126">回答这些问题, 并在每次命中断点时选择 "在 Visual Studio Code 中**继续**"。</span><span class="sxs-lookup"><span data-stu-id="efe1f-126">Answer them and select **Continue** in Visual Studio Code each time a breakpoint is hit.</span></span> <span data-ttu-id="efe1f-127">完成后, 选择 "调试" 工具栏中的 "**停止**" 按钮以结束调试会话。</span><span class="sxs-lookup"><span data-stu-id="efe1f-127">When you're done, select the **Stop** button in the debugging toolbar to end the debugging session.</span></span>

<span data-ttu-id="efe1f-128">在这种情况下, 你有一个功能完全正常的 bot, 并了解如何通过在 Microsoft bot 框架仿真器中本地运行它来调试它。</span><span class="sxs-lookup"><span data-stu-id="efe1f-128">At this point, you have a fully functioning bot and know how to debug it by running it locally in the Microsoft Bot Framework Emulator.</span></span> <span data-ttu-id="efe1f-129">下一步是将 bot 连接到您发布的知识库, 使其更加智能化。</span><span class="sxs-lookup"><span data-stu-id="efe1f-129">The next step is to make the bot more intelligent by connecting it to the knowledge base you published.</span></span>