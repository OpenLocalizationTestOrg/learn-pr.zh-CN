Lamna 保健最近遇到了一个面向客户的 web 应用程序的重大中断。 授予工程师对包含生产 web 应用程序的资源组的完全访问权限。 此人意外删除了资源组和所有子资源, 包括承载实时客户数据的数据库。 

幸运的是, 应用程序源代码和资源在源代码管理中可用, 而常规数据库备份按计划自动运行。 因此, 该服务的恢复相对较容易。 在这里, 我们将探讨如何通过使用 Azure 上的功能来保护对基础结构的访问, 从而避免此中断。

## <a name="criticality-of-infrastructure"></a>基础结构的关键程度

云基础结构正在成为许多企业的关键部分。 确保人员和过程仅拥有完成其工作所需的权限, 这一点非常重要。 分配不正确的访问可能会导致数据丢失、数据泄露或导致服务变得不可用。 

系统管理员可负责大量用户、系统和权限集。 因此, 正确授予访问权限可能很快就会变得无法管理, 并且可能会导致 "一种大小适应所有" 方法。 这种方法可以降低管理的复杂性, 但会使更易于无意中授予比所需更多的权限。

## <a name="role-based-access-control"></a>基于角色的访问控制

基于角色的访问控制 (RBAC) 提供了一种略有不同的方法。 角色定义为访问权限的集合。 安全主体直接或通过组成员身份映射到角色。 将安全主体、访问权限和资源分开可提供简化的访问管理和更精细的控制。

在 azure 中, 用户、组和角色都存储在 azure Active Directory (azure AD) 中。 azure 资源管理器 API 使用基于角色的访问控制来保护 Azure 中的所有资源访问管理。

![显示基于角色的访问控制实现的插图。](../media/ACL_Based_Access.png)

<!-- ![Role-based access control](../media/Role_Based_Access.png)
 -->

### <a name="roles-and-management-groups"></a>角色和管理组

角色是权限集, 如 "只读" 或 "投稿人", 可授予用户访问 Azure 服务实例的权限。 可以在单独的服务实例级别授予角色, 但这些角色也会向下传递 Azure 资源管理器层次结构。 在更高作用域 (如整个订阅) 中分配的角色由子作用域继承, 如服务实例。 

管理组是最近引入到 RBAC 模型中的其他层次结构级别。 管理组添加了将订阅分组在一起, 并在更高级别应用策略的功能。

通过任意定义的订阅层次结构传递角色的功能还允许管理员为经过身份验证的用户授予对整个环境的临时访问权限。 例如, 审核员可能需要对所有订阅的临时只读访问权限。

![显示管理组中基于角色的访问的分层表示形式的插图。](../media/management_groups.png)

### <a name="privileged-identity-management"></a>特权身份管理

除了使用 RBAC 管理 Azure 资源访问之外, 基础结构保护的综合方法应考虑在组织发生变化和演变时包括角色成员的持续审核。 Azure ad 特权标识管理 (PIM) 是一个额外付费的产品, 可提供角色分配、自助服务和实时角色激活和 azure AD & azure 资源访问审核的监督。

![特权标识管理仪表板的屏幕截图](../media/PIM_Dashboard.png)

## <a name="providing-identities-to-services"></a>向服务提供标识

服务具有标识通常很有价值。 通常情况下, 凭据信息嵌入在配置文件中, 而不是最佳实践。 除了这些配置文件的安全性之外, 任何对系统或存储库的访问权限的用户都可以访问这些凭据和风险暴露。

azure AD 通过两种方法来解决此问题: azure 服务的服务主体和托管标识。

### <a name="service-principals"></a>服务主体

若要了解服务主体, 在身份管理领域中, 首先了解词的**标识**和**主体**是非常有用的。

**标识**只是可以进行身份验证的内容。 显然, 这包括用户的用户名和密码, 但也可以包括应用程序或其他服务器, 这些服务器可能会使用密钥或证书进行身份验证。 作为奖金定义,**帐户**是与标识关联的数据。

**主体**是使用特定角色或声明的标识。 请考虑在 bash 提示符处或使用 "以管理员身份运行" 的窗口上使用 "sudo"。 在这两种情况下, 您仍以与之前相同的身份登录, 但您已更改要执行的角色。

因此,**服务主体**是按字面名命名的。 它是服务或应用程序使用的标识。 与其他标识一样, 可以为其分配角色。

例如, Lamna 医疗保健可将其部署脚本分配为以服务主体身份进行身份验证。 如果这是唯一具有执行破坏性操作的权限的身份, 则 Lamna 将已有很长的时间来确保它们没有重复的意外资源删除。

### <a name="managed-identities-for-azure-resources"></a>Azure 资源的托管标识

服务主体的创建可能是一个单调乏味的过程, 并且有许多触控点可以使它们保持困难。 管理 Azure 资源的标识更容易, 并将为你执行大部分工作。

可以为任何支持它的 Azure 服务即时创建托管标识 (该列表持续增长)。 为服务创建托管标识时, 将在 Azure AD 租户上创建帐户。 Azure 基础结构将自动负责对服务进行身份验证并管理帐户。 然后, 您可以像使用任何其他 AD 帐户一样使用该帐户, 包括安全地允许经过身份验证的服务访问其他 Azure 资源。

Lamna 保健将其身份管理更进一步, 并对需要执行基础结构管理和部署的所有受支持的服务使用托管身份。

## <a name="infrastructure-protection-at-lamna-healthcare"></a>Lamna 医疗保健方面的基础结构保护

我们已了解 Lamna 医疗保健如何解决意外删除基础结构的事件中的问题。 他们使用基于角色的访问控制来更好地管理其基础结构的安全性, 并使用托管标识将其凭据保留在代码之外, 并简化其服务所需的身份管理。

## <a name="summary"></a>摘要

为了确保基础结构的可用性和完整性, 一定要正确保护基础结构。 正确使用 RBAC 和托管标识等功能将有助于保护您的 Azure 环境免遭未经授权或无意的访问, 并将增强体系结构中的标识安全功能。