<span data-ttu-id="c269b-101">Lamna 保健最近遇到了一个面向客户的 web 应用程序的重大中断。</span><span class="sxs-lookup"><span data-stu-id="c269b-101">Lamna Healthcare recently experienced a significant outage to a customer-facing web application.</span></span> <span data-ttu-id="c269b-102">授予工程师对包含生产 web 应用程序的资源组的完全访问权限。</span><span class="sxs-lookup"><span data-stu-id="c269b-102">An engineer was granted full access to a resource group containing the production web application.</span></span> <span data-ttu-id="c269b-103">此人意外删除了资源组和所有子资源, 包括承载实时客户数据的数据库。</span><span class="sxs-lookup"><span data-stu-id="c269b-103">This person accidentally deleted the resource group and all child resources, including the database hosting live customer data.</span></span> 

<span data-ttu-id="c269b-104">幸运的是, 应用程序源代码和资源在源代码管理中可用, 而常规数据库备份按计划自动运行。</span><span class="sxs-lookup"><span data-stu-id="c269b-104">Fortunately, the application source code and resources were available in source control and regular database backups were running automatically on a schedule.</span></span> <span data-ttu-id="c269b-105">因此, 该服务的恢复相对较容易。</span><span class="sxs-lookup"><span data-stu-id="c269b-105">Therefore, the service was reinstated relatively easily.</span></span> <span data-ttu-id="c269b-106">在这里, 我们将探讨如何通过使用 Azure 上的功能来保护对基础结构的访问, 从而避免此中断。</span><span class="sxs-lookup"><span data-stu-id="c269b-106">Here, we will explore how this outage could have been avoided by utilizing capabilities on Azure to protect the access to infrastructure.</span></span>

## <a name="criticality-of-infrastructure"></a><span data-ttu-id="c269b-107">基础结构的关键程度</span><span class="sxs-lookup"><span data-stu-id="c269b-107">Criticality of infrastructure</span></span>

<span data-ttu-id="c269b-108">云基础结构正在成为许多企业的关键部分。</span><span class="sxs-lookup"><span data-stu-id="c269b-108">Cloud infrastructure is becoming a critical piece of many businesses.</span></span> <span data-ttu-id="c269b-109">确保人员和过程仅拥有完成其工作所需的权限, 这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="c269b-109">It is critical to ensure people and processes have only the rights they need to get their job done.</span></span> <span data-ttu-id="c269b-110">分配不正确的访问可能会导致数据丢失、数据泄露或导致服务变得不可用。</span><span class="sxs-lookup"><span data-stu-id="c269b-110">Assigning incorrect access can result in data loss, data leakage, or cause services to become unavailable.</span></span> 

<span data-ttu-id="c269b-111">系统管理员可负责大量用户、系统和权限集。</span><span class="sxs-lookup"><span data-stu-id="c269b-111">System administrators can be responsible for a large number of users, systems, and permission sets.</span></span> <span data-ttu-id="c269b-112">因此, 正确授予访问权限可能很快就会变得无法管理, 并且可能会导致 "一种大小适应所有" 方法。</span><span class="sxs-lookup"><span data-stu-id="c269b-112">So correctly granting access can quickly become unmanageable and can lead to a 'one size fits all' approach.</span></span> <span data-ttu-id="c269b-113">这种方法可以降低管理的复杂性, 但会使更易于无意中授予比所需更多的权限。</span><span class="sxs-lookup"><span data-stu-id="c269b-113">This approach can reduce the complexity of administration, but makes it far easier to inadvertently grant more permissive access than required.</span></span>

## <a name="role-based-access-control"></a><span data-ttu-id="c269b-114">基于角色的访问控制</span><span class="sxs-lookup"><span data-stu-id="c269b-114">Role-based access control</span></span>

<span data-ttu-id="c269b-115">基于角色的访问控制 (RBAC) 提供了一种略有不同的方法。</span><span class="sxs-lookup"><span data-stu-id="c269b-115">Role-based access control (RBAC) offers a slightly different approach.</span></span> <span data-ttu-id="c269b-116">角色定义为访问权限的集合。</span><span class="sxs-lookup"><span data-stu-id="c269b-116">Roles are defined as collections of access permissions.</span></span> <span data-ttu-id="c269b-117">安全主体直接或通过组成员身份映射到角色。</span><span class="sxs-lookup"><span data-stu-id="c269b-117">Security principals are mapped to roles directly or through group membership.</span></span> <span data-ttu-id="c269b-118">将安全主体、访问权限和资源分开可提供简化的访问管理和更精细的控制。</span><span class="sxs-lookup"><span data-stu-id="c269b-118">Separating security principals, access permissions, and resources provides simplified access management and more fine-grained control.</span></span>

<span data-ttu-id="c269b-119">在 azure 中, 用户、组和角色都存储在 azure Active Directory (azure AD) 中。</span><span class="sxs-lookup"><span data-stu-id="c269b-119">On Azure, users, groups, and roles are all stored in Azure Active Directory (Azure AD).</span></span> <span data-ttu-id="c269b-120">azure 资源管理器 API 使用基于角色的访问控制来保护 Azure 中的所有资源访问管理。</span><span class="sxs-lookup"><span data-stu-id="c269b-120">The Azure Resource Manager API uses role-based access control to secure all resource access management within Azure.</span></span>

![显示基于角色的访问控制实现的插图。](../media/ACL_Based_Access.png)

<!-- ![Role-based access control](../media/Role_Based_Access.png)
 -->

### <a name="roles-and-management-groups"></a><span data-ttu-id="c269b-122">角色和管理组</span><span class="sxs-lookup"><span data-stu-id="c269b-122">Roles and management groups</span></span>

<span data-ttu-id="c269b-123">角色是权限集, 如 "只读" 或 "投稿人", 可授予用户访问 Azure 服务实例的权限。</span><span class="sxs-lookup"><span data-stu-id="c269b-123">Roles are sets of permissions, like "Read-only" or "Contributor", that users can be granted to access an Azure service instance.</span></span> <span data-ttu-id="c269b-124">可以在单独的服务实例级别授予角色, 但这些角色也会向下传递 Azure 资源管理器层次结构。</span><span class="sxs-lookup"><span data-stu-id="c269b-124">Roles can be granted at the individual service instance level, but they also flow down the Azure Resource Manager hierarchy.</span></span> <span data-ttu-id="c269b-125">在更高作用域 (如整个订阅) 中分配的角色由子作用域继承, 如服务实例。</span><span class="sxs-lookup"><span data-stu-id="c269b-125">Roles assigned at a higher scope, like an entire subscription, are inherited by child scopes, like service instances.</span></span> 

<span data-ttu-id="c269b-126">管理组是最近引入到 RBAC 模型中的其他层次结构级别。</span><span class="sxs-lookup"><span data-stu-id="c269b-126">Management groups are an additional hierarchical level recently introduced into the RBAC model.</span></span> <span data-ttu-id="c269b-127">管理组添加了将订阅分组在一起, 并在更高级别应用策略的功能。</span><span class="sxs-lookup"><span data-stu-id="c269b-127">Management groups add the ability to group subscriptions together and apply policy at an even higher level.</span></span>

<span data-ttu-id="c269b-128">通过任意定义的订阅层次结构传递角色的功能还允许管理员为经过身份验证的用户授予对整个环境的临时访问权限。</span><span class="sxs-lookup"><span data-stu-id="c269b-128">The ability to flow roles through an arbitrarily defined subscription hierarchy also allows administrators to grant temporary access to an entire environment for authenticated users.</span></span> <span data-ttu-id="c269b-129">例如, 审核员可能需要对所有订阅的临时只读访问权限。</span><span class="sxs-lookup"><span data-stu-id="c269b-129">For example, an auditor may require temporary read-only access to all subscriptions.</span></span>

![显示管理组中基于角色的访问的分层表示形式的插图。](../media/management_groups.png)

### <a name="privileged-identity-management"></a><span data-ttu-id="c269b-131">特权身份管理</span><span class="sxs-lookup"><span data-stu-id="c269b-131">Privileged Identity Management</span></span>

<span data-ttu-id="c269b-132">除了使用 RBAC 管理 Azure 资源访问之外, 基础结构保护的综合方法应考虑在组织发生变化和演变时包括角色成员的持续审核。</span><span class="sxs-lookup"><span data-stu-id="c269b-132">In addition to managing Azure resource access with RBAC, a comprehensive approach to infrastructure protection should consider including the ongoing auditing of role members as their organization changes and evolves.</span></span> <span data-ttu-id="c269b-133">Azure ad 特权标识管理 (PIM) 是一个额外付费的产品, 可提供角色分配、自助服务和实时角色激活和 azure AD & azure 资源访问审核的监督。</span><span class="sxs-lookup"><span data-stu-id="c269b-133">Azure AD Privileged Identity Management (PIM) is an additional paid-for offering that provides oversight of role assignments, self-service, and just-in-time role activation and Azure AD & Azure resource access reviews.</span></span>

![特权标识管理仪表板的屏幕截图](../media/PIM_Dashboard.png)

## <a name="providing-identities-to-services"></a><span data-ttu-id="c269b-135">向服务提供标识</span><span class="sxs-lookup"><span data-stu-id="c269b-135">Providing identities to services</span></span>

<span data-ttu-id="c269b-136">服务具有标识通常很有价值。</span><span class="sxs-lookup"><span data-stu-id="c269b-136">It's often valuable for services to have identities.</span></span> <span data-ttu-id="c269b-137">通常情况下, 凭据信息嵌入在配置文件中, 而不是最佳实践。</span><span class="sxs-lookup"><span data-stu-id="c269b-137">Often times, and against best practices, credential information is embedded in configuration files.</span></span> <span data-ttu-id="c269b-138">除了这些配置文件的安全性之外, 任何对系统或存储库的访问权限的用户都可以访问这些凭据和风险暴露。</span><span class="sxs-lookup"><span data-stu-id="c269b-138">With no security around these configuration files, anyone with access to the systems or repositories can access these credentials and risk exposure.</span></span>

<span data-ttu-id="c269b-139">azure AD 通过两种方法来解决此问题: azure 服务的服务主体和托管标识。</span><span class="sxs-lookup"><span data-stu-id="c269b-139">Azure AD addresses this problem through two methods: service principals and managed identities for Azure services.</span></span>

### <a name="service-principals"></a><span data-ttu-id="c269b-140">服务主体</span><span class="sxs-lookup"><span data-stu-id="c269b-140">Service principals</span></span>

<span data-ttu-id="c269b-141">若要了解服务主体, 在身份管理领域中, 首先了解词的**标识**和**主体**是非常有用的。</span><span class="sxs-lookup"><span data-stu-id="c269b-141">To understand service principals, it's useful to first understand the words **identity** and **principal** as they are used in Identity management world.</span></span>

<span data-ttu-id="c269b-142">**标识**只是可以进行身份验证的内容。</span><span class="sxs-lookup"><span data-stu-id="c269b-142">An **identity** is just a thing that can be authenticated.</span></span> <span data-ttu-id="c269b-143">显然, 这包括用户的用户名和密码, 但也可以包括应用程序或其他服务器, 这些服务器可能会使用密钥或证书进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="c269b-143">Obviously, this includes users with username and password, but it can also include applications or other servers, which might authenticate with secret keys or certificates.</span></span> <span data-ttu-id="c269b-144">作为奖金定义,**帐户**是与标识关联的数据。</span><span class="sxs-lookup"><span data-stu-id="c269b-144">As a bonus definition, an **account** is data associated with an identity.</span></span>

<span data-ttu-id="c269b-145">**主体**是使用特定角色或声明的标识。</span><span class="sxs-lookup"><span data-stu-id="c269b-145">A **principal** is an identity acting with certain roles or claims.</span></span> <span data-ttu-id="c269b-146">请考虑在 bash 提示符处或使用 "以管理员身份运行" 的窗口上使用 "sudo"。</span><span class="sxs-lookup"><span data-stu-id="c269b-146">Consider the use 'sudo' on a bash prompt or on Windows using "run as Administrator".</span></span> <span data-ttu-id="c269b-147">在这两种情况下, 您仍以与之前相同的身份登录, 但您已更改要执行的角色。</span><span class="sxs-lookup"><span data-stu-id="c269b-147">In both of those cases, you are still logged in as the same identity as before, but you've changed the role under which you are executing.</span></span>

<span data-ttu-id="c269b-148">因此,**服务主体**是按字面名命名的。</span><span class="sxs-lookup"><span data-stu-id="c269b-148">So, a **Service Principal** is literally named.</span></span> <span data-ttu-id="c269b-149">它是服务或应用程序使用的标识。</span><span class="sxs-lookup"><span data-stu-id="c269b-149">It is an identity that is used by a service or application.</span></span> <span data-ttu-id="c269b-150">与其他标识一样, 可以为其分配角色。</span><span class="sxs-lookup"><span data-stu-id="c269b-150">Like other identities, it can be assigned roles.</span></span>

<span data-ttu-id="c269b-151">例如, Lamna 医疗保健可将其部署脚本分配为以服务主体身份进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="c269b-151">For example, Lamna Healthcare can assign its deployment scripts to run authenticated as a service principal.</span></span> <span data-ttu-id="c269b-152">如果这是唯一具有执行破坏性操作的权限的身份, 则 Lamna 将已有很长的时间来确保它们没有重复的意外资源删除。</span><span class="sxs-lookup"><span data-stu-id="c269b-152">If that is the only identity that has permission to perform destructive actions, Lamna will have gone a long way toward making sure they don't have a repeat of the accidental resource deletion.</span></span>

### <a name="managed-identities-for-azure-resources"></a><span data-ttu-id="c269b-153">Azure 资源的托管标识</span><span class="sxs-lookup"><span data-stu-id="c269b-153">Managed identities for Azure resources</span></span>

<span data-ttu-id="c269b-154">服务主体的创建可能是一个单调乏味的过程, 并且有许多触控点可以使它们保持困难。</span><span class="sxs-lookup"><span data-stu-id="c269b-154">The creation of service principals can be a tedious process, and there are a lot of touch points that can make maintaining them difficult.</span></span> <span data-ttu-id="c269b-155">管理 Azure 资源的标识更容易, 并将为你执行大部分工作。</span><span class="sxs-lookup"><span data-stu-id="c269b-155">Manage identities for Azure resources are much easier and will do most of the work for you.</span></span>

<span data-ttu-id="c269b-156">可以为任何支持它的 Azure 服务即时创建托管标识 (该列表持续增长)。</span><span class="sxs-lookup"><span data-stu-id="c269b-156">A managed identity can be instantly created for any Azure service that supports it (the list is constantly growing).</span></span> <span data-ttu-id="c269b-157">为服务创建托管标识时, 将在 Azure AD 租户上创建帐户。</span><span class="sxs-lookup"><span data-stu-id="c269b-157">When you create a managed identity for a service, you are creating an account on the Azure AD tenant.</span></span> <span data-ttu-id="c269b-158">Azure 基础结构将自动负责对服务进行身份验证并管理帐户。</span><span class="sxs-lookup"><span data-stu-id="c269b-158">Azure infrastructure will automatically take care of authenticating the service and managing the account.</span></span> <span data-ttu-id="c269b-159">然后, 您可以像使用任何其他 AD 帐户一样使用该帐户, 包括安全地允许经过身份验证的服务访问其他 Azure 资源。</span><span class="sxs-lookup"><span data-stu-id="c269b-159">You can then use that account like any other AD account including securely letting the authenticated service access other Azure resources.</span></span>

<span data-ttu-id="c269b-160">Lamna 保健将其身份管理更进一步, 并对需要执行基础结构管理和部署的所有受支持的服务使用托管身份。</span><span class="sxs-lookup"><span data-stu-id="c269b-160">Lamna Healthcare takes their identity management a step further and uses managed identities for all supported services that need the ability to perform infrastructure management and deployments.</span></span>

## <a name="infrastructure-protection-at-lamna-healthcare"></a><span data-ttu-id="c269b-161">Lamna 医疗保健方面的基础结构保护</span><span class="sxs-lookup"><span data-stu-id="c269b-161">Infrastructure protection at Lamna Healthcare</span></span>

<span data-ttu-id="c269b-162">我们已了解 Lamna 医疗保健如何解决意外删除基础结构的事件中的问题。</span><span class="sxs-lookup"><span data-stu-id="c269b-162">We've seen how Lamna Healthcare has addressed issues from their incident where infrastructure was inadvertently deleted.</span></span> <span data-ttu-id="c269b-163">他们使用基于角色的访问控制来更好地管理其基础结构的安全性, 并使用托管标识将其凭据保留在代码之外, 并简化其服务所需的身份管理。</span><span class="sxs-lookup"><span data-stu-id="c269b-163">They've used role-based access control to better manage the security of their infrastructure, and are using managed identities to keep their credentials out of code and ease administration of the identities needed for their services.</span></span>

## <a name="summary"></a><span data-ttu-id="c269b-164">摘要</span><span class="sxs-lookup"><span data-stu-id="c269b-164">Summary</span></span>

<span data-ttu-id="c269b-165">为了确保基础结构的可用性和完整性, 一定要正确保护基础结构。</span><span class="sxs-lookup"><span data-stu-id="c269b-165">To ensure the availability and integrity of infrastructure, it's important to properly secure your infrastructure.</span></span> <span data-ttu-id="c269b-166">正确使用 RBAC 和托管标识等功能将有助于保护您的 Azure 环境免遭未经授权或无意的访问, 并将增强体系结构中的标识安全功能。</span><span class="sxs-lookup"><span data-stu-id="c269b-166">Properly using features such as RBAC and managed  identities will help protect your Azure environment from unauthorized or unintended access, and will enhance the identity security capabilities in your architecture.</span></span>