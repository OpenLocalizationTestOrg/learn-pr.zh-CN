保护网络免受攻击和未经授权的访问是任何体系结构的重要部分。 在规划云迁移的过程中, Lamna 医疗保健需要花时间来规划自己的网络基础结构, 以确保 it 有适当的网络安全控制来保护其网络基础结构免遭攻击。 在这里, 我们将了解网络安全的外观、如何将分层方法集成到您的体系结构中, 以及 Azure 如何帮助您为您的环境提供网络安全。

## <a name="what-is-network-security"></a>什么是网络安全

网络安全保护在网络内部和外部的资源的通信。 目标是在您的服务和系统中限制网络层的暴露。 通过限制这种公开程度, 可以降低资源受到攻击的可能性。 在重点关注网络安全性的同时, 工作可以重点关注以下方面:

- 保护应用程序和 internet 之间的通信流
- 保护应用程序之间的通信流
- 保护用户与应用程序之间的通信流

保护应用程序和 internet 之间的通信流的安全主要是限制网络外部的暴露。 网络攻击通常会在网络外部启动, 因此, 通过限制 internet 暴露和保护外围环境, 可以降低受到攻击的风险。

确保应用程序之间的通信流侧重于应用程序和其层之间、不同环境之间以及网络中的其他服务之间的数据。 通过限制这些资源之间的暴露程度, 可以减少受损资源的影响。 这有助于减少网络中的进一步传播。

保护用户和应用程序之间的通信流的安全, 重点在于保护最终用户的网络流量。 这将限制您的资源对外部攻击的暴露程度, 并为用户提供使用您的资源的安全机制。 

## <a name="a-layered-approach-to-network-security"></a>网络安全的分层方法

整个本模块中的公用线程都采用了分层方法来实现安全, 在网络层, 这种方法是没有区别的。 仅专注于保护网络外围, 或将重点放在网络内的服务之间的网络安全上是不够的。 分层方法提供了多个级别的保护, 因此, 如果攻击者通过一个层, 则有进一步的保护来限制进一步的攻击。

让我们来看看 Azure 如何为分层方法提供用于保护网络空间的工具。

### <a name="internet-protection"></a>Internet 保护

如果我们在网络外围启动, 我们将重点介绍如何限制和消除来自 internet 的攻击。 开始时的首要位置是评估面向 internet 的资源, 并在必要时仅允许入站和出站通信。 确定允许任何类型的入站网络流量的所有资源, 并确保它们是必需的, 并且仅限于所需的端口/协议。 Azure 安全中心是查找此信息的理想位置, 因为它将标识未与之关联的网络安全组 (NSG) 的面向 internet 的资源, 以及防火墙后面不受保护的资源。

若要在外围提供入站保护, 有几种方法可以实现此目的。 应用程序网关是第7层负载平衡器, 它还包含 web 应用程序防火墙 (WAF), 用于为您的基于 HTTP 的服务提供高级安全性。 WAF 基于 OWASP 3.0 或2.2.9 核心规则集的规则, 并提供了针对常见漏洞 (如跨站点脚本和 SQL 注入) 的保护。

![图中显示了单个应用程序网关筛选对位于两个不同站点的虚拟机发出的所有外部请求。 应用程序网关的 web 应用程序防火墙功能可保护系统免遭恶意攻击, 而负载平衡器可在虚拟机之间分发合法请求。](../media/appgw-waf.png)

为了保护非基于 HTTP 的服务或提高自定义项, 可以使用网络虚拟设备 (NVA) 来保护网络资源。 NVAs 类似于在本地网络中可能会发现的防火墙装置, 并且可从许多最受欢迎的网络安全供应商处获得。 NVAs 可以为需要它的应用程序提供更好的安全性自定义, 但可能会增加复杂性, 因此建议您仔细考虑要求。

向 internet 公开的任何资源都存在受到拒绝服务攻击的风险。 这些类型的攻击试图通过发送这么多请求资源变慢或不响应, 从而导致网络资源严重不足。 为了缓解这些攻击, azure DDoS 提供了跨所有 Azure 服务的基本保护, 并增强了保护以进一步为你的资源自定义。 DDoS 保护会阻止攻击流量, 并将其余流量转发到其预期的目标。 在几分钟的攻击检测中, 您会收到使用 Azure Monitor 指标的通知。

![显示在虚拟网络和外部用户请求之间安装了 Azure DDoS 保护的说明。 Azure DDoS 保护会阻止恶意流量攻击, 但会将合法流量转发到预期的目标。](../media/ddos.png)

### <a name="virtual-network-security"></a>虚拟网络安全

在虚拟网络 (VNet) 中, 将资源之间的通信限制为仅需要的内容非常重要。

对于虚拟机之间的通信, 网络安全组 (NSG) 是限制不必要的通信的关键部分。 NSGs 在层 3 & 4 处运行, 并提供与网络接口和子网之间允许和拒绝的通信的列表。 NSGs 可完全自定义, 并使您能够完全锁定与虚拟机之间的网络通信。 通过使用 NSGs, 您可以在环境、层和服务之间隔离应用程序。

![该图显示了网络安全组的使用情况, 以限制后端和中端与 Internet 的直接通信。 Internet 请求由前端接收, 然后将其传递到中端。 中端与后端通信。 ](../media/azure-network-security.png)

若要隔离 Azure 服务以仅允许来自虚拟网络的通信, 请使用 VNet 服务终结点。 使用服务终结点, 可以将 Azure 服务资源固定到虚拟网络。 通过将公用 internet 访问与虚拟网络保护, 使服务资源安全, 可通过完全删除对资源的公共 internet 访问来提高安全性, 并且仅允许来自你的虚拟网络的流量。 这样可以减少环境的攻击面, 降低限制 VNet 和 Azure 服务之间的通信所需的管理, 并为此通信提供最佳路由。

### <a name="network-integration"></a>网络集成

通常情况下, 需要集成现有网络基础结构以提供来自本地网络的通信, 或者在 Azure 中提供服务之间的改进通信。 有几种主要方法可以处理这种集成并提高网络安全性。

虚拟专用网络 (VPN) 连接是在网络之间建立安全通信通道的一种常用方法, 在使用 Azure 上的虚拟网络时, 这是不相同的。 azure vnet 和本地 VPN 设备之间的连接是在网络和 Azure 上的虚拟机之间提供安全通信的绝佳方式。

若要在网络和 Azure 之间提供专用的专用连接, 可以使用 ExpressRoute。 ExpressRoute 允许你通过连接提供程序加速的专用连接将本地网络扩展到 Microsoft 云。 使用 ExpressRoute, 可以建立与 microsoft 云服务 (如 microsoft Azure、Office 365 和 Dynamics 365) 的连接。 这将通过使用专用线路而不是通过 internet 发送此流量来提高本地通信的安全性。 您无需通过 internet 允许最终用户访问这些服务, 并且可以通过设备发送此流量以进行进一步的流量检查。

![显示与 Azure 资源连接客户网络的 ExpressRoute 电路的体系结构图。](../media/expressroute-connection-overview.png)

为轻松地在 Azure 中集成多个 vnet, VNet 对等互连在指定的 vnet 之间建立直接连接。 建立后, 您可以使用 NSGs 在资源之间以与保证 VNet 中的资源相同的方式提供资源之间的隔离。 此集成使您能够在任何 peered vnet 中提供相同的基本安全层。 仅允许直接连接的 vnet 之间的通信。

## <a name="network-security-at-lamna-healthcare"></a>Lamna 保健中的网络安全

Lamna 保健利用了许多服务来构建安全的网络基础结构。 默认情况下拒绝资源之间的通信, 并且仅在需要时允许。 仅对需要它的服务启用来自 internet 的入站连接;不允许 RDP 和 SSH 从 internet 终结点 (仅限来自受信任的内部资源)。

为了保护其面向 internet 的 web 服务的安全, 它们将它们放在启用了 WAF 的应用程序网关后面。 对于在虚拟机上运行的服务以及应用服务, 这都是如此。 通过使用应用程序网关, 他们可以抵御许多常见漏洞的攻击。

它们启用了 DDoS 标准, 以针对其面向 internet 的终结点提供对拒绝服务攻击的保护。

通过使用 NSGs, 它们可以完全隔离应用程序服务和环境之间的通信。 它们只允许在环境中的服务之间进行必要的通信, 并且不允许在生产和非生产环境之间进行任何访问。

若要在 Azure 中的最终用户和应用程序之间提供专用连接, 他们已使用与本地网络的连接性预配的 ExpressRoute 电路。 这将使它们的流量保持与 internet 的 azure 断开, 并为 azure 中的服务提供专用连接, 以便与本地系统保持通信。

通过此方法, Lamna 医疗保健已利用 Azure 服务在其网络基础结构的多个层提供安全性。

## <a name="summary"></a>摘要

网络安全的分层方法有助于降低通过基于网络的攻击暴露的风险。 Azure 提供了多种服务和功能, 以保护面向 internet 的资源、内部资源和本地网络之间的通信。 利用这些功能, 可以在 Azure 上创建安全解决方案。