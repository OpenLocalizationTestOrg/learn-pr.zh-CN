与本地计算机非常相似, 虚拟机性能通常可直接与读取和写入数据的速度相关联。 为了了解如何提高性能, 我们首先需要了解性能的衡量方式以及影响它的设置和选择。

我们正在查找用于虚拟机的基础磁盘和存储。 在查看性能时, 请记住, 您还需要考虑应用程序层。 例如, 如果在虚拟机中运行数据库, 则需要查看数据库的特定性能设置, 以确保它已针对要在其中运行它的 VM 和存储进行了优化。

让我们先定义几个术语, 并确保 Azure 对它们进行介绍。

## <a name="io-operations-per-second"></a>每秒的 i/o 操作数

您选择的存储类型 ("标准" 或 "高级") 将决定磁盘的速度。 我们在每秒 i/o 操作或 IOPS (明显为 "目视") 中测量此性能。

IOPS 是可在一秒内由磁盘处理的请求数。 单个请求是读取或写入操作。 此度量值直接应用于存储。 例如, 如果您有一个可以执行**5000 IOPS**的磁盘, 则意味着理论上可以处理每秒的5000读取和或写入操作。

IOPS 将直接影响应用程序的性能。 某些应用程序 (如零售网站) 需要较高的 IOPS 来处理所有必须快速处理的小型和随机 i/o 请求, 以保持网站的响应性。

### <a name="iops-in-azure"></a>Azure 中的 IOPS

当您将一个高级存储磁盘附加到高扩展 VM 时, Azure 将根据磁盘规格设置一个保证的 IOPS 数。 例如, **P50**磁盘将预配**7500 IOPS**。 每个高扩展 VM 大小也具有可承受的特定 IOPS 限制。 例如,**标准 GS5** VM 的 IOPS 限制为**80000 IOPS** 。

IOPS 是存储磁盘的度量, 但它是_理论_限制-两个其他因素可能会影响实际应用程序性能:**吞吐量**和**延迟**。

### <a name="what-is-throughput"></a>吞吐量是什么？
吞吐量 (也称为 "带宽") 是指在指定时间间隔 (通常每秒) 将应用程序发送到存储磁盘的数据量。 如果您的应用程序执行的是大数据块的 i/o, 则需要高吞吐量。

Azure 根据磁盘规范预配高级存储磁盘中的吞吐量。 例如, **P50**磁盘设置**每秒 250 MB**的磁盘吞吐量。 每个高规模 VM 大小也都具有其可承受的特定_吞吐量限制_。 例如,**标准 GS5** VM 的最大吞吐量为**每秒 2000 MB**。

#### <a name="iops-vs-throughput"></a>IOPS 与吞吐量的对比

吞吐量和 IOPS 具有直接关系, 更改其中一个将直接影响另一个。 若要获得理论上的吞吐量限制, 可以使用公式: `IOPS x I/O size = throughput`。 在规划应用程序时, 请务必考虑这两个值。

### <a name="what-is-latency"></a>什么是延迟？

读取和写入数据需要一些时间。 在这种情况下, 会发生_延迟_。 延迟是应用程序向磁盘发送请求并获取响应所用的时间。 实际上, 延迟会告诉我们_处理_单个读取或写入 i/o 请求所需的时间。

延迟会对 IOPS 施加限制。 例如, 如果我们的磁盘可以处理 5000 IOPS, 但每个操作需要10毫秒的时间来处理, 那么, 由于处理时间, 我们的应用将每秒限制为100个操作。 这是一个简单的示例, 大多数时间延迟将大大降低。 最终, 延迟和吞吐量将决定您的应用程序可以多快地处理存储中的数据。 

高级存储提供一致的低延迟, 您可以通过_缓存_实现更高的延迟 (如果需要)。 

## <a name="testing-your-disk-performance"></a>测试磁盘性能

您可以通过选择正确的 vm 大小和存储类型来调整和平衡 VM 磁盘的 IOPS、吞吐量和延迟。 通常情况下, 更大或更昂贵的 VM 大小将具有更高的最大 IOPS 和吞吐量保证。 将添加到该公式标准与高级存储以及 HDD 与 SSD 选项, 并且您有多个参数可供播放。

选择适当的组合将了解您的应用程序要求。 高 i/o 应用程序 (如数据库服务器或联机事务性处理系统) 将需要更高的 IOPS, 而基于更多计算的应用程序可能会有更少的要求。 此外, 应用程序执行的操作_类型_将影响你的吞吐量。 高随机存取 i/o 往往比长顺序读取的速度慢。

选择您的配置后, 您可以使用[Iometer](http://iometer.org/)之类的工具测试 Linux 和 Windows 虚拟机上的磁盘性能。 这将为您提供对预期性能种类的更真实的认识。 它还可以帮助您确定改进应用程序的存储使用情况的方法。 例如, 执行单线程 i/o 的应用程序可能会因为延迟而降低 i/o 性能。

我们来看看可用于提高磁盘性能的一些其他事项。

