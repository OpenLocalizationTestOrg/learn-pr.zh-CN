<span data-ttu-id="67846-101">与本地计算机非常相似, 虚拟机性能通常可直接与读取和写入数据的速度相关联。</span><span class="sxs-lookup"><span data-stu-id="67846-101">Much like your local computers, virtual machine performance can often be tied directly to how quickly it can read and write data.</span></span> <span data-ttu-id="67846-102">为了了解如何提高性能, 我们首先需要了解性能的衡量方式以及影响它的设置和选择。</span><span class="sxs-lookup"><span data-stu-id="67846-102">In order to understand how to improve that performance, we first have to understand how performance is measured and the settings and choices that affect it.</span></span>

<span data-ttu-id="67846-103">我们正在查找用于虚拟机的基础磁盘和存储。</span><span class="sxs-lookup"><span data-stu-id="67846-103">We are looking specifically at the underlying disks and storage used for VMs.</span></span> <span data-ttu-id="67846-104">在查看性能时, 请记住, 您还需要考虑应用程序层。</span><span class="sxs-lookup"><span data-stu-id="67846-104">When you are looking at performance, keep in mind that you will also have to consider the application layer.</span></span> <span data-ttu-id="67846-105">例如, 如果在虚拟机中运行数据库, 则需要查看数据库的特定性能设置, 以确保它已针对要在其中运行它的 VM 和存储进行了优化。</span><span class="sxs-lookup"><span data-stu-id="67846-105">For example, if you are running a database in a VM, you will want to look at the performance settings specific to the database to ensure it is optimized for the VM and storage you are running it on.</span></span>

<span data-ttu-id="67846-106">让我们先定义几个术语, 并确保 Azure 对它们进行介绍。</span><span class="sxs-lookup"><span data-stu-id="67846-106">Let's start by defining a few terms and the guarantees Azure makes about them.</span></span>

## <a name="io-operations-per-second"></a><span data-ttu-id="67846-107">每秒的 i/o 操作数</span><span class="sxs-lookup"><span data-stu-id="67846-107">I/O operations per second</span></span>

<span data-ttu-id="67846-108">您选择的存储类型 ("标准" 或 "高级") 将决定磁盘的速度。</span><span class="sxs-lookup"><span data-stu-id="67846-108">The storage type you select (standard or premium) will decide how fast your disks are.</span></span> <span data-ttu-id="67846-109">我们在每秒 i/o 操作或 IOPS (明显为 "目视") 中测量此性能。</span><span class="sxs-lookup"><span data-stu-id="67846-109">We measure this performance in I/O operations per second, or IOPS (pronounced "eye-ops").</span></span>

<span data-ttu-id="67846-110">IOPS 是可在一秒内由磁盘处理的请求数。</span><span class="sxs-lookup"><span data-stu-id="67846-110">IOPS is number of requests that can be processed by the disk in one second.</span></span> <span data-ttu-id="67846-111">单个请求是读取或写入操作。</span><span class="sxs-lookup"><span data-stu-id="67846-111">A single request is a read or write operation.</span></span> <span data-ttu-id="67846-112">此度量值直接应用于存储。</span><span class="sxs-lookup"><span data-stu-id="67846-112">This measurement is applied directly to storage.</span></span> <span data-ttu-id="67846-113">例如, 如果您有一个可以执行**5000 IOPS**的磁盘, 则意味着理论上可以处理每秒的5000读取和或写入操作。</span><span class="sxs-lookup"><span data-stu-id="67846-113">For example, if you have a disk that can do a **5000 IOPS**, it means that it is theoretically capable of processing 5,000 read and or write operations per second.</span></span>

<span data-ttu-id="67846-114">IOPS 将直接影响应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="67846-114">IOPS directly affects your application performance.</span></span> <span data-ttu-id="67846-115">某些应用程序 (如零售网站) 需要较高的 IOPS 来处理所有必须快速处理的小型和随机 i/o 请求, 以保持网站的响应性。</span><span class="sxs-lookup"><span data-stu-id="67846-115">Some applications, such as retail websites, need high IOPS to handle all the small and random I/O requests that must be processed quickly to keep the site responsive.</span></span>

### <a name="iops-in-azure"></a><span data-ttu-id="67846-116">Azure 中的 IOPS</span><span class="sxs-lookup"><span data-stu-id="67846-116">IOPS in Azure</span></span>

<span data-ttu-id="67846-117">当您将一个高级存储磁盘附加到高扩展 VM 时, Azure 将根据磁盘规格设置一个保证的 IOPS 数。</span><span class="sxs-lookup"><span data-stu-id="67846-117">When you attach a premium storage disk to your high scale VM, Azure provisions a guaranteed number of IOPS as per the disk specification.</span></span> <span data-ttu-id="67846-118">例如, **P50**磁盘将预配**7500 IOPS**。</span><span class="sxs-lookup"><span data-stu-id="67846-118">For example, a **P50** disk provisions **7500 IOPS**.</span></span> <span data-ttu-id="67846-119">每个高扩展 VM 大小也具有可承受的特定 IOPS 限制。</span><span class="sxs-lookup"><span data-stu-id="67846-119">Each high scale VM size also has a specific IOPS limit that it can sustain.</span></span> <span data-ttu-id="67846-120">例如,**标准 GS5** VM 的 IOPS 限制为**80000 IOPS** 。</span><span class="sxs-lookup"><span data-stu-id="67846-120">For example, a **Standard GS5** VM has an **80,000 IOPS** limit.</span></span>

<span data-ttu-id="67846-121">IOPS 是存储磁盘的度量, 但它是_理论_限制-两个其他因素可能会影响实际应用程序性能:**吞吐量**和**延迟**。</span><span class="sxs-lookup"><span data-stu-id="67846-121">IOPS is a measurement of the storage disks, however it's a _theoretical_ limit - two other factors can affect the actual application performance: **throughput** and **latency**.</span></span>

### <a name="what-is-throughput"></a><span data-ttu-id="67846-122">吞吐量是什么？</span><span class="sxs-lookup"><span data-stu-id="67846-122">What is throughput?</span></span>
<span data-ttu-id="67846-123">吞吐量 (也称为 "带宽") 是指在指定时间间隔 (通常每秒) 将应用程序发送到存储磁盘的数据量。</span><span class="sxs-lookup"><span data-stu-id="67846-123">Throughput (also called "bandwidth") is the amount of data that your application is sending to the storage disks in a specified interval (typically per second).</span></span> <span data-ttu-id="67846-124">如果您的应用程序执行的是大数据块的 i/o, 则需要高吞吐量。</span><span class="sxs-lookup"><span data-stu-id="67846-124">If your application is performing I/O with large blocks of data, it requires high throughput.</span></span>

<span data-ttu-id="67846-125">Azure 根据磁盘规范预配高级存储磁盘中的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="67846-125">Azure provisions throughput in premium storage disks based on that disks' specification.</span></span> <span data-ttu-id="67846-126">例如, **P50**磁盘设置**每秒 250 MB**的磁盘吞吐量。</span><span class="sxs-lookup"><span data-stu-id="67846-126">For example, a **P50** disk provisions **250 MB per second** disk throughput.</span></span> <span data-ttu-id="67846-127">每个高规模 VM 大小也都具有其可承受的特定_吞吐量限制_。</span><span class="sxs-lookup"><span data-stu-id="67846-127">Each high scale VM size also has as specific _throughput limit_ that it can sustain.</span></span> <span data-ttu-id="67846-128">例如,**标准 GS5** VM 的最大吞吐量为**每秒 2000 MB**。</span><span class="sxs-lookup"><span data-stu-id="67846-128">For example, **Standard GS5** VM has a maximum throughput of **2,000 MB per second**.</span></span>

#### <a name="iops-vs-throughput"></a><span data-ttu-id="67846-129">IOPS 与吞吐量的对比</span><span class="sxs-lookup"><span data-stu-id="67846-129">IOPS vs. throughput</span></span>

<span data-ttu-id="67846-130">吞吐量和 IOPS 具有直接关系, 更改其中一个将直接影响另一个。</span><span class="sxs-lookup"><span data-stu-id="67846-130">Throughput and IOPS have a direct relationship, changing one will have a direct impact on the other.</span></span> <span data-ttu-id="67846-131">若要获得理论上的吞吐量限制, 可以使用公式: `IOPS x I/O size = throughput`。</span><span class="sxs-lookup"><span data-stu-id="67846-131">To get a theoretical limit of throughput you can use the formula: `IOPS x I/O size = throughput`.</span></span> <span data-ttu-id="67846-132">在规划应用程序时, 请务必考虑这两个值。</span><span class="sxs-lookup"><span data-stu-id="67846-132">It's important to consider both of these values when planning your application.</span></span>

### <a name="what-is-latency"></a><span data-ttu-id="67846-133">什么是延迟？</span><span class="sxs-lookup"><span data-stu-id="67846-133">What is latency?</span></span>

<span data-ttu-id="67846-134">读取和写入数据需要一些时间。</span><span class="sxs-lookup"><span data-stu-id="67846-134">Reading and writing data takes time.</span></span> <span data-ttu-id="67846-135">在这种情况下, 会发生_延迟_。</span><span class="sxs-lookup"><span data-stu-id="67846-135">This is where _latency_ comes in.</span></span> <span data-ttu-id="67846-136">延迟是应用程序向磁盘发送请求并获取响应所用的时间。</span><span class="sxs-lookup"><span data-stu-id="67846-136">Latency is the time it takes your app to send a request to the disk and get a response.</span></span> <span data-ttu-id="67846-137">实际上, 延迟会告诉我们_处理_单个读取或写入 i/o 请求所需的时间。</span><span class="sxs-lookup"><span data-stu-id="67846-137">Essentially, latency tells us how long it takes to _process_ a single read or write I/O request.</span></span>

<span data-ttu-id="67846-138">延迟会对 IOPS 施加限制。</span><span class="sxs-lookup"><span data-stu-id="67846-138">Latency puts a limit on IOPS.</span></span> <span data-ttu-id="67846-139">例如, 如果我们的磁盘可以处理 5000 IOPS, 但每个操作需要10毫秒的时间来处理, 那么, 由于处理时间, 我们的应用将每秒限制为100个操作。</span><span class="sxs-lookup"><span data-stu-id="67846-139">For example, if our disk can handle 5000 IOPS but each operation takes 10 ms to process, then our app will be capped to 100 operation per second due to the processing time.</span></span> <span data-ttu-id="67846-140">这是一个简单的示例, 大多数时间延迟将大大降低。</span><span class="sxs-lookup"><span data-stu-id="67846-140">This is a simple example, most of the time latency will be much lower.</span></span> <span data-ttu-id="67846-141">最终, 延迟和吞吐量将决定您的应用程序可以多快地处理存储中的数据。</span><span class="sxs-lookup"><span data-stu-id="67846-141">Ultimately, latency and throughput will determine how fast your app can process data from storage.</span></span> 

<span data-ttu-id="67846-142">高级存储提供一致的低延迟, 您可以通过_缓存_实现更高的延迟 (如果需要)。</span><span class="sxs-lookup"><span data-stu-id="67846-142">Premium Storage provides consistent low latencies and you can achieve even better latency when necessary through _caching_.</span></span> 

## <a name="testing-your-disk-performance"></a><span data-ttu-id="67846-143">测试磁盘性能</span><span class="sxs-lookup"><span data-stu-id="67846-143">Testing your disk performance</span></span>

<span data-ttu-id="67846-144">您可以通过选择正确的 vm 大小和存储类型来调整和平衡 VM 磁盘的 IOPS、吞吐量和延迟。</span><span class="sxs-lookup"><span data-stu-id="67846-144">You can adjust and balance the IOPS, throughput, and latency of your VM disks by selecting the right VM size and storage type.</span></span> <span data-ttu-id="67846-145">通常情况下, 更大或更昂贵的 VM 大小将具有更高的最大 IOPS 和吞吐量保证。</span><span class="sxs-lookup"><span data-stu-id="67846-145">Typically, the larger or more expensive VM sizes will have higher guarantees for max IOPS and throughput.</span></span> <span data-ttu-id="67846-146">将添加到该公式标准与高级存储以及 HDD 与 SSD 选项, 并且您有多个参数可供播放。</span><span class="sxs-lookup"><span data-stu-id="67846-146">Add into that equation Standard vs. Premium storage and HDD vs. SSD choices and you have several parameters to play with.</span></span>

<span data-ttu-id="67846-147">选择适当的组合将了解您的应用程序要求。</span><span class="sxs-lookup"><span data-stu-id="67846-147">Selecting the right combination involves understanding what your application requirements are.</span></span> <span data-ttu-id="67846-148">高 i/o 应用程序 (如数据库服务器或联机事务性处理系统) 将需要更高的 IOPS, 而基于更多计算的应用程序可能会有更少的要求。</span><span class="sxs-lookup"><span data-stu-id="67846-148">High-I/O applications, such as database servers or online transactional processing systems will require higher IOPS, whereas more computational based applications might get by with much lower requirements.</span></span> <span data-ttu-id="67846-149">此外, 应用程序执行的操作_类型_将影响你的吞吐量。</span><span class="sxs-lookup"><span data-stu-id="67846-149">In addition, the _types_ of operations the applications do will affect your throughput.</span></span> <span data-ttu-id="67846-150">高随机存取 i/o 往往比长顺序读取的速度慢。</span><span class="sxs-lookup"><span data-stu-id="67846-150">High random access I/O tends to be slower than long sequential reads.</span></span>

<span data-ttu-id="67846-151">选择您的配置后, 您可以使用[Iometer](http://iometer.org/)之类的工具测试 Linux 和 Windows 虚拟机上的磁盘性能。</span><span class="sxs-lookup"><span data-stu-id="67846-151">Once you select your configuration, you can use tools such as [Iometer](http://iometer.org/) to test your disk performance on Linux and Windows VMs.</span></span> <span data-ttu-id="67846-152">这将为您提供对预期性能种类的更真实的认识。</span><span class="sxs-lookup"><span data-stu-id="67846-152">This will give you a more real-world sense of what kind of performance to expect.</span></span> <span data-ttu-id="67846-153">它还可以帮助您确定改进应用程序的存储使用情况的方法。</span><span class="sxs-lookup"><span data-stu-id="67846-153">It can also help you to identify ways to improve your app's usage of storage.</span></span> <span data-ttu-id="67846-154">例如, 执行单线程 i/o 的应用程序可能会因为延迟而降低 i/o 性能。</span><span class="sxs-lookup"><span data-stu-id="67846-154">For example, an application that does single threaded I/O is likely to suffer reduced I/O performance because of latency.</span></span>

<span data-ttu-id="67846-155">我们来看看可用于提高磁盘性能的一些其他事项。</span><span class="sxs-lookup"><span data-stu-id="67846-155">Let's look at some other things we can do to improve our disk performance.</span></span>

