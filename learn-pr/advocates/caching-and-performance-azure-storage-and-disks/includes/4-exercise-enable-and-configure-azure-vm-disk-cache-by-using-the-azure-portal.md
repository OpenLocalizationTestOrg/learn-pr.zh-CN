
假设您运行的照片共享网站的数据存储在运行 SQL Server 和自定义应用程序的 Azure 虚拟机 (vm) 上。 您希望进行以下调整:

- 您需要更改 VM 上的磁盘缓存设置。
- 您想要将新的数据磁盘添加到虚拟机, 并启用缓存。

你已决定通过 Azure 门户进行这些更改。

在本练习中, 我们将逐步完成对上面所述的 VM 进行的更改。 首先, 让我们登录到门户并创建 VM。

[!include[](../../../includes/azure-sandbox-activate.md)]

## <a name="create-a-virtual-machine"></a>创建虚拟机

在此步骤中, 我们将创建具有以下属性的 VM:

| 属性        | 值   |
|-----------------|---------|
| 图像           | **Windows Server 2016 Datacenter** |
| 名称            | **fotoshareVM** |
| 资源组  |   **<rgn>[沙盒资源组名称]</rgn>** |
| 位置        | 请参见下文。 |

1. 使用与激活沙盒时相同的帐户登录[Azure 门户](https://portal.azure.com/learn.docs.microsoft.com?azure-portal=true)。

1. 选择左侧侧栏菜单中的 "**创建资源**"。

1. _Windows Server 2016 VM_应位于**受欢迎**的 Marketplace 元素列表中。 如果不是, 请尝试使用顶部的搜索框搜索 "Windows Server 2016 DataCenter"。

1. 选择 "Windows VM", 然后单击 "**创建**" 以启动 VM 创建过程。

1. 在 "**基础知识**" 面板中, 验证所选**订阅**是否为_Concierge 订阅_。

1. 在 "**资源组**" 下, 选择 "**使用现有**" 并选择 " _<rgn>[沙盒资源组名称]</rgn>_"。

1. 在 "**虚拟机名称**" 框中, 输入_fotoshareVM_。

1. 在 "**位置**" 下拉列表中, 从以下列表中选择最接近你的区域。

    [!include[](../../../includes/azure-sandbox-regions-first-mention-note-friendly.md)]

1. 对于 VM**大小**, 默认值为**DS1 v2** , 它为您提供了一个 CPU 和 3.5 GB 的内存。 这在此示例中很不错。

1. 在 "**管理员帐户**" 部分中, 为新 VM 上的管理员帐户输入**用户名**和**密码**/"**确认密码**"。

1. 下面的图像是在填写时**基本**配置的外观示例。保留其余选项卡和字段的默认值, 然后单击 "**审阅 + 创建**"。

    ![显示 "创建虚拟机" 边栏的 Azure 门户屏幕截图, 其中一些示例基本配置已按说明进行填写。](../media/4-basics-vm.png)

1. 检查新的 vm 设置后, 单击 "**创建**" 以开始部署新的 vm。

VM 创建可能需要几分钟时间, 因为它会创建所有不同的资源 (存储、网络接口等) 来支持虚拟机。 等待 VM 部署完毕, 然后再继续练习。

## <a name="view-os-disk-cache-status-in-the-portal"></a>在门户中查看 OS 磁盘缓存状态

部署虚拟机后, 我们可以使用以下步骤确认 OS 磁盘的缓存状态:

1. 选择 " **fotoshareVM** " 资源以在门户中打开 VM 详细信息。 或者, 您可以单击左侧边栏中的 "**所有资源**", 然后选择您的 VM **fotoshareVM**。

1. 在 "**设置**" 下, 选择 "**磁盘**"。

1. 在**磁盘**窗格中, VM 具有一个磁盘, 即 OS 磁盘。 其缓存类型当前设置为可**读/写**的默认值。

![显示 VM 刀片磁盘部分的 Azure 门户屏幕截图, 操作系统磁盘显示并设置为只读缓存。](../media/4-os-disk-rw.PNG)

## <a name="change-the-cache-settings-of-the-os-disk-in-the-portal"></a>在门户中更改 OS 磁盘的缓存设置

1. 在 "**磁盘**" 窗格中, 选择屏幕左上角的 "**编辑**"。

1. 使用下拉列表将 OS 磁盘的**主机缓存**值更改为**只读**, 然后选择屏幕左上角的 "**保存**"。

1. 此更新可能需要一段时间。 原因是, 更改 Azure 磁盘的缓存设置会分离和将目标磁盘。 如果它是操作系统磁盘, 也会重新启动虚拟机。 操作完成后, 你将收到一条通知, 指出 VM 磁盘已更新。

1. 完成后, OS 磁盘缓存类型将设置为**只读**。

让我们转到数据磁盘缓存配置。 若要配置磁盘, 我们需要先创建一个磁盘。

## <a name="add-a-data-disk-to-the-vm-and-set-caching-type"></a>将数据磁盘添加到 VM 并设置缓存类型

1. 回到门户中的虚拟机的**磁盘**视图, 继续执行, 然后单击 "**添加数据磁盘**"。 "**名称**" 字段中会立即出现一个错误, 告诉我们该字段不能为空。 我们还没有数据磁盘, 因此我们创建一个。

1. 在 "**名称**" 列表中单击, 然后单击 "**创建磁盘**"。

1. 在 "**创建托管磁盘**" 窗格中的 "**名称**" 框中, 键入**fotosharesVM-data**。

1. 在 "**资源组**" 下, 选择 "**使用现有**", 然后选择 " _<rgn>[沙盒资源组名称]</rgn>_"。

1. 记下剩余字段的默认值:
    - 高级 SSD
    - 1023 GB 大小
    - 在与 VM 相同的位置 (不可更改)。
    - IOPS 限制-5000
    - 吞吐量限制 (MB/秒)-200

1. 在屏幕底部, 单击 "**创建**"。

    等到创建完磁盘, 然后再继续。

1. 使用下拉列表将新的数据磁盘的**主机缓存**值更改为**只读**(可能已设置), 然后单击屏幕左上角的 "**保存**"。

    等待 VM 完成更新新数据磁盘。 完成后, 你的虚拟机上将有一个新的数据磁盘。

在本练习中, 我们使用 Azure 门户在新 VM 上配置缓存、更改现有磁盘上的缓存设置以及在新的数据磁盘上配置缓存。 下面的屏幕截图显示了最后的配置:

![在我们的 VM 刀片的磁盘部分中显示操作系统磁盘和新数据磁盘的 Azure 门户屏幕截图, 同时将这两个磁盘设置为只读缓存。](../media/disks-final-config-portal.PNG)
