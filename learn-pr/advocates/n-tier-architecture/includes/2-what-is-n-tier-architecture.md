<span data-ttu-id="2e3d6-101">N 层体系结构将应用程序划分为**逻辑层**和**物理层**。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-101">An N-tier architecture divides an application into **logical layers** and **physical tiers**.</span></span> <span data-ttu-id="2e3d6-102">**N**表示应用程序拆分成的物理层的数量, 通常与层的数量相关联。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-102">The **N** represents the number of physical tiers the application is separated into, which typically correlates with the number of layers.</span></span> <span data-ttu-id="2e3d6-103">我们可以有两层体系结构 (客户端-服务器), 甚至是五层体系结构, 尽管这很常见, 但通常最好将层数保持在四个或更少。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-103">We could have a two-tier architecture (client-server), or even a five-tier architecture, though it's common, and often best to keep the number of tiers to four or less.</span></span> 

<span data-ttu-id="2e3d6-104">我们来谈谈图层和层的组成。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-104">Let's talk about what makes up the layers and tiers.</span></span>

## <a name="what-are-layers"></a><span data-ttu-id="2e3d6-105">图层是什么？</span><span class="sxs-lookup"><span data-stu-id="2e3d6-105">What are layers?</span></span>

<span data-ttu-id="2e3d6-106">层以逻辑方式分隔组成应用程序的应用程序代码。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-106">Layers logically separate the application code that makes up an application.</span></span> <span data-ttu-id="2e3d6-107">每个层都具有特定职责, 如处理来自用户的请求、运行业务逻辑或处理数据存储。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-107">Each layer has a specific responsibility such as handling requests from users, running business logic, or handling the storage of data.</span></span>

<span data-ttu-id="2e3d6-108">通过将应用程序分离到这些逻辑层, 我们可独立处理每个层。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-108">By separating an application into these logical layers, we treat each layer independently.</span></span> <span data-ttu-id="2e3d6-109">这将使应用程序的组件成为模块化的, 并使我们能够更轻松地维护应用程序。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-109">This makes the components of the application modular and allows us to more easily maintain the app.</span></span> <span data-ttu-id="2e3d6-110">我们可以为每个责任优化应用程序。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-110">We can optimize the application for each responsibility.</span></span> <span data-ttu-id="2e3d6-111">处理 web 请求的层将重点放在其主要任务上: 处理 web 请求。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-111">The layer handling web requests focuses on its primary task: handling web requests.</span></span> <span data-ttu-id="2e3d6-112">无需关注数据存储或正在运行业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-112">It doesn't need to be concerned with the storage of data or running business logic.</span></span> <span data-ttu-id="2e3d6-113">相反, 数据访问层侧重于优化与数据存储区的通信, 以及有关如何向用户呈现数据的不详细信息。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-113">Conversely, the data access layer focuses on optimizing communication to the data store, and disregards details about how the data is presented to the user.</span></span> <span data-ttu-id="2e3d6-114">限制将重点放在特定功能上的这一概念称为*分离关注因素*。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-114">This concept of limiting focus on particular features is called *separation of concerns*.</span></span>

<span data-ttu-id="2e3d6-115">下面的图表显示了常见的 N 层体系结构中的层。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-115">Here's a diagram that shows layers in a common N-tier architecture.</span></span> <span data-ttu-id="2e3d6-116">每个层处理应用程序的一个方面。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-116">Each layer handles one aspect of the application.</span></span> <span data-ttu-id="2e3d6-117">业务层管理用户界面层和数据访问层之间的通信。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-117">The business layer manages communication between the user interface layer and the data access layer.</span></span>

![图层的可视化](../media/2-layers.svg)

## <a name="what-are-tiers"></a><span data-ttu-id="2e3d6-119">什么是层？</span><span class="sxs-lookup"><span data-stu-id="2e3d6-119">What are tiers?</span></span>

<span data-ttu-id="2e3d6-120">层表示在单独的计算资源上物理分离应用程序的各个部分。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-120">Tiers represent the physical separation of parts of your application on separate compute resources.</span></span> <span data-ttu-id="2e3d6-121">通常, 每个**物理**层都运行应用程序的一个**逻辑**层。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-121">In general, each **physical** tier runs one **logical** layer of the application.</span></span>

<span data-ttu-id="2e3d6-122">将体系结构分成物理层有以下几个好处:</span><span class="sxs-lookup"><span data-stu-id="2e3d6-122">Separating the architecture into physical tiers comes with several benefits:</span></span>

- <span data-ttu-id="2e3d6-123">可以通过向每个层添加资源来单独扩展应用程序组件。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-123">The application components can be scaled separately by adding resources to each tier.</span></span>
- <span data-ttu-id="2e3d6-124">通过添加负载平衡来检测失败的资源并将请求重定向到正常系统, 应用程序可以更具灵活性。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-124">The application can be more resilient by adding load balancing to detect failed resources and redirect requests to healthy systems.</span></span>
- <span data-ttu-id="2e3d6-125">应用程序可以通过限制层之间的网络通信并仅允许所需的访问来提高安全性。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-125">The application can be more secure by restricting network communication between tiers and only allowing the access that is required.</span></span>

<span data-ttu-id="2e3d6-126">层之间的通信应以自上而下的方式进行。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-126">Communication between tiers should be in a top-down fashion.</span></span> <span data-ttu-id="2e3d6-127">允许每个层与下一层对话, 但通常不允许跳过层。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-127">Each tier is allowed talk to the next tier below it, but generally is not allowed to skip tiers.</span></span> <span data-ttu-id="2e3d6-128">这样做是为了通过限制层的公开表面区域来提高安全性。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-128">This is done to improve security by limiting the exposed surface area of a tier.</span></span>

![分层的可视化](../media/2-tiers.svg)

## <a name="the-three-tier-architecture"></a><span data-ttu-id="2e3d6-130">三层体系结构</span><span class="sxs-lookup"><span data-stu-id="2e3d6-130">The three-tier architecture</span></span>


<span data-ttu-id="2e3d6-131">在所有 N 层体系结构中, 三层体系结构最常见。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-131">Of all N-tier architectures, a three-tier architecture is the most common.</span></span> <span data-ttu-id="2e3d6-132">每个层和层的责任和名称因应用程序和业务而异, 但典型的三层应用程序具有: 表示层、应用程序或中间层以及数据层。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-132">The responsibilities and names of each layer and tier vary by application and business, but a typical three-tier application has: a presentation tier, an application or middle tier, and a data tier.</span></span> <span data-ttu-id="2e3d6-133">这是最常见的 N 层样式, 对于本模块的其余部分, 我们将引用三层模型, 每个层运行一个应用程序的一个层, 并将它们作为分层引用 synonymously。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-133">This is the most common N-tier style, and for the rest of this module we'll reference a three-tier model with each tier running a single layer of the application, and refer to them synonymously as tiers.</span></span>

### <a name="presentation-tier"></a><span data-ttu-id="2e3d6-134">表示层</span><span class="sxs-lookup"><span data-stu-id="2e3d6-134">Presentation tier</span></span>

<span data-ttu-id="2e3d6-135">表示层通常有利于用户请求。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-135">The presentation tier typically facilitates user requests.</span></span> <span data-ttu-id="2e3d6-136">这些用户可以是最终用户访问网页, 也可以是通过公开 API 对应用程序的公共访问。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-136">These could be end users accessing a web page, or public access to your application through an exposed API.</span></span> <span data-ttu-id="2e3d6-137">此层的重点是用户体验, 提供了类似直观的界面, 并可确保最终用户和应用程序之间的安全通信的内容。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-137">The focus at this tier is on the user experience, providing things like an intuitive interface and ensuring secure communication between the end user and your application.</span></span>

<span data-ttu-id="2e3d6-138">在此层, 您不关心数据本身, 而不是向最终用户呈现的方式。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-138">At this tier you're not concerned with the data itself, other than how it's presented to the end user.</span></span> <span data-ttu-id="2e3d6-139">通常情况下, 此层中不会发生数据处理或数据访问。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-139">Typically there is no data processing or data access that is happening at this tier.</span></span> <span data-ttu-id="2e3d6-140">这是较低层的责任。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-140">This is the responsibility of the lower tiers.</span></span>

### <a name="application-tier"></a><span data-ttu-id="2e3d6-141">应用层</span><span class="sxs-lookup"><span data-stu-id="2e3d6-141">Application tier</span></span>

<span data-ttu-id="2e3d6-142">应用程序层 (也通常称为中间层) 通常侧重于处理应用程序的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-142">The application tier (also often called the middle tier) typically focuses on handling the business logic of the application.</span></span> <span data-ttu-id="2e3d6-143">这可能会处理客户订单、跟踪货物或根据收到的材料更新库存。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-143">This could be handling a customer order, tracking a shipment, or updating inventory based on materials received.</span></span> <span data-ttu-id="2e3d6-144">此层还负责创建、读取、更新、删除 (CRUD) 针对数据层的活动。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-144">This tier is also responsible for create, read, update, delete (CRUD) activities against the data tier.</span></span> <span data-ttu-id="2e3d6-145">这也是调用相关服务 (如外部 api) 的一个很有用的位置。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-145">This is also a good location to make calls to dependent services, such as external APIs.</span></span> 

<span data-ttu-id="2e3d6-146">此层不涉及信息如何呈现给用户, 也不关心数据的存储和检索方式。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-146">This tier isn't concerned with how the information is presented back to the user, nor is it concerned with how the data is stored and retrieved.</span></span> <span data-ttu-id="2e3d6-147">重点在于实现应用程序已收到的请求所需的业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-147">The focus is on the business logic required to fulfill the request that the application has received.</span></span>

### <a name="data-tier"></a><span data-ttu-id="2e3d6-148">数据层</span><span class="sxs-lookup"><span data-stu-id="2e3d6-148">Data tier</span></span>

<span data-ttu-id="2e3d6-149">在此层, 重点是在数据存储上。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-149">At this tier, the focus is on data storage.</span></span> <span data-ttu-id="2e3d6-150">存储在表、文件或其他媒体中的数据是此层的责任。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-150">Storage of the data in tables, files, or other medium is the responsibility of this tier.</span></span> <span data-ttu-id="2e3d6-151">此层提供一个接口 (如 t-sql) 来访问数据。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-151">This tier provides an interface (such as T-SQL) to access the data.</span></span> <span data-ttu-id="2e3d6-152">在三层体系结构中, 数据层提供对应用层的数据访问。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-152">In a three-tier architecture, the data layer provides data access to the application tier.</span></span>

<span data-ttu-id="2e3d6-153">该层不侧重于向用户呈现数据的方式, 也不重点关注数据周围的任何逻辑。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-153">This tier is not focused on how the data is presented to the user, nor is it focused on any logic around the data.</span></span> <span data-ttu-id="2e3d6-154">存储过程的使用可能在该层中, 但在更高层上应处理数据本身的大多数逻辑。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-154">The usage of stored procedures may sit in this tier, but most of the logic around the data itself should be handled at a higher tier.</span></span>

## <a name="when-to-use-n-tier-architectures"></a><span data-ttu-id="2e3d6-155">何时使用 N 层体系结构</span><span class="sxs-lookup"><span data-stu-id="2e3d6-155">When to use N-tier architectures</span></span>

<span data-ttu-id="2e3d6-156">至此, 我们已经讨论了 N 层体系结构是什么, 我们来讨论何时应使用此样式的体系结构。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-156">Now that we've talked about what an N-tier architecture is, let's discuss when would you use an architecture of this style.</span></span> <span data-ttu-id="2e3d6-157">考虑以下各项的 N 层体系结构:</span><span class="sxs-lookup"><span data-stu-id="2e3d6-157">Consider an N-tier architecture for:</span></span>

- <span data-ttu-id="2e3d6-158">小型到中型 web 应用程序</span><span class="sxs-lookup"><span data-stu-id="2e3d6-158">Small to medium-sized web applications</span></span>
- <span data-ttu-id="2e3d6-159">使用最少的重构将本地应用程序迁移到 Azure</span><span class="sxs-lookup"><span data-stu-id="2e3d6-159">Migrating an on-premises application to Azure with minimal refactoring</span></span>
- <span data-ttu-id="2e3d6-160">利用技能集和开发人员功能, 实现内部部署开发体验</span><span class="sxs-lookup"><span data-stu-id="2e3d6-160">Leveraging skill sets and developer capabilities with on premises dev experience</span></span>

<span data-ttu-id="2e3d6-161">Web 应用程序对于此样式的体系结构来说是一个很有用的用例。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-161">Web applications are a good use case for architectures of this style.</span></span> <span data-ttu-id="2e3d6-162">由于这种体系结构样式的复杂性较低, 并且在 web 应用程序中的责任之间通常是自然分离的, 因此 N 层体系结构可能很好地发挥作用。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-162">Because of the reduced complexity of this architectural style, and the often natural separation between responsibilities in web applications, N-tier architectures may work well.</span></span> <span data-ttu-id="2e3d6-163">这些应用程序可以是面向公众的应用程序, 也可以是组织内部使用的业务线应用程序。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-163">These could be public facing applications, or line-of-business applications used internally by an organization.</span></span> <span data-ttu-id="2e3d6-164">对于较小或不太复杂的应用程序, 双层 (客户端/服务器) 体系结构可能足够, 而不是采用单独的演示文稿和应用层进行组合。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-164">For smaller or less complex applications, a two-tier (client/server) architecture might be sufficient, with the presentation and application tiers combined instead of separated.</span></span>

<span data-ttu-id="2e3d6-165">N 层体系结构在传统的本地应用程序中很常见, 因此它自然适合将现有工作负载迁移到 Azure。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-165">N-tier architectures are common in traditional on-premises applications, so it's a natural fit for migrating existing workloads to Azure.</span></span> <span data-ttu-id="2e3d6-166">此样式中的应用程序通常通过最少的重构或修改迁移到 Azure, 从而简化了初始迁移。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-166">Applications in this style are often migrated to Azure with minimal refactoring or modifications, simplifying the initial migration.</span></span> <span data-ttu-id="2e3d6-167">在 Azure 上, 您可以利用平台即服务 (PaaS) 服务来进一步改进您的应用程序。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-167">Once on Azure, you can take advantage of platform-as-a-service (PaaS) services to further improve your application.</span></span>

<span data-ttu-id="2e3d6-168">由于这是一种常见的体系结构样式, 因此工程师通常具有更高级别的体验, 并对其进行了熟悉。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-168">Since this is a common architectural style, engineers often have a higher level of experience and familiarity with it.</span></span> <span data-ttu-id="2e3d6-169">通过选择此体系结构, 您可以使用现有技能集部署应用程序, 而无需向上斜向新的体系结构模式进行斜向。</span><span class="sxs-lookup"><span data-stu-id="2e3d6-169">By choosing this architecture, you can use  existing skill sets to deploy applications without ramping up on new architectural patterns.</span></span> 