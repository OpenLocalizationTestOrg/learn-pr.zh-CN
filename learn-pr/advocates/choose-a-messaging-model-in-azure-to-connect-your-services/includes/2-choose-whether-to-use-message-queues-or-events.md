假设您正在规划分布式音乐共享应用程序的体系结构。 您希望确保应用程序的可靠性和可伸缩性尽可能可靠, 并且您打算使用 Azure 技术构建可靠的通信基础结构。

在选择正确的 Azure 技术之前, 必须了解应用程序的组件交换的各个通信。 对于每个通信, 你可以选择不同的 Azure 技术。

了解通信的第一件事就是发送**邮件**还是**事件**。 这是一种基本选择, 可帮助您选择要使用的适当的 Azure 服务。

#### <a name="communication-strategies-in-azure-apis"></a>Azure 中的通信策略 (api)

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yuaw]

## <a name="what-is-a-message"></a>什么是邮件？
在分布式应用程序的术语中,**邮件**具有以下特征:

- 邮件包含由一个组件生成的、将由另一个组件使用的原始数据。
- 邮件包含数据本身, 而不仅仅是对该数据的引用。
- 发送组件要求以某种方式通过目标组件处理邮件内容。 整个系统的完整性可能取决于发件人和接收器执行特定作业。

例如, 假设用户使用移动音乐共享应用上传新歌曲。 移动应用必须将该歌曲发送到在 Azure 中运行的 web API。 歌曲媒体文件本身必须发送, 而不只是指示已添加新歌曲的通知。 移动应用程序要求 web API 将新歌曲存储在数据库中, 并使其可供其他用户使用。 这是一封邮件的示例。

## <a name="what-is-an-event"></a>什么是事件？

**事件**比邮件的重量轻, 最常用于广播通信。 发送事件的组件称为 "**发布者**", 而接收器称为 "**订阅者**"。

使用事件时, 接收组件通常会决定他们感兴趣的通信, 并将 "订阅" 这些人。 订阅通常由中介管理, 如 azure 事件网格或 azure 事件中心。 当发布服务器发送事件时, 中间会将该事件路由到感兴趣的订阅者。 这称为 "发布-订阅体系结构"。 这并不是处理事件的唯一方法, 但它是最常见的方法。

事件具有以下特征:

- 事件是一个轻量通知, 指示发生了什么情况。
- 该事件可能会发送给多个接收器, 或根本无法发送到 "无"。
- 事件通常用于 "扇出", 或者每个发布者拥有大量订阅者。
- 事件发布者没有预期接收组件所采用的操作。
- 有些事件是离散的单元, 与其他事件无关。 
- 有些事件是相关和已排序系列的一部分。  

例如, 假设已完成音乐文件上传, 并且已将新歌曲添加到数据库中。 为了向用户通知新文件, web API 必须通知 web 前端和移动应用用户新文件。 用户可以选择是否收听新歌曲, 因此初始通知不会包含音乐文件, 而只会通知用户该歌曲存在。 发件人没有特定的预期, 事件接收器将在接收此事件的响应中执行任何特定的操作。

这是一个离散事件的示例。

## <a name="how-to-choose-messages-or-events"></a>如何选择邮件或事件

单个应用程序可能会将事件用于某些用途和其他信息。 在选择之前, 必须分析应用程序的体系结构及其所有用例, 以确定其组件必须相互通信的所有不同用途。

事件更有可能用于广播, 并且通常是暂时的, 这意味着如果没有当前订阅, 则任何接收器都不会处理通信。 在分布式应用程序要求保证通信将得到处理的情况下, 更有可能使用消息。

对于每种通信, 请考虑以下问题:**发送组件是否希望通过特定方式处理目标组件的通信？**

如果答案为 _"是"_, 请选择使用消息。 如果答案为 "_否_", 则可能可以使用事件。

了解你的组件需要进行通信的方式将有助于你选择组件的通信方式。 让我们从邮件开始。