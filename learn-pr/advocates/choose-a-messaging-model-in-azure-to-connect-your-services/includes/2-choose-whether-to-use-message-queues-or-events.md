<span data-ttu-id="cdfcd-101">假设您正在规划分布式音乐共享应用程序的体系结构。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-101">Suppose you are planning the architecture of a distributed music-sharing application.</span></span> <span data-ttu-id="cdfcd-102">您希望确保应用程序的可靠性和可伸缩性尽可能可靠, 并且您打算使用 Azure 技术构建可靠的通信基础结构。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-102">You want to ensure that the application is as reliable and scalable as possible, and you intend to use Azure technologies to build a robust communication infrastructure.</span></span>

<span data-ttu-id="cdfcd-103">在选择正确的 Azure 技术之前, 必须了解应用程序的组件交换的各个通信。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-103">Before you can choose the right Azure technology, you must understand each individual communication that the components of the application exchange.</span></span> <span data-ttu-id="cdfcd-104">对于每个通信, 你可以选择不同的 Azure 技术。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-104">For each communication you can choose a different Azure technology.</span></span>

<span data-ttu-id="cdfcd-105">了解通信的第一件事就是发送**邮件**还是**事件**。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-105">The first thing to understand about a communication is whether it sends **messages** or **events**.</span></span> <span data-ttu-id="cdfcd-106">这是一种基本选择, 可帮助您选择要使用的适当的 Azure 服务。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-106">This is a fundamental choice that will help you choose the appropriate Azure service to use.</span></span>

#### <a name="communication-strategies-in-azure-apis"></a><span data-ttu-id="cdfcd-107">Azure 中的通信策略 (api)</span><span class="sxs-lookup"><span data-stu-id="cdfcd-107">Communication strategies in Azure (APIs)</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yuaw]

## <a name="what-is-a-message"></a><span data-ttu-id="cdfcd-108">什么是邮件？</span><span class="sxs-lookup"><span data-stu-id="cdfcd-108">What is a message?</span></span>
<span data-ttu-id="cdfcd-109">在分布式应用程序的术语中,**邮件**具有以下特征:</span><span class="sxs-lookup"><span data-stu-id="cdfcd-109">In the terminology of distributed applications, **messages** have the following characteristics:</span></span>

- <span data-ttu-id="cdfcd-110">邮件包含由一个组件生成的、将由另一个组件使用的原始数据。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-110">A message contains raw data, produced by one component, that will be consumed by another component.</span></span>
- <span data-ttu-id="cdfcd-111">邮件包含数据本身, 而不仅仅是对该数据的引用。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-111">A message contains the data itself, not just a reference to that data.</span></span>
- <span data-ttu-id="cdfcd-112">发送组件要求以某种方式通过目标组件处理邮件内容。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-112">The sending component expects the message content to be processed in a certain way by the destination component.</span></span> <span data-ttu-id="cdfcd-113">整个系统的完整性可能取决于发件人和接收器执行特定作业。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-113">The integrity of the overall system may depend on both sender and receiver doing a specific job.</span></span>

<span data-ttu-id="cdfcd-114">例如, 假设用户使用移动音乐共享应用上传新歌曲。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-114">For example, suppose a user uploads a new song by using the mobile music-sharing app.</span></span> <span data-ttu-id="cdfcd-115">移动应用必须将该歌曲发送到在 Azure 中运行的 web API。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-115">The mobile app must send that song to the web API that runs in Azure.</span></span> <span data-ttu-id="cdfcd-116">歌曲媒体文件本身必须发送, 而不只是指示已添加新歌曲的通知。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-116">The song media file itself must be sent, not just an alert that indicates that a new song has been added.</span></span> <span data-ttu-id="cdfcd-117">移动应用程序要求 web API 将新歌曲存储在数据库中, 并使其可供其他用户使用。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-117">The mobile app expects that the web API will store the new song in the database and make it available to other users.</span></span> <span data-ttu-id="cdfcd-118">这是一封邮件的示例。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-118">This is an example of a message.</span></span>

## <a name="what-is-an-event"></a><span data-ttu-id="cdfcd-119">什么是事件？</span><span class="sxs-lookup"><span data-stu-id="cdfcd-119">What is an event?</span></span>

<span data-ttu-id="cdfcd-120">**事件**比邮件的重量轻, 最常用于广播通信。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-120">**Events** are lighter weight than messages, and are most often used for broadcast communications.</span></span> <span data-ttu-id="cdfcd-121">发送事件的组件称为 "**发布者**", 而接收器称为 "**订阅者**"。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-121">The components sending the event are known as **publishers**, and receivers are known as **subscribers**.</span></span>

<span data-ttu-id="cdfcd-122">使用事件时, 接收组件通常会决定他们感兴趣的通信, 并将 "订阅" 这些人。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-122">With events, receiving components will generally decide in which communications they are interested, and will "subscribe" to those.</span></span> <span data-ttu-id="cdfcd-123">订阅通常由中介管理, 如 azure 事件网格或 azure 事件中心。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-123">The subscription is usually managed by an intermediary, like Azure Event Grid or Azure Event Hubs.</span></span> <span data-ttu-id="cdfcd-124">当发布服务器发送事件时, 中间会将该事件路由到感兴趣的订阅者。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-124">When publishers send an event, the intermediary will route that event to interested subscribers.</span></span> <span data-ttu-id="cdfcd-125">这称为 "发布-订阅体系结构"。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-125">This is known as a "publish-subscribe architecture."</span></span> <span data-ttu-id="cdfcd-126">这并不是处理事件的唯一方法, 但它是最常见的方法。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-126">It's not the only way to deal with events, but it is the most common.</span></span>

<span data-ttu-id="cdfcd-127">事件具有以下特征:</span><span class="sxs-lookup"><span data-stu-id="cdfcd-127">Events have the following characteristics:</span></span>

- <span data-ttu-id="cdfcd-128">事件是一个轻量通知, 指示发生了什么情况。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-128">An event is a lightweight notification that indicates that something happened.</span></span>
- <span data-ttu-id="cdfcd-129">该事件可能会发送给多个接收器, 或根本无法发送到 "无"。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-129">The event may be sent to multiple receivers, or to none at all.</span></span>
- <span data-ttu-id="cdfcd-130">事件通常用于 "扇出", 或者每个发布者拥有大量订阅者。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-130">Events are often intended to "fan out," or have a large number of subscribers for each publisher.</span></span>
- <span data-ttu-id="cdfcd-131">事件发布者没有预期接收组件所采用的操作。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-131">The publisher of the event has no expectation about the action a receiving component takes.</span></span>
- <span data-ttu-id="cdfcd-132">有些事件是离散的单元, 与其他事件无关。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-132">Some events are discrete units and unrelated to other events.</span></span> 
- <span data-ttu-id="cdfcd-133">有些事件是相关和已排序系列的一部分。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-133">Some events are part of a related and ordered series.</span></span>  

<span data-ttu-id="cdfcd-134">例如, 假设已完成音乐文件上传, 并且已将新歌曲添加到数据库中。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-134">For example, suppose the music file upload has been completed, and the new song has been added to the database.</span></span> <span data-ttu-id="cdfcd-135">为了向用户通知新文件, web API 必须通知 web 前端和移动应用用户新文件。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-135">In order to inform users of the new file, the web API must inform the web front end and mobile app users of the new file.</span></span> <span data-ttu-id="cdfcd-136">用户可以选择是否收听新歌曲, 因此初始通知不会包含音乐文件, 而只会通知用户该歌曲存在。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-136">The users can choose whether to listen to the new song, so the initial notification does not include the music file but only notifies users that the song exists.</span></span> <span data-ttu-id="cdfcd-137">发件人没有特定的预期, 事件接收器将在接收此事件的响应中执行任何特定的操作。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-137">The sender does not have a specific expectation that the event receivers will do anything particular in responsiveness of receiving this event.</span></span>

<span data-ttu-id="cdfcd-138">这是一个离散事件的示例。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-138">This is an example of a discrete event.</span></span>

## <a name="how-to-choose-messages-or-events"></a><span data-ttu-id="cdfcd-139">如何选择邮件或事件</span><span class="sxs-lookup"><span data-stu-id="cdfcd-139">How to choose messages or events</span></span>

<span data-ttu-id="cdfcd-140">单个应用程序可能会将事件用于某些用途和其他信息。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-140">A single application is likely to use events for some purposes and messages for others.</span></span> <span data-ttu-id="cdfcd-141">在选择之前, 必须分析应用程序的体系结构及其所有用例, 以确定其组件必须相互通信的所有不同用途。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-141">Before you choose, you must analyze your application's architecture and all its use cases, to identify all the different purposes where its components have to communicate with each other.</span></span>

<span data-ttu-id="cdfcd-142">事件更有可能用于广播, 并且通常是暂时的, 这意味着如果没有当前订阅, 则任何接收器都不会处理通信。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-142">Events are more likely to be used for broadcasts and are often ephemeral, meaning a communication might not be handled by any receiver if none are currently subscribing.</span></span> <span data-ttu-id="cdfcd-143">在分布式应用程序要求保证通信将得到处理的情况下, 更有可能使用消息。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-143">Messages are more likely to be used where the distributed application requires a guarantee that the communication will be processed.</span></span>

<span data-ttu-id="cdfcd-144">对于每种通信, 请考虑以下问题:**发送组件是否希望通过特定方式处理目标组件的通信？**</span><span class="sxs-lookup"><span data-stu-id="cdfcd-144">For each communication, consider the following question: **Does the sending component expect the communication to be processed in a particular way by the destination component?**</span></span>

<span data-ttu-id="cdfcd-145">如果答案为 _"是"_, 请选择使用消息。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-145">If the answer is _yes_, choose to use a message.</span></span> <span data-ttu-id="cdfcd-146">如果答案为 "_否_", 则可能可以使用事件。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-146">If the answer is _no_, you may be able to use events.</span></span>

<span data-ttu-id="cdfcd-147">了解你的组件需要进行通信的方式将有助于你选择组件的通信方式。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-147">Understanding how your components need to communicate will help you to choose how your components will communicate.</span></span> <span data-ttu-id="cdfcd-148">让我们从邮件开始。</span><span class="sxs-lookup"><span data-stu-id="cdfcd-148">Let's start with messages.</span></span>