<span data-ttu-id="876a2-101">高可用性 (HA) 可确保体系结构能够处理故障。</span><span class="sxs-lookup"><span data-stu-id="876a2-101">High availability (HA) ensures your architecture can handle failures.</span></span> <span data-ttu-id="876a2-102">假设您负责必须始终能够完全操作的系统。</span><span class="sxs-lookup"><span data-stu-id="876a2-102">Imagine you're responsible for a system that must be always fully operational.</span></span> <span data-ttu-id="876a2-103">可能会发生故障并将发生故障, 因此如何确保系统在出现问题时保持在线状态？</span><span class="sxs-lookup"><span data-stu-id="876a2-103">Failures can and will happen, so how do you ensure that your system can remain online when something goes wrong?</span></span> <span data-ttu-id="876a2-104">如何在不中断服务的情况下执行维护？</span><span class="sxs-lookup"><span data-stu-id="876a2-104">How do you perform maintenance without service interruption?</span></span> 

<span data-ttu-id="876a2-105">在这里, 你将了解高可用性的需求, 评估应用程序高可用性要求, 并了解 Azure 平台如何帮助你实现可用性目标。</span><span class="sxs-lookup"><span data-stu-id="876a2-105">Here, you'll learn the need for high availability, evaluate application high-availability requirements, and see how the Azure platform helps you meet your availability goals.</span></span>

## <a name="what-is-high-availability"></a><span data-ttu-id="876a2-106">高可用性是什么？</span><span class="sxs-lookup"><span data-stu-id="876a2-106">What is high availability?</span></span>

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE2yEvc]

<span data-ttu-id="876a2-107">高可用性服务是一项 absorbs 相关服务和硬件中的可用性、负载和临时故障的变化的服务。</span><span class="sxs-lookup"><span data-stu-id="876a2-107">A highly-available service is a service that absorbs fluctuations in availability, load, and temporary failures in dependent services and hardware.</span></span> <span data-ttu-id="876a2-108">在执行 acceptably 时, 应用程序仍保持联机并可用 (或保持其外观)。</span><span class="sxs-lookup"><span data-stu-id="876a2-108">The application remains online and available (or maintains the appearance of it) while performing acceptably.</span></span> <span data-ttu-id="876a2-109">此可用性通常由业务要求、服务级别目标或服务级别协议来定义。</span><span class="sxs-lookup"><span data-stu-id="876a2-109">This availability is often defined by business requirements, service-level objectives, or service-level agreements.</span></span>

<span data-ttu-id="876a2-110">高可用性最终是指处理系统组件的丢失或严重降级的能力。</span><span class="sxs-lookup"><span data-stu-id="876a2-110">High availability is ultimately about the ability to handle the loss or severe degradation of a component of a system.</span></span> <span data-ttu-id="876a2-111">这可能是因为主机发生故障, 托管应用程序将脱机的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="876a2-111">This might be due to a virtual machine that's hosting an application going offline because the host failed.</span></span> <span data-ttu-id="876a2-112">这可能是由于系统升级计划的维护造成的。</span><span class="sxs-lookup"><span data-stu-id="876a2-112">It could be due to planned maintenance for a system upgrade.</span></span> <span data-ttu-id="876a2-113">它甚至可能是由云中的服务故障导致的。</span><span class="sxs-lookup"><span data-stu-id="876a2-113">It could even be caused by the failure of a service in the cloud.</span></span> <span data-ttu-id="876a2-114">确定系统可能发生故障的地方, 并构建用于处理这些故障的功能, 将确保您为客户提供的服务可以保持在线。</span><span class="sxs-lookup"><span data-stu-id="876a2-114">Identifying the places where your system can fail, and building in the capabilities to handle those failures, will ensure that the services you offer to your customers can stay online.</span></span>

<span data-ttu-id="876a2-115">服务的高可用性通常需要构成服务的组件的高可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-115">High availability of a service typically requires high availability of the components that make up the service.</span></span> <span data-ttu-id="876a2-116">考虑提供在线市场以购买项目的网站。</span><span class="sxs-lookup"><span data-stu-id="876a2-116">Think of a website that offers an online marketplace to purchase items.</span></span> <span data-ttu-id="876a2-117">向客户提供的服务是能够在联机状态下列出、购买和销售项目的功能。</span><span class="sxs-lookup"><span data-stu-id="876a2-117">The service that's offered to your customers is the ability to list, buy, and sell items online.</span></span> <span data-ttu-id="876a2-118">若要提供此服务, 您将拥有多个组件: 数据库、web 服务器、应用程序服务器等。</span><span class="sxs-lookup"><span data-stu-id="876a2-118">To provide this service, you'll have multiple components: a database, web servers, application servers, and so on.</span></span> <span data-ttu-id="876a2-119">这些组件中的每一个都可能会失败, 因此您必须确定故障点的方式和位置, 并确定如何在体系结构中解决这些故障点。</span><span class="sxs-lookup"><span data-stu-id="876a2-119">Each of these components could fail, so you have to identify how and where  your failure points are, and determine how to address these failure points in your architecture.</span></span>

## <a name="evaluate-high-availability-for-your-architecture"></a><span data-ttu-id="876a2-120">评估体系结构的高可用性</span><span class="sxs-lookup"><span data-stu-id="876a2-120">Evaluate high availability for your architecture</span></span>

<span data-ttu-id="876a2-121">评估应用程序的高可用性的步骤有三个:</span><span class="sxs-lookup"><span data-stu-id="876a2-121">There are three steps to evaluate an application for high availability:</span></span>

1. <span data-ttu-id="876a2-122">确定应用程序的服务级别协议</span><span class="sxs-lookup"><span data-stu-id="876a2-122">Determine the service-level agreement of your application</span></span>
1. <span data-ttu-id="876a2-123">评估应用程序的 HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-123">Evaluate the HA capabilities of the application</span></span>
1. <span data-ttu-id="876a2-124">评估依赖应用程序的 HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-124">Evaluate the HA capabilities of dependent applications</span></span>

<span data-ttu-id="876a2-125">让我们详细了解这些步骤。</span><span class="sxs-lookup"><span data-stu-id="876a2-125">Let's explore these steps in detail.</span></span>

### <a name="determine-the-service-level-agreement-of-your-application"></a><span data-ttu-id="876a2-126">确定应用程序的服务级别协议</span><span class="sxs-lookup"><span data-stu-id="876a2-126">Determine the service-level agreement of your application</span></span>

<span data-ttu-id="876a2-127">服务级别协议 (SLA) 是服务提供商和服务使用者之间的一种协议, 服务提供商根据可衡量的指标和定义的责任向服务提供商提交标准服务。</span><span class="sxs-lookup"><span data-stu-id="876a2-127">A service-level agreement (SLA) is an agreement between a service provider and a service consumer in which the service provider commits to a standard of service based on measurable metrics and defined responsibilities.</span></span> <span data-ttu-id="876a2-128">sla 可以是严格、法律约束、合同协议或预期的客户的预期可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-128">SLAs can be strict, legally bound, contractual agreements, or assumed expectations of availability by customers.</span></span> <span data-ttu-id="876a2-129">服务指标通常重点关注服务吞吐量、容量和可用性, 所有这些都可以通过多种方式衡量。</span><span class="sxs-lookup"><span data-stu-id="876a2-129">Service metrics typically focus on service throughput, capacity, and availability, all of which can be measured in various ways.</span></span> <span data-ttu-id="876a2-130">无论构成 sla 的具体指标如何, 如果无法满足 sla, 都可能会对服务提供商产生严重的财务后果。</span><span class="sxs-lookup"><span data-stu-id="876a2-130">Regardless of the specific metrics that make up the SLA, failure to meet the SLA can have serious financial ramifications for the service provider.</span></span> <span data-ttu-id="876a2-131">服务协议的一个公用组件保证了财务补偿, 缺少 sla。</span><span class="sxs-lookup"><span data-stu-id="876a2-131">A common component of service agreements is guaranteed financial reimbursement for missed SLAs.</span></span>

<span data-ttu-id="876a2-132">服务级别目标 (SLO) 是用于衡量性能、可靠性或可用性的目标指标的值。</span><span class="sxs-lookup"><span data-stu-id="876a2-132">Service-level objectives (SLO) are the values of target metrics that are used to measure performance, reliability, or availability.</span></span> <span data-ttu-id="876a2-133">这些指标可以是定义请求处理性能的指标 (以毫秒为单位)、服务的可用性 (每月分钟数) 或每小时处理的请求数。</span><span class="sxs-lookup"><span data-stu-id="876a2-133">These could be metrics defining the performance of request processing in milliseconds, the availability of services in minutes per month, or the number of requests processed per hour.</span></span> <span data-ttu-id="876a2-134">通过评估您的应用程序公开的指标并了解客户用作质量指标的指标, 您可以为这些 slo 定义可接受和不可接受的范围。</span><span class="sxs-lookup"><span data-stu-id="876a2-134">By evaluating the metrics exposed by your application and understanding what customers use as a measure of quality, you can define the acceptable and unacceptable ranges for these SLOs.</span></span> <span data-ttu-id="876a2-135">通过定义这些目标, 可以清楚地为支持使用这些服务的服务和客户的团队设置目标和期望。</span><span class="sxs-lookup"><span data-stu-id="876a2-135">By defining these objectives, you clearly set goals and expectations with both the teams supporting the services and customers who are consuming these services.</span></span> <span data-ttu-id="876a2-136">这些 slo 将用于确定是否符合你的总体 SLA。</span><span class="sxs-lookup"><span data-stu-id="876a2-136">These SLOs will be used to determine if your overall SLA is being met.</span></span>

<span data-ttu-id="876a2-137">下表显示了各种 SLA 级别可能造成的累积故障时间。</span><span class="sxs-lookup"><span data-stu-id="876a2-137">The following table shows the potential cumulative downtime for various SLA levels.</span></span> 

| <span data-ttu-id="876a2-138">SLA</span><span class="sxs-lookup"><span data-stu-id="876a2-138">SLA</span></span> | <span data-ttu-id="876a2-139">每周停机时间</span><span class="sxs-lookup"><span data-stu-id="876a2-139">Downtime per week</span></span> | <span data-ttu-id="876a2-140">每月停机时间</span><span class="sxs-lookup"><span data-stu-id="876a2-140">Downtime per month</span></span> | <span data-ttu-id="876a2-141">每年停机时间</span><span class="sxs-lookup"><span data-stu-id="876a2-141">Downtime per year</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="876a2-142">99%</span><span class="sxs-lookup"><span data-stu-id="876a2-142">99%</span></span> |<span data-ttu-id="876a2-143">1.68 小时</span><span class="sxs-lookup"><span data-stu-id="876a2-143">1.68 hours</span></span> |<span data-ttu-id="876a2-144">7.2 小时</span><span class="sxs-lookup"><span data-stu-id="876a2-144">7.2 hours</span></span> |<span data-ttu-id="876a2-145">3.65 天</span><span class="sxs-lookup"><span data-stu-id="876a2-145">3.65 days</span></span> |
| <span data-ttu-id="876a2-146">99.9%</span><span class="sxs-lookup"><span data-stu-id="876a2-146">99.9%</span></span> |<span data-ttu-id="876a2-147">10.1 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-147">10.1 minutes</span></span> |<span data-ttu-id="876a2-148">43.2 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-148">43.2 minutes</span></span> |<span data-ttu-id="876a2-149">8.76 小时</span><span class="sxs-lookup"><span data-stu-id="876a2-149">8.76 hours</span></span> |
| <span data-ttu-id="876a2-150">99.95%</span><span class="sxs-lookup"><span data-stu-id="876a2-150">99.95%</span></span> |<span data-ttu-id="876a2-151">5分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-151">5 minutes</span></span> |<span data-ttu-id="876a2-152">21.6 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-152">21.6 minutes</span></span> |<span data-ttu-id="876a2-153">4.38 小时</span><span class="sxs-lookup"><span data-stu-id="876a2-153">4.38 hours</span></span> |
| <span data-ttu-id="876a2-154">99.99%</span><span class="sxs-lookup"><span data-stu-id="876a2-154">99.99%</span></span> |<span data-ttu-id="876a2-155">1.01 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-155">1.01 minutes</span></span> |<span data-ttu-id="876a2-156">4.32 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-156">4.32 minutes</span></span> |<span data-ttu-id="876a2-157">52.56 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-157">52.56 minutes</span></span> |
| <span data-ttu-id="876a2-158">99.999%</span><span class="sxs-lookup"><span data-stu-id="876a2-158">99.999%</span></span> |<span data-ttu-id="876a2-159">6秒</span><span class="sxs-lookup"><span data-stu-id="876a2-159">6 seconds</span></span> |<span data-ttu-id="876a2-160">25.9 秒</span><span class="sxs-lookup"><span data-stu-id="876a2-160">25.9 seconds</span></span> |<span data-ttu-id="876a2-161">5.26 分钟</span><span class="sxs-lookup"><span data-stu-id="876a2-161">5.26 minutes</span></span> |

<span data-ttu-id="876a2-162">当然, 可用性越高越好, 其他一切都是相等的。</span><span class="sxs-lookup"><span data-stu-id="876a2-162">Of course, higher availability is better, everything else being equal.</span></span> <span data-ttu-id="876a2-163">但是, 随着您在努力实现更多的 9, 成本和复杂性可实现该级别的可用性增长。</span><span class="sxs-lookup"><span data-stu-id="876a2-163">But as you strive for more 9s, the cost and complexity to achieve that level of availability grows.</span></span> <span data-ttu-id="876a2-164">99.99% 的正常运行时间约为每月总停机时间的5分钟。</span><span class="sxs-lookup"><span data-stu-id="876a2-164">An uptime of 99.99% translates to about 5 minutes of total downtime per month.</span></span> <span data-ttu-id="876a2-165">是否值得将额外的复杂性和成本推向五个9？</span><span class="sxs-lookup"><span data-stu-id="876a2-165">Is it worth the additional complexity and cost to reach five 9s?</span></span> <span data-ttu-id="876a2-166">答案取决于业务要求。</span><span class="sxs-lookup"><span data-stu-id="876a2-166">The answer depends on the business requirements.</span></span> 

<span data-ttu-id="876a2-167">以下是定义 SLA 时的一些其他注意事项:</span><span class="sxs-lookup"><span data-stu-id="876a2-167">Here are some other considerations when defining an SLA:</span></span>

* <span data-ttu-id="876a2-168">若要实现四个 9 (99.99%), 您可能无法依靠手动干预从故障中恢复。</span><span class="sxs-lookup"><span data-stu-id="876a2-168">To achieve four 9's (99.99%), you probably can't rely on manual intervention to recover from failures.</span></span> <span data-ttu-id="876a2-169">应用程序必须是自诊断和自我修复。</span><span class="sxs-lookup"><span data-stu-id="876a2-169">The application must be self-diagnosing and self-healing.</span></span> 
* <span data-ttu-id="876a2-170">除了四个 9, 更难快速检测出故障以满足 SLA 要求。</span><span class="sxs-lookup"><span data-stu-id="876a2-170">Beyond four 9's, it is challenging to detect outages quickly enough to meet the SLA.</span></span>
* <span data-ttu-id="876a2-171">考虑评估 SLA 所依据的时间范围。</span><span class="sxs-lookup"><span data-stu-id="876a2-171">Think about the time window that your SLA is measured against.</span></span> <span data-ttu-id="876a2-172">窗口越小, 公差越紧密。</span><span class="sxs-lookup"><span data-stu-id="876a2-172">The smaller the window, the tighter the tolerances.</span></span> <span data-ttu-id="876a2-173">在每小时或每日正常运行时间定义 SLA 可能不是很有意义的。</span><span class="sxs-lookup"><span data-stu-id="876a2-173">It probably doesn't make sense to define your SLA in terms of hourly or daily uptime.</span></span> 

<span data-ttu-id="876a2-174">确定您的体系结构将需要的高可用性功能时, 确定 sla 是重要的首要步骤。</span><span class="sxs-lookup"><span data-stu-id="876a2-174">Identifying SLAs is an important first step when determining the high availability capabilities that your architecture will require.</span></span> <span data-ttu-id="876a2-175">这些方法将帮助您将用来使应用程序高度可用的方法进行整形。</span><span class="sxs-lookup"><span data-stu-id="876a2-175">These will help shape the methods you'll use to make your application highly available.</span></span>

### <a name="evaluate-the-ha-capabilities-of-the-application"></a><span data-ttu-id="876a2-176">评估应用程序的 HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-176">Evaluate the HA capabilities of the application</span></span>

<span data-ttu-id="876a2-177">若要评估应用程序的 HA 功能, 请执行故障分析。</span><span class="sxs-lookup"><span data-stu-id="876a2-177">To evaluate the HA capabilities of your application, perform a failure analysis.</span></span> <span data-ttu-id="876a2-178">重点关注单个故障点和关键组件, 这些组件对应用程序的访问、配置不当或启动行为意外导致的影响较大。</span><span class="sxs-lookup"><span data-stu-id="876a2-178">Focus on single points of failure and critical components that would have a large impact on the application if they were unreachable, misconfigured, or started behaving unexpectedly.</span></span> <span data-ttu-id="876a2-179">对于具有冗余的区域, 确定应用程序是否能够检测错误条件和自我修复。</span><span class="sxs-lookup"><span data-stu-id="876a2-179">For areas that do have redundancy, determine whether the application is capable of detecting error conditions and self-healing.</span></span>

<span data-ttu-id="876a2-180">您需要仔细评估应用程序的所有组件, 包括旨在提供 HA 功能的部分, 如负载平衡器。</span><span class="sxs-lookup"><span data-stu-id="876a2-180">You'll need to carefully evaluate all components of your application, including the pieces designed to provide HA functionality, such as load balancers.</span></span> <span data-ttu-id="876a2-181">需要修改单一故障点, 以使 HA 功能集成, 或者需要将其替换为可提供 ha 功能的服务。</span><span class="sxs-lookup"><span data-stu-id="876a2-181">Single points of failure will either need to be modified to have HA capabilities integrated, or will need to be replaced with services that can provide HA capabilities.</span></span>

### <a name="evaluate-the-ha-capabilities-of-dependent-applications"></a><span data-ttu-id="876a2-182">评估依赖应用程序的 HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-182">Evaluate the HA capabilities of dependent applications</span></span>

<span data-ttu-id="876a2-183">您不仅需要了解您的应用程序对您的使用者的 sla 要求, 还需要了解应用程序可能依赖的任何资源的提供 sla。</span><span class="sxs-lookup"><span data-stu-id="876a2-183">You'll need to understand not only your application's SLA requirements to your consumer, but also the provided SLAs of any resource that your application may depend on.</span></span> <span data-ttu-id="876a2-184">如果要向客户提交 99.9% 的正常运行时间, 但您的应用程序所依赖的服务的运行时间承诺仅为 99%, 这可能导致您无法满足您的客户 SLA 的风险。</span><span class="sxs-lookup"><span data-stu-id="876a2-184">If you are committing an uptime to your customers of 99.9%, but a service your application depends on only has an uptime commitment of 99%, this could put you at risk of not meeting your SLA to your customers.</span></span> <span data-ttu-id="876a2-185">如果依赖服务无法提供足够的 sla, 您可能需要修改您自己的 sla, 将依赖项替换为替代项, 或者在依赖项不可用时查找符合 SLA 的方法。</span><span class="sxs-lookup"><span data-stu-id="876a2-185">If a dependent service is unable to provide a sufficient SLA, you may need to modify your own SLA, replace the dependency with an alternative, or find ways to meet your SLA while the dependency is unavailable.</span></span> <span data-ttu-id="876a2-186">根据方案和依赖项的性质, 可以暂时使用类似于缓存和工作队列的解决方案来解决依赖项的故障。</span><span class="sxs-lookup"><span data-stu-id="876a2-186">Depending on the scenario and the nature of the dependency, failing dependencies can be temporarily worked around with solutions like caches and work queues.</span></span>

## <a name="azures-highly-available-platform"></a><span data-ttu-id="876a2-187">Azure 的高可用性平台</span><span class="sxs-lookup"><span data-stu-id="876a2-187">Azure's highly available platform</span></span>

<span data-ttu-id="876a2-188">Azure 云平台设计为可在其所有服务中提供高可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-188">The Azure cloud platform has been designed to provide high availability throughout all its services.</span></span> <span data-ttu-id="876a2-189">与任何系统一样, 应用程序可能受硬件和软件平台事件的影响。</span><span class="sxs-lookup"><span data-stu-id="876a2-189">Like any system, applications may be affected by both hardware and software platform events.</span></span> <span data-ttu-id="876a2-190">设计应用程序体系结构以处理故障的需求非常关键, Azure 云平台为您提供了使应用程序高度可用的工具和功能。</span><span class="sxs-lookup"><span data-stu-id="876a2-190">The need to design your application architecture to handle failures is critical, and the Azure cloud platform provides you with the tools and capabilities to make your application highly available.</span></span> <span data-ttu-id="876a2-191">在为 Azure 上的体系结构考虑 HA 时, 有以下几个核心概念:</span><span class="sxs-lookup"><span data-stu-id="876a2-191">There are several core concepts when considering HA for your architecture on Azure:</span></span>

* <span data-ttu-id="876a2-192">可用性集</span><span class="sxs-lookup"><span data-stu-id="876a2-192">Availability sets</span></span>
* <span data-ttu-id="876a2-193">可用性区域</span><span class="sxs-lookup"><span data-stu-id="876a2-193">Availability zones</span></span>
* <span data-ttu-id="876a2-194">负载平衡</span><span class="sxs-lookup"><span data-stu-id="876a2-194">Load balancing</span></span>
* <span data-ttu-id="876a2-195">平台即服务 (PaaS) HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-195">Platform as a service (PaaS) HA capabilities</span></span>

### <a name="availability-sets"></a><span data-ttu-id="876a2-196">可用性集</span><span class="sxs-lookup"><span data-stu-id="876a2-196">Availability sets</span></span>

<span data-ttu-id="876a2-197">可用性集是一种通知 Azure 的方法。应分发属于相同应用程序工作负荷的 vm, 以防止硬件故障和定期维护的并发影响。</span><span class="sxs-lookup"><span data-stu-id="876a2-197">Availability sets are a way for you to inform Azure that VMs that belong to the same application workload should be distributed to prevent simultaneous impact from hardware failure and scheduled maintenance.</span></span> <span data-ttu-id="876a2-198">可用性集由*更新域*和*容错域*组成。</span><span class="sxs-lookup"><span data-stu-id="876a2-198">Availability sets are made up of *update domains* and *fault domains*.</span></span>

![显示三个可用性集的插图。](../media/AzAvailSets.png)

<span data-ttu-id="876a2-201">更新域: 确保当虚拟机托管在 Azure 数据中心中时, 您的应用程序服务器的子集始终保持运行状态, 以便在维护时需要停机。</span><span class="sxs-lookup"><span data-stu-id="876a2-201">Update domains ensure that a subset of your application's servers always remain running when the virtual machine hosts in an Azure datacenter require downtime for maintenance.</span></span> <span data-ttu-id="876a2-202">大多数更新可以在不影响其上运行的 vm 的情况下执行, 但有时这是不可能的。</span><span class="sxs-lookup"><span data-stu-id="876a2-202">Most updates can be performed with no impact to the VMs running on them, but there are times when this isn't possible.</span></span> <span data-ttu-id="876a2-203">为了确保一次更新不会对整个数据中心进行更新, Azure 数据中心在逻辑上分为多个更新域 (UD)。</span><span class="sxs-lookup"><span data-stu-id="876a2-203">To ensure that updates don't happen to a whole datacenter at once, the Azure datacenter is logically sectioned into update domains (UD).</span></span> <span data-ttu-id="876a2-204">当需要将维护事件 (如性能更新和关键安全修补程序) 应用到主机时, 将通过更新域对更新进行排序。</span><span class="sxs-lookup"><span data-stu-id="876a2-204">When a maintenance event, such as a performance update and critical security patch that needs to be applied to the host, the update is sequenced through update domains.</span></span> <span data-ttu-id="876a2-205">使用更新域进行先后顺序更新可确保在平台更新和修补过程中整个数据中心不可用。</span><span class="sxs-lookup"><span data-stu-id="876a2-205">The use of sequencing updates using update domains ensures that the whole datacenter isn't unavailable during platform updates and patching.</span></span>

<span data-ttu-id="876a2-206">[! 说明] 当 update 域表示数据中心的逻辑部分时, 故障域 (FD) 表示数据中心的物理部分, 并确保在可用性集中的服务器的服务器多样性。</span><span class="sxs-lookup"><span data-stu-id="876a2-206">While update domains represent a logical section of the datacenter, fault domains (FD) represent physical sections of the datacenter and ensure rack diversity of servers in an availability set.</span></span> <span data-ttu-id="876a2-207">故障域与数据中心中共享硬件的物理分离相一致。</span><span class="sxs-lookup"><span data-stu-id="876a2-207">Fault domains align to the physical separation of shared hardware in the datacenter.</span></span> <span data-ttu-id="876a2-208">这包括支持位于服务器机架中的物理服务器的电源、冷却和网络硬件。</span><span class="sxs-lookup"><span data-stu-id="876a2-208">This includes power, cooling, and network hardware that supports the physical servers located in server racks.</span></span> <span data-ttu-id="876a2-209">如果支持服务器机架的硬件变得不可用, 则中断仅影响服务器机架。</span><span class="sxs-lookup"><span data-stu-id="876a2-209">In the event the hardware that supports a server rack has become unavailable, only that rack of servers would be affected by the outage.</span></span> <span data-ttu-id="876a2-210">通过将 vm 放在可用性集内, 你的 vm 将自动分布在多个 FDs 中, 以便在发生硬件故障时仅有部分 vm 将受到影响。</span><span class="sxs-lookup"><span data-stu-id="876a2-210">By placing your VMs in an availability set, your VMs will be automatically spread across multiple FDs so that in the event of a hardware failure only part of your VMs will be impacted.</span></span>

<span data-ttu-id="876a2-211">使用可用性集, 可以确保在需要高影响维护事件或发生硬件故障时, 您的应用程序保持在线。</span><span class="sxs-lookup"><span data-stu-id="876a2-211">With availability sets, you can ensure your application remains online if a high-impact maintenance event is required or hardware failures occur.</span></span>

### <a name="availability-zones"></a><span data-ttu-id="876a2-212">可用性区域</span><span class="sxs-lookup"><span data-stu-id="876a2-212">Availability zones</span></span>

<span data-ttu-id="876a2-213">可用性区域是区域内独立的物理数据中心位置, 包括其自己的电源、冷却和网络。</span><span class="sxs-lookup"><span data-stu-id="876a2-213">Availability zones are independent physical datacenter locations within a region that include their own power, cooling, and networking.</span></span> <span data-ttu-id="876a2-214">通过在部署资源时考虑可用性区域, 可以保护工作负载不受数据中心中断, 同时在特定区域保留状态。</span><span class="sxs-lookup"><span data-stu-id="876a2-214">By taking availability zones into account when deploying resources, you can protect workloads from datacenter outages while retaining presence in a particular region.</span></span> <span data-ttu-id="876a2-215">像虚拟机这样的服务是一种*区域性服务*, 允许您将它们部署到区域内的特定区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-215">Services like virtual machines are *zonal services* and allow you to deploy them to specific zones within a region.</span></span> <span data-ttu-id="876a2-216">其他服务是*区域冗余服务*, 将在特定 Azure 区域中的可用性区域之间进行复制。</span><span class="sxs-lookup"><span data-stu-id="876a2-216">Other services are *zone-redundant services* and will replicate across the availability zones in the specific Azure region.</span></span> <span data-ttu-id="876a2-217">这两种类型都可确保在 Azure 区域中没有单点故障。</span><span class="sxs-lookup"><span data-stu-id="876a2-217">Both types ensure that within an Azure region there are no single points of failure.</span></span>

![显示 Azure 区域中三个可用性区域的插图。](../media/AzAvailZones.png)

<span data-ttu-id="876a2-220">支持的区域至少包含三个可用性区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-220">Supported regions contain a minimum of three availability zones.</span></span> <span data-ttu-id="876a2-221">在这些区域中创建区域性服务资源时, 您将能够选择应在其中创建资源的区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-221">When creating zonal service resources in those regions, you'll have the ability to select the zone in which the resource should be created.</span></span> <span data-ttu-id="876a2-222">这将使您能够将应用程序设计为经受区域性中断, 并继续在 azure 区域中运行, 然后再将您的应用程序 evacuate 到另一个 azure 区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-222">This will allow you to design your application to withstand a zonal outage and continue to operate in an Azure region before having to evacuate your application to another Azure region.</span></span>

<span data-ttu-id="876a2-223">可用性区域是 Azure 区域的较新的高可用性配置服务, 目前可用于某些区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-223">Availability zones are a newer high availability configuration service for Azure regions and are currently available for certain regions.</span></span> <span data-ttu-id="876a2-224">如果您想要考虑此功能, 请务必在计划部署应用程序的区域中检查此服务的可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-224">It's important to check the availability of this service in the region that you're planning to deploy your application if you want to consider this functionality.</span></span> <span data-ttu-id="876a2-225">使用虚拟机以及多个 PaaS 服务时支持可用性区域。</span><span class="sxs-lookup"><span data-stu-id="876a2-225">Availability zones are supported when using virtual machines, as well as several PaaS services.</span></span> <span data-ttu-id="876a2-226">可用性区域与可用性集互斥。</span><span class="sxs-lookup"><span data-stu-id="876a2-226">Availability zones are mutually exclusive with availability sets.</span></span> <span data-ttu-id="876a2-227">使用可用性区域时, 不再需要为系统定义可用性集。</span><span class="sxs-lookup"><span data-stu-id="876a2-227">When using availability zones you no longer need to define an availability set for your systems.</span></span> <span data-ttu-id="876a2-228">你将在数据中心级别拥有多元化, 并且将永远不会对多个可用性区域同时执行更新。</span><span class="sxs-lookup"><span data-stu-id="876a2-228">You'll have diversity at the data center level, and updates will never be performed to multiple availability zones at the same time.</span></span>

### <a name="load-balancing"></a><span data-ttu-id="876a2-229">负载平衡</span><span class="sxs-lookup"><span data-stu-id="876a2-229">Load balancing</span></span>

<span data-ttu-id="876a2-230">负载平衡器管理如何在应用程序中分布网络流量。</span><span class="sxs-lookup"><span data-stu-id="876a2-230">Load balancers manage how network traffic is distributed across an application.</span></span> <span data-ttu-id="876a2-231">负载平衡器对于保持应用程序对单个组件故障的恢复能力非常重要, 并确保应用程序可用于处理请求。</span><span class="sxs-lookup"><span data-stu-id="876a2-231">Load balancers are essential in keeping your application resilient to individual component failures and to ensure your application is available to process requests.</span></span> <span data-ttu-id="876a2-232">对于未内置服务发现的应用程序, 可用性集和可用性区域都需要负载平衡。</span><span class="sxs-lookup"><span data-stu-id="876a2-232">For applications that don't have service discovery built in, load balancing is required for both availability sets and availability zones.</span></span>

<span data-ttu-id="876a2-233">Azure 拥有三种负载平衡技术服务, 它们在功能上不同于路由网络流量:</span><span class="sxs-lookup"><span data-stu-id="876a2-233">Azure possesses three load balancing technology services that are distinct in their abilities to route network traffic:</span></span>

* <span data-ttu-id="876a2-234">**Azure 流量管理器**提供全局 DNS 负载平衡。</span><span class="sxs-lookup"><span data-stu-id="876a2-234">**Azure Traffic Manager** provides global DNS load balancing.</span></span> <span data-ttu-id="876a2-235">您可以考虑使用流量管理器在 Azure 区域内或跨 Azure 区域提供 DNS 终结点的负载平衡。</span><span class="sxs-lookup"><span data-stu-id="876a2-235">You would consider using Traffic Manager to provide load balancing of DNS endpoints within or across Azure regions.</span></span> <span data-ttu-id="876a2-236">流量管理器会将请求分发到可用终结点, 并使用终结点监视来检测和删除加载失败的终结点。</span><span class="sxs-lookup"><span data-stu-id="876a2-236">Traffic manager will distribute requests to available endpoints, and use endpoint monitoring to detect and remove failed endpoints from load.</span></span>
* <span data-ttu-id="876a2-237">**Azure 应用程序网关**提供了第7层负载平衡功能, 如传入流量的循环分布、基于 cookie 的会话相关性、基于 URL 路径的路由以及在单个应用程序中托管多个网站的功能应用程序网关。</span><span class="sxs-lookup"><span data-stu-id="876a2-237">**Azure Application Gateway** provides Layer 7 load-balancing capabilities, such as round-robin distribution of incoming traffic, cookie-based session affinity, URL path-based routing, and the ability to host multiple websites behind a single application gateway.</span></span> <span data-ttu-id="876a2-238">[! 注意] 默认情况下, 应用程序网关监视其后端池中所有资源的运行状况, 并自动从池中删除任何被视为不正常的资源。</span><span class="sxs-lookup"><span data-stu-id="876a2-238">Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span></span> <span data-ttu-id="876a2-239">应用程序网关继续监视不正常的实例, 并在这些实例变为可用后再将它们重新添加到正常的后端池, 并对运行状况探测器做出响应。</span><span class="sxs-lookup"><span data-stu-id="876a2-239">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span></span>
* <span data-ttu-id="876a2-240">**Azure 负载平衡器**是第4层负载平衡器。</span><span class="sxs-lookup"><span data-stu-id="876a2-240">**Azure Load Balancer** is a layer 4 load balancer.</span></span> <span data-ttu-id="876a2-241">您可以配置公共和内部负载平衡终结点, 并定义规则, 以使用 TCP 和 HTTP 运行状况探测选项来映射到后端池目标的入站连接, 以管理服务可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-241">You can configure public and internal load-balanced endpoints and define rules to map inbound connections to back-end pool destinations by using TCP and HTTP health-probing options to manage service availability.</span></span>

<span data-ttu-id="876a2-242">这三种 Azure 负载平衡技术的一个或多个组合可确保您有必要的选项可用于构建高可用性解决方案, 以通过应用程序路由网络流量。</span><span class="sxs-lookup"><span data-stu-id="876a2-242">One or a combination of all three Azure load-balancing technologies can ensure you have the necessary options available to architect a highly available solution to route network traffic through your application.</span></span>

![azure 负载平衡 optionsAn 图显示了 Azure 中的不同负载平衡技术。](../media/AzLBOptions.png)

### <a name="paas-ha-capabilities"></a><span data-ttu-id="876a2-248">PaaS HA 功能</span><span class="sxs-lookup"><span data-stu-id="876a2-248">PaaS HA capabilities</span></span>

<span data-ttu-id="876a2-249">提供的 PaaS 服务具有内置的高可用性。</span><span class="sxs-lookup"><span data-stu-id="876a2-249">PaaS services come with high availability built in.</span></span> <span data-ttu-id="876a2-250">azure SQL Database、azure App Service 和 azure Service Bus 等服务包括高可用性功能, 并确保服务的单个组件的故障对您的应用程序是无缝的。</span><span class="sxs-lookup"><span data-stu-id="876a2-250">Services such as Azure SQL Database, Azure App Service, and Azure Service Bus include high availability features and ensure that failures of an individual component of the service will be seamless to your application.</span></span> <span data-ttu-id="876a2-251">使用 PaaS 服务是确保体系结构高度可用的最佳方法之一。</span><span class="sxs-lookup"><span data-stu-id="876a2-251">Using PaaS services is one of the best ways to ensure that your architecture is highly available.</span></span>

<span data-ttu-id="876a2-252">在构建高可用性时, 您需要了解提交给客户的 SLA。</span><span class="sxs-lookup"><span data-stu-id="876a2-252">When architecting for high availability, you'll want to understand the SLA that you're committing to your customers.</span></span> <span data-ttu-id="876a2-253">然后, 评估您的应用程序具有的 ha 功能以及依赖系统的 ha 功能和 sla。</span><span class="sxs-lookup"><span data-stu-id="876a2-253">Then evaluate both the HA capabilities that your application has, and the HA capabilities and SLAs of dependent systems.</span></span> <span data-ttu-id="876a2-254">建立这些功能之后, 请使用 Azure 功能 (如可用性集、可用性区域和各种负载平衡技术) 将 HA 功能添加到应用程序中。</span><span class="sxs-lookup"><span data-stu-id="876a2-254">After those have been established, use Azure features, such as availability sets, availability zones, and various load-balancing technologies, to add HA capabilities to your application.</span></span> <span data-ttu-id="876a2-255">应选择使用的任何 PaaS 服务都具有内置的 HA 功能。</span><span class="sxs-lookup"><span data-stu-id="876a2-255">Any PaaS services you should choose to use will have HA capabilities built in.</span></span>
