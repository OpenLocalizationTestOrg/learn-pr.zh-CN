备份是针对永久性数据丢失的最终和最强大的防御线。 有效的备份策略不只需要制作数据副本。 它需要将您的应用程序的数据体系结构和基础结构考虑在内。 您的应用程序可以管理不同重要性的多种类型的数据, 广泛分布于文件系统、数据库以及在云中和本地的其他存储服务中。 如果需要还原备份, 则使用适当的服务和产品可简化备份过程, 并增加恢复时间。

## <a name="establish-backup-and-restoration-requirements"></a>建立备份和还原要求

与灾难恢复策略一样, 备份要求基于成本效益分析。 应通过应用管理的不同数据类别的相对重要性以及外部要求 (如数据保留法律) 来指导您的应用程序数据的分析。

若要为应用程序建立备份要求, 请根据以下要求对应用程序的数据进行分组:

* 此类数据中的多少可承受损失, 以持续时间度量
* 此类型数据的还原所需的最长时间
* 备份保留要求: 备份需要保持的时间和频率是否保持可用

这些概念整齐地映射到恢复点目标和恢复时间目标 (RPO 和 RTO) 的概念。 可接受丢失的持续时间通常将直接转换为所需的备份间隔和 RPO。 还原所需的最长时间与应用程序的数据组件的 RTO 相对应。 这两个要求都应相对于实现它们的成本来开发。 每个组织都希望说他们确实无法承受丢失*任何*数据, 但通常情况下, 在考虑达到该要求的成本时不会出现这种情况。

Backup 在灾难恢复 (DR) 中绝对扮演了一个角色, 但备份、还原及其关联的方案超出了 DR 的范围。 可能需要在非灾难情况下还原备份, 包括在不考虑 RTO 和 RPO 的情况下进行备份。 例如, 如果较少的备份间隔的数据已损坏或被删除, 但应用程序不会经历停机时间, 则应用程序可能永远不会出现丢失 SLA 的危险, 并且成功的还原将导致数据丢失。 灾难恢复计划可能包括也可能不包括在非灾难情况下执行还原的指南。

> [!TIP]
> 请勿混淆*存档*、*复制*和*备份*。 存档是用于长期保留和读取访问的数据存储。 复制是副本之间的数据的近乎实时复制, 以支持高可用性和特定的灾难恢复方案。 某些要求 (如数据保留法律) 可能会影响所有三个问题的策略。 存档、复制和备份都需要单独的分析和实现。

## <a name="azure-backup-and-restore-capabilities"></a>Azure 备份和还原功能

azure 为各种方案提供了多个与备份相关的服务和功能, 包括 Azure 和本地数据中的数据。 大多数 Azure 服务都提供了某种备份功能。 在这里, 我们将介绍一些与备份相关的最受欢迎的 Azure 产品。

### <a name="azure-backup"></a>Azure 备份

Azure backup 是一系列备份产品, 用于将数据备份到 Azure 恢复服务电子仓库以实现存储和恢复。 恢复服务电子仓库是 Azure 中的存储资源, 专用于存放虚拟机、服务器和各个工作站和工作负载的数据和配置备份。

> [!NOTE]
> azure Backup 和 azure Site Recovery 都使用 Azure 恢复服务保管库进行存储。 Azure backup 是一种通用的备份解决方案。 Azure Site Recovery 可以协调复制和故障转移, 并支持较低的 RPO 和 RTO 灾难恢复操作。

Azure Backup 可用作在 vm 或物理服务器上运行的云和本地工作流的常规用途的备份解决方案。 它旨在作为将数据存储在 Azure 中 (而不是存档磁带或其他本地物理媒体) 的传统备份解决方案的放置替代项。

四种不同的产品和服务可使用 Azure 备份创建备份:

* **Azure Backup 代理**是一个小型 Windows 应用程序, 它从安装了的 windows VM 或服务器备份文件、文件夹和系统状态。 它的工作方式类似于许多基于用户云的备份解决方案, 但需要 Azure 恢复电子仓库的配置。 下载并将其安装到 Windows server 或 VM 后, 可以将其配置为一天的三次创建备份。
* **System Center Data Protection Manager**是一个功能强大且功能全面的企业级备份和恢复系统。 Data Protection Manager 是一种 Windows Server 应用程序, 它可以备份文件系统和虚拟机 (Windows 和 Linux), 创建物理服务器的裸机备份, 并对许多 Microsoft 服务器产品 (如 SQL) 执行应用程序感知备份。服务器和 Exchange。 Data Protection Manager 是 system center 产品系列的一部分, 使用 system center 进行授权和销售, 但它被视为 azure 备份系列的一部分, 因为它可以将备份存储在 azure 恢复保管库中。
* **azure Backup Server**类似于数据保护管理器, 但它被授权为 Azure 订阅的一部分, 不需要 System Center 许可证。 除了本地磁带备份和与其他 System Center 产品集成之外, Azure Backup Server 还支持与数据保护管理器相同的功能。
* **azure IaaS VM 备份**是 Azure 虚拟机的全包式备份和还原功能。 VM 备份支持 Windows 和 Linux 虚拟机的每日一次性备份。 它支持单个文件、完整磁盘和整个虚拟机的恢复, 还可以执行与应用程序一致的备份。 可以让单个应用程序了解备份操作, 并使其文件系统资源处于一致状态, 然后再执行快照。

![显示配置了恢复保管库和 azure 虚拟机备份的 azure 备份代理的插图。 备份代理和 Azure 虚拟机备份将所有数据保存到恢复保管库。](../media/azure-backup.png)

Azure Backup 可以为适用于所有规模和形状的 IaaS 和本地应用程序添加价值并参与备份和还原策略。

### <a name="azure-blob-storage"></a>Azure Blob 存储

Azure 存储不包括自动备份功能, 但 blob 通常用于备份各种源中的所有类型的数据。 许多提供备份功能的服务使用 blob 存储其数据, 而 blob 是各种备份方案中的脚本和工具的常见目标。

常规用途 v2 存储帐户支持三种不同的 blob 存储层, 性能和成本各不相同。 **酷**存储为大多数备份提供了最佳的性能比率 (相对于**热**存储), 这可提供较低的访问成本, 但存储成本更高。 **存档**层存储可能适用于辅助备份或数据备份, 对恢复时间不是很低的预期。 成本较低, 但需要最长15小时的时间来访问。

不可擦除的可变 blob 存储不可擦除且不可修改用户指定的时间间隔。 不可变 blob 存储主要用于满足某些类型的数据 (如财务数据) 的严格要求。 这是一个很好的选择, 可确保备份受到保护以防止意外删除或修改。

### <a name="azure-sql-database"></a>Azure SQL 数据库

全面的自动备份功能包含在 Azure SQL 数据库中, 无需额外收费。 每周创建一次完整备份, 每12个小时执行一次差异备份, 每5分钟创建一次日志备份。 通过服务创建的备份可用于将数据库还原到特定的时间点, 即使已将其删除也是如此。 可以使用 Azure 门户、PowerShell 或 REST API 执行还原。 默认情况下, 使用透明数据加密 (默认情况下启用) 加密的数据库备份也会进行加密。

SQL 数据库备份是企业级、生产就绪和默认启用的。 如果要评估应用程序的不同数据库选项, 它应作为成本效益分析的一部分包括在内, 因为它是服务的重要优势。 使用 Azure SQL 数据库的每个应用程序都应通过将其包含在灾难恢复计划和备份/还原过程中来利用它。

### <a name="azure-app-service"></a>Azure 应用服务

托管在 Azure 应用服务标准和高级层中的 Web 应用程序支持全包式计划和手动备份。 备份包括配置和文件内容, 以及应用程序使用的数据库的内容。 它们还支持用于排除文件的简单筛选器。 还原操作可面向不同的应用程序服务实例, 使应用程序服务恢复为将一个应用的内容移动到另一个应用程序的简单方法。

app Service 备份的总数限制为 10 GB, 包括应用程序和数据库内容。 对于开发和小规模应用程序中的新应用来说, 它们是一个很棒的解决方案。 更成熟的应用程序通常不会使用应用服务备份。 它们将依赖于强健的部署和回滚过程、不使用应用程序磁盘存储的存储策略以及针对数据库和永久存储的专用备份策略。

## <a name="verify-backups-and-test-restore-procedures"></a>验证备份和测试还原过程

没有备份系统完成, 没有验证备份和测试还原过程的策略。 即使您使用的是专用的备份服务或产品, 仍应记录和实践恢复过程, 以确保他们能够充分理解并将系统恢复到预期状态。

验证备份的策略各不相同, 取决于基础结构的性质。 您可能需要考虑一些技术, 例如, 创建应用程序的新部署, 将备份还原到该部署, 并比较这两个实例的状态。 在很多情况下, 此技术会对实际的灾难恢复过程进行认真模拟。 只需在创建备份后立即对实时数据执行备份数据子集的比较即可。 备份验证的常见组件是尝试还原旧的备份, 以确保它们仍可用且正常运行, 并且备份系统不能以呈现它们不兼容的方式进行更改。

在尝试从灾难恢复时, 任何策略都比找出备份损坏或不完整的过程更好。

备份和还原策略是确保体系结构可以从数据丢失或损坏中恢复的重要部分。 检查您的体系结构以定义备份和还原要求。 Azure 提供了几种服务和功能, 可为任何体系结构提供备份和还原功能。
