<span data-ttu-id="4573b-101">为实现高可用性进行设计有助于让应用程序或进程在有不利的事件和负面条件的情况时保持运行。</span><span class="sxs-lookup"><span data-stu-id="4573b-101">Designing for high availability helps keep an application or process running despite unfavorable events and adverse conditions.</span></span> <span data-ttu-id="4573b-102">但是, 如果出现过多的数据而导致您的应用程序和进程无法继续运行, 您该怎么办？</span><span class="sxs-lookup"><span data-stu-id="4573b-102">But what do you do when something so significant happens that you've lost data and it's impossible to keep your apps and processes from going down?</span></span> <span data-ttu-id="4573b-103">灾难发生时, 您需要制定一个计划, 让服务再次运行。</span><span class="sxs-lookup"><span data-stu-id="4573b-103">When disaster strikes, you need to have a plan to get your services running again.</span></span> <span data-ttu-id="4573b-104">您应了解要恢复的目标和预期、您的计划的成本和限制以及您的计划的执行方式和限制。</span><span class="sxs-lookup"><span data-stu-id="4573b-104">You should know what your goals and expectations are for recovering, what are the costs and limitations of your plan, and how to execute on it.</span></span>

## <a name="what-is-disaster-recovery"></a><span data-ttu-id="4573b-105">什么是灾难恢复？</span><span class="sxs-lookup"><span data-stu-id="4573b-105">What is disaster recovery?</span></span>

<span data-ttu-id="4573b-106">灾难恢复是指从导致宕机和数据丢失的*影响较大的事件中恢复*。</span><span class="sxs-lookup"><span data-stu-id="4573b-106">Disaster recovery is about *recovering from high-impact events* that result in downtime and data loss.</span></span> <span data-ttu-id="4573b-107">灾难是单一的主要事件, 其影响大大增加且长期, 而不是应用程序可以通过其设计的高可用性部分进行缓解。</span><span class="sxs-lookup"><span data-stu-id="4573b-107">A disaster is a single, major event with an impact much larger and long-lasting than the application can mitigate through the high-availability portion of its design.</span></span>

<span data-ttu-id="4573b-108">"灾难" 一词通常 evokes*自然*灾难和外部事件 (地震、洪水、tropical 风暴等) 的想法, 但也存在许多其他类型的灾难。</span><span class="sxs-lookup"><span data-stu-id="4573b-108">The word "disaster" often evokes thoughts of *natural* disasters and external events (earthquakes, floods, tropical storms, and so on) but many other kinds of disasters exist as well.</span></span> <span data-ttu-id="4573b-109">失败的部署或升级可能会使应用程序处于无法识别的状态。</span><span class="sxs-lookup"><span data-stu-id="4573b-109">A failed deployment or upgrade can leave an app in an unrecognizable state.</span></span> <span data-ttu-id="4573b-110">恶意黑客可以加密或删除数据, 并对使某个应用程序脱机或消除某些功能的其他种类的损坏造成损害。</span><span class="sxs-lookup"><span data-stu-id="4573b-110">Malicious hackers can encrypt or delete data and inflict other kinds of damage that take an app offline or eliminate some of its functionality.</span></span>

<span data-ttu-id="4573b-111">无论其原因如何, 发生灾难的最佳补救措施是定义完善的、经过测试的灾难恢复计划, 以及在其设计中主动支持灾难恢复工作的应用程序。</span><span class="sxs-lookup"><span data-stu-id="4573b-111">Regardless of its cause, the best remedy for a disaster once it has occurred is a well-defined, tested disaster recovery plan and an application that actively supports disaster recovery efforts through its design.</span></span>

## <a name="how-to-create-a-disaster-recovery-plan"></a><span data-ttu-id="4573b-112">如何创建灾难恢复计划</span><span class="sxs-lookup"><span data-stu-id="4573b-112">How to create a disaster recovery plan</span></span>

<span data-ttu-id="4573b-113">灾难恢复计划是一个文档, 该文档详细介绍了从灾难导致的数据丢失和停机中恢复所需的过程, 并确定将这些过程定向到谁负责。</span><span class="sxs-lookup"><span data-stu-id="4573b-113">A disaster recovery plan is a single document that details the procedures that are required to recover from data loss and downtime caused by a disaster, and identifies who's in charge of directing those procedures.</span></span> <span data-ttu-id="4573b-114">在灾难发生之后, 操作员应能够使用计划作为恢复应用程序连接和恢复数据的一种手动方式。</span><span class="sxs-lookup"><span data-stu-id="4573b-114">Operators should be able to use the plan as a manual to restore application connectivity and recover data after a disaster occurs.</span></span> <span data-ttu-id="4573b-115">专用于灾难恢复的一个详细的书面计划对于确保理想的结果至关重要。</span><span class="sxs-lookup"><span data-stu-id="4573b-115">A detailed, written plan that's dedicated to disaster recovery is critical to ensuring a favorable outcome.</span></span> <span data-ttu-id="4573b-116">创建计划的过程将有助于组合应用程序的完整图。</span><span class="sxs-lookup"><span data-stu-id="4573b-116">The process of creating the plan will help to assemble a complete picture of the application.</span></span> <span data-ttu-id="4573b-117">在灾难事件的 panicked、chaotic aftermath 中, 生成的编写步骤将促进良好的决策制定和跟进。</span><span class="sxs-lookup"><span data-stu-id="4573b-117">The resulting written steps will promote good decision-making and follow-through in the panicked, chaotic aftermath of a disaster event.</span></span>

<span data-ttu-id="4573b-118">创建灾难恢复计划需要具备对应用程序工作流、数据、基础结构和依赖项的专业知识。</span><span class="sxs-lookup"><span data-stu-id="4573b-118">Creating a disaster recovery plan requires expert knowledge of the application's workflows, data, infrastructure, and dependencies.</span></span>

### <a name="risk-assessment-and-process-inventory"></a><span data-ttu-id="4573b-119">风险评估和处理清单</span><span class="sxs-lookup"><span data-stu-id="4573b-119">Risk assessment and process inventory</span></span>

<span data-ttu-id="4573b-120">创建灾难恢复计划的第一步是执行风险分析, 以检查应用程序中不同类型的灾难的影响。</span><span class="sxs-lookup"><span data-stu-id="4573b-120">The first step in creating a disaster recovery plan is performing a risk analysis that examines the impact of different kinds of disasters on the application.</span></span> <span data-ttu-id="4573b-121">灾难的确切性质并不像其数据丢失和应用程序停机造成的潜在影响那样重要。</span><span class="sxs-lookup"><span data-stu-id="4573b-121">The exact nature of a disaster isn't as important to the risk analysis as its potential impact through data loss and application downtime.</span></span> <span data-ttu-id="4573b-122">探索各种假设的灾难并在考虑其效果时尽量具体。</span><span class="sxs-lookup"><span data-stu-id="4573b-122">Explore various kinds of hypothetical disasters and try to be specific when thinking about their effects.</span></span> <span data-ttu-id="4573b-123">例如, 目标恶意攻击可能会修改产生与地震不同的代码或数据, 而不会影响网络连接和数据中心可用性。</span><span class="sxs-lookup"><span data-stu-id="4573b-123">For example, a targeted malicious attack may modify code or data that results in a different kind of impact than an earthquake that disrupts network connectivity and datacenter availability.</span></span>

<span data-ttu-id="4573b-124">风险评估需要考虑*每个*无法无限期停机的过程, 以及无法承受无限损失的每个数据类别。</span><span class="sxs-lookup"><span data-stu-id="4573b-124">The risk assessment needs to consider *every* process that can't afford unlimited downtime, and every category of data that can't afford unlimited loss.</span></span> <span data-ttu-id="4573b-125">在影响多个应用程序组件的灾难发生时, 计划所有者可以使用计划来充分了解需要注意的事项以及如何设置每个项目的优先级, 这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="4573b-125">When a disaster that affects multiple application components occurs, it's critical that the plan owners can use the plan to take a complete inventory of what needs attention and how to prioritize each item.</span></span>

<span data-ttu-id="4573b-126">某些应用程序可能仅构成数据的单个过程或分类。</span><span class="sxs-lookup"><span data-stu-id="4573b-126">Some apps may only constitute a single process or classification of data.</span></span> <span data-ttu-id="4573b-127">请务必注意这一点, 因为应用程序可能是更大灾难恢复计划中的一个组件, 其中包括多个组织的应用程序。</span><span class="sxs-lookup"><span data-stu-id="4573b-127">This is still important to note, as the application will likely be one component of a larger disaster recovery plan that includes multiple applications with the organization.</span></span>

### <a name="recovery-objectives"></a><span data-ttu-id="4573b-128">恢复目标</span><span class="sxs-lookup"><span data-stu-id="4573b-128">Recovery objectives</span></span>

<span data-ttu-id="4573b-129">完整的计划需要为应用程序实现的每个进程指定两个关键的业务要求:</span><span class="sxs-lookup"><span data-stu-id="4573b-129">A complete plan needs to specify two critical business requirements for each process implemented by the application:</span></span>

* <span data-ttu-id="4573b-130">**恢复点目标 (RPO)**: 可接受数据丢失的最长持续时间。</span><span class="sxs-lookup"><span data-stu-id="4573b-130">**Recovery Point Objective (RPO)**: The maximum duration of acceptable data loss.</span></span> <span data-ttu-id="4573b-131">RPO 以时间单位计量, 而不是按卷: "30 分钟的数据"、"四个小时的数据" 等。</span><span class="sxs-lookup"><span data-stu-id="4573b-131">RPO is measured in units of time, not volume: "30 minutes of data", "four hours of data", and so on.</span></span> <span data-ttu-id="4573b-132">RPO 是关于限制和恢复数据*丢失*, 而不是数据*泄露*。</span><span class="sxs-lookup"><span data-stu-id="4573b-132">RPO is about limiting and recovering from data *loss*, not data *theft*.</span></span>
* <span data-ttu-id="4573b-133">**恢复时间目标 (RTO)**: 可接受停机时间的最长持续时间, 其中 "停机时间" 需要由你的规范定义。</span><span class="sxs-lookup"><span data-stu-id="4573b-133">**Recovery Time Objective (RTO)**: The maximum duration of acceptable downtime, where "downtime" needs to be defined by your specification.</span></span> <span data-ttu-id="4573b-134">例如, 如果灾难发生时可接受的停机时间为8小时, 则 RTO 为8小时。</span><span class="sxs-lookup"><span data-stu-id="4573b-134">For example, if the acceptable downtime duration is eight hours in the event of a disaster, then your RTO is eight hours.</span></span>

![图中显示恢复点目标和灾难恢复时间目标的持续时间 (以小时为单位)。](../media/rto-rpo.png)

<span data-ttu-id="4573b-136">应用程序实现的每个主要进程或工作负荷应具有单独的 RPO 和 RTO 值。</span><span class="sxs-lookup"><span data-stu-id="4573b-136">Each major process or workload that's implemented by an app should have separate RPO and RTO values.</span></span> <span data-ttu-id="4573b-137">即使您为不同的进程提供了相同的值, 也应通过单独的分析来生成每个进程, 以检查灾难方案风险和每个各自的过程的潜在恢复策略。</span><span class="sxs-lookup"><span data-stu-id="4573b-137">Even if you arrive at the same values for different processes, each one should be generated through a separate analysis that examines disaster scenario risks and potential recovery strategies for each respective process.</span></span>

<span data-ttu-id="4573b-138">指定 RPO 和 RTO 的过程实际上是创建应用程序的灾难恢复要求的过程。</span><span class="sxs-lookup"><span data-stu-id="4573b-138">The process of specifying an RPO and RTO is effectively the creation of disaster recovery requirements for your application.</span></span> <span data-ttu-id="4573b-139">它要求制定每个工作负载和数据类别的优先级, 并执行成本效益分析。</span><span class="sxs-lookup"><span data-stu-id="4573b-139">It requires establishing the priority of each workload and category of data and performing a cost-benefit analysis.</span></span> <span data-ttu-id="4573b-140">分析包括一些顾虑, 如实施和维护成本、运营费用、处理开销、性能影响, 以及停机时间和丢失数据的影响。</span><span class="sxs-lookup"><span data-stu-id="4573b-140">The analysis includes concerns, such as implementation and maintenance cost, operational expense, process overhead, performance impact, and the impact of downtime and lost data.</span></span> <span data-ttu-id="4573b-141">您需要为您的应用程序准确定义 "宕机" 的含义, 在某些情况下, 您可以为不同的功能级别建立不同的 RPO 和 RTO 值。</span><span class="sxs-lookup"><span data-stu-id="4573b-141">You'll need to define exactly what "downtime" means for your application, and in some cases, you may establish separate RPO and RTO values for different levels of functionality.</span></span> <span data-ttu-id="4573b-142">指定 RPO 和 RTO 不只是选择任意值。</span><span class="sxs-lookup"><span data-stu-id="4573b-142">Specifying RPO and RTO should be more than simply choosing arbitrary values.</span></span> <span data-ttu-id="4573b-143">灾难恢复计划的大部分价值都来自研究和分析, 以发现灾难的潜在影响和缓解风险的成本。</span><span class="sxs-lookup"><span data-stu-id="4573b-143">Much of the value of a disaster recovery plan comes from the research and analysis that goes into discovering the potential impact of a disaster and the cost of mitigating the risks.</span></span>

### <a name="detailing-recovery-steps"></a><span data-ttu-id="4573b-144">详细介绍恢复步骤</span><span class="sxs-lookup"><span data-stu-id="4573b-144">Detailing recovery steps</span></span>

<span data-ttu-id="4573b-145">最终计划应详细介绍应采取哪些步骤来还原丢失的数据和应用程序连接。</span><span class="sxs-lookup"><span data-stu-id="4573b-145">The final plan should go into detail about exactly what steps should be taken to restore lost data and application connectivity.</span></span> <span data-ttu-id="4573b-146">步骤通常包括有关以下内容的信息:</span><span class="sxs-lookup"><span data-stu-id="4573b-146">Steps often include information about:</span></span>

* <span data-ttu-id="4573b-147">**备份**: 创建的频率、位置, 以及如何从这些备份中还原数据。</span><span class="sxs-lookup"><span data-stu-id="4573b-147">**Backups**: How often they're created, where they're located, and how to restore data from them.</span></span>
* <span data-ttu-id="4573b-148">**数据副本**: 副本的数量和位置、复制数据的性质和一致性特征, 以及如何切换到不同的副本。</span><span class="sxs-lookup"><span data-stu-id="4573b-148">**Data replicas**: The number and locations of replicas, the nature and consistency characteristics of the replicated data, and how to switch over to a different replica.</span></span>
* <span data-ttu-id="4573b-149">**部署**: 如何执行部署、回滚的发生方式以及部署的故障方案。</span><span class="sxs-lookup"><span data-stu-id="4573b-149">**Deployments**: How deployments are executed, how rollbacks occur, and failure scenarios for deployments.</span></span>
* <span data-ttu-id="4573b-150">**基础结构**: 内部部署和云资源、网络基础结构和硬件清单。</span><span class="sxs-lookup"><span data-stu-id="4573b-150">**Infrastructure**: On-premises and cloud resources, network infrastructure, and hardware inventory.</span></span>
* <span data-ttu-id="4573b-151">**依赖项**: 应用程序使用的外部服务, 包括 sla 和联系信息。</span><span class="sxs-lookup"><span data-stu-id="4573b-151">**Dependencies**: External services that are used by the application, including SLAs and contact information.</span></span>
* <span data-ttu-id="4573b-152">**配置和通知**: 可设置为能够正常降低应用程序的标志或选项, 以及用于向用户通知应用程序影响的服务。</span><span class="sxs-lookup"><span data-stu-id="4573b-152">**Configuration and notification**: Flags or options that can be set to gracefully degrade the application, and services that are used to notify users of application impact.</span></span>

<span data-ttu-id="4573b-153">所需的确切步骤将很大程度上取决于应用程序的实施细节, 这使规划更新的重要性非常重要。</span><span class="sxs-lookup"><span data-stu-id="4573b-153">The exact steps that are required will depend heavily on implementation details of the app, making it important to keep the plan updated.</span></span> <span data-ttu-id="4573b-154">定期测试计划将有助于识别空缺和过时的部分。</span><span class="sxs-lookup"><span data-stu-id="4573b-154">Routinely testing the plan will help identify gaps and outdated sections.</span></span>

## <a name="designing-for-disaster-recovery"></a><span data-ttu-id="4573b-155">用于灾难恢复的设计</span><span class="sxs-lookup"><span data-stu-id="4573b-155">Designing for disaster recovery</span></span>

<span data-ttu-id="4573b-156">灾难恢复并不是一项自动功能。</span><span class="sxs-lookup"><span data-stu-id="4573b-156">Disaster recovery is not an automatic feature.</span></span> <span data-ttu-id="4573b-157">必须对其进行设计、构建和测试。</span><span class="sxs-lookup"><span data-stu-id="4573b-157">It must be designed, built, and tested.</span></span> <span data-ttu-id="4573b-158">需要支持稳定灾难恢复策略的应用程序必须从基本的灾难恢复中进行构建。</span><span class="sxs-lookup"><span data-stu-id="4573b-158">An app that needs to support a solid disaster recovery strategy must be built from the ground up with disaster recovery in mind.</span></span> <span data-ttu-id="4573b-159">Azure 提供了服务、功能和指南, 可帮助您创建支持灾难恢复的应用程序, 但你可以在设计中加入这些应用。</span><span class="sxs-lookup"><span data-stu-id="4573b-159">Azure offers services, features, and guidance to help you create apps that support disaster recovery, but it's up to you to include them in your design.</span></span>

<span data-ttu-id="4573b-160">用于灾难恢复的设计有两个主要问题:</span><span class="sxs-lookup"><span data-stu-id="4573b-160">Designing for disaster recovery has two main concerns:</span></span>

* <span data-ttu-id="4573b-161">**数据恢复**: 使用备份和复制来还原丢失的数据。</span><span class="sxs-lookup"><span data-stu-id="4573b-161">**Data recovery**: Using backups and replication to restore lost data.</span></span>
* <span data-ttu-id="4573b-162">**进程恢复**: 恢复服务和部署代码以从中断中恢复。</span><span class="sxs-lookup"><span data-stu-id="4573b-162">**Process recovery**: Recovering services and deploying code to recover from outages.</span></span>

### <a name="data-recovery-and-replication"></a><span data-ttu-id="4573b-163">数据恢复和复制</span><span class="sxs-lookup"><span data-stu-id="4573b-163">Data recovery and replication</span></span>

<span data-ttu-id="4573b-164">复制在多个数据存储副本之间重复存储数据。</span><span class="sxs-lookup"><span data-stu-id="4573b-164">Replication duplicates stored data between multiple data store replicas.</span></span> <span data-ttu-id="4573b-165">与*backup*(用于创建用于恢复的数据的长期、只读快照) 不同, 复制创建实时数据的实时或近乎实时的副本。</span><span class="sxs-lookup"><span data-stu-id="4573b-165">Unlike *backup*, which creates long-lived, read-only snapshots of data for use in recovery, replication creates real-time or near-real-time copies of live data.</span></span> <span data-ttu-id="4573b-166">复制的目标是使副本保持尽可能少的延迟, 同时保持应用程序响应。</span><span class="sxs-lookup"><span data-stu-id="4573b-166">The goal of replication is to keep replicas synchronized with as little latency as possible while maintaining application responsiveness.</span></span> <span data-ttu-id="4573b-167">复制是为实现高可用性和灾难恢复而设计的关键组件, 是生产级应用程序的常见功能。</span><span class="sxs-lookup"><span data-stu-id="4573b-167">Replication is a key component of designing for high availability and disaster recovery, and is a common feature of production-grade applications.</span></span>

<span data-ttu-id="4573b-168">通过执行*故障转移*, 可使用复制来缓解故障或不可访问的数据存储: 更改应用程序配置以将数据请求路由到工作副本。</span><span class="sxs-lookup"><span data-stu-id="4573b-168">Replication is used to mitigate a failed or unreachable data store by executing a *failover*: changing application configuration to route data requests to a working replica.</span></span> <span data-ttu-id="4573b-169">故障转移通常是自动进行的, 由内置于数据存储产品中的错误检测触发, 或者是通过监控解决方案实现的检测。</span><span class="sxs-lookup"><span data-stu-id="4573b-169">Failover is often automated, triggered by error detection built into a data storage product, or detection that you implement through your monitoring solution.</span></span> <span data-ttu-id="4573b-170">根据实现和方案, 可能需要由系统操作员手动执行故障转移。</span><span class="sxs-lookup"><span data-stu-id="4573b-170">Depending on the implementation and the scenario, failover may need to be manually executed by system operators.</span></span>

<span data-ttu-id="4573b-171">复制不是从头开始实施的内容。</span><span class="sxs-lookup"><span data-stu-id="4573b-171">Replication is not something you implement from scratch.</span></span> <span data-ttu-id="4573b-172">由于功能和性能要求, 大多数功能最重要的数据库系统和其他数据存储产品和服务包括一些复制, 这是一种紧密集成的功能。</span><span class="sxs-lookup"><span data-stu-id="4573b-172">Most fully featured database systems and other data storage products and services include some kind of replication as a tightly integrated feature due to its functional and performance requirements.</span></span> <span data-ttu-id="4573b-173">但是, 您可以在应用程序设计中包含这些功能, 并对它们进行适当的使用。</span><span class="sxs-lookup"><span data-stu-id="4573b-173">However, it's up to you to include these features in your application design and make appropriate use of them.</span></span>

<span data-ttu-id="4573b-174">不同的 Azure 服务支持复制的各种级别和概念。</span><span class="sxs-lookup"><span data-stu-id="4573b-174">Different Azure services support various levels and concepts of replication.</span></span> <span data-ttu-id="4573b-175">例如：</span><span class="sxs-lookup"><span data-stu-id="4573b-175">For example:</span></span>

* <span data-ttu-id="4573b-176">**Azure 存储**复制功能取决于为存储帐户选择的复制类型。</span><span class="sxs-lookup"><span data-stu-id="4573b-176">**Azure Storage** replication capabilities depend on the replication type of selected for the storage account.</span></span> <span data-ttu-id="4573b-177">此复制可以是本地的 (数据中心内)、区域性 (区域内的数据中心之间) 或区域 (区域之间)。</span><span class="sxs-lookup"><span data-stu-id="4573b-177">This replication can be local (within a datacenter), zonal (between data centers within a region), or regional (between regions).</span></span> <span data-ttu-id="4573b-178">您的应用程序和运算符都不直接与之进行交互。</span><span class="sxs-lookup"><span data-stu-id="4573b-178">Neither your application nor your operators interact with it directly.</span></span> <span data-ttu-id="4573b-179">故障转移是自动且透明的, 只需选择平衡成本和风险的复制级别即可。</span><span class="sxs-lookup"><span data-stu-id="4573b-179">Failovers are automatic and transparent, and you simply need to select a replication level that balances cost and risk.</span></span>
* <span data-ttu-id="4573b-180">**Azure SQL 数据库**复制在很小的范围内是自动进行的, 但从完整的 Azure 数据中心或区域中断恢复需要异地复制。</span><span class="sxs-lookup"><span data-stu-id="4573b-180">**Azure SQL Database** replication is automatic at a small scale, but recovery from a full Azure datacenter or regional outage requires geo-replication.</span></span> <span data-ttu-id="4573b-181">设置异地复制是手动进行的, 但它是服务的第一类功能, 并且文档受到充分支持。</span><span class="sxs-lookup"><span data-stu-id="4573b-181">Setting up geo-replication is manual, but it's a first-class feature of the service and well supported by documentation.</span></span>
* <span data-ttu-id="4573b-182">**Cosmos DB**是一个全局分布式数据库系统, 复制是其实现的中心。</span><span class="sxs-lookup"><span data-stu-id="4573b-182">**Cosmos DB** is a globally distributed database system, and replication is central to its implementation.</span></span> <span data-ttu-id="4573b-183">使用 Azure Cosmos DB, 不是直接配置复制, 而是配置与分区和数据一致性相关的选项。</span><span class="sxs-lookup"><span data-stu-id="4573b-183">With Azure Cosmos DB, instead of configuring replication directly, you configure options related to partitioning and data consistency.</span></span>

<span data-ttu-id="4573b-184">存在许多不同的复制设计, 它们对数据一致性、性能和成本进行了不同的优先级。</span><span class="sxs-lookup"><span data-stu-id="4573b-184">Many different replication designs exist that place different priorities on data consistency, performance, and cost.</span></span> <span data-ttu-id="4573b-185">*主动*复制需要更新以同时在多个副本上进行, 从而以吞吐量的成本来保证一致性。</span><span class="sxs-lookup"><span data-stu-id="4573b-185">*Active* replication requires updates to take place on multiple replicas simultaneously, guaranteeing consistency at the cost of throughput.</span></span> <span data-ttu-id="4573b-186">相比之下,*被动*复制在后台执行同步, 将复制作为对应用程序性能的限制进行删除, 但要提高 RPO。</span><span class="sxs-lookup"><span data-stu-id="4573b-186">In contrast, *passive* replication performs synchronization in the background, removing replication as a constraint on application performance, but increasing RPO.</span></span> <span data-ttu-id="4573b-187">*主动-主动*或*多主机*复制允许多个副本同时使用, 从而以降低数据一致性的成本实现负载平衡, 同时*主动-被动*复制保留副本用于实时仅在故障转移期间使用。</span><span class="sxs-lookup"><span data-stu-id="4573b-187">*Active-active* or *multi-master* replication enables multiple replicas to be used simultaneously, enabling load balancing at the cost of complicating data consistency, while *active-passive* replication reserves replicas for live use only during failover.</span></span>

![显示地理复制示例的插图。](../media/geo-replication.png)

> [!IMPORTANT]
> <span data-ttu-id="4573b-190">**复制和备份都不是完全独立的灾难恢复解决方案**。</span><span class="sxs-lookup"><span data-stu-id="4573b-190">**Neither replication nor backup are complete disaster recovery solutions on their own**.</span></span> <span data-ttu-id="4573b-191">数据恢复只是灾难恢复的一个组件, 并且复制将不会完全满足多种灾难恢复方案。</span><span class="sxs-lookup"><span data-stu-id="4573b-191">Data recovery is only one component of disaster recovery, and replication will not fully satisfy many kinds of disaster recovery scenarios.</span></span> <span data-ttu-id="4573b-192">例如, 在数据损坏的情况下, 损坏的性质可能允许它从主数据存储传播到副本, 从而使所有副本都毫无用处且需要备份以进行恢复。</span><span class="sxs-lookup"><span data-stu-id="4573b-192">For example, in a data corruption scenario, the nature of the corruption may allow it to spread from the primary data store to the replicas, rendering all the replicas useless and requiring a backup for recovery.</span></span>

### <a name="process-recovery"></a><span data-ttu-id="4573b-193">进程恢复</span><span class="sxs-lookup"><span data-stu-id="4573b-193">Process recovery</span></span>

<span data-ttu-id="4573b-194">灾难发生之后, 业务数据不是唯一需要恢复的资产。</span><span class="sxs-lookup"><span data-stu-id="4573b-194">After a disaster, business data isn't the only asset that needs recovering.</span></span> <span data-ttu-id="4573b-195">灾难方案通常也会导致停机, 无论是由于网络连接问题、数据中心中断还是虚拟机实例或软件部署损坏。</span><span class="sxs-lookup"><span data-stu-id="4573b-195">Disaster scenarios will also commonly result in downtime, whether it's due to network connectivity problems, datacenter outages, or damaged VM instances or software deployments.</span></span> <span data-ttu-id="4573b-196">您的应用程序的设计需要使您能够将其还原到工作状态。</span><span class="sxs-lookup"><span data-stu-id="4573b-196">The design of your application needs to enable you to restore it to a working state.</span></span>

<span data-ttu-id="4573b-197">在大多数情况下, 进程还原涉及到单独的工作部署的故障转移。</span><span class="sxs-lookup"><span data-stu-id="4573b-197">In most cases, process restoration involves failover to a separate, working deployment.</span></span> <span data-ttu-id="4573b-198">根据应用场景的不同, 地理位置可能是一个关键方面。</span><span class="sxs-lookup"><span data-stu-id="4573b-198">Depending on the scenario, geographic location may be a critical aspect.</span></span> <span data-ttu-id="4573b-199">例如, 将整个 Azure 区域脱机引入的大规模自然灾难将需要还原另一个区域中的服务。</span><span class="sxs-lookup"><span data-stu-id="4573b-199">For example, a large-scale natural disaster that brings an entire Azure region offline will necessitate restoring service in another region.</span></span> <span data-ttu-id="4573b-200">您的应用程序的灾难恢复要求 (尤其是 RTO) 应驱动您的设计, 并帮助您确定应拥有的复制环境的数量、应在哪里, 以及它们是应在准备运行状态下维护还是应准备好在发生灾难时接受部署。</span><span class="sxs-lookup"><span data-stu-id="4573b-200">Your application's disaster recovery requirements, especially RTO, should drive your design and help you decide how many replicated environments you should have, where they should be located, and whether they should be maintained in a ready-to-run state or should be ready to accept a deployment in the event of disaster.</span></span>

<span data-ttu-id="4573b-201">根据应用程序的设计, 您可以利用几种不同的策略和功能, 以改进应用程序在灾难发生后对进程恢复的支持。</span><span class="sxs-lookup"><span data-stu-id="4573b-201">Depending on the design of your application, there are a few different strategies and Azure services and features that you can take advantage of to improve your app's support for process recovery after a disaster.</span></span>

#### <a name="azure-site-recovery"></a><span data-ttu-id="4573b-202">Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="4573b-202">Azure Site Recovery</span></span>

<span data-ttu-id="4573b-203">Azure Site Recovery 是专门用于管理在部署到 Azure 的 vm、在物理服务器上运行的 vm 以及直接在物理服务器上运行的工作负荷的进程恢复的服务。</span><span class="sxs-lookup"><span data-stu-id="4573b-203">Azure Site Recovery is a service that's dedicated to managing process recovery for workloads running on VMs deployed to Azure, VMs running on physical servers, and workloads running directly on physical servers.</span></span> <span data-ttu-id="4573b-204">网站恢复将工作负荷复制到备用位置, 并在发生中断时帮助您进行故障转移, 并支持对灾难恢复计划进行测试。</span><span class="sxs-lookup"><span data-stu-id="4573b-204">Site Recovery replicates workloads to alternate locations and helps you to failover when an outage occurs and supports testing of a disaster recovery plan.</span></span>

![图中显示了 Azure site recovery 在将位于美国东部的三个虚拟机上的工作负荷复制到美国西部我们的角色。](../media/asr.png)

<span data-ttu-id="4573b-206">网站恢复支持复制整个 vm 和物理服务器映像以及单个*工作*负荷, 其中工作负荷可能是单个应用程序或整个 VM 或操作系统及其应用程序。</span><span class="sxs-lookup"><span data-stu-id="4573b-206">Site Recovery supports replicating whole VMs and physical server images as well as individual *workloads*, where a workload may be an individual application or an entire VM or operating system with its applications.</span></span> <span data-ttu-id="4573b-207">可以复制任何应用程序工作负载, 但网站恢复具有对许多 Microsoft 服务器应用程序的第一类集成支持, 如 SQL server 和 SharePoint 以及 SAP 等第三方应用程序。</span><span class="sxs-lookup"><span data-stu-id="4573b-207">Any application workload can be replicated, but Site Recovery has first-class integrated support for many Microsoft server applications, such as SQL Server and SharePoint, as well as a handful of third-party applications like SAP.</span></span>

<span data-ttu-id="4573b-208">在 vm 或物理服务器上运行的任何应用程序都应至少调查 Azure Site Recovery 的使用。</span><span class="sxs-lookup"><span data-stu-id="4573b-208">Any app that runs on VMs or physical servers should at least investigate the use of Azure Site Recovery.</span></span> <span data-ttu-id="4573b-209">这是发现和探索过程恢复的方案和可能性的一种非常好的方法。</span><span class="sxs-lookup"><span data-stu-id="4573b-209">It's a great way to discover and explore scenarios and possibilities for process recovery.</span></span>

#### <a name="service-specific-features"></a><span data-ttu-id="4573b-210">特定于服务的功能</span><span class="sxs-lookup"><span data-stu-id="4573b-210">Service-specific features</span></span>

<span data-ttu-id="4573b-211">对于在 Azure PaaS 产品 (如应用服务) 上运行的应用程序, 大多数此类服务提供了支持灾难恢复的功能和指南。</span><span class="sxs-lookup"><span data-stu-id="4573b-211">For apps that run on Azure PaaS offerings like App Service, most such services offer features and guidance for supporting disaster recovery.</span></span> <span data-ttu-id="4573b-212">在某些情况下, 您可以使用特定于服务的功能来支持快速恢复。</span><span class="sxs-lookup"><span data-stu-id="4573b-212">For certain scenarios, you can use service-specific features to support fast recovery.</span></span> <span data-ttu-id="4573b-213">例如, Azure SQL Server 支持异地复制以在另一个区域中快速还原服务。</span><span class="sxs-lookup"><span data-stu-id="4573b-213">For example, Azure SQL Server supports geo-replication for quickly restoring service in another region.</span></span> <span data-ttu-id="4573b-214">azure 应用服务具有备份和还原功能, 并且文档包含有关使用 Azure 流量管理器支持到辅助区域的路由流量的指南。</span><span class="sxs-lookup"><span data-stu-id="4573b-214">Azure App Service has a Backup and Restore feature, and the documentation includes guidance for using Azure Traffic Manager to support routing traffic to a secondary region.</span></span>

![显示单个数据中心的地理位置中的区域对的插图。](../media/AzRegionPairs.png)

## <a name="testing-a-disaster-recovery-plan"></a><span data-ttu-id="4573b-216">测试灾难恢复计划</span><span class="sxs-lookup"><span data-stu-id="4573b-216">Testing a disaster recovery plan</span></span>

<span data-ttu-id="4573b-217">一旦准备好了计划, 灾难恢复规划就不会结束。</span><span class="sxs-lookup"><span data-stu-id="4573b-217">Disaster recovery planning doesn't end once you have a completed plan in hand.</span></span> <span data-ttu-id="4573b-218">测试计划是灾难恢复的一个关键方面, 以确保说明和说明清楚且最新。</span><span class="sxs-lookup"><span data-stu-id="4573b-218">Testing the plan is a crucial aspect of disaster recovery, to ensure that the directions and explanations are clear and up-to-date.</span></span>

<span data-ttu-id="4573b-219">选择每隔6个月执行不同类型和测试范围的间隔, 如每月测试备份和故障转移机制, 并执行完全规模的灾难恢复模拟。</span><span class="sxs-lookup"><span data-stu-id="4573b-219">Choose intervals to perform different types and scopes of tests, such as testing backups and failover mechanisms every month, and performing a full-scale disaster recovery simulation every six months.</span></span> <span data-ttu-id="4573b-220">始终按照在计划中记录的步骤和详细信息中的说明操作, 并考虑让不熟悉计划的人对任何可能变得更清楚的内容进行学习。</span><span class="sxs-lookup"><span data-stu-id="4573b-220">Always follow the steps and details exactly as they're documented in the plan, and consider having someone unfamiliar with the plan give perspective on anything that could be made clearer.</span></span> <span data-ttu-id="4573b-221">在执行测试时, 请确定差距、改进的领域以及实现自动化的位置, 并将这些增强功能添加到您的计划中。</span><span class="sxs-lookup"><span data-stu-id="4573b-221">As you execute the test, identify gaps, areas of improvement, and places to automate and add these enhancements to your plan.</span></span>

<span data-ttu-id="4573b-222">此外, 请务必在测试中包含监视系统。</span><span class="sxs-lookup"><span data-stu-id="4573b-222">Make sure to include your monitoring system in your testing as well.</span></span> <span data-ttu-id="4573b-223">例如, 如果您的应用程序支持自动故障转移, 则在依赖项或其他关键组件中引入故障, 以确保应用程序的行为正确端到端, 包括检测到故障并触发自动故障.</span><span class="sxs-lookup"><span data-stu-id="4573b-223">For example, if your application supports automated failover, introduce failures in a dependency or other critical component to ensure that the application behaves correctly end-to-end, including detection of the failure and triggering of the automated failover.</span></span>

 <span data-ttu-id="4573b-224">通过仔细确定您的要求并布置计划, 您将能够确定需要使用哪些类型的服务来满足您的恢复目标。</span><span class="sxs-lookup"><span data-stu-id="4573b-224">By carefully identifying your requirements and laying out a plan, you'll be able to determine what types of services you'll need to use to meet your recovery objectives.</span></span> <span data-ttu-id="4573b-225">Azure 提供了多种服务和功能, 可帮助您实现这些目标。</span><span class="sxs-lookup"><span data-stu-id="4573b-225">Azure provides several services and features to help you meet these objectives.</span></span>
