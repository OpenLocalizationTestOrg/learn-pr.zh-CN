确保电子商务方案 (如您的电子商务) 中的丰富用户体验需要高可用性和低延迟。

通过在您创建的 Azure Cosmos DB 帐户上启用多主机支持, 这两个性能方面有多大好处, 并且所有好处都是由 Azure Cosmos 提供的财务支持的服务级别协议 (sla) 保证的。db-25.

## <a name="what-is-multi-master-support"></a>什么是多主机支持？

多主支持是可在新的 Azure Cosmos DB 帐户上启用的选项。 在多个区域中复制帐户后, 每个区域都是一个主区域, 该区域同样参与到一个写入式模型 (也称为主动活动模式)。

在多主配置中作为主区域运行的 Azure Cosmos DB 区域可自动聚合写入所有副本的数据, 并确保全局一致性和数据完整性。

使用 Azure Cosmos DB 多主机支持, 可以在世界范围内对已启用的区域中的任何容器执行写入操作。 写入的数据将立即传播到所有其他区域。  

## <a name="what-are-the-benefits-of-multi-master-support"></a>多主机支持的好处是什么？

多主机支持的好处包括:

* 一位数的写入延迟-多主帐户的写入延迟为 <10 ms, 99% 的写入延迟为非多主帐户的 <15 毫秒。
* 99.999% 读写可用性-写入可用性多主帐户将从 99.99% 增加到 99.999%, 而非多主机帐户。
* 无限制的写入可伸缩性和吞吐量–使用多主机帐户, 可以对每个区域进行写入, 提供无限制的写入可伸缩性和吞吐量以支持数十亿个设备。
* 内置冲突解决方案–多主帐户具有解决冲突的三种方法, 以确保全局数据完整性和一致性。

## <a name="conflict-resolution"></a>冲突解决

添加多主机支持后, 可能会遇到对不同区域进行写入的冲突。 冲突在 Azure Cosmos DB 中很少发生, 并且仅当在多个区域中同时更改项目时才会发生冲突, 在这些区域之间发生传播之前。 鉴于复制在全球范围内发生的速度, 您不应经常遇到冲突 (如果有的话)。 但是, Azure Cosmos DB 提供了冲突解决模式, 使用户能够决定如何处理在两个或更多区域中的不同编写器同时更新同一记录的情况。  

Azure Cosmos DB 提供了三种冲突解决模式。

* **最后一个编写器-Wins (LWW)**, 其中根据文档中用户定义的 integer 属性的值解析冲突。 默认情况下, _ts 用于确定上次写入的文档。 最后一个作者-Wins 是默认的冲突处理机制。
* **自定义用户定义的函数**, 可在其中通过向集合注册用户定义函数来完全控制冲突解决方法。 用户定义函数是一种特殊类型的存储过程, 具有特定的签名。 如果用户定义的函数失败或不存在, 则 Azure Cosmos DB 会将所有冲突添加到只读冲突源中, 它们可以异步处理。  
* **自定义-异步**, 其中 Azure Cosmos DB 排除所有冲突的提交并在只读冲突源中注册它们, 以供用户的应用程序延迟解析。 应用程序可以异步执行冲突解决, 并使用任何逻辑或引用任何外部源、应用程序或服务来解决冲突。

## <a name="summary"></a>摘要

在此单元中, 您了解了多主帐户, 使您能够将数据写入多个区域以提高可用性和性能。