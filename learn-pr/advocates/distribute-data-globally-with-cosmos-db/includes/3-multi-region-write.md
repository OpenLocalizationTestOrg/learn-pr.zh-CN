<span data-ttu-id="eeffb-101">确保电子商务方案 (如您的电子商务) 中的丰富用户体验需要高可用性和低延迟。</span><span class="sxs-lookup"><span data-stu-id="eeffb-101">Assuring a great user experience in an e-commerce scenario such as yours requires high availability and low latency.</span></span>

<span data-ttu-id="eeffb-102">通过在您创建的 Azure Cosmos DB 帐户上启用多主机支持, 这两个性能方面有多大好处, 并且所有好处都是由 Azure Cosmos 提供的财务支持的服务级别协议 (sla) 保证的。db-25.</span><span class="sxs-lookup"><span data-stu-id="eeffb-102">By enabling multi-master support on the Azure Cosmos DB account you created, there are multiple benefits to both of these performance aspects, and all of the benefits are guaranteed by the financially backed service level agreements (SLAs) provided by Azure Cosmos DB.</span></span>

## <a name="what-is-multi-master-support"></a><span data-ttu-id="eeffb-103">什么是多主机支持？</span><span class="sxs-lookup"><span data-stu-id="eeffb-103">What is multi-master support?</span></span>

<span data-ttu-id="eeffb-104">多主支持是可在新的 Azure Cosmos DB 帐户上启用的选项。</span><span class="sxs-lookup"><span data-stu-id="eeffb-104">Multi-master support is an option that can be enabled on new Azure Cosmos DB accounts.</span></span> <span data-ttu-id="eeffb-105">在多个区域中复制帐户后, 每个区域都是一个主区域, 该区域同样参与到一个写入式模型 (也称为主动活动模式)。</span><span class="sxs-lookup"><span data-stu-id="eeffb-105">Once the account is replicated in multiple regions, each region is a master region that equally participates in a write-anywhere model, also known as an active-active pattern.</span></span>

<span data-ttu-id="eeffb-106">在多主配置中作为主区域运行的 Azure Cosmos DB 区域可自动聚合写入所有副本的数据, 并确保全局一致性和数据完整性。</span><span class="sxs-lookup"><span data-stu-id="eeffb-106">Azure Cosmos DB regions operating as master regions in a multi-master configuration automatically work to converge data written to all replicas and ensure global consistency and data integrity.</span></span>

<span data-ttu-id="eeffb-107">使用 Azure Cosmos DB 多主机支持, 可以在世界范围内对已启用的区域中的任何容器执行写入操作。</span><span class="sxs-lookup"><span data-stu-id="eeffb-107">With Azure Cosmos DB multi-master support, you can perform writes on any container in a write-enabled region world-wide.</span></span> <span data-ttu-id="eeffb-108">写入的数据将立即传播到所有其他区域。</span><span class="sxs-lookup"><span data-stu-id="eeffb-108">Written data is propagated to all other regions immediately.</span></span>  

## <a name="what-are-the-benefits-of-multi-master-support"></a><span data-ttu-id="eeffb-109">多主机支持的好处是什么？</span><span class="sxs-lookup"><span data-stu-id="eeffb-109">What are the benefits of multi-master support?</span></span>

<span data-ttu-id="eeffb-110">多主机支持的好处包括:</span><span class="sxs-lookup"><span data-stu-id="eeffb-110">The benefits of multi-master support are:</span></span>

* <span data-ttu-id="eeffb-111">一位数的写入延迟-多主帐户的写入延迟为 <10 ms, 99% 的写入延迟为非多主帐户的 <15 毫秒。</span><span class="sxs-lookup"><span data-stu-id="eeffb-111">Single-digit write latency – Multi-master accounts have an improved write latency of <10 ms for 99% of writes, up from <15 ms for non-multi-master accounts.</span></span>
* <span data-ttu-id="eeffb-112">99.999% 读写可用性-写入可用性多主帐户将从 99.99% 增加到 99.999%, 而非多主机帐户。</span><span class="sxs-lookup"><span data-stu-id="eeffb-112">99.999% read-write availability - The write availability multi-master accounts increases to 99.999%, up from the 99.99% for non-multi-master accounts.</span></span>
* <span data-ttu-id="eeffb-113">无限制的写入可伸缩性和吞吐量–使用多主机帐户, 可以对每个区域进行写入, 提供无限制的写入可伸缩性和吞吐量以支持数十亿个设备。</span><span class="sxs-lookup"><span data-stu-id="eeffb-113">Unlimited write scalability and throughput – With multi-master accounts, you can write to every region, providing unlimited write scalability and throughput to support billions of devices.</span></span>
* <span data-ttu-id="eeffb-114">内置冲突解决方案–多主帐户具有解决冲突的三种方法, 以确保全局数据完整性和一致性。</span><span class="sxs-lookup"><span data-stu-id="eeffb-114">Built-in conflict resolution – Multi-master accounts have three methods for resolving conflicts to ensure global data integrity and consistency.</span></span>

## <a name="conflict-resolution"></a><span data-ttu-id="eeffb-115">冲突解决</span><span class="sxs-lookup"><span data-stu-id="eeffb-115">Conflict resolution</span></span>

<span data-ttu-id="eeffb-116">添加多主机支持后, 可能会遇到对不同区域进行写入的冲突。</span><span class="sxs-lookup"><span data-stu-id="eeffb-116">With the addition of multi-master support comes the possibility of encountering conflicts for writes to different regions.</span></span> <span data-ttu-id="eeffb-117">冲突在 Azure Cosmos DB 中很少发生, 并且仅当在多个区域中同时更改项目时才会发生冲突, 在这些区域之间发生传播之前。</span><span class="sxs-lookup"><span data-stu-id="eeffb-117">Conflicts are rare in Azure Cosmos DB and can only occur when an item is simultaneously changed in multiple regions, before propagation between the regions has happened.</span></span> <span data-ttu-id="eeffb-118">鉴于复制在全球范围内发生的速度, 您不应经常遇到冲突 (如果有的话)。</span><span class="sxs-lookup"><span data-stu-id="eeffb-118">Given the speed with which replication happens globally, you should not experience conflicts often, if at all.</span></span> <span data-ttu-id="eeffb-119">但是, Azure Cosmos DB 提供了冲突解决模式, 使用户能够决定如何处理在两个或更多区域中的不同编写器同时更新同一记录的情况。</span><span class="sxs-lookup"><span data-stu-id="eeffb-119">However, Azure Cosmos DB does provide conflict resolution modes that allow users to decide how to handle scenarios where the same record is updated simultaneously by different writers in two or more regions.</span></span>  

<span data-ttu-id="eeffb-120">Azure Cosmos DB 提供了三种冲突解决模式。</span><span class="sxs-lookup"><span data-stu-id="eeffb-120">There are three conflict resolution modes offered by Azure Cosmos DB.</span></span>

* <span data-ttu-id="eeffb-121">**最后一个编写器-Wins (LWW)**, 其中根据文档中用户定义的 integer 属性的值解析冲突。</span><span class="sxs-lookup"><span data-stu-id="eeffb-121">**Last-Writer-Wins (LWW)**, in which conflicts are resolved based on the value of a user-defined integer property in the document.</span></span> <span data-ttu-id="eeffb-122">默认情况下, _ts 用于确定上次写入的文档。</span><span class="sxs-lookup"><span data-stu-id="eeffb-122">By default _ts is used to determine the last written document.</span></span> <span data-ttu-id="eeffb-123">最后一个作者-Wins 是默认的冲突处理机制。</span><span class="sxs-lookup"><span data-stu-id="eeffb-123">Last-Writer-Wins is the default conflict handling mechanism.</span></span>
* <span data-ttu-id="eeffb-124">**自定义用户定义的函数**, 可在其中通过向集合注册用户定义函数来完全控制冲突解决方法。</span><span class="sxs-lookup"><span data-stu-id="eeffb-124">**Custom - User-defined function**, in which you can fully control conflict resolution by registering a User-defined function to the collection.</span></span> <span data-ttu-id="eeffb-125">用户定义函数是一种特殊类型的存储过程, 具有特定的签名。</span><span class="sxs-lookup"><span data-stu-id="eeffb-125">A User-defined function is a special type of stored procedure with a specific signature.</span></span> <span data-ttu-id="eeffb-126">如果用户定义的函数失败或不存在, 则 Azure Cosmos DB 会将所有冲突添加到只读冲突源中, 它们可以异步处理。</span><span class="sxs-lookup"><span data-stu-id="eeffb-126">If the User-defined function fails or does not exist, Azure Cosmos DB will add all conflicts into the read-only conflicts feed they can be processed asynchronously.</span></span>  
* <span data-ttu-id="eeffb-127">**自定义-异步**, 其中 Azure Cosmos DB 排除所有冲突的提交并在只读冲突源中注册它们, 以供用户的应用程序延迟解析。</span><span class="sxs-lookup"><span data-stu-id="eeffb-127">**Custom - Async**, in which Azure Cosmos DB excludes all conflicts from being committed and registers them in the read-only conflicts feed for deferred resolution by the user’s application.</span></span> <span data-ttu-id="eeffb-128">应用程序可以异步执行冲突解决, 并使用任何逻辑或引用任何外部源、应用程序或服务来解决冲突。</span><span class="sxs-lookup"><span data-stu-id="eeffb-128">The application can perform conflict resolution asynchronously and use any logic or refer to any external source, application, or service to resolve the conflict.</span></span>

## <a name="summary"></a><span data-ttu-id="eeffb-129">摘要</span><span class="sxs-lookup"><span data-stu-id="eeffb-129">Summary</span></span>

<span data-ttu-id="eeffb-130">在此单元中, 您了解了多主帐户, 使您能够将数据写入多个区域以提高可用性和性能。</span><span class="sxs-lookup"><span data-stu-id="eeffb-130">In this unit, you learned about multi-master accounts, which enable you to write data to multiple regions for improved availability and performance.</span></span>