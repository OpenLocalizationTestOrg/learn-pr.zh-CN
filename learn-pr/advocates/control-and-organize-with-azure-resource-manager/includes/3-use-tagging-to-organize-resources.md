你已经完成了资源, 并将其移动到了比以前更多的组织的资源组中。 但如果资源有多个用途, 该怎么办？ 如何更好地搜索、筛选和组织这些资源？ 在您希望改进 Azure 资源的组织时, 标记可能非常有用。

## <a name="what-are-tags"></a>什么是标记？

标记是可应用于资源和资源组的文本数据的名称/值对。 标记允许您关联资源的自定义详细信息, 以及资源具有的标准 Azure 属性:

- 部门 (财务、市场营销等)
- 环境 (生产、测试、开发)、
- 成本中心
- 生命周期和自动化 (例如, 关闭和启动虚拟机)。

一个资源最长可包含15个标记。 对于除存储帐户之外的所有类型的资源, 名称限制为512个字符, 最多可包含128个字符。 对于所有类型的资源, tag 值限制为256个字符。 标记不是从父资源继承的。 并非所有资源类型都支持标记, 并且标记不能应用于经典资源。

可以通过 azure 门户、azure CLI、azure PowerShell、资源管理器模板和 REST API 添加和操作标记。 例如, 若要使用 Azure CLI 将资源标记添加到虚拟网络, 可以使用以下命令:

```azurecli
az resource tag --tags Department=Finance \
       -g msftlearn-core-infrastructure-rg \
       -name msftlearn-vnet1 \
       --resource-type "Microsoft.Network/virtualNetworks"
```

此外, 还可以利用 Azure 策略根据诸如创建资源的用户或创建的资源类型等条件, 将标记添加到创建的资源。 例如, 可以添加标记以标识成本中心或在其中创建资源的特定环境。

## <a name="apply-tags-to-resources"></a>将标签应用于资源

让我们将一些标签应用于您创建的资源。 回想一下, 我们在资源组**msftlearn-vnet1**和**msftlearn-vnet2**中创建了一个资源组**msftlearn-core-rg**和两个 vnet。 vnet 的名称是相对常规的, 因此, 我们希望将 vnet 与来自不同部门的服务相关联。 

1. 继续执行并提起[Azure 门户](https://portal.azure.com/?azure-portal=true)。 导航到 "msftlearn"-"**基础结构-rg** " 资源组。

1. 在资源组的 "**概述**" 选项卡上, 您应看到两个 vnet 列出。 默认视图不显示 "标记" 列, 因此, 让我们将其添加到显示中。 选择顶部的 "**编辑列**"。 在 "**可用列**" 列表中**** , 选择 " **->** 标记", 然后单击以将其添加到 "**选定的列**" 列表中。 单击 "**应用**" 以应用所做的更改。

    ![演示如何将 "标签" 列添加到显示中的门户图像](../media/3-add-tag-column.PNG)

1. 现在, 您应该会看到 "标记" 列, 但它是空的, 因为我们尚未添加任何标记。 我们将直接在此处添加标记。 您还可以在资源的 "**标签**" 面板上向支持它的任何资源中添加标记。 在资源列表中, 您应该会在 "**标签**" 列中看到一个铅笔, 您可以在其中直接编辑标签。 单击**msftlearn-vnet1**资源的铅笔。

1. 这将显示用于编辑标签的对话框。 让我们将几个标记添加到此 VNet。 在 "**名称**框类型"**部门**中, 在 "**值**" 框中键入 "**财务**"。 单击 "**保存**" 以保存所做的更改, 然后单击 "**关闭**" 关闭该对话框。

    ![显示对话框以添加标记的门户图像](../media/3-add-tag-1.PNG)

1. 让我们为**msftlearn-vnet2** VNet 执行相同的步骤。 对于此 VNet, 请将 "**部门: 营销**" 标记添加到资源。

    您现在应该会看到应用于每个资源的标记。

    ![显示包含标记的资源的门户的图像](../media/3-tags-displayed.PNG)

1. 让我们批量为这两个资源添加标记。 选中每个 vnet 左侧的复选框, 然后在顶部菜单中单击 "**分配标签**"。 通过选择多个资源, 我们可以批量向其添加标记, 以便在有多个资源要对其应用相同标记的情况下轻松地向其添加标记。

    将 "**环境: 培训**" 标记添加到资源。 您应该会在对话框中看到将应用于每个 vnet 的标记。

    ![显示用于批量添加标签的对话框的门户图像](../media/3-add-bulk-tag.PNG)

    返回到资源列表现在, 您将看到一个**2**显示, 因为我们现在对每个资源应用了两个标记。

1. 我们来看看如何使用标记来筛选你的资源。 在左侧的主 Azure 菜单上, 选择 "**所有资源**"。

1. 在 "**所有标记**" 下拉下的 "**环境**选择**培训**" 下。 您应该只会看到显示的两个 vnet, 因为我们已使用 "**环境: 培训**" 标记对这些资源进行了标记。

    ![在培训标记上筛选出的所有资源的图像](../media/3-all-resources-tag-filter.PNG)

1. 此外, 我们还可以通过对 "**部门: 财务**" 或 "**部门: 营销**标记" 进行进一步筛选来进一步筛选这些内容。

## <a name="use-tags-for-organization"></a>使用组织的标记

上面的示例只是一个示例, 您可以在其中使用标记来组织资源。 通过其灵活性, 可以通过多种方式使用标记来提高优势。

您可以使用标记对帐单数据进行分组。 例如, 如果您正在为不同的组织运行多个虚拟机, 请使用标记按成本中心对使用进行分组。 您还可以使用标记按运行时环境对成本进行分类, 例如在生产环境中运行的 vm 的记帐使用情况。 在导出帐单数据或通过计费 api 访问它时, 这些标记将包含在该数据中, 并可用于从成本角度进一步切分您的数据。

您可以使用特定的标记名称或值检索订阅中的所有资源。 标记使您能够从不同的资源组中检索相关资源。 当您需要组织资源以进行计费或管理时, 此方法非常有用。

标记资源还可以帮助监视跟踪受影响的资源。 监视系统可能包含带警报的标记数据, 使您能够准确知道受影响的用户。 在上面的示例中, 我们将 "**部门: 财务**" 标记应用到**msftlearn-vnet1**资源。 如果在**msftlearn-vnet1**上引发了警报, 并且警报包含了标记, 我们就会知道财务部门可能会受到触发警报的条件的影响。 如果出现问题, 则此上下文信息可能非常有用。

此外, 在自动化中使用标记也是很常见的。 如果要在非工作时间内自动关闭和启动虚拟机, 以节省成本, 可以使用标记来协助实现。 将**shutdown:** **7AM**标记添加到虚拟机, 然后创建一个查找这些标记的自动化作业, 并根据标记值将其关闭或启动它们。 Azure 自动化 runbook 库中有几个解决方案, 这些解决方案使用标记的方式类似于实现此目的。
