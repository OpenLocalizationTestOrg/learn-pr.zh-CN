在最近的对话中, 你的经理已提到, 已错误地删除了关键 Azure 资源的一些实例。 由于在其 Azure 环境中有 disorganization, 因此, 清理不必要的资源会导致意外删除。 您听说过 Azure 上的资源锁。 你向你的经理表明你认为可以帮助防止将来发生此类事件。 我们来看看如何使用资源锁定来解决此问题。

## <a name="what-are-resource-locks"></a>什么是资源锁定？

资源锁定是一种设置, 可应用于任何资源以阻止修改或删除。 资源锁定可设置为**删除**或**只读**。 删除操作将允许对资源进行所有操作, 但会阻止删除该资源的功能。 **只读**将只允许对其执行读活动, 阻止对资源进行任何修改或删除。 资源锁定可应用于订阅、资源组和各个资源, 并在更高级别应用时进行继承。

> [!NOTE]
> 应用**只读**可能会导致意外的结果, 因为像读操作这样的某些操作实际上需要其他操作。 例如, 将只读锁定放在存储帐户上可阻止所有用户列出密钥。 通过 POST 请求处理列表键操作, 因为返回的键可用于写入操作。

应用资源锁定时, 必须先删除锁定, 才能执行该活动。 通过在允许对资源执行操作之前放置额外的步骤, 可帮助保护资源不受无意操作的攻击, 并帮助您的管理员避免执行可能不打算执行的操作。 无论 RBAC 权限如何, 都将应用资源锁定。 即使您是资源的所有者, 仍必须删除锁定, 然后才能实际执行阻止的活动。

我们来看看资源锁定的工作方式。

## <a name="create-a-resource-lock"></a>创建资源锁定

回想一下我们的**msftlearn-rg**资源组。 现在, 我们在其中获取了两个 vnet 和一个存储帐户。 我们认为这些资源是 Azure 环境的关键部分, 并希望确保它们不会被错误删除。 让我们对资源组应用资源锁定, 以防止删除资源组及其包含的资源。

1. 如果你还没有, 请继续在 web 浏览器中提取[Azure 门户](https://portal.azure.com/?azure-portal=true)(如果尚不存在)。 在顶部导航栏的搜索框中, 搜索 msftlearn- **rg-rg**并单击资源组。

1. 在左侧菜单的 "**设置**" 部分中, 选择 "**锁定**"。 您应该会看到资源当前没有锁定。 让我们添加一个。

1. 单击 " **+ 添加**"。 将锁定命名为 " **BlockDeletion** ", 然后选择 "**删除**" 的**锁定类型**。 单击"确定"。

    ![显示正在配置的新资源锁定的门户的图像](../media/6-add-lock.PNG)

    现在, 您已将锁定应用于将阻止删除资源组的资源组, 并由资源组中的所有资源继承。 让我们尝试删除其中一个 vnet, 以查看发生的情况。

1. 返回到 "**概述**", 然后单击 " **msftlearn"-"vnet1** " 以查看资源。

1. 在**msftlearn-vnet1**的**概述**窗格中, 单击顶部的 "**删除**", 然后单击 **"是"** 确认。 您应该会收到一条错误消息, 指出资源的锁定阻止了其删除。

    ![阻止删除资源的错误的图像](../media/6-delete-error.PNG)

1. 在左侧菜单的 "**设置**" 部分中, 选择 "**锁定**"。 您应该会看到, 我们的**msftlearn-vnet1**具有一个从资源组继承的锁定。

1. 导航回 msftlearn- **rg**资源组, 并显示 "**锁定**" 窗格。 我们来删除我们的锁定, 以便我们能够进行清理。 在**BlockDeletion**锁定处单击 " **...** ", 然后选择 "**删除**"。

## <a name="using-resource-locks-in-practice"></a>在实践中使用资源锁定

我们已了解资源锁定如何保护以防止意外删除。 为了删除虚拟网络, 我们需要删除该锁定。 此 concerted 操作可帮助确保您确实要删除或修改有问题的资源。

使用资源锁可保护那些在删除或修改时可能会产生重大影响的 Azure 关键部件。 一些示例是 ExpressRoute 电路、虚拟网络、关键数据库和域控制器。 评估你的资源, 并应用你希望从意外操作中获得额外保护层的锁。
