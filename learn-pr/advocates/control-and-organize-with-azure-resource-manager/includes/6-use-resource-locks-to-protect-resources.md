<span data-ttu-id="f595b-101">在最近的对话中, 你的经理已提到, 已错误地删除了关键 Azure 资源的一些实例。</span><span class="sxs-lookup"><span data-stu-id="f595b-101">In a recent conversation, your manager mentioned that there had been instances where critical Azure resources had been mistakenly deleted.</span></span> <span data-ttu-id="f595b-102">由于在其 Azure 环境中有 disorganization, 因此, 清理不必要的资源会导致意外删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-102">Since there was disorganization across their Azure environment, some good intentions of cleaning up unnecessary resources resulted in accidental deletion.</span></span> <span data-ttu-id="f595b-103">您听说过 Azure 上的资源锁。</span><span class="sxs-lookup"><span data-stu-id="f595b-103">You've heard of resource locks on Azure.</span></span> <span data-ttu-id="f595b-104">你向你的经理表明你认为可以帮助防止将来发生此类事件。</span><span class="sxs-lookup"><span data-stu-id="f595b-104">You mention to your manager that you think you can help prevent this type of incident from happening in the future.</span></span> <span data-ttu-id="f595b-105">我们来看看如何使用资源锁定来解决此问题。</span><span class="sxs-lookup"><span data-stu-id="f595b-105">Let's take a look at how you could use resource locks to solve this problem.</span></span>

## <a name="what-are-resource-locks"></a><span data-ttu-id="f595b-106">什么是资源锁定？</span><span class="sxs-lookup"><span data-stu-id="f595b-106">What are resource locks?</span></span>

<span data-ttu-id="f595b-107">资源锁定是一种设置, 可应用于任何资源以阻止修改或删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-107">Resource locks are a setting that can be applied to any resource to block modification or deletion.</span></span> <span data-ttu-id="f595b-108">资源锁定可设置为**删除**或**只读**。</span><span class="sxs-lookup"><span data-stu-id="f595b-108">Resource locks can set to either **Delete** or **Read-only**.</span></span> <span data-ttu-id="f595b-109">删除操作将允许对资源进行所有操作, 但会阻止删除该资源的功能。</span><span class="sxs-lookup"><span data-stu-id="f595b-109">Delete will allow all operations against the resource but block the ability to delete it.</span></span> <span data-ttu-id="f595b-110">**只读**将只允许对其执行读活动, 阻止对资源进行任何修改或删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-110">**Read-only** will only allow read activities to be performed against it, blocking any modification or deletion of the resource.</span></span> <span data-ttu-id="f595b-111">资源锁定可应用于订阅、资源组和各个资源, 并在更高级别应用时进行继承。</span><span class="sxs-lookup"><span data-stu-id="f595b-111">Resource locks can be applied to subscriptions, resource groups, and to individual resources, and are inherited when applied at higher levels.</span></span>

> [!NOTE]
> <span data-ttu-id="f595b-112">应用**只读**可能会导致意外的结果, 因为像读操作这样的某些操作实际上需要其他操作。</span><span class="sxs-lookup"><span data-stu-id="f595b-112">Applying **Read-only** can lead to unexpected results because some operations that seem like read operations actually require additional actions.</span></span> <span data-ttu-id="f595b-113">例如, 将只读锁定放在存储帐户上可阻止所有用户列出密钥。</span><span class="sxs-lookup"><span data-stu-id="f595b-113">For example, placing a Read-only lock on a storage account prevents all users from listing the keys.</span></span> <span data-ttu-id="f595b-114">通过 POST 请求处理列表键操作, 因为返回的键可用于写入操作。</span><span class="sxs-lookup"><span data-stu-id="f595b-114">The list keys operation is handled through a POST request because the returned keys are available for write operations.</span></span>

<span data-ttu-id="f595b-115">应用资源锁定时, 必须先删除锁定, 才能执行该活动。</span><span class="sxs-lookup"><span data-stu-id="f595b-115">When a resource lock is applied, you must first remove the lock in order to perform that activity.</span></span> <span data-ttu-id="f595b-116">通过在允许对资源执行操作之前放置额外的步骤, 可帮助保护资源不受无意操作的攻击, 并帮助您的管理员避免执行可能不打算执行的操作。</span><span class="sxs-lookup"><span data-stu-id="f595b-116">By putting an additional step in place before allowing the action to be taken on the resource, it helps protect resources from inadvertent actions, and helps protect your administrators from doing something they may not have intended to do.</span></span> <span data-ttu-id="f595b-117">无论 RBAC 权限如何, 都将应用资源锁定。</span><span class="sxs-lookup"><span data-stu-id="f595b-117">Resource locks apply regardless of RBAC permissions.</span></span> <span data-ttu-id="f595b-118">即使您是资源的所有者, 仍必须删除锁定, 然后才能实际执行阻止的活动。</span><span class="sxs-lookup"><span data-stu-id="f595b-118">Even if you are an owner of the resource, you must still remove the lock before you'll actually be able to perform the blocked activity.</span></span>

<span data-ttu-id="f595b-119">我们来看看资源锁定的工作方式。</span><span class="sxs-lookup"><span data-stu-id="f595b-119">Let's take a look at how a resource lock works in action.</span></span>

## <a name="create-a-resource-lock"></a><span data-ttu-id="f595b-120">创建资源锁定</span><span class="sxs-lookup"><span data-stu-id="f595b-120">Create a resource lock</span></span>

<span data-ttu-id="f595b-121">回想一下我们的**msftlearn-rg**资源组。</span><span class="sxs-lookup"><span data-stu-id="f595b-121">Recall our **msftlearn-core-infrastructure-rg** resource group.</span></span> <span data-ttu-id="f595b-122">现在, 我们在其中获取了两个 vnet 和一个存储帐户。</span><span class="sxs-lookup"><span data-stu-id="f595b-122">We've now got two VNets and a storage account in them.</span></span> <span data-ttu-id="f595b-123">我们认为这些资源是 Azure 环境的关键部分, 并希望确保它们不会被错误删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-123">We consider these resources to be critical pieces of our Azure environment, and want to ensure that they aren't mistakenly deleted.</span></span> <span data-ttu-id="f595b-124">让我们对资源组应用资源锁定, 以防止删除资源组及其包含的资源。</span><span class="sxs-lookup"><span data-stu-id="f595b-124">Let's apply a resource lock to the resource group to prevent the resource group and its contained resources from being deleted.</span></span>

1. <span data-ttu-id="f595b-125">如果你还没有, 请继续在 web 浏览器中提取[Azure 门户](https://portal.azure.com/?azure-portal=true)(如果尚不存在)。</span><span class="sxs-lookup"><span data-stu-id="f595b-125">Go ahead and pull up the [Azure portal](https://portal.azure.com/?azure-portal=true) in a web browser if you haven't already.</span></span> <span data-ttu-id="f595b-126">在顶部导航栏的搜索框中, 搜索 msftlearn- **rg-rg**并单击资源组。</span><span class="sxs-lookup"><span data-stu-id="f595b-126">In the search box in the top navigation bar, search for **msftlearn-core-infrastructure-rg** and click on the resource group.</span></span>

1. <span data-ttu-id="f595b-127">在左侧菜单的 "**设置**" 部分中, 选择 "**锁定**"。</span><span class="sxs-lookup"><span data-stu-id="f595b-127">In the **Settings** section in the left menu, select **Locks**.</span></span> <span data-ttu-id="f595b-128">您应该会看到资源当前没有锁定。</span><span class="sxs-lookup"><span data-stu-id="f595b-128">You should see that the resource currently has no locks.</span></span> <span data-ttu-id="f595b-129">让我们添加一个。</span><span class="sxs-lookup"><span data-stu-id="f595b-129">Let's add one.</span></span>

1. <span data-ttu-id="f595b-130">单击 " **+ 添加**"。</span><span class="sxs-lookup"><span data-stu-id="f595b-130">Click **+ Add**.</span></span> <span data-ttu-id="f595b-131">将锁定命名为 " **BlockDeletion** ", 然后选择 "**删除**" 的**锁定类型**。</span><span class="sxs-lookup"><span data-stu-id="f595b-131">Name the lock **BlockDeletion** and select a **Lock type** of **Delete**.</span></span> <span data-ttu-id="f595b-132">单击"确定"。</span><span class="sxs-lookup"><span data-stu-id="f595b-132">Click **OK**.</span></span>

    ![显示正在配置的新资源锁定的门户的图像](../media/6-add-lock.PNG)

    <span data-ttu-id="f595b-134">现在, 您已将锁定应用于将阻止删除资源组的资源组, 并由资源组中的所有资源继承。</span><span class="sxs-lookup"><span data-stu-id="f595b-134">You now have a lock applied to the resource group that will prevent deletion of the resource group, and is inherited by all resources within the resource group.</span></span> <span data-ttu-id="f595b-135">让我们尝试删除其中一个 vnet, 以查看发生的情况。</span><span class="sxs-lookup"><span data-stu-id="f595b-135">Let's try to delete one of the VNets to see what happens.</span></span>

1. <span data-ttu-id="f595b-136">返回到 "**概述**", 然后单击 " **msftlearn"-"vnet1** " 以查看资源。</span><span class="sxs-lookup"><span data-stu-id="f595b-136">Go back to **Overview**, and click on **msftlearn-vnet1** to view the resource.</span></span>

1. <span data-ttu-id="f595b-137">在**msftlearn-vnet1**的**概述**窗格中, 单击顶部的 "**删除**", 然后单击 **"是"** 确认。</span><span class="sxs-lookup"><span data-stu-id="f595b-137">In the **Overview** pane for **msftlearn-vnet1**, click **Delete** at the top, then **Yes** to confirm.</span></span> <span data-ttu-id="f595b-138">您应该会收到一条错误消息, 指出资源的锁定阻止了其删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-138">You should receive an error, stating that there is a lock on the resource preventing its deletion.</span></span>

    ![阻止删除资源的错误的图像](../media/6-delete-error.PNG)

1. <span data-ttu-id="f595b-140">在左侧菜单的 "**设置**" 部分中, 选择 "**锁定**"。</span><span class="sxs-lookup"><span data-stu-id="f595b-140">In the **Settings** section in the left menu, select **Locks**.</span></span> <span data-ttu-id="f595b-141">您应该会看到, 我们的**msftlearn-vnet1**具有一个从资源组继承的锁定。</span><span class="sxs-lookup"><span data-stu-id="f595b-141">You should see here that our **msftlearn-vnet1** has a lock that is inherited by from the resource group.</span></span>

1. <span data-ttu-id="f595b-142">导航回 msftlearn- **rg**资源组, 并显示 "**锁定**" 窗格。</span><span class="sxs-lookup"><span data-stu-id="f595b-142">Navigate back to the **msftlearn-core-infrastructure-rg** resource group, and bring up the **Locks** pane.</span></span> <span data-ttu-id="f595b-143">我们来删除我们的锁定, 以便我们能够进行清理。</span><span class="sxs-lookup"><span data-stu-id="f595b-143">Let's remove our lock so we can clean up.</span></span> <span data-ttu-id="f595b-144">在**BlockDeletion**锁定处单击 " **...** ", 然后选择 "**删除**"。</span><span class="sxs-lookup"><span data-stu-id="f595b-144">Click the **...** on the **BlockDeletion** lock and select **Delete**.</span></span>

## <a name="using-resource-locks-in-practice"></a><span data-ttu-id="f595b-145">在实践中使用资源锁定</span><span class="sxs-lookup"><span data-stu-id="f595b-145">Using resource locks in practice</span></span>

<span data-ttu-id="f595b-146">我们已了解资源锁定如何保护以防止意外删除。</span><span class="sxs-lookup"><span data-stu-id="f595b-146">We've seen how resource locks can protect from accidental deletion.</span></span> <span data-ttu-id="f595b-147">为了删除虚拟网络, 我们需要删除该锁定。</span><span class="sxs-lookup"><span data-stu-id="f595b-147">In order to delete the virtual network, we needed to remove the lock.</span></span> <span data-ttu-id="f595b-148">此 concerted 操作可帮助确保您确实要删除或修改有问题的资源。</span><span class="sxs-lookup"><span data-stu-id="f595b-148">This concerted action helps ensure that you really intend to delete or modify the resource in question.</span></span>

<span data-ttu-id="f595b-149">使用资源锁可保护那些在删除或修改时可能会产生重大影响的 Azure 关键部件。</span><span class="sxs-lookup"><span data-stu-id="f595b-149">Use resource locks to protect those key pieces of Azure that could have a large impact if they were removed or modified.</span></span> <span data-ttu-id="f595b-150">一些示例是 ExpressRoute 电路、虚拟网络、关键数据库和域控制器。</span><span class="sxs-lookup"><span data-stu-id="f595b-150">Some examples are ExpressRoute circuits, and virtual networks, critical databases, and domain controllers.</span></span> <span data-ttu-id="f595b-151">评估你的资源, 并应用你希望从意外操作中获得额外保护层的锁。</span><span class="sxs-lookup"><span data-stu-id="f595b-151">Evaluate your resources, and apply locks where you'd like to have an extra layer of protection from accidental actions.</span></span>
